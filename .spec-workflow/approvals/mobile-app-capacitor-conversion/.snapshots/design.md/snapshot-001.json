{
  "id": "snapshot_1759496130012_aq71yhkqw",
  "approvalId": "approval_1759496130010_ucy7y5pai",
  "approvalTitle": "Design Document - Mobile App Technical Architecture",
  "version": 1,
  "timestamp": "2025-10-03T12:55:30.012Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Design Document\n\n## Overview\n\nThis design specifies the technical architecture for converting the Sacred Sutra Tools web application into a native mobile application using Capacitor 6. The conversion will maintain maximum code reuse (95%+) by wrapping the existing React + Material-UI web app in Capacitor's native container, while creating mobile-optimized component variants for enhanced mobile UX.\n\nThe architecture leverages Capacitor's web-to-native bridge to run the existing codebase on iOS and Android devices, with minimal modifications required to the core business logic, state management, or Firebase integration. The primary changes focus on: (1) adding Capacitor configuration and native projects, (2) integrating @capacitor-firebase plugins, (3) creating mobile-responsive UI variants, and (4) implementing mobile-specific navigation patterns.\n\n## Steering Document Alignment\n\n### Technical Standards (tech.md)\n\n**Component-Based Architecture**: The mobile conversion maintains the existing React 18 + Material-UI architecture, adding mobile-specific component variants within the established feature-based structure (e.g., `pages/todaysOrders/mobile/` subdirectories).\n\n**State Management**: Redux Toolkit slices remain unchanged, as Capacitor runs the same JavaScript runtime. Redux Persist will work identically on mobile for offline state persistence.\n\n**Firebase Integration**: Existing Firebase 11.6.1 services (Auth, Firestore, Storage) will be replaced with @capacitor-firebase/* plugins for native mobile integration, maintaining API compatibility with the web SDK to minimize code changes.\n\n**Build System**: Vite configuration remains the primary build tool, with additional Capacitor CLI commands (`npx cap sync`, `npx cap open`) for native project synchronization. Existing code splitting and lazy loading strategies continue to work in the mobile WebView.\n\n**Code Quality**: All existing TypeScript strict mode, ESLint rules, and Jest testing frameworks continue to apply. Mobile-specific components follow the same testing standards (80% coverage, React Testing Library).\n\n### Project Structure (structure.md)\n\n**Feature-First Organization**: Mobile components will follow the existing page-based structure:\n\n```\nsrc/pages/[feature]/\n├── [Feature]Page.tsx          # Existing desktop/responsive page\n├── mobile/                    # NEW: Mobile-specific components\n│   ├── Mobile[Feature]Page.tsx\n│   ├── components/\n│   │   └── [MobileComponent].tsx\n│   └── __tests__/\n│       └── [MobileComponent].test.tsx\n```\n\n**Service Layer Separation**: Existing services (product.service.ts, inventory.service.ts) remain untouched. Firebase service will have minimal updates to integrate Capacitor plugins while maintaining the same public API.\n\n**Module Boundaries**: Mobile components import from existing services and store slices, maintaining the established dependency direction: `Pages → Components → Services → Firebase`.\n\n**Testing Structure**: Mobile components will have colocated tests in `__tests__/` directories following the existing `[ComponentName].test.tsx` naming convention.\n\n## Code Reuse Analysis\n\n### Existing Components to Leverage\n\n- **DataTable Component**: Already has mobile-responsive logic with `useMediaQuery`, `MobileDataRow`, and `MobileFilters` components. Will serve as the pattern for other mobile component conversions.\n- **InventoryStatusChip**: Reusable as-is with potential sizing adjustments for mobile touch targets.\n- **FormattedCurrency**: Works on mobile without changes; may add responsive font sizing.\n- **ErrorBoundary**: Reusable for mobile error handling and crash prevention.\n- **ProtectedRoute**: Existing authentication flow works identically on mobile with Capacitor Firebase Auth plugin.\n\n### Existing Services to Reuse\n\n- **FirebaseService Base Class**: 95% reusable. Only needs @capacitor-firebase plugin imports instead of web SDK. Offline persistence logic (`enableIndexedDbPersistence`) already implemented.\n- **ProductService, CategoryService, InventoryService**: 100% reusable. All business logic, CRUD operations, and data transformations work identically.\n- **TodaysOrder, BatchService, BarcodeService**: Full reuse. Barcode scanning will use Capacitor camera API but service interfaces remain unchanged.\n- **TransactionAnalysis, CostPriceResolution**: Pure business logic services with zero mobile-specific changes required.\n\n### Integration Points\n\n- **Redux Store**: All existing slices (ordersSlice, productsSlice, categoriesSlice) work without modification. Redux Persist configuration may need Capacitor-specific storage adapter.\n- **Firebase Firestore**: Replace `firebase/firestore` imports with `@capacitor-firebase/firestore` in firebase.service.ts. Maintain existing query patterns and real-time listeners.\n- **Firebase Authentication**: Replace `firebase/auth` with `@capacitor-firebase/authentication`. Existing auth state management in authSlice works identically.\n- **Firebase Storage**: Replace `firebase/storage` with `@capacitor-firebase/storage` for PDF file storage operations.\n- **React Router**: Existing routing structure works in mobile WebView. May add Capacitor App plugin for hardware back button handling on Android.\n\n## Architecture\n\n### System Architecture\n\nThe mobile app uses Capacitor's **hybrid architecture** where a native container (iOS/Android) hosts a WebView running the React application:\n\n```mermaid\ngraph TB\n    subgraph \"Native Layer\"\n        iOS[iOS Native Container]\n        Android[Android Native Container]\n        CapBridge[Capacitor Bridge]\n    end\n\n    subgraph \"Web Layer\"\n        WebView[WebView - WKWebView/Chrome]\n        ReactApp[React Application]\n        Redux[Redux Store]\n    end\n\n    subgraph \"Services Layer\"\n        FirebasePlugins[@capacitor-firebase Plugins]\n        CapPlugins[Capacitor Core Plugins]\n        BusinessLogic[Existing Services]\n    end\n\n    subgraph \"Backend\"\n        Firebase[Firebase Backend]\n    end\n\n    iOS --> CapBridge\n    Android --> CapBridge\n    CapBridge --> WebView\n    WebView --> ReactApp\n    ReactApp --> Redux\n    ReactApp --> BusinessLogic\n    BusinessLogic --> FirebasePlugins\n    BusinessLogic --> CapPlugins\n    FirebasePlugins --> Firebase\n```\n\n### Modular Design Principles\n\n- **Single File Responsibility**: Mobile component variants (e.g., `MobileOrdersPage.tsx`) handle only mobile UI layout, delegating to existing components for data display and existing services for business logic.\n- **Component Isolation**: Mobile components are isolated in `/mobile` subdirectories, avoiding pollution of existing web components. Responsive detection logic (`useMediaQuery`) determines which variant to render.\n- **Service Layer Separation**: Zero changes to service layer business logic. Only Firebase SDK imports change from web to Capacitor plugins.\n- **Utility Modularity**: Existing utilities (date formatting, validation, calculations) remain unchanged and work identically on mobile.\n\n### Responsive Component Pattern\n\nThe application will use a **conditional rendering pattern** based on device detection:\n\n```typescript\n// Pattern used in page components\nconst MyFeaturePage: React.FC = () => {\n  const theme = useTheme();\n  const isMobile = useMediaQuery(theme.breakpoints.down('sm'));\n\n  if (isMobile) {\n    return <MobileMyFeaturePage />;\n  }\n\n  return <DesktopMyFeaturePage />;\n};\n```\n\nThis pattern:\n- Maintains single entry point per feature (existing page file)\n- Allows mobile and desktop components to evolve independently\n- Enables code splitting (mobile components only load on mobile devices)\n- Follows existing DataTable component pattern\n\n## Components and Interfaces\n\n### Component 1: Capacitor Configuration\n\n- **Purpose:** Configure Capacitor for iOS and Android platforms with Firebase plugin integration\n- **Files:**\n  - `capacitor.config.ts` - Main Capacitor configuration\n  - `android/` - Android Studio project (auto-generated)\n  - `ios/` - Xcode project (auto-generated)\n- **Interfaces:**\n  - `CapacitorConfig` - Platform settings, plugins, server URL\n  - Native build configurations (build.gradle, Podfile)\n- **Dependencies:** @capacitor/core, @capacitor/cli, @capacitor-firebase/*\n- **Reuses:** Existing build output from Vite (`dist/` directory)\n\n### Component 2: Firebase Plugin Integration\n\n- **Purpose:** Replace web Firebase SDK with Capacitor Firebase plugins for native mobile integration\n- **Files:**\n  - `src/services/firebase.service.ts` (modified imports)\n  - `src/services/firebase.config.ts` (plugin initialization)\n- **Interfaces:**\n  - Existing service interfaces remain unchanged\n  - Internal implementation uses @capacitor-firebase APIs\n- **Dependencies:** @capacitor-firebase/authentication, @capacitor-firebase/firestore, @capacitor-firebase/storage\n- **Reuses:**\n  - Existing FirebaseService base class error handling\n  - Existing offline persistence logic\n  - All service classes (ProductService, CategoryService, etc.)\n\n### Component 3: Mobile Navigation System\n\n- **Purpose:** Provide mobile-appropriate navigation with bottom tabs and hardware back button support\n- **Files:**\n  - `src/navigation/MobileBottomNav.tsx` (NEW)\n  - `src/navigation/MobileAppShell.tsx` (NEW)\n  - `src/App.tsx` (modified for mobile detection)\n- **Interfaces:**\n  - `MobileNavConfig` - Bottom tab configuration (labels, icons, routes)\n  - Hardware back button event handler\n- **Dependencies:** Material-UI BottomNavigation, @capacitor/app (for back button)\n- **Reuses:**\n  - Existing React Router routes and lazy loading\n  - Existing ProtectedRoute authentication logic\n  - Material-UI icon components\n\n### Component 4: Mobile DataTable (Pattern Component)\n\n- **Purpose:** Provide mobile-optimized table display with card layouts and swipe actions\n- **Files:**\n  - `src/components/DataTable/DataTable.tsx` (already mobile-aware)\n  - `src/components/DataTable/MobileDataRow.tsx` (exists, may enhance)\n  - `src/components/DataTable/MobileFilters.tsx` (exists, may enhance)\n- **Interfaces:**\n  - Existing `DataTableProps<T>` interface unchanged\n  - `MobileDataRowProps` for card display\n  - `MobileFiltersProps` for bottom sheet filters\n- **Dependencies:** Material-UI responsive hooks (useMediaQuery, useTheme)\n- **Reuses:**\n  - Existing DataTable sorting, filtering, and pagination logic\n  - Existing column configuration and formatters\n\n### Component 5: Mobile Orders Page\n\n- **Purpose:** Display and manage today's orders with mobile-optimized layout\n- **Files:**\n  - `src/pages/todaysOrders/mobile/MobileTodaysOrdersPage.tsx` (NEW)\n  - `src/pages/todaysOrders/mobile/components/MobileOrderCard.tsx` (NEW)\n  - `src/pages/todaysOrders/mobile/components/MobileOrderFilters.tsx` (NEW)\n- **Interfaces:**\n  - Uses existing `ActiveOrder` type from ordersSlice\n  - `MobileOrderCardProps` for card display\n- **Dependencies:** Material-UI Card, Chip, SwipeableDrawer\n- **Reuses:**\n  - Existing ordersSlice Redux state and actions\n  - Existing order service methods\n  - Existing barcode scanning components (adapt for mobile camera)\n  - Existing date picker (replace with MobileDatePicker)\n\n### Component 6: Mobile Products Page\n\n- **Purpose:** Display product catalog with mobile-optimized search and filters\n- **Files:**\n  - `src/pages/products/mobile/MobileProductsPage.tsx` (NEW)\n  - `src/pages/products/mobile/components/MobileProductCard.tsx` (NEW)\n  - `src/pages/products/mobile/components/MobileProductSearch.tsx` (NEW)\n- **Interfaces:**\n  - Uses existing `Product` and `ProductWithCategoryGroup` types\n  - `MobileProductCardProps` for card display\n- **Dependencies:** Material-UI Card, TextField (search), InfiniteScroll or virtual scrolling\n- **Reuses:**\n  - Existing productsSlice state management\n  - Existing ProductService CRUD operations\n  - Existing InventoryStatusChip component\n\n### Component 7: Mobile Categories Pages\n\n- **Purpose:** Manage categories and category groups with mobile-friendly forms\n- **Files:**\n  - `src/pages/categories/mobile/MobileCategoriesPage.tsx` (NEW)\n  - `src/pages/categoryGroups/mobile/MobileCategoryGroupsPage.tsx` (NEW)\n  - `src/pages/categories/mobile/components/MobileCategoryForm.tsx` (NEW)\n- **Interfaces:**\n  - Uses existing `Category` and `CategoryGroup` types\n  - `MobileCategoryFormProps` for mobile form inputs\n- **Dependencies:** Material-UI mobile-optimized form components\n- **Reuses:**\n  - Existing categoriesSlice and categoryGroupsSlice\n  - Existing CategoryService and CategoryGroupService\n  - Existing category validation logic\n\n## Data Models\n\nAll existing data models remain unchanged. The mobile app uses identical TypeScript interfaces and types:\n\n### Existing Models (No Changes)\n\n```typescript\n// From types/inventory.ts\ninterface InventoryLevel {\n  categoryGroupId: string;\n  currentStock: number;\n  minimumThreshold: number;\n  status: InventoryStatus; // 'healthy' | 'low_stock' | 'zero_stock' | 'negative_stock'\n}\n\n// From services/product.service.ts\ninterface Product {\n  sku: string;\n  name: string;\n  platform: 'amazon' | 'flipkart';\n  categoryId?: string;\n  categoryGroupId?: string;\n  costPrice?: number;\n  // ... existing fields\n}\n\n// From services/todaysOrder.service.ts\ninterface ActiveOrder {\n  name: string;\n  SKU?: string;\n  quantity: number;\n  type: 'amazon' | 'flipkart';\n  batchInfo?: BatchInfo;\n  isCompleted?: boolean;\n  completedAt?: string;\n  // ... existing fields\n}\n\n// From types/category.ts\ninterface Category {\n  id?: string;\n  name: string;\n  description?: string;\n  costPrice?: number;\n  inventoryDeductionQuantity?: number;\n  categoryGroupId?: string;\n}\n```\n\n### New Mobile-Specific Models\n\n```typescript\n// src/types/mobile.ts (NEW)\ninterface MobileNavigationConfig {\n  tabs: MobileTab[];\n  defaultTab: string;\n}\n\ninterface MobileTab {\n  id: string;\n  label: string;\n  icon: React.ReactNode;\n  route: string;\n  badge?: number; // For notification badges\n}\n\ninterface MobileViewportConfig {\n  breakpoint: 'xs' | 'sm' | 'md';\n  cardWidth: string;\n  spacing: number;\n  touchTargetSize: number; // Minimum 44px per iOS HIG\n}\n\ninterface OfflineQueueItem {\n  id: string;\n  type: 'order_update' | 'product_update' | 'category_update';\n  payload: unknown;\n  timestamp: number;\n  retryCount: number;\n}\n```\n\n## Error Handling\n\n### Error Scenarios\n\n#### 1. Capacitor Plugin Initialization Failure\n- **Scenario:** @capacitor-firebase plugins fail to initialize on app startup\n- **Handling:**\n  - Log error to console with plugin name and error details\n  - Show user-friendly alert: \"Unable to connect to backend services. Please restart the app.\"\n  - Provide retry button that re-attempts initialization\n  - Fall back to offline mode if retry fails (show cached data only)\n- **User Impact:** User sees alert banner, can retry or continue with limited offline functionality\n- **Implementation:** Wrap plugin initialization in try-catch blocks in firebase.config.ts\n\n#### 2. Network Connectivity Loss During Operation\n- **Scenario:** Network disconnects while user is browsing orders/products\n- **Handling:**\n  - Redux middleware detects failed Firebase operations\n  - Queue mutations in IndexedDB offline queue\n  - Display offline indicator in app bar (cloud-off icon)\n  - Continue showing cached data from Firestore offline persistence\n  - Auto-retry when connectivity restored (exponential backoff: 1s, 2s, 4s, 8s)\n- **User Impact:** Seamless offline experience; user can continue viewing data\n- **Implementation:** Enhance existing FirebaseService error handling with offline queue\n\n#### 3. Camera Permission Denied (Barcode Scanning)\n- **Scenario:** User denies camera permission when trying to scan barcode\n- **Handling:**\n  - Catch permission denial error from @capacitor/camera\n  - Show dialog: \"Camera access required for barcode scanning\"\n  - Provide \"Open Settings\" button using Capacitor App plugin to deep link to app settings\n  - Offer manual order lookup as fallback (search by product name/SKU)\n- **User Impact:** Clear explanation why feature unavailable; alternative workflow provided\n- **Implementation:** Permission request wrapper in barcode scanner component\n\n#### 4. Firebase Storage Quota Exceeded (PDF Uploads)\n- **Scenario:** User attempts to upload PDF but Firebase Storage quota is full\n- **Handling:**\n  - Catch `storage/quota-exceeded` error\n  - Show error message: \"Storage limit reached. Please contact support or delete old files.\"\n  - Navigate user to Storage Management page to review and delete files\n  - Log error with user ID and timestamp for admin monitoring\n- **User Impact:** Clear actionable error; ability to free up space\n- **Implementation:** Enhance existing pdfStorageService error handling\n\n#### 5. Invalid Firestore Data Structure\n- **Scenario:** Backend data doesn't match expected TypeScript interfaces (schema mismatch)\n- **Handling:**\n  - Existing validateFirestoreData in FirebaseService catches type mismatches\n  - Log detailed error with collection, document ID, and invalid fields\n  - Skip invalid document and continue processing valid ones\n  - Show warning notification: \"Some data could not be loaded. Contact support if issue persists.\"\n  - Report error to monitoring service for investigation\n- **User Impact:** Partial data displayed; issue doesn't block entire page\n- **Implementation:** Extend existing FirebaseService validation\n\n#### 6. App Background State / Memory Pressure\n- **Scenario:** iOS/Android kills app in background due to memory pressure\n- **Handling:**\n  - Use @capacitor/app plugin to detect background/foreground transitions\n  - Persist critical Redux state (current filters, selected date) before backgrounding\n  - On foreground, restore state and refresh data if stale (>5 minutes)\n  - Clear large data caches when memory warnings received\n- **User Impact:** App resumes where user left off; fresh data on return\n- **Implementation:** App lifecycle listeners in App.tsx, Redux Persist configuration\n\n#### 7. TypeScript/ESLint Errors During Build\n- **Scenario:** Developer introduces type error or lint violation\n- **Handling:**\n  - Pre-commit hooks (Husky) block commit with failed `npm run lint-full`\n  - CI pipeline fails build with detailed error messages\n  - Developer must fix errors before merge\n  - Production builds (`npm run build`) fail fast on type/lint errors\n- **User Impact:** Users never see broken code; quality enforced automatically\n- **Implementation:** Existing Husky configuration, CI pipeline setup\n\n## Testing Strategy\n\n### Unit Testing\n\n**Approach:** Test mobile components in isolation using React Testing Library with mobile viewport simulation.\n\n**Key Components to Test:**\n- **MobileOrderCard**: Render with different order states (pending, completed, low stock), verify touch interactions, test swipe actions\n- **MobileProductCard**: Render with inventory status badges, test tap to details modal, verify accessibility labels\n- **MobileFilters**: Test bottom sheet open/close, filter selection, apply/clear actions\n- **MobileBottomNav**: Test tab switching, active tab highlighting, badge display\n- **Mobile DatePicker**: Test date selection, today shortcut, date range constraints\n\n**Test Patterns:**\n```typescript\n// Example mobile component test with viewport simulation\nimport { render, screen, fireEvent } from '@testing-library/react';\nimport { MobileOrderCard } from './MobileOrderCard';\n\ndescribe('MobileOrderCard', () => {\n  beforeEach(() => {\n    // Simulate mobile viewport\n    window.matchMedia = jest.fn().mockImplementation(query => ({\n      matches: query === '(max-width: 600px)',\n      media: query,\n      onchange: null,\n      addEventListener: jest.fn(),\n      removeEventListener: jest.fn(),\n    }));\n  });\n\n  it('should render order details in card layout', () => {\n    const order = { name: 'Test Product', SKU: 'TEST-123', quantity: 2 };\n    render(<MobileOrderCard order={order} />);\n\n    expect(screen.getByText('Test Product')).toBeInTheDocument();\n    expect(screen.getByText('SKU: TEST-123')).toBeInTheDocument();\n  });\n\n  it('should call onComplete when complete button tapped', () => {\n    const onComplete = jest.fn();\n    render(<MobileOrderCard order={mockOrder} onComplete={onComplete} />);\n\n    fireEvent.click(screen.getByRole('button', { name: /complete/i }));\n    expect(onComplete).toHaveBeenCalledWith(mockOrder);\n  });\n});\n```\n\n**Coverage Requirements:**\n- Minimum 80% coverage for all new mobile components\n- 100% coverage for critical paths (order completion, product search, category management)\n- Snapshot tests for complex mobile layouts to detect unintended changes\n\n### Integration Testing\n\n**Approach:** Test multi-component interactions and Redux state integration with Firebase service mocks.\n\n**Key Flows to Test:**\n\n1. **Order Management Flow**:\n   - Load orders page → apply filters → scan barcode → mark order complete → verify Redux state update → verify Firebase mutation queued\n\n2. **Product Search Flow**:\n   - Open products page → enter search term → verify filtered results → tap product card → verify details modal → check inventory status display\n\n3. **Category Management Flow**:\n   - Load categories → create new category → verify form validation → submit → verify Redux state update → verify Firestore write\n\n4. **Offline Synchronization Flow**:\n   - Load orders while online → go offline → mark order complete → verify queued in offline queue → go online → verify sync to Firebase\n\n**Test Pattern:**\n```typescript\n// Integration test with Redux and Firebase mocks\nimport { renderWithProviders } from '../../test/test-utils';\nimport { MobileTodaysOrdersPage } from './MobileTodaysOrdersPage';\n\ndescribe('MobileTodaysOrdersPage Integration', () => {\n  it('should filter orders and update state correctly', async () => {\n    const { store } = renderWithProviders(<MobileTodaysOrdersPage />);\n\n    // Wait for orders to load\n    await waitFor(() => {\n      expect(screen.getByText(/10 orders/i)).toBeInTheDocument();\n    });\n\n    // Apply platform filter\n    fireEvent.click(screen.getByText('Amazon'));\n\n    // Verify Redux state updated\n    const state = store.getState();\n    expect(state.orders.platformFilter).toBe('amazon');\n\n    // Verify filtered results displayed\n    expect(screen.getByText(/5 orders/i)).toBeInTheDocument();\n  });\n});\n```\n\n### End-to-End Testing\n\n**Approach:** Test complete user scenarios on actual mobile devices using Capacitor's dev server and physical device testing.\n\n**User Scenarios to Test:**\n\n1. **Daily Order Processing Scenario**:\n   - Launch app → authenticate → navigate to Active Orders → select today's date → apply batch filter → scan barcode to complete order → verify order marked complete → pull to refresh → verify fresh data\n\n2. **Product Lookup Scenario**:\n   - Navigate to Products → tap search field → enter product SKU → verify autocomplete suggestions → tap product → view details modal → check inventory level → close modal → verify return to list\n\n3. **Category Setup Scenario**:\n   - Navigate to Categories → tap FAB to add category → enter category name → set cost price → link to category group → save → verify category appears in list → verify inventory threshold inherited\n\n4. **Offline Work Scenario**:\n   - Load orders while online → enable airplane mode → mark multiple orders complete → navigate between pages → disable airplane mode → verify offline queue processes → verify all changes synced to Firebase\n\n**Device Testing Matrix:**\n- **iOS**: iPhone SE (low-end), iPhone 13 (mid-range), iPhone 15 Pro (high-end)\n- **Android**: Samsung Galaxy A series (low-end), Google Pixel 6 (mid-range), Samsung S23 (high-end)\n- **Viewport Sizes**: 320px (iPhone SE), 375px (iPhone 13), 428px (iPhone 15 Pro Max), 360px (Android standard), 412px (Android large)\n\n**Performance Metrics to Validate:**\n- Initial load time <3 seconds on mid-range devices\n- List rendering (100 items) <1 second\n- Search filtering <200ms\n- Navigation transitions <300ms, 60fps\n- Memory usage <150MB during normal operation\n\n**Accessibility Testing:**\n- VoiceOver (iOS) and TalkBack (Android) navigation of all mobile pages\n- Keyboard navigation support (for users with Bluetooth keyboards)\n- Color contrast ratios meet WCAG 2.1 AA standards\n- Touch target sizes minimum 44x44px\n- Focus indicators visible on all interactive elements\n\n### Continuous Integration Testing\n\n**CI Pipeline Requirements:**\n- Run `npm run type-check` → must pass with zero errors\n- Run `npm run lint` → must pass with zero errors\n- Run `npm run test:ci` → all tests must pass\n- Run `npm run test:coverage` → verify ≥80% coverage\n- Run `npm run build` → production build must succeed\n- Build iOS and Android apps with Capacitor CLI → verify no native build errors\n\n**Pre-commit Validation:**\n- Husky pre-commit hook runs `npm run lint-full` and `npm run test:related`\n- Blocks commit if any checks fail\n- Ensures code quality standards maintained\n\n## Technical Implementation Details\n\n### Capacitor Configuration\n\n**capacitor.config.ts:**\n```typescript\nimport { CapacitorConfig } from '@capacitor/cli';\n\nconst config: CapacitorConfig = {\n  appId: 'com.sacredsutra.tools',\n  appName: 'Sacred Sutra Tools',\n  webDir: 'dist',\n  bundledWebRuntime: false,\n  plugins: {\n    SplashScreen: {\n      launchShowDuration: 2000,\n      backgroundColor: '#2196f3', // Material UI primary blue\n      showSpinner: true,\n    },\n    Keyboard: {\n      resize: 'body',\n      style: 'dark',\n      resizeOnFullScreen: true,\n    },\n    StatusBar: {\n      style: 'dark',\n      backgroundColor: '#2196f3',\n    },\n  },\n  server: {\n    // For development with live reload\n    androidScheme: 'https',\n    iosScheme: 'https',\n  },\n};\n\nexport default config;\n```\n\n### Firebase Plugin Integration\n\n**Modifications to firebase.config.ts:**\n```typescript\n// Replace web SDK imports with Capacitor plugins\nimport { FirebaseAuthentication } from '@capacitor-firebase/authentication';\nimport { FirebaseFirestore } from '@capacitor-firebase/firestore';\nimport { FirebaseStorage } from '@capacitor-firebase/storage';\n\n// Initialize Firebase with native config (from GoogleService-Info.plist / google-services.json)\nexport const initializeFirebase = async () => {\n  try {\n    // Capacitor Firebase plugins auto-initialize from native config files\n    await FirebaseAuthentication.init();\n    await FirebaseFirestore.init();\n    await FirebaseStorage.init();\n\n    console.log('Firebase plugins initialized successfully');\n  } catch (error) {\n    console.error('Firebase initialization error:', error);\n    throw error;\n  }\n};\n```\n\n### Mobile Navigation Implementation\n\n**src/navigation/MobileBottomNav.tsx:**\n```typescript\nimport React from 'react';\nimport { BottomNavigation, BottomNavigationAction, Paper } from '@mui/material';\nimport { ShoppingCart, Inventory, Category } from '@mui/icons-material';\nimport { useNavigate, useLocation } from 'react-router-dom';\n\nexport const MobileBottomNav: React.FC = () => {\n  const navigate = useNavigate();\n  const location = useLocation();\n\n  const tabs = [\n    { label: 'Orders', icon: <ShoppingCart />, path: '/active-orders' },\n    { label: 'Products', icon: <Inventory />, path: '/products' },\n    { label: 'Categories', icon: <Category />, path: '/categories' },\n  ];\n\n  const currentTabIndex = tabs.findIndex(tab => location.pathname.startsWith(tab.path));\n\n  return (\n    <Paper\n      sx={{ position: 'fixed', bottom: 0, left: 0, right: 0, zIndex: 1000 }}\n      elevation={3}\n    >\n      <BottomNavigation\n        value={currentTabIndex}\n        onChange={(_, newValue) => navigate(tabs[newValue].path)}\n        showLabels\n      >\n        {tabs.map((tab) => (\n          <BottomNavigationAction\n            key={tab.path}\n            label={tab.label}\n            icon={tab.icon}\n          />\n        ))}\n      </BottomNavigation>\n    </Paper>\n  );\n};\n```\n\n### Responsive Component Pattern\n\n**Implementation in page components:**\n```typescript\nimport { useMediaQuery, useTheme } from '@mui/material';\nimport { DesktopProductsPage } from './DesktopProductsPage';\nimport { MobileProductsPage } from './mobile/MobileProductsPage';\n\nexport const ProductsPage: React.FC = () => {\n  const theme = useTheme();\n  const isMobile = useMediaQuery(theme.breakpoints.down('sm'));\n\n  // Capacitor.isNativePlatform() can also be used for explicit mobile detection\n  // const isMobileApp = Capacitor.isNativePlatform();\n\n  if (isMobile) {\n    return <MobileProductsPage />;\n  }\n\n  return <DesktopProductsPage />;\n};\n```\n\nThis pattern allows:\n- Single entry point per feature\n- Independent evolution of mobile/desktop UIs\n- Code splitting (mobile bundle only loads on mobile)\n- Gradual migration (can be applied page-by-page)\n\n## Build and Deployment\n\n### Development Workflow\n\n1. **Web Development**: Standard `npm run dev` with Vite and Firebase emulators\n2. **Mobile Development**:\n   ```bash\n   npm run build         # Build web assets\n   npx cap sync          # Copy to native projects\n   npx cap open ios      # Open in Xcode\n   npx cap open android  # Open in Android Studio\n   ```\n3. **Live Reload**: Configure `server.url` in capacitor.config.ts to point to Vite dev server for instant updates\n\n### Production Builds\n\n**iOS Build Process:**\n```bash\nnpm run build                    # Production build\nnpx cap sync ios                 # Sync to iOS project\nnpx cap open ios                 # Open Xcode\n# In Xcode: Product → Archive → Distribute App → App Store Connect\n```\n\n**Android Build Process:**\n```bash\nnpm run build                    # Production build\nnpx cap sync android             # Sync to Android project\nnpx cap open android             # Open Android Studio\n# In Android Studio: Build → Generate Signed Bundle/APK → Upload to Play Console\n```\n\n### App Store Metadata Requirements\n\n- App icons (1024x1024px for iOS, adaptive icons for Android)\n- Splash screens (various sizes per platform guidelines)\n- Screenshots (minimum 3 per platform, showing key features)\n- Privacy policy URL\n- App description and keywords\n- Version number (must match package.json)\n\n### Version Management\n\n- Web app version in package.json\n- iOS version in ios/App/App.xcodeproj (CFBundleShortVersionString)\n- Android version in android/app/build.gradle (versionName, versionCode)\n- Maintain version parity across all platforms for Firebase schema compatibility\n",
  "fileStats": {
    "size": 30417,
    "lines": 746,
    "lastModified": "2025-10-03T12:55:14.972Z"
  },
  "comments": []
}