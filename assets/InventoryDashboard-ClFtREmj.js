import{u as ie,bD as rt,E as H,W as K,c as X,j as e,ac as R,T as B,af as ve,ag as be,B as l,h as n,ah as Ce,a8 as S,a0 as ee,a1 as st,ao as te,ap as oe,aq as ae,ar as N,bd as nt,X as _,a2 as Z,k as q,w as ot,x as xe,y as Le,U as J,at as Y,A as re,p as me,r as ye,o as pe,D as at,aj as Ie,C as le,bE as _e,bF as lt,I as O,am as Be,az as Ee,as as De,bG as Ue,a as Oe,aV as ke,S as qe,ba as it,b4 as ge,b9 as ct,bH as dt,q as Te,bI as ut,bJ as ht,bK as he,aA as xt,i as ze,bA as Ne,bL as Ge,bM as Ae,bN as Me,bj as Ve,ax as fe,bO as mt,b6 as yt,ab as pt,bP as gt,d as ft,al as jt,bg as vt,aT as bt,aU as We,N as Ct}from"./mui-vendor-D4OjBZQt.js";import{a as v,b as It}from"./react-vendor-DYr15v6v.js";import{u as Q,a as F,e as He,Z as Ke,m as ce,c as Se,a5 as Qe,h as je,q as V,as as kt,d as Ze,at as St,au as wt,av as Tt,aw as $e,ax as zt,ay as Gt,f as At,az as Re,aA as Mt,aB as Wt,aC as $t,aD as Rt}from"./index-BIOtAz8Z.js";import{D as Je}from"./DataTable-EonKnU6y.js";import{u as Ye,c as Xe,b as Pt,d as Ft,e as et,a as ne}from"./index.esm-Cqya02Iw.js";import{L as Lt,A as _t,D as Pe}from"./AdapterDateFns-ChDwltzC.js";import"./redux-vendor-CLOwJCHO.js";import"./firebase-vendor-OxXAdhiL.js";import"./utils-vendor-CFocuF-S.js";import"./pdf-vendor-CApBJrGQ.js";import"./endOfMonth-CrccTSkP.js";const se=({status:t,size:h="medium",variant:C="filled",showIcon:x=!1,tooltip:c,onClick:j,className:f})=>{const m=ie(),I={healthy:{label:"Healthy",color:"success",icon:X,description:"Inventory levels are adequate",muiColor:m.palette.success.main},low_stock:{label:"Low Stock",color:"warning",icon:K,description:"Inventory levels are below threshold",muiColor:m.palette.warning.main},zero_stock:{label:"Out of Stock",color:"error",icon:H,description:"No inventory available",muiColor:m.palette.error.main},negative_stock:{label:"Negative Stock",color:"error",icon:rt,description:"Inventory levels are below zero - requires immediate attention",muiColor:"#9C27B0"}}[t],d=I.icon,p=()=>typeof c=="string"?c:c===!0?I.description:"",o=()=>t==="negative_stock"?{backgroundColor:C==="filled"?"#7B1FA2":"transparent",color:C==="filled"?"#ffffff":"#4A148C",borderColor:C==="outlined"?"#4A148C":void 0,fontWeight:700,"& .MuiChip-icon":{color:C==="filled"?"#ffffff":"#4A148C"}}:{},A=e.jsx(R,{label:I.label,color:t==="negative_stock"?void 0:I.color,size:h,variant:C,icon:x?e.jsx(d,{fontSize:h==="small"?"small":"medium"}):void 0,onClick:j,className:f,sx:{fontWeight:500,cursor:j?"pointer":"default",...o()},"aria-label":`Inventory status: ${I.label}`,role:j?"button":void 0,tabIndex:j?0:void 0,onKeyDown:j?y=>{(y.key==="Enter"||y.key===" ")&&(y.preventDefault(),j())}:void 0});return c?e.jsx(B,{title:p(),arrow:!0,children:e.jsx("span",{children:A})}):A},Bt=Xe({categoryGroupId:ne().when("bulkMode",{is:!1,then:t=>t.required("Category Group is required"),otherwise:t=>t}),newThreshold:et().required("Threshold is required").min(0,"Threshold must be non-negative").test("reasonable-threshold","Threshold seems unreasonably high",function(t){return t&&t>1e4?this.createError({message:"Threshold above 10,000 units seems excessive. Please verify."}):!0}),bulkMode:Ft(),selectedCategoryGroups:Pt().when("bulkMode",{is:!0,then:t=>t.min(1,"Select at least one category group for bulk update"),otherwise:t=>t})}),Fe=(t,h)=>t<=0?"zero_stock":t<0?"negative_stock":t<=h?"low_stock":"healthy",Et=(t,h)=>{const C=t/h;return C<=0?"high":C<=.5?"medium":"low"},Dt=({open:t,onClose:h,onSuccess:C,selectedCategoryGroupId:x})=>{const c=Q(),j=F(He),f=F(Ke),m=F(ce),W=F(Se),[I,d]=v.useState(!1),[p,o]=v.useState([]),[A,y]=v.useState(!1),[G,$]=v.useState(!1),s=Ye({initialValues:{categoryGroupId:x||"",newThreshold:0,bulkMode:!1,selectedCategoryGroups:[]},validationSchema:Bt,onSubmit:async i=>{try{if(A&&!G){$(!0);return}const M=(i.bulkMode?i.selectedCategoryGroups:[i.categoryGroupId]).map(r=>c(Qe({id:r,groupData:{minimumThreshold:i.newThreshold}})).unwrap());await Promise.all(M),await c(je()).unwrap(),c(V()),w(),C==null||C()}catch(u){console.error("Failed to update thresholds:",u)}}});v.useEffect(()=>{t&&(j.length===0&&!f&&c(je()),m.length===0&&!W.inventoryLevels&&c(V()))},[t,j.length,f,m.length,W.inventoryLevels,c]),v.useEffect(()=>{x&&s.values.categoryGroupId!==x&&s.setFieldValue("categoryGroupId",x)},[x]),v.useEffect(()=>{s.values.newThreshold>0&&b()},[s.values.newThreshold,s.values.categoryGroupId,s.values.selectedCategoryGroups,s.values.bulkMode]);const b=()=>{const u=(s.values.bulkMode?s.values.selectedCategoryGroups:[s.values.categoryGroupId].filter(Boolean)).map(r=>{const a=j.find(ue=>ue.id===r),z=m.find(ue=>ue.categoryGroupId===r);if(!a||!z)return null;const E=Fe(z.currentInventory,z.minimumThreshold),de=Fe(z.currentInventory,s.values.newThreshold),D=s.values.newThreshold>z.currentInventory,tt=Et(z.currentInventory,s.values.newThreshold);return{categoryGroupId:r,categoryGroupName:a.name,currentLevel:z.currentInventory,currentThreshold:z.minimumThreshold,newThreshold:s.values.newThreshold,unit:z.inventoryUnit,currentStatus:E,newStatus:de,wouldTriggerAlert:D,alertSeverity:tt}}).filter(Boolean);o(u);const M=u.some(r=>r.wouldTriggerAlert);y(M),$(!1)},w=()=>{s.resetForm(),d(!1),o([]),y(!1),$(!1),h()},P=i=>{s.setFieldValue("bulkMode",i),i?s.setFieldValue("categoryGroupId",""):s.setFieldValue("selectedCategoryGroups",[])},U=()=>{if(s.values.bulkMode)return null;const i=j.find(u=>u.id===s.values.categoryGroupId);return(i==null?void 0:i.minimumThreshold)||null},k=()=>s.values.bulkMode?null:m.find(i=>i.categoryGroupId===s.values.categoryGroupId)||null,T=p.filter(i=>i.wouldTriggerAlert).length,L=U(),g=k();return e.jsx(ve,{open:t,onClose:w,maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:e.jsxs("form",{onSubmit:s.handleSubmit,children:[e.jsx(be,{children:e.jsxs(l,{children:[e.jsx(n,{variant:"h6",fontWeight:"bold",children:"Configure Inventory Thresholds"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Set minimum inventory thresholds that trigger automatic alerts when stock levels are low"})]})}),e.jsx(Ce,{dividers:!0,children:e.jsxs(S,{container:!0,spacing:3,children:[e.jsxs(S,{item:!0,xs:12,children:[e.jsx(ee,{control:e.jsx(st,{checked:s.values.bulkMode,onChange:i=>P(i.target.checked)}),label:"Bulk Update Mode"}),e.jsx(n,{variant:"caption",color:"text.secondary",display:"block",children:"Enable to set the same threshold for multiple category groups"})]}),!s.values.bulkMode&&e.jsx(S,{item:!0,xs:12,children:e.jsxs(te,{fullWidth:!0,error:s.touched.categoryGroupId&&!!s.errors.categoryGroupId,children:[e.jsx(oe,{children:"Category Group *"}),e.jsx(ae,{name:"categoryGroupId",value:s.values.categoryGroupId,onChange:s.handleChange,onBlur:s.handleBlur,label:"Category Group *",disabled:f,children:j.map(i=>{const u=m.find(M=>M.categoryGroupId===i.id);return e.jsx(N,{value:i.id,children:e.jsxs(l,{display:"flex",alignItems:"center",gap:1,width:"100%",children:[e.jsx(l,{sx:{width:16,height:16,backgroundColor:i.color,borderRadius:"50%"}}),e.jsx(n,{children:i.name}),e.jsxs(l,{sx:{ml:"auto",display:"flex",gap:1},children:[e.jsx(R,{label:`${i.currentInventory} ${i.inventoryUnit}`,size:"small",variant:"outlined"}),u&&e.jsx(se,{status:u.status,size:"small"})]})]})},i.id)})}),s.touched.categoryGroupId&&s.errors.categoryGroupId&&e.jsx(n,{variant:"caption",color:"error",sx:{mt:1,ml:2},children:s.errors.categoryGroupId})]})}),s.values.bulkMode&&e.jsx(S,{item:!0,xs:12,children:e.jsx(nt,{multiple:!0,options:j,getOptionLabel:i=>i.name,value:j.filter(i=>s.values.selectedCategoryGroups.includes(i.id||"")),onChange:(i,u)=>{s.setFieldValue("selectedCategoryGroups",u.map(M=>M.id).filter(Boolean))},renderInput:i=>e.jsx(_,{...i,label:"Select Category Groups *",error:s.touched.selectedCategoryGroups&&!!s.errors.selectedCategoryGroups,helperText:s.touched.selectedCategoryGroups&&s.errors.selectedCategoryGroups}),renderOption:(i,u)=>{const M=m.find(r=>r.categoryGroupId===u.id);return e.jsx("li",{...i,children:e.jsxs(l,{display:"flex",alignItems:"center",gap:1,width:"100%",children:[e.jsx(l,{sx:{width:16,height:16,backgroundColor:u.color,borderRadius:"50%"}}),e.jsx(n,{children:u.name}),e.jsxs(l,{sx:{ml:"auto",display:"flex",gap:1},children:[e.jsx(R,{label:`${u.currentInventory} ${u.inventoryUnit}`,size:"small",variant:"outlined"}),M&&e.jsx(se,{status:M.status,size:"small"})]})]})})},disabled:f})}),!s.values.bulkMode&&L!==null&&g&&e.jsx(S,{item:!0,xs:12,children:e.jsxs(Z,{sx:{p:2,bgcolor:"grey.30"},children:[e.jsx(n,{variant:"subtitle2",gutterBottom:!0,children:"Current Configuration"}),e.jsxs(l,{display:"flex",flexWrap:"wrap",gap:2,children:[e.jsxs(l,{children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"Current Inventory"}),e.jsxs(n,{variant:"h6",children:[g.currentInventory," ",g.inventoryUnit]})]}),e.jsxs(l,{children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"Current Threshold"}),e.jsxs(n,{variant:"body1",children:[L," ",g.inventoryUnit]})]}),e.jsxs(l,{children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"Current Status"}),e.jsx(se,{status:g.status})]})]})]})}),e.jsx(S,{item:!0,xs:12,sm:6,children:e.jsx(_,{fullWidth:!0,label:"New Minimum Threshold",name:"newThreshold",type:"number",value:s.values.newThreshold,onChange:s.handleChange,onBlur:s.handleBlur,error:s.touched.newThreshold&&!!s.errors.newThreshold,helperText:s.touched.newThreshold&&s.errors.newThreshold,inputProps:{min:0,step:"any"},InputProps:{endAdornment:!s.values.bulkMode&&g&&e.jsx(n,{variant:"body2",color:"text.secondary",sx:{ml:1},children:g.inventoryUnit})}})}),e.jsx(S,{item:!0,xs:12,sm:6,children:e.jsx(l,{display:"flex",alignItems:"center",height:"100%",children:e.jsx(q,{variant:"outlined",onClick:()=>d(!I),disabled:!s.values.newThreshold||p.length===0,startIcon:I?e.jsx(ot,{}):e.jsx(xe,{}),fullWidth:!0,sx:{height:"56px"},children:I?"Hide Preview":"Preview Impact"})})}),e.jsx(S,{item:!0,xs:12,children:e.jsx(Le,{in:I,children:e.jsx(J,{sx:{mt:2},children:e.jsxs(Y,{children:[e.jsx(n,{variant:"subtitle1",gutterBottom:!0,children:"Threshold Impact Analysis"}),T>0&&e.jsx(re,{severity:"warning",sx:{mb:2,"& .MuiAlert-message":{color:"rgba(51, 51, 51, 1)"},"& .MuiAlert-icon":{color:"rgba(51, 51, 51, 1)"},backgroundColor:"rgba(255, 248, 225, 1)",border:"2px solid rgba(255, 193, 7, 1)"},children:e.jsxs(l,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(K,{sx:{color:"rgba(51, 51, 51, 1)"}}),e.jsxs(n,{sx:{color:"rgba(51, 51, 51, 1)",fontWeight:500},children:["This threshold will trigger immediate alerts for ",T," category group",T>1?"s":""]})]})}),e.jsx(me,{children:p.map((i,u)=>e.jsxs(It.Fragment,{children:[e.jsx(ye,{children:e.jsx(pe,{primary:e.jsxs(l,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(n,{variant:"subtitle2",children:i.categoryGroupName}),i.wouldTriggerAlert&&e.jsx(B,{title:`Would trigger ${i.alertSeverity} severity alert`,children:e.jsx(K,{color:i.alertSeverity==="high"?"error":i.alertSeverity==="medium"?"warning":"info",fontSize:"small"})})]}),secondary:e.jsxs(S,{container:!0,spacing:2,sx:{mt:1},children:[e.jsxs(S,{item:!0,xs:12,sm:4,children:[e.jsx(n,{variant:"caption",color:"text.secondary",children:"Current Level"}),e.jsxs(n,{variant:"body2",children:[i.currentLevel," ",i.unit]})]}),e.jsxs(S,{item:!0,xs:12,sm:4,children:[e.jsx(n,{variant:"caption",color:"text.secondary",children:"Threshold Change"}),e.jsxs(n,{variant:"body2",children:[i.currentThreshold," → ",i.newThreshold," ",i.unit]})]}),e.jsxs(S,{item:!0,xs:12,sm:4,children:[e.jsx(n,{variant:"caption",color:"text.secondary",children:"Status Change"}),e.jsxs(l,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(se,{status:i.currentStatus,size:"small"}),e.jsx(n,{variant:"caption",children:"→"}),e.jsx(se,{status:i.newStatus,size:"small"})]})]})]})})}),u<p.length-1&&e.jsx(at,{})]},i.categoryGroupId))})]})})})}),G&&e.jsx(S,{item:!0,xs:12,children:e.jsxs(re,{severity:"warning",sx:{"& .MuiAlert-message":{color:"rgba(51, 51, 51, 1)"},"& .MuiAlert-icon":{color:"rgba(51, 51, 51, 1)"},backgroundColor:"rgba(255, 248, 225, 1)",border:"2px solid rgba(255, 193, 7, 1)"},children:[e.jsx(n,{variant:"subtitle2",gutterBottom:!0,sx:{color:"rgba(51, 51, 51, 1)",fontWeight:600},children:"Confirmation Required"}),e.jsxs(n,{variant:"body2",sx:{color:"rgba(51, 51, 51, 1)",fontWeight:500},children:["The new threshold will trigger immediate alerts for ",T," category group",T>1?"s":"",". This means the current inventory levels are below the new threshold you're setting."]}),e.jsx(n,{variant:"body2",sx:{mt:1,color:"rgba(51, 51, 51, 1)",fontWeight:500},children:"Are you sure you want to proceed? These alerts will be created immediately."})]})})]})}),e.jsxs(Ie,{sx:{p:2},children:[e.jsx(q,{onClick:w,disabled:f,children:"Cancel"}),G?e.jsxs(e.Fragment,{children:[e.jsx(q,{onClick:()=>$(!1),color:"inherit",children:"Back"}),e.jsx(q,{type:"submit",variant:"contained",color:"warning",disabled:f,children:f?e.jsx(le,{size:20}):"Confirm & Update Thresholds"})]}):e.jsx(q,{type:"submit",variant:"contained",disabled:f||!s.isValid||!s.dirty,children:f?e.jsx(le,{size:20}):"Update Threshold"+(s.values.bulkMode&&s.values.selectedCategoryGroups.length>1?"s":"")})]})]})})},Ut=48,Ot=8,qt={PaperProps:{style:{maxHeight:Ut*4.5+Ot,width:250}}},Nt=({filters:t={},onFilterChange:h,onClearFilters:C,inventoryLevels:x=[],onThresholdConfigSuccess:c,onRefresh:j})=>{const[f,m]=v.useState((t==null?void 0:t.searchTerm)||""),[W,I]=v.useState(!1),d=[{value:"healthy",label:"Healthy",color:"#2e7d32"},{value:"low_stock",label:"Low Stock",color:"#e65100"},{value:"zero_stock",label:"Zero Stock",color:"#c62828"},{value:"negative_stock",label:"Negative",color:"#6a1b9a"}],p=[{value:"kg",label:"Kilogram (kg)"},{value:"g",label:"Gram (g)"},{value:"pcs",label:"Pieces (pcs)"}],o=[{value:"weight",label:"Weight-based"},{value:"qty",label:"Quantity-based"}],A=g=>{const i=g.target.value;m(i),h({searchTerm:i||void 0})},y=g=>{const i=g.target.value,u=typeof i=="string"?i.split(","):i,M={lowStock:u.includes("low_stock"),zeroStock:u.includes("zero_stock"),negativeStock:u.includes("negative_stock"),healthyStock:u.includes("healthy")};u.length===0&&(M.lowStock=void 0,M.zeroStock=void 0,M.negativeStock=void 0,M.healthyStock=void 0),h(M)},G=g=>{const i=g.target.value;h({unit:i||void 0})},$=g=>{const i=g.target.value;h({inventoryType:i||void 0})},s=()=>{m(""),C()},b=()=>{j==null||j()},w=()=>{I(!0)},P=()=>{I(!1)},U=()=>{I(!1),c==null||c()},k=()=>{const i=[["Category Group Name","Current Inventory","Unit","Inventory Type","Minimum Threshold","Status","Last Updated"].join(","),...x.map(a=>[`"${a.name}"`,a.currentInventory,a.inventoryUnit,a.inventoryType,a.minimumThreshold,a.status,a.lastInventoryUpdate?new Date(a.lastInventoryUpdate.toDate()).toISOString():"Never"].join(","))].join(`
`),u=new Blob([i],{type:"text/csv;charset=utf-8;"}),M=document.createElement("a"),r=URL.createObjectURL(u);M.setAttribute("href",r),M.setAttribute("download",`inventory-levels-${new Date().toISOString().split("T")[0]}.csv`),M.style.visibility="hidden",document.body.appendChild(M),M.click(),document.body.removeChild(M)},T=()=>{const g=[];return t.lowStock&&g.push("low_stock"),t.zeroStock&&g.push("zero_stock"),t.negativeStock&&g.push("negative_stock"),t.healthyStock&&g.push("healthy"),g},L=()=>!!(t.searchTerm||t.unit||t.inventoryType||t.lowStock||t.zeroStock||t.negativeStock||t.healthyStock);return e.jsxs(l,{sx:{mb:2,display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2,alignItems:"center"},children:[e.jsx(_,{label:"Search by Name",value:f,onChange:A,placeholder:"Enter category group name...",sx:{minWidth:{xs:"100%",sm:250},flexGrow:1}}),e.jsxs(te,{sx:{minWidth:{xs:"100%",sm:200}},children:[e.jsx(oe,{children:"Status"}),e.jsx(ae,{multiple:!0,value:T(),onChange:y,input:e.jsx(_e,{label:"Status"}),renderValue:g=>e.jsx(l,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:g.map(i=>{const u=d.find(M=>M.value===i);return e.jsx(R,{label:(u==null?void 0:u.label)||i,size:"small",sx:{backgroundColor:(u==null?void 0:u.color)||"#757575",color:"#ffffff",fontWeight:"medium","&:hover":{backgroundColor:(u==null?void 0:u.color)||"#757575",filter:"brightness(0.9)"}}},i)})}),MenuProps:qt,children:d.map(g=>e.jsx(N,{value:g.value,children:e.jsx(R,{label:g.label,size:"small",sx:{backgroundColor:g.color,color:"white",fontWeight:"medium"}})},g.value))})]}),e.jsxs(_,{select:!0,label:"Unit",value:t.unit||"",onChange:G,sx:{minWidth:{xs:"100%",sm:150}},children:[e.jsx(N,{value:"",children:"All Units"}),p.map(g=>e.jsx(N,{value:g.value,children:g.label},g.value))]}),e.jsxs(_,{select:!0,label:"Type",value:t.inventoryType||"",onChange:$,sx:{minWidth:{xs:"100%",sm:150}},children:[e.jsx(N,{value:"",children:"All Types"}),o.map(g=>e.jsx(N,{value:g.value,children:g.label},g.value))]}),e.jsxs(l,{sx:{display:"flex",gap:1},children:[e.jsx(B,{title:"Configure Thresholds",children:e.jsx(q,{variant:"outlined",onClick:w,startIcon:e.jsx(lt,{}),size:"medium",sx:{minWidth:{xs:"auto",sm:"auto"},px:{xs:1,sm:2}},children:e.jsx(l,{sx:{display:{xs:"none",sm:"block"}},children:"Thresholds"})})}),e.jsx(B,{title:"Refresh Data",children:e.jsx(O,{onClick:b,color:"primary",sx:{border:"1px solid",borderColor:"primary.main","&:hover":{backgroundColor:"primary.light",color:"white"}},children:e.jsx(Be,{})})}),e.jsx(B,{title:"Export to CSV",children:e.jsx(O,{onClick:k,color:"primary",disabled:x.length===0,sx:{border:"1px solid",borderColor:"primary.main","&:hover":{backgroundColor:"primary.light",color:"white"}},children:e.jsx(Ee,{})})}),L()&&e.jsx(B,{title:"Clear All Filters",children:e.jsx(O,{onClick:s,color:"secondary",sx:{border:"1px solid",borderColor:"secondary.main","&:hover":{backgroundColor:"secondary.light",color:"white"}},children:e.jsx(De,{})})})]}),e.jsx(Dt,{open:W,onClose:P,onSuccess:U})]})},Vt=({inventoryLevel:t,onUpdateSuccess:h,onUpdateError:C})=>{const x=Q(),[c,j]=v.useState(!1),[f,m]=v.useState(t.minimumThreshold.toString()),[W,I]=v.useState(!1),[d,p]=v.useState(null);v.useEffect(()=>{m(t.minimumThreshold.toString())},[t.minimumThreshold]);const o=(s,b)=>b==="g"&&s>=1e3?`${(s/1e3).toFixed(2)} kg`:`${s.toFixed(2)} ${b}`,A=()=>{j(!0),p(null)},y=()=>{j(!1),m(t.minimumThreshold.toString()),p(null)},G=async()=>{const s=parseFloat(f);if(isNaN(s)||s<0){p("Please enter a valid non-negative number");return}if(s>1e4){p("Threshold seems unreasonably high. Please verify.");return}if(s===t.minimumThreshold){j(!1),p(null);return}I(!0),p(null);try{await x(Qe({id:t.categoryGroupId,groupData:{minimumThreshold:s}})).unwrap(),x(V()),j(!1),h==null||h(t.categoryGroupId,s)}catch(b){const w=b instanceof Error?b.message:"Failed to update threshold";p(w),C==null||C(t.categoryGroupId,w)}finally{I(!1)}},$=s=>{s.key==="Enter"?G():s.key==="Escape"&&y()};return c?e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(_,{size:"small",type:"number",value:f,onChange:s=>m(s.target.value),onKeyDown:$,error:!!d,helperText:d,placeholder:`0 ${t.inventoryUnit}`,inputProps:{min:0,step:"any",style:{textAlign:"right"}},InputProps:{endAdornment:e.jsx(n,{variant:"caption",color:"text.secondary",children:t.inventoryUnit})},sx:{width:100,"& .MuiOutlinedInput-root":{fontSize:"0.875rem"}},autoFocus:!0,disabled:W}),e.jsxs(l,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(B,{title:"Save changes",children:e.jsx("span",{children:e.jsx(O,{size:"small",onClick:G,disabled:W,sx:{color:"success.main"},children:W?e.jsx(le,{size:16}):e.jsx(Ue,{fontSize:"small"})})})}),e.jsx(B,{title:"Cancel editing",children:e.jsx("span",{children:e.jsx(O,{size:"small",onClick:y,disabled:W,sx:{color:"error.main"},children:e.jsx(Oe,{fontSize:"small"})})})})]})]}):e.jsxs(l,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",borderRadius:1,px:1,py:.5,transition:"all 0.2s","&:hover":{backgroundColor:"action.hover","& .edit-button":{opacity:1}}},onClick:A,children:[e.jsx(n,{variant:"body2",children:o(t.minimumThreshold,t.inventoryUnit)}),e.jsx(B,{title:"Click to edit threshold",children:e.jsx(O,{size:"small",onClick:s=>{s.stopPropagation(),A()},className:"edit-button",sx:{opacity:0,transition:"opacity 0.2s",ml:1,p:.25,color:"primary.main"},children:e.jsx(ke,{fontSize:"small"})})})]})},Ht=({inventoryLevel:t,onUpdateSuccess:h,onUpdateError:C})=>{const x=Q(),[c,j]=v.useState(!1),[f,m]=v.useState(t.currentInventory.toString()),[W,I]=v.useState(!1),[d,p]=v.useState(null);v.useEffect(()=>{m(t.currentInventory.toString())},[t.currentInventory]);const o=(s,b)=>b==="g"&&s>=1e3?`${(s/1e3).toFixed(2)} kg`:`${s.toFixed(2)} ${b}`,A=()=>{j(!0),p(null)},y=()=>{j(!1),m(t.currentInventory.toString()),p(null)},G=async()=>{const s=parseFloat(f);if(isNaN(s)||s<0){p("Please enter a valid non-negative number");return}if(s>1e5){p("Inventory level seems unreasonably high. Please verify.");return}if(s===t.currentInventory){j(!1),p(null);return}I(!0),p(null);try{await new kt().adjustInventoryManually({categoryGroupId:t.categoryGroupId,adjustmentType:"set",quantity:s,reason:"correction",notes:`Set inventory level to ${s} ${t.inventoryUnit}`,adjustedBy:"current-user"}),x(V()),j(!1),h==null||h(t.categoryGroupId,s)}catch(b){const w=b instanceof Error?b.message:"Failed to update inventory level";p(w),C==null||C(t.categoryGroupId,w)}finally{I(!1)}},$=s=>{s.key==="Enter"?G():s.key==="Escape"&&y()};return c?e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(_,{size:"small",type:"number",value:f,onChange:s=>m(s.target.value),onKeyDown:$,error:!!d,helperText:d,placeholder:`0 ${t.inventoryUnit}`,inputProps:{min:0,step:"any",style:{textAlign:"right"}},InputProps:{endAdornment:e.jsx(n,{variant:"caption",color:"text.secondary",children:t.inventoryUnit})},sx:{width:120,"& .MuiOutlinedInput-root":{fontSize:"0.875rem"}},autoFocus:!0,disabled:W}),e.jsxs(l,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(B,{title:"Set inventory level",children:e.jsx("span",{children:e.jsx(O,{size:"small",onClick:G,disabled:W,sx:{color:"success.main"},children:W?e.jsx(le,{size:16}):e.jsx(Ue,{fontSize:"small"})})})}),e.jsx(B,{title:"Cancel editing",children:e.jsx("span",{children:e.jsx(O,{size:"small",onClick:y,disabled:W,sx:{color:"error.main"},children:e.jsx(Oe,{fontSize:"small"})})})})]})]}):e.jsxs(l,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",borderRadius:1,px:1,py:.5,transition:"all 0.2s","&:hover":{backgroundColor:"action.hover","& .edit-button":{opacity:1}}},onClick:A,children:[e.jsx(n,{variant:"body2",sx:{fontWeight:"medium",color:t.currentInventory<=0?"error.main":"text.primary"},children:o(t.currentInventory,t.inventoryUnit)}),e.jsx(B,{title:"Click to set inventory level",children:e.jsx(O,{size:"small",onClick:s=>{s.stopPropagation(),A()},className:"edit-button",sx:{opacity:0,transition:"opacity 0.2s",ml:1,p:.25,color:"primary.main"},children:e.jsx(ke,{fontSize:"small"})})})]})},Kt=({onManualAdjustment:t})=>{const h=Q(),C=F(ce),x=F(Se),c=F(Ze),j=F(St),[f,m]=v.useState(!1),[W,I]=v.useState(""),[d,p]=v.useState("success");v.useEffect(()=>{h(V())},[h]);const o=()=>{h(V())};v.useEffect(()=>{c.inventoryLevels&&(I(c.inventoryLevels),p("error"),m(!0))},[c.inventoryLevels]);const A=k=>{h(Tt(k))},y=()=>{h(wt())},G=()=>{m(!1)},$=k=>{switch(k){case"healthy":return"#2e7d32";case"low_stock":return"#e65100";case"zero_stock":return"#c62828";case"negative_stock":return"#6a1b9a";default:return"#757575"}},s=k=>{switch(k){case"healthy":return"Healthy";case"low_stock":return"Low Stock";case"zero_stock":return"Zero Stock";case"negative_stock":return"Negative";default:return"Unknown"}},b=(k,T)=>T==="g"&&k>=1e3?`${(k/1e3).toFixed(2)} kg`:`${k.toFixed(2)} ${T}`,w=k=>{if(!k)return"Never";try{const T=k&&typeof k=="object"&&"toDate"in k?k.toDate():new Date(k);return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(T)}catch{return"Invalid Date"}},P=[{id:"name",label:"Category Group",priorityOnMobile:!0},{id:"currentInventory",label:"Current Inventory",align:"right",format:(k,T)=>T?e.jsx(Ht,{inventoryLevel:T,onUpdateSuccess:(L,g)=>{I(`Successfully updated inventory to ${b(g,T.inventoryUnit)}`),p("success"),m(!0),o()},onUpdateError:(L,g)=>{I(`Failed to update inventory: ${g}`),p("error"),m(!0)}}):e.jsx(n,{variant:"body2",children:"-"})},{id:"inventoryType",label:"Type",format:k=>{const T=k;return e.jsx(R,{label:T==="weight"?"Weight":"Quantity",size:"small",color:T==="weight"?"primary":"secondary",variant:"outlined"})}},{id:"minimumThreshold",label:"Min Threshold",align:"right",format:(k,T)=>T?e.jsx(Vt,{inventoryLevel:T,onUpdateSuccess:(L,g)=>{I(`Successfully updated threshold to ${g} ${T.inventoryUnit}`),p("success"),m(!0),o()},onUpdateError:(L,g)=>{I(`Failed to update threshold: ${g}`),p("error"),m(!0)}}):e.jsx(n,{variant:"body2",children:"-"})},{id:"status",label:"Status",format:k=>{const T=k;return e.jsx(R,{label:s(T),size:"small",sx:{backgroundColor:$(T),color:"#ffffff",fontWeight:"medium","&:hover":{backgroundColor:$(T),filter:"brightness(0.9)"}}})},priorityOnMobile:!0},{id:"lastInventoryUpdate",label:"Last Updated",format:k=>e.jsx(n,{variant:"body2",color:"text.secondary",children:w(k)})},{id:"actions",label:"Actions",align:"center",format:(k,T)=>U(T)}],U=k=>e.jsx(l,{sx:{display:"flex",gap:.5,justifyContent:"center"},children:t&&e.jsx(B,{title:"Adjust Inventory",children:e.jsx(O,{size:"small","aria-label":`adjust-${k.categoryGroupId}`,onClick:()=>t(k),color:"primary",children:e.jsx(it,{})})})});return e.jsxs(l,{sx:{width:"100%"},children:[e.jsx(Nt,{filters:j.inventory,onFilterChange:A,onClearFilters:y,inventoryLevels:C,onRefresh:o}),e.jsx(Je,{columns:P,data:C,defaultSortColumn:"name",defaultSortDirection:"asc",rowsPerPageOptions:[10,25,50,100],defaultRowsPerPage:25,getRowId:k=>k.categoryGroupId}),x.inventoryLevels&&e.jsx(l,{sx:{display:"flex",justifyContent:"center",alignItems:"center",p:3},children:e.jsx(n,{variant:"body2",color:"text.secondary",children:"Loading inventory levels..."})}),!x.inventoryLevels&&C.length===0&&e.jsx(l,{sx:{display:"flex",justifyContent:"center",alignItems:"center",p:3},children:e.jsx(n,{variant:"body2",color:"text.secondary",children:"No inventory levels found."})}),e.jsx(qe,{open:f,autoHideDuration:6e3,onClose:G,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(re,{onClose:G,severity:d,sx:{width:"100%"},children:W})})]})},we=["stock_received","stock_damaged","stock_expired","stock_returned","stock_counted","stock_transferred","stock_lost","correction","other"],Qt=48,Zt=8,Jt={PaperProps:{style:{maxHeight:Qt*4.5+Zt,width:250}}},Yt=({filters:t={},onFilterChange:h})=>{var i,u,M;const[C,x]=v.useState(t.categoryGroupId||""),[c,j]=v.useState(t.orderReference||""),[f,m]=v.useState(t.transactionReference||""),[W,I]=v.useState(t.productSku||""),[d,p]=v.useState(t.adjustedBy||""),o=[{value:"addition",label:"Addition",color:"#4caf50"},{value:"deduction",label:"Deduction",color:"#f44336"},{value:"adjustment",label:"Adjustment",color:"#2196f3"},{value:"initial",label:"Initial",color:"#757575"}],A=[{value:"amazon",label:"Amazon"},{value:"flipkart",label:"Flipkart"}],y=we.map(r=>({value:r,label:r.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase())})),G=r=>{const a=r.target.value;x(a),h({categoryGroupId:a||void 0})},$=r=>{const a=r.target.value,z=typeof a=="string"?a.split(","):a;z.length===1?h({movementType:z[0]}):h({movementType:void 0})},s=r=>{const a=r.target.value;h({platform:a||void 0})},b=r=>{const a=r.target.value;h({reason:a||void 0})},w=r=>{h({startDate:r||void 0})},P=r=>{h({endDate:r||void 0})},U=r=>{const a=r.target.value;j(a),h({orderReference:a||void 0})},k=r=>{const a=r.target.value;m(a),h({transactionReference:a||void 0})},T=r=>{const a=r.target.value;I(a),h({productSku:a||void 0})},L=r=>{const a=r.target.value;p(a),h({adjustedBy:a||void 0})},g=()=>t.movementType?[t.movementType]:[];return e.jsx(Lt,{dateAdapter:_t,children:e.jsxs(l,{sx:{width:"100%"},children:[e.jsx(n,{variant:"subtitle2",sx:{mb:2,fontWeight:"medium"},children:"Filter Inventory Movements"}),e.jsxs(S,{container:!0,spacing:2,children:[e.jsx(S,{item:!0,xs:12,sm:6,md:3,children:e.jsx(Pe,{label:"Start Date",value:t.startDate||null,onChange:w,slotProps:{textField:{fullWidth:!0,size:"small"}}})}),e.jsx(S,{item:!0,xs:12,sm:6,md:3,children:e.jsx(Pe,{label:"End Date",value:t.endDate||null,onChange:P,slotProps:{textField:{fullWidth:!0,size:"small"}}})}),e.jsx(S,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(te,{fullWidth:!0,size:"small",children:[e.jsx(oe,{children:"Movement Type"}),e.jsx(ae,{multiple:!0,value:g(),onChange:$,input:e.jsx(_e,{label:"Movement Type"}),renderValue:r=>e.jsx(l,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:r.map(a=>{const z=o.find(E=>E.value===a);return e.jsx(R,{label:(z==null?void 0:z.label)||a,size:"small",sx:{backgroundColor:(z==null?void 0:z.color)||"#757575",color:"white",fontWeight:"medium"}},a)})}),MenuProps:Jt,children:o.map(r=>e.jsx(N,{value:r.value,children:e.jsx(R,{label:r.label,size:"small",sx:{backgroundColor:r.color,color:"white",fontWeight:"medium"}})},r.value))})]})}),e.jsx(S,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(_,{select:!0,label:"Platform",value:t.platform||"",onChange:s,fullWidth:!0,size:"small",children:[e.jsx(N,{value:"",children:"All Platforms"}),A.map(r=>e.jsx(N,{value:r.value,children:r.label},r.value))]})}),e.jsx(S,{item:!0,xs:12,sm:6,md:3,children:e.jsx(_,{label:"Category Group",value:C,onChange:G,placeholder:"Search by category name...",fullWidth:!0,size:"small"})}),e.jsx(S,{item:!0,xs:12,sm:6,md:3,children:e.jsx(_,{label:"Order Reference",value:c,onChange:U,placeholder:"Enter order reference...",fullWidth:!0,size:"small"})}),e.jsx(S,{item:!0,xs:12,sm:6,md:3,children:e.jsx(_,{label:"Transaction Reference",value:f,onChange:k,placeholder:"Enter transaction reference...",fullWidth:!0,size:"small"})}),e.jsx(S,{item:!0,xs:12,sm:6,md:3,children:e.jsx(_,{label:"Product SKU",value:W,onChange:T,placeholder:"Enter product SKU...",fullWidth:!0,size:"small"})}),e.jsx(S,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(_,{select:!0,label:"Adjustment Reason",value:t.reason||"",onChange:b,fullWidth:!0,size:"small",children:[e.jsx(N,{value:"",children:"All Reasons"}),y.map(r=>e.jsx(N,{value:r.value,children:r.label},r.value))]})}),e.jsx(S,{item:!0,xs:12,sm:6,md:3,children:e.jsx(_,{label:"Adjusted By",value:d,onChange:L,placeholder:"Enter user identifier...",fullWidth:!0,size:"small"})}),e.jsx(S,{item:!0,xs:12,children:e.jsx(Z,{sx:{p:1.5,backgroundColor:"grey.50"},children:e.jsxs(n,{variant:"caption",color:"text.secondary",children:[e.jsx("strong",{children:"Filter Summary:"}),t.startDate&&` From ${t.startDate.toLocaleDateString()}`,t.endDate&&` To ${t.endDate.toLocaleDateString()}`,t.movementType&&` • Type: ${(i=o.find(r=>r.value===t.movementType))==null?void 0:i.label}`,t.platform&&` • Platform: ${(u=A.find(r=>r.value===t.platform))==null?void 0:u.label}`,t.categoryGroupId&&` • Category: ${t.categoryGroupId}`,t.orderReference&&` • Order: ${t.orderReference}`,t.transactionReference&&` • Transaction: ${t.transactionReference}`,t.productSku&&` • SKU: ${t.productSku}`,t.reason&&` • Reason: ${(M=y.find(r=>r.value===t.reason))==null?void 0:M.label}`,t.adjustedBy&&` • User: ${t.adjustedBy}`,!Object.values(t).some(r=>r)&&" No filters applied - showing all movements"]})})})]})]})})},Xt=({onOrderClick:t,onTransactionClick:h})=>{const C=ie(),x=Q(),c=F(r=>r.inventory.filteredInventoryMovements),j=F(r=>r.inventory.loading.inventoryMovements),f=F(r=>r.inventory.error.inventoryMovements),m=F(r=>r.inventory.filters.movements),[W,I]=v.useState(!1),[d,p]=v.useState(""),[o,A]=v.useState("success"),[y,G]=v.useState(!1);v.useEffect(()=>{x($e(m))},[x,m]),v.useEffect(()=>{f&&(p(f),A("error"),I(!0))},[f]);const $=r=>{x(Gt(r))},s=()=>{x(zt())},b=()=>{x($e(m)),p("Movements data refreshed"),A("success"),I(!0)},w=()=>{I(!1)},P=r=>{switch(r){case"addition":return C.palette.success.main;case"deduction":return C.palette.error.main;case"adjustment":return C.palette.primary.main;case"initial":return C.palette.grey[500];default:return C.palette.grey[500]}},U=r=>{switch(r){case"addition":return"Addition";case"deduction":return"Deduction";case"adjustment":return"Adjustment";case"initial":return"Initial";default:return"Unknown"}},k=r=>{const a=r.movementType==="deduction"?"-":"+",z=r.unit==="g"&&r.quantity>=1e3?`${(r.quantity/1e3).toFixed(2)} kg`:`${r.quantity.toFixed(2)} ${r.unit}`;return`${a}${z}`},T=(r,a)=>a==="g"&&r>=1e3?`${(r/1e3).toFixed(2)} kg`:`${r.toFixed(2)} ${a}`,L=r=>{if(!r)return"Unknown";try{const a=r,z=a!=null&&a.toDate?a.toDate():new Date(r);return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(z)}catch{return"Invalid Date"}},g=r=>{const a=[];return r.platform&&a.push(e.jsx(R,{label:r.platform.charAt(0).toUpperCase()+r.platform.slice(1),size:"small",variant:"outlined",sx:{fontSize:"0.75rem",color:"rgba(25, 30, 55, 1)",borderColor:"rgba(25, 30, 55, 0.5)",backgroundColor:"rgba(245, 247, 250, 1)"}},"platform")),r.orderReference&&a.push(e.jsxs(Te,{component:"button",variant:"body2",onClick:z=>{z.stopPropagation(),t==null||t(r.orderReference)},sx:{textDecoration:"underline",cursor:"pointer",color:"rgba(25, 118, 210, 1)",fontSize:"0.75rem",fontWeight:500,"&:hover":{color:"rgba(21, 101, 192, 1)",backgroundColor:"rgba(25, 118, 210, 0.04)"},"&:focus":{outline:"2px solid rgba(25, 118, 210, 0.5)",outlineOffset:"2px"}},children:["Order: ",r.orderReference]},"order")),r.transactionReference&&a.push(e.jsxs(Te,{component:"button",variant:"body2",onClick:z=>{z.stopPropagation(),h==null||h(r.transactionReference)},sx:{textDecoration:"underline",cursor:"pointer",color:"rgba(25, 118, 210, 1)",fontSize:"0.75rem",fontWeight:500,"&:hover":{color:"rgba(21, 101, 192, 1)",backgroundColor:"rgba(25, 118, 210, 0.04)"},"&:focus":{outline:"2px solid rgba(25, 118, 210, 0.5)",outlineOffset:"2px"}},children:["Txn: ",r.transactionReference]},"transaction")),r.productSku&&a.push(e.jsxs(n,{variant:"caption",sx:{fontFamily:"monospace",backgroundColor:"rgba(245, 245, 245, 1)",color:"rgba(33, 33, 33, 1)",px:.5,py:.25,borderRadius:.5,fontSize:"0.7rem",fontWeight:500,border:"1px solid rgba(189, 189, 189, 1)"},children:["SKU: ",r.productSku]},"sku")),r.reason&&a.push(e.jsxs(n,{variant:"caption",sx:{color:"rgba(97, 97, 97, 1)",fontStyle:"italic",fontSize:"0.75rem",fontWeight:500},children:["Reason: ",r.reason.replace(/_/g," ").replace(/\b\w/g,z=>z.toUpperCase())]},"reason")),r.adjustedBy&&a.push(e.jsxs(n,{variant:"caption",sx:{color:"rgba(97, 97, 97, 1)",fontSize:"0.75rem",fontWeight:500},children:["By: ",r.adjustedBy]},"adjustedBy")),a.length===0?e.jsx(n,{variant:"caption",sx:{color:"rgba(97, 97, 97, 1)"},children:"—"}):e.jsx(l,{sx:{display:"flex",flexDirection:"column",gap:.5},children:a})},i=()=>{const a=[["Date/Time","Category Group","Movement Type","Quantity Change","Previous Level","New Level","Unit","Platform","Order Reference","Transaction Reference","Product SKU","Reason","Adjusted By","Notes"].join(","),...c.map(D=>[`"${L(D.createdAt)}"`,`"${D.categoryGroupId}"`,`"${U(D.movementType)}"`,`"${k(D)}"`,D.previousInventory,D.newInventory,D.unit,D.platform||"",D.orderReference||"",D.transactionReference||"",D.productSku||"",D.reason||"",D.adjustedBy||"",`"${D.notes||""}"`].join(","))].join(`
`),z=new Blob([a],{type:"text/csv;charset=utf-8;"}),E=document.createElement("a"),de=URL.createObjectURL(z);E.setAttribute("href",de),E.setAttribute("download",`inventory-movements-${new Date().toISOString().split("T")[0]}.csv`),E.style.visibility="hidden",document.body.appendChild(E),E.click(),document.body.removeChild(E),p("Movements exported to CSV"),A("success"),I(!0)},u=()=>!!(m.categoryGroupId||m.movementType||m.startDate||m.endDate||m.platform||m.adjustedBy||m.transactionReference||m.orderReference||m.productSku||m.reason),M=[{id:"createdAt",label:"Date/Time",priorityOnMobile:!0,format:r=>e.jsx(n,{variant:"body2",sx:{fontFamily:"monospace",fontSize:"0.85rem"},children:L(r)})},{id:"categoryGroupId",label:"Category Group",filter:!0,priorityOnMobile:!0,format:r=>e.jsx(n,{variant:"body2",sx:{fontWeight:"medium"},children:r})},{id:"movementType",label:"Type",filter:!0,align:"center",format:r=>{const a=r;return e.jsx(R,{label:U(a),size:"small",sx:{backgroundColor:P(a),color:"white",fontWeight:"medium",minWidth:"80px"}})},priorityOnMobile:!0},{id:"quantity",label:"Quantity Change",align:"right",format:(r,a)=>{const z=a,E=z.movementType==="deduction";return e.jsx(n,{variant:"body2",sx:{fontWeight:"medium",fontFamily:"monospace",color:E?"error.main":"success.main"},children:k(z)})}},{id:"previousInventory",label:"Previous Level",align:"right",format:(r,a)=>{const z=r,E=(a==null?void 0:a.unit)||"";return e.jsx(n,{variant:"body2",sx:{fontFamily:"monospace"},children:T(z,E)})}},{id:"newInventory",label:"New Level",align:"right",format:(r,a)=>{const z=r,E=(a==null?void 0:a.unit)||"";return e.jsx(n,{variant:"body2",sx:{fontFamily:"monospace",fontWeight:"medium",color:z<=0?"error.main":"text.primary"},children:T(z,E)})}},{id:"context",label:"Context",format:(r,a)=>g(a)}];return e.jsxs(l,{sx:{width:"100%"},children:[e.jsxs(l,{sx:{mb:2,display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2,alignItems:{xs:"stretch",sm:"center"},justifyContent:"space-between"},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ge,{color:"primary"}),e.jsx(n,{variant:"h6",sx:{fontWeight:"medium"},children:"Inventory Movements"}),c.length>0&&e.jsx(R,{label:`${c.length} movements`,size:"small",variant:"outlined"})]}),e.jsxs(l,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[e.jsx(B,{title:"Toggle Filters",children:e.jsx(O,{onClick:()=>G(!y),color:y?"primary":"default",sx:{border:"1px solid",borderColor:y?"primary.main":"grey.300"},children:e.jsx(ct,{})})}),e.jsx(B,{title:"Refresh Data",children:e.jsx(O,{onClick:b,color:"primary",sx:{border:"1px solid",borderColor:"primary.main"},children:e.jsx(Be,{})})}),e.jsx(B,{title:"Export to CSV",children:e.jsx(O,{onClick:i,color:"primary",disabled:c.length===0,sx:{border:"1px solid",borderColor:"primary.main"},children:e.jsx(dt,{})})}),u()&&e.jsx(B,{title:"Clear All Filters",children:e.jsx(O,{onClick:s,color:"secondary",sx:{border:"1px solid",borderColor:"secondary.main"},children:e.jsx(De,{})})})]})]}),e.jsx(Le,{in:y,children:e.jsx(Z,{sx:{p:2,mb:2},children:e.jsx(Yt,{filters:m,onFilterChange:$,onClearFilters:s})})}),e.jsx(Je,{columns:M,data:c,defaultSortColumn:"createdAt",defaultSortDirection:"desc",rowsPerPageOptions:[10,25,50,100],defaultRowsPerPage:25,getRowId:r=>r.id||`${r.categoryGroupId}-${r.createdAt}`}),j&&e.jsx(l,{sx:{display:"flex",justifyContent:"center",alignItems:"center",p:3},children:e.jsx(n,{variant:"body2",color:"text.secondary",children:"Loading inventory movements..."})}),!j&&c.length===0&&e.jsxs(l,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",p:3,textAlign:"center"},children:[e.jsx(ge,{sx:{fontSize:48,color:"grey.400",mb:2}}),e.jsx(n,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No Inventory Movements Found"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:u()?"Try adjusting your filters to see more results.":"Inventory movements will appear here as orders are processed and adjustments are made."})]}),e.jsx(qe,{open:W,autoHideDuration:6e3,onClose:w,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(re,{onClose:w,severity:o,sx:{width:"100%"},children:d})})]})},er=Xe({categoryGroupId:ne().required("Category Group is required"),adjustmentType:ne().oneOf(["increase","decrease","set"],"Invalid adjustment type").required("Adjustment type is required"),quantity:et().required("Quantity is required").min(0,"Quantity must be non-negative").test("positive-for-increase-decrease","Quantity must be positive for increase/decrease operations",function(t){const{adjustmentType:h}=this.parent;return h==="increase"||h==="decrease"?t>0:!0}),reason:ne().oneOf(we,"Invalid reason").required("Reason is required"),notes:ne().max(500,"Notes must be 500 characters or less")}),tr=t=>t.split("_").map(h=>h.charAt(0).toUpperCase()+h.slice(1)).join(" "),rr=t=>{switch(t){case"increase":return"Increase Inventory";case"decrease":return"Decrease Inventory";case"set":return"Set Inventory Level";default:return t}},sr=({open:t,onClose:h,onSuccess:C,selectedCategoryGroupId:x,initialData:c})=>{const j=Q(),f=F(At),m=F(Se),W=F(Ze),I=F(He),d=F(Ke),p=F(ce),o=Ye({initialValues:{categoryGroupId:(c==null?void 0:c.categoryGroupId)||x||"",adjustmentType:(c==null?void 0:c.movementType)==="adjustment"?"set":"increase",quantity:(c==null?void 0:c.quantity)||0,reason:(c==null?void 0:c.reason)||"correction",notes:(c==null?void 0:c.notes)||""},validationSchema:er,onSubmit:async b=>{try{const w={categoryGroupId:b.categoryGroupId,adjustmentType:b.adjustmentType,quantity:b.quantity,reason:b.reason,notes:b.notes||void 0,adjustedBy:(f==null?void 0:f.uid)||(f==null?void 0:f.email)||"unknown"};await j(Mt(w)).unwrap(),A(),C==null||C()}catch(w){console.error("Failed to adjust inventory:",w)}}});v.useEffect(()=>{t&&I.length===0&&!d&&j(je())},[t,I.length,d,j]),v.useEffect(()=>{x&&o.values.categoryGroupId!==x&&o.setFieldValue("categoryGroupId",x)},[x]),v.useEffect(()=>{t&&j(Re())},[t,j]);const A=()=>{o.resetForm(),j(Re()),h()},y=I.find(b=>b.id===o.values.categoryGroupId),G=p.find(b=>b.categoryGroupId===o.values.categoryGroupId),s=(()=>{if(!G||!o.values.quantity)return null;switch(o.values.adjustmentType){case"increase":return G.currentInventory+o.values.quantity;case"decrease":return G.currentInventory-o.values.quantity;case"set":return o.values.quantity;default:return null}})();return e.jsx(ve,{open:t,onClose:A,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:e.jsxs("form",{onSubmit:o.handleSubmit,children:[e.jsx(be,{children:e.jsxs(l,{children:[e.jsx(n,{variant:"h6",fontWeight:"bold",children:"Manual Inventory Adjustment"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Adjust inventory levels manually with proper tracking and audit trail"})]})}),e.jsxs(Ce,{dividers:!0,children:[W.adjustment&&e.jsx(re,{severity:"error",sx:{mb:3,bgcolor:"#d32f2f",color:"#ffffff",border:"2px solid #b71c1c",fontWeight:"bold","& .MuiAlert-icon":{color:"#ffffff"}},children:W.adjustment}),e.jsxs(S,{container:!0,spacing:3,children:[e.jsx(S,{item:!0,xs:12,children:e.jsxs(te,{fullWidth:!0,error:o.touched.categoryGroupId&&!!o.errors.categoryGroupId,children:[e.jsx(oe,{children:"Category Group *"}),e.jsx(ae,{name:"categoryGroupId",value:o.values.categoryGroupId,onChange:o.handleChange,onBlur:o.handleBlur,label:"Category Group *",disabled:d||!!x,children:I.map(b=>e.jsx(N,{value:b.id,children:e.jsxs(l,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(l,{sx:{width:16,height:16,backgroundColor:b.color,borderRadius:"50%"}}),e.jsx(n,{children:b.name}),e.jsx(R,{label:`${b.currentInventory} ${b.inventoryUnit}`,size:"small",variant:"outlined",sx:{ml:"auto"}})]})},b.id))}),o.touched.categoryGroupId&&o.errors.categoryGroupId&&e.jsx(n,{variant:"caption",color:"error",sx:{mt:1,ml:2},children:o.errors.categoryGroupId}),x&&e.jsx(n,{variant:"caption",color:"text.secondary",sx:{mt:1,ml:2},children:"Category is pre-selected for this inventory item"})]})}),y&&G&&e.jsx(S,{item:!0,xs:12,children:e.jsxs(Z,{sx:{p:2,bgcolor:"#2e3440",border:"2px solid #434c5e",borderRadius:2},children:[e.jsx(n,{variant:"subtitle2",gutterBottom:!0,sx:{color:"#ffffff",fontWeight:"bold"},children:"Current Inventory Information"}),e.jsxs(l,{display:"flex",flexWrap:"wrap",gap:2,children:[e.jsxs(l,{children:[e.jsx(n,{variant:"body2",sx:{color:"#d8dee9",fontWeight:"medium"},children:"Current Level"}),e.jsxs(n,{variant:"h6",sx:{color:"#ffffff",fontWeight:"bold"},children:[G.currentInventory," ",G.inventoryUnit]})]}),e.jsxs(l,{children:[e.jsx(n,{variant:"body2",sx:{color:"#d8dee9",fontWeight:"medium"},children:"Minimum Threshold"}),e.jsxs(n,{variant:"body1",sx:{color:"#ffffff",fontWeight:"bold"},children:[G.minimumThreshold," ",G.inventoryUnit]})]}),e.jsxs(l,{children:[e.jsx(n,{variant:"body2",sx:{color:"#d8dee9",fontWeight:"medium"},children:"Status"}),e.jsx(R,{label:G.status.replace("_"," ").toUpperCase(),size:"small",sx:{backgroundColor:G.status==="healthy"?"#2e7d32":G.status==="low_stock"?"#f57c00":"#d32f2f",color:"#ffffff",fontWeight:"bold",border:"1px solid #ffffff"}})]})]})]})}),e.jsx(S,{item:!0,xs:12,children:e.jsxs(te,{component:"fieldset",error:o.touched.adjustmentType&&!!o.errors.adjustmentType,children:[e.jsx(ut,{component:"legend",children:"Adjustment Type *"}),e.jsxs(ht,{name:"adjustmentType",value:o.values.adjustmentType,onChange:o.handleChange,row:!0,children:[e.jsx(ee,{value:"increase",control:e.jsx(he,{}),label:"Increase"}),e.jsx(ee,{value:"decrease",control:e.jsx(he,{}),label:"Decrease"}),e.jsx(ee,{value:"set",control:e.jsx(he,{}),label:"Set Level"})]}),o.touched.adjustmentType&&o.errors.adjustmentType&&e.jsx(n,{variant:"caption",color:"error",children:o.errors.adjustmentType})]})}),e.jsx(S,{item:!0,xs:12,sm:6,children:e.jsx(_,{fullWidth:!0,label:`Quantity ${o.values.adjustmentType==="set"?"to Set":`to ${rr(o.values.adjustmentType).toLowerCase()}`}`,name:"quantity",type:"number",value:o.values.quantity,onChange:o.handleChange,onBlur:o.handleBlur,error:o.touched.quantity&&!!o.errors.quantity,helperText:o.touched.quantity&&o.errors.quantity,inputProps:{min:0,step:o.values.adjustmentType==="set"?"any":1},InputProps:{endAdornment:y&&e.jsx(n,{variant:"body2",color:"text.secondary",sx:{ml:1},children:y.inventoryUnit})}})}),s!==null&&y&&e.jsx(S,{item:!0,xs:12,sm:6,children:e.jsxs(Z,{sx:{p:2,bgcolor:s<0?"#d32f2f":"#2e7d32",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",border:s<0?"2px solid #b71c1c":"2px solid #1b5e20"},children:[e.jsx(n,{variant:"subtitle2",gutterBottom:!0,sx:{color:"#ffffff",fontWeight:"bold"},children:"New Inventory Level"}),e.jsxs(n,{variant:"h6",sx:{color:"#ffffff",fontWeight:"bold"},children:[s," ",y.inventoryUnit]}),s<0&&e.jsx(n,{variant:"caption",sx:{color:"#ffebee",fontWeight:"bold"},children:"⚠️ Warning: Negative inventory level"})]})}),e.jsx(S,{item:!0,xs:12,sm:6,children:e.jsxs(te,{fullWidth:!0,error:o.touched.reason&&!!o.errors.reason,children:[e.jsx(oe,{children:"Reason *"}),e.jsx(ae,{name:"reason",value:o.values.reason,onChange:o.handleChange,onBlur:o.handleBlur,label:"Reason *",children:we.map(b=>e.jsx(N,{value:b,children:tr(b)},b))}),o.touched.reason&&o.errors.reason&&e.jsx(n,{variant:"caption",color:"error",sx:{mt:1,ml:2},children:o.errors.reason})]})}),e.jsx(S,{item:!0,xs:12,sm:6,children:e.jsx(_,{fullWidth:!0,label:"Adjusted By",value:(f==null?void 0:f.email)||(f==null?void 0:f.uid)||"Current User",disabled:!0,helperText:"Automatically filled from current user session"})}),e.jsx(S,{item:!0,xs:12,children:e.jsx(_,{fullWidth:!0,label:"Notes (Optional)",name:"notes",multiline:!0,rows:3,value:o.values.notes,onChange:o.handleChange,onBlur:o.handleBlur,error:o.touched.notes&&!!o.errors.notes,helperText:o.touched.notes&&o.errors.notes,placeholder:"Add any additional details about this adjustment..."})})]})]}),e.jsxs(Ie,{sx:{p:2},children:[e.jsx(q,{onClick:A,disabled:m.adjustment,children:"Cancel"}),e.jsx(q,{type:"submit",variant:"contained",disabled:m.adjustment||!o.isValid||!o.dirty,children:m.adjustment?e.jsx(le,{size:20}):"Apply Adjustment"})]})]})})},nr=({open:t,onClose:h,onSuccess:C})=>{const x=Q(),[c,j]=v.useState(null),[f,m]=v.useState(""),[W,I]=v.useState(!1),[d,p]=v.useState(!1),[o,A]=v.useState(!1),[y,G]=v.useState(null),$=w=>{var U;const P=(U=w.target.files)==null?void 0:U[0];if(P){j(P),G(null);const k=new FileReader;k.onload=T=>{var g;const L=(g=T.target)==null?void 0:g.result;m(L)},k.readAsText(P)}},s=async()=>{if(f){A(!0);try{const w=await x(Wt({csvData:f,options:{updateExisting:W,validateOnly:d,skipMovements:!0}})).unwrap();G(w),w.success&&!d&&setTimeout(()=>{C()},2e3)}catch(w){G({success:!1,imported:0,errors:[w instanceof Error?w.message:"Import failed"],warnings:[],skipped:0})}finally{A(!1)}}},b=()=>{j(null),m(""),G(null),A(!1),h()};return e.jsxs(ve,{open:t,onClose:b,maxWidth:"md",fullWidth:!0,children:[e.jsx(be,{children:"Import Inventory Data"}),e.jsx(Ce,{children:e.jsxs(l,{sx:{mb:3},children:[e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Import inventory levels from CSV file. The CSV must include columns: CategoryGroupId, CategoryGroupName, CurrentInventory, InventoryUnit, InventoryType, MinimumThreshold, Status, LastUpdated"}),e.jsxs(l,{sx:{border:"2px dashed",borderColor:c?"primary.main":"grey.300",borderRadius:2,p:3,textAlign:"center",backgroundColor:c?"primary.50":"grey.50",cursor:"pointer",transition:"all 0.3s","&:hover":{borderColor:"primary.main",backgroundColor:"primary.50"}},component:"label",children:[e.jsx("input",{type:"file",accept:".csv",onChange:$,style:{display:"none"}}),e.jsx(xt,{sx:{fontSize:48,color:"primary.main",mb:1}}),e.jsx(n,{variant:"h6",gutterBottom:!0,children:c?c.name:"Select CSV File"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:c?"File loaded successfully":"Click to browse or drag and drop"})]}),c&&e.jsxs(l,{sx:{mt:3},children:[e.jsx(n,{variant:"subtitle2",gutterBottom:!0,children:"Import Options"}),e.jsx(ee,{control:e.jsx(ze,{checked:W,onChange:w=>I(w.target.checked)}),label:"Update existing inventory levels"}),e.jsx(ee,{control:e.jsx(ze,{checked:d,onChange:w=>p(w.target.checked)}),label:"Validate only (don't import)"})]}),o&&e.jsxs(l,{sx:{mt:3},children:[e.jsx(n,{variant:"body2",gutterBottom:!0,children:d?"Validating...":"Importing..."}),e.jsx(Ne,{})]}),y&&e.jsxs(l,{sx:{mt:3},children:[e.jsxs(re,{severity:y.success?"success":"error",icon:y.success?e.jsx(X,{}):e.jsx(H,{}),sx:{mb:2},children:[e.jsx(n,{variant:"subtitle2",children:y.success?d?"Validation completed successfully":"Import completed successfully":"Import failed"}),e.jsxs(l,{sx:{display:"flex",gap:1,mt:1,flexWrap:"wrap"},children:[y.imported>0&&e.jsx(R,{label:`${y.imported} ${d?"validated":"imported"}`,color:"success",size:"small"}),y.skipped>0&&e.jsx(R,{label:`${y.skipped} skipped`,color:"warning",size:"small"}),y.errors.length>0&&e.jsx(R,{label:`${y.errors.length} errors`,color:"error",size:"small"}),y.warnings.length>0&&e.jsx(R,{label:`${y.warnings.length} warnings`,color:"warning",size:"small"})]})]}),y.errors.length>0&&e.jsxs(Ge,{sx:{mb:1},children:[e.jsx(Ae,{expandIcon:e.jsx(xe,{}),children:e.jsxs(l,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(H,{color:"error",sx:{mr:1}}),e.jsxs(n,{color:"error",children:["Errors (",y.errors.length,")"]})]})}),e.jsx(Me,{children:e.jsx(me,{dense:!0,children:y.errors.map((w,P)=>e.jsx(ye,{children:e.jsx(pe,{primary:w,primaryTypographyProps:{color:"error",variant:"body2"}})},P))})})]}),y.warnings.length>0&&e.jsxs(Ge,{children:[e.jsx(Ae,{expandIcon:e.jsx(xe,{}),children:e.jsxs(l,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(K,{color:"warning",sx:{mr:1}}),e.jsxs(n,{color:"warning.dark",children:["Warnings (",y.warnings.length,")"]})]})}),e.jsx(Me,{children:e.jsx(me,{dense:!0,children:y.warnings.map((w,P)=>e.jsx(ye,{children:e.jsx(pe,{primary:w,primaryTypographyProps:{color:"warning.dark",variant:"body2"}})},P))})})]})]})]})}),e.jsxs(Ie,{sx:{p:3,pt:0},children:[e.jsx(q,{onClick:b,children:y!=null&&y.success&&!d?"Close":"Cancel"}),e.jsx(q,{variant:"contained",startIcon:e.jsx(Ve,{}),onClick:s,disabled:!c||o||(y==null?void 0:y.success)&&!d,children:d?"Validate":"Import"})]})]})},or=({inventoryLevels:t,loading:h=!1,onEdit:C,onManualAdjustment:x})=>{const c=ie(),j=d=>{switch(d){case"healthy":return c.palette.success.main;case"low_stock":return c.palette.warning.main;case"zero_stock":return c.palette.error.main;case"negative_stock":return c.palette.error.dark;default:return c.palette.grey[500]}},f=d=>{switch(d){case"healthy":return e.jsx(X,{});case"low_stock":return e.jsx(K,{});case"zero_stock":return e.jsx(H,{});case"negative_stock":return e.jsx(gt,{});default:return e.jsx(fe,{})}},m=d=>{switch(d){case"healthy":return"Healthy";case"low_stock":return"Low Stock";case"zero_stock":return"Zero Stock";case"negative_stock":return"Negative Stock";default:return"Unknown"}},W=(d,p)=>p===0?d>0?100:0:d<=0?0:Math.min(d/p*100,100),I=(d,p)=>p==="pcs"?`${Math.floor(d)} ${p}`:`${d.toFixed(2)} ${p}`;return h?e.jsx(l,{sx:{p:2},children:e.jsx(n,{variant:"body1",color:"text.secondary",children:"Loading inventory data..."})}):t.length===0?e.jsxs(l,{sx:{p:2,textAlign:"center"},children:[e.jsx(fe,{sx:{fontSize:48,color:"text.secondary",mb:2}}),e.jsx(n,{variant:"h6",color:"text.secondary",children:"No inventory data available"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Create category groups with inventory tracking to get started"})]}):e.jsx(S,{container:!0,spacing:2,sx:{p:2},children:t.map(d=>{const p=j(d.status),o=f(d.status),A=W(d.currentInventory,d.minimumThreshold);return e.jsx(S,{item:!0,xs:12,children:e.jsxs(J,{elevation:2,sx:{borderLeft:`4px solid ${p}`,"&:hover":{elevation:4,transform:"translateY(-2px)",transition:"all 0.2s ease-in-out"}},children:[e.jsx(mt,{title:e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(n,{variant:"h6",component:"span",noWrap:!0,children:d.name}),e.jsx(R,{icon:o,label:m(d.status),size:"small",sx:{backgroundColor:p,color:"#ffffff","& .MuiChip-icon":{color:"#ffffff"},"&:hover":{backgroundColor:p,filter:"brightness(0.9)"}}})]}),subheader:e.jsxs(n,{variant:"body2",color:"text.secondary",children:[d.inventoryType==="weight"?"Weight-based":"Quantity-based"," • ",d.inventoryUnit]}),action:e.jsx(O,{size:"small",onClick:()=>C==null?void 0:C(d),sx:{color:"text.secondary"},children:e.jsx(ke,{fontSize:"small"})}),sx:{pb:1}}),e.jsxs(Y,{sx:{pt:0,pb:1},children:[e.jsxs(l,{sx:{mb:2},children:[e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"Current Inventory"}),e.jsx(n,{variant:"body2",fontWeight:"medium",children:I(d.currentInventory,d.inventoryUnit)})]}),e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:"Minimum Threshold"}),e.jsx(n,{variant:"body2",fontWeight:"medium",children:I(d.minimumThreshold,d.inventoryUnit)})]}),e.jsxs(l,{sx:{mt:1},children:[e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",mb:.5},children:[e.jsx(n,{variant:"caption",color:"text.secondary",children:"Inventory Level"}),e.jsxs(n,{variant:"caption",color:"text.secondary",children:[A.toFixed(0),"%"]})]}),e.jsx(Ne,{variant:"determinate",value:Math.min(A,100),sx:{height:6,borderRadius:3,backgroundColor:c.palette.grey[200],"& .MuiLinearProgress-bar":{backgroundColor:A<25?c.palette.error.main:A<50?c.palette.warning.main:c.palette.success.main,borderRadius:3}}})]})]}),d.status!=="healthy"&&e.jsxs(l,{sx:{p:1.5,borderRadius:1,backgroundColor:c.palette.grey[50],border:`1px solid ${c.palette.grey[200]}`},children:[e.jsx(n,{variant:"caption",color:"text.secondary",display:"block",children:"Status Alert"}),e.jsxs(n,{variant:"body2",sx:{mt:.5},children:[d.status==="low_stock"&&"Inventory is below minimum threshold",d.status==="zero_stock"&&"Inventory is completely depleted",d.status==="negative_stock"&&"Inventory shows negative balance - immediate attention required"]})]})]}),e.jsx(yt,{sx:{px:2,pb:2,pt:0},children:e.jsx(q,{size:"small",variant:"outlined",startIcon:e.jsx(pt,{}),onClick:()=>x==null?void 0:x(d),fullWidth:!0,sx:{textTransform:"none",borderRadius:2,py:1},children:"Adjust Inventory"})})]})},d.categoryGroupId)})})},gr=()=>{const t=Q(),h=F(ce),C=ie(),x=ft(C.breakpoints.down("md")),[c,j]=v.useState(!1),[f,m]=v.useState(),[W,I]=v.useState(0),[d,p]=v.useState(!1);v.useEffect(()=>{t(V()),t($t())},[t]);const o=u=>{m(u),j(!0)},A=()=>{j(!1),m(void 0)},y=()=>{t(V()),j(!1),m(void 0)},G=(u,M)=>{I(M)},$=async()=>{try{const u=await t(Rt({includeMovements:!0})).unwrap(),M=new Blob([u],{type:"text/csv"}),r=window.URL.createObjectURL(M),a=document.createElement("a");a.href=r,a.download=`inventory-export-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(r)}catch(u){console.error("Export failed:",u)}},s=()=>{p(!0)},b=()=>{p(!1)},w=()=>{t(V()),p(!1)},P=h.length,U=h.filter(u=>u.status==="healthy"),k=h.filter(u=>u.status==="low_stock"),T=h.filter(u=>u.status==="zero_stock"),L=h.filter(u=>u.status==="negative_stock"),g=u=>{switch(u){case"healthy":return e.jsx(X,{sx:{color:"#2e7d32"}});case"low_stock":return e.jsx(K,{sx:{color:"#e65100"}});case"zero_stock":return e.jsx(H,{sx:{color:"#c62828"}});case"negative_stock":return e.jsx(H,{sx:{color:"#6a1b9a"}});default:return e.jsx(X,{sx:{color:"#757575"}})}},i=[...k,...T,...L];return e.jsxs(l,{sx:{p:x?1:3},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:x?2:3,flexDirection:x?"column":"row",gap:x?2:0},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(fe,{sx:{mr:2,color:"primary.main",fontSize:x?28:32}}),e.jsx(n,{variant:x?"h5":"h4",component:"h1",sx:{fontWeight:"bold",color:"primary.dark"},children:"Inventory Management"})]}),e.jsxs(jt,{direction:x?"column":"row",spacing:1,sx:{width:x?"100%":"auto"},children:[e.jsx(q,{variant:"outlined",startIcon:e.jsx(Ee,{}),onClick:$,size:x?"small":"medium",sx:{minWidth:x?"auto":void 0,width:x?"100%":"auto"},children:"Export"}),e.jsx(q,{variant:"outlined",startIcon:e.jsx(Ve,{}),onClick:s,size:x?"small":"medium",sx:{minWidth:x?"auto":void 0,width:x?"100%":"auto"},children:"Import"}),e.jsx(q,{variant:"contained",startIcon:e.jsx(vt,{}),onClick:()=>o(),size:x?"small":"medium",sx:{minWidth:x?"auto":void 0,width:x?"100%":"auto"},children:"Manual Adjustment"})]})]}),!x&&e.jsxs(S,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(S,{item:!0,xs:12,sm:6,md:3,children:e.jsx(J,{sx:{height:"100%",borderLeft:"4px solid #2e7d32"},children:e.jsx(Y,{children:e.jsxs(l,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(l,{children:[e.jsx(n,{variant:"h4",sx:{fontWeight:"bold",color:"success.dark"},children:U.length}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Healthy Stock"})]}),e.jsx(X,{sx:{fontSize:40,color:"#2e7d32"}})]})})})}),e.jsx(S,{item:!0,xs:12,sm:6,md:3,children:e.jsx(J,{sx:{height:"100%",borderLeft:"4px solid #e65100"},children:e.jsx(Y,{children:e.jsxs(l,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(l,{children:[e.jsx(n,{variant:"h4",sx:{fontWeight:"bold",color:"warning.dark"},children:k.length}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Low Stock"})]}),e.jsx(K,{sx:{fontSize:40,color:"#e65100"}})]})})})}),e.jsx(S,{item:!0,xs:12,sm:6,md:3,children:e.jsx(J,{sx:{height:"100%",borderLeft:"4px solid #c62828"},children:e.jsx(Y,{children:e.jsxs(l,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(l,{children:[e.jsx(n,{variant:"h4",sx:{fontWeight:"bold",color:"error.dark"},children:T.length}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Zero Stock"})]}),e.jsx(H,{sx:{fontSize:40,color:"#c62828"}})]})})})}),e.jsx(S,{item:!0,xs:12,sm:6,md:3,children:e.jsx(J,{sx:{height:"100%",borderLeft:"4px solid #6a1b9a"},children:e.jsx(Y,{children:e.jsxs(l,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(l,{children:[e.jsx(n,{variant:"h4",sx:{fontWeight:"bold",color:"secondary.dark"},children:L.length}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Negative Stock"})]}),e.jsx(H,{sx:{fontSize:40,color:"#6a1b9a"}})]})})})})]}),i.length>0&&e.jsxs(Z,{sx:{p:2,mb:3,bgcolor:"#b71c1c",borderRadius:2,border:"2px solid #7f0000"},children:[e.jsxs(n,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",color:"#ffffff",fontWeight:"bold"},children:[e.jsx(K,{sx:{mr:1,color:"#ffffff"}}),"Inventory Alerts (",i.length,")"]}),e.jsxs(l,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:[i.slice(0,6).map(u=>e.jsx(R,{label:`${u.name}: ${u.currentInventory} ${u.inventoryUnit}`,color:u.status==="low_stock"?"warning":"error",size:"small",icon:g(u.status),sx:{fontSize:"0.75rem"}},u.categoryGroupId)),i.length>6&&e.jsx(R,{label:`+${i.length-6} more`,color:"default",size:"small",sx:{fontSize:"0.75rem"}})]})]}),e.jsxs(Z,{sx:{p:0},children:[e.jsx(l,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(bt,{value:W,onChange:G,"aria-label":"inventory sections",children:[e.jsx(We,{icon:e.jsx(Ct,{}),label:"Inventory Levels",iconPosition:"start",sx:{fontWeight:"medium"}}),e.jsx(We,{icon:e.jsx(ge,{}),label:"Activity History",iconPosition:"start",sx:{fontWeight:"medium"}})]})}),W===0&&e.jsxs(l,{sx:{p:x?0:2},children:[!x&&e.jsxs(l,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsx(n,{variant:"h6",sx:{fontWeight:"bold"},children:"All Inventory Levels"}),e.jsxs(n,{variant:"body2",color:"text.secondary",children:[P," category groups"]})]}),x?e.jsx(or,{inventoryLevels:h,onManualAdjustment:o}):e.jsx(Kt,{onManualAdjustment:o})]}),W===1&&e.jsx(l,{sx:{p:2},children:e.jsx(Xt,{})})]}),e.jsx(sr,{open:c,onClose:A,onSuccess:y,selectedCategoryGroupId:f==null?void 0:f.categoryGroupId,initialData:f?{categoryGroupId:f.categoryGroupId,movementType:"adjustment",quantity:f.currentInventory,reason:"correction",notes:`Adjusting inventory for ${f.name}`}:void 0}),e.jsx(nr,{open:d,onClose:b,onSuccess:w})]})};export{gr as InventoryDashboard,gr as default};
