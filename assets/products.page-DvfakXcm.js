import{j as e,B as d,a0 as W,a1 as F,T,ae as M,k as R,aR as V,S as z,A as L,ac as g,I as O,aV as $,Q as H,a2 as K,ax as _,h as w,D as G,C as J}from"./mui-vendor-D4OjBZQt.js";import{a as l,b as Q}from"./react-vendor-DYr15v6v.js";import{u as E,w as q,a as C,I as X,l as Y,n as Z,J as ee,K as te,L as ae,M as se}from"./index-BIOtAz8Z.js";import{P as re,a as ne}from"./ProductTableToolbar-CAnoAnGG.js";import{D as oe}from"./DataTable-EonKnU6y.js";import{F as ie}from"./FormattedCurrency-Cr38E1t8.js";import{V as le,a as ce}from"./ActionButtons-BZGx5Hc7.js";import"./redux-vendor-CLOwJCHO.js";import"./firebase-vendor-OxXAdhiL.js";import"./utils-vendor-CFocuF-S.js";import"./pdf-vendor-CApBJrGQ.js";const de=({onImport:n})=>{const[u,c]=l.useState(null),[f,m]=l.useState(!1),p=async o=>{var x;const i=(x=o.target.files)==null?void 0:x[0];if(i){if(!i.name.endsWith(".xlsx")&&!i.name.endsWith(".xls")&&!i.name.endsWith(".txt")){c("Please upload an Excel file (.xlsx or .xls)");return}try{c(null),await n(i,f)}catch{c("Failed to import products. Please check the file format.")}o.target.value=""}};return e.jsxs(d,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:1},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(W,{control:e.jsx(F,{checked:f,onChange:o=>m(o.target.checked),size:"small"}),label:"Update existing products",sx:{mr:2}}),e.jsx(T,{title:"When checked, existing products will be updated with new prices and metadata from the import file. User customizations (cost price, categories, visibility) will be preserved.",children:e.jsx(M,{sx:{fontSize:20,color:"text.secondary",cursor:"help"}})})]}),e.jsxs(R,{variant:"contained",component:"label",startIcon:e.jsx(V,{}),children:["Import Products",e.jsx("input",{type:"file",hidden:!0,accept:".xlsx,.xls,.txt",onChange:p})]}),e.jsx(z,{open:!!u,autoHideDuration:6e3,onClose:()=>c(null),message:u})]})},ue=({products:n,allProducts:u,onEdit:c,onFilterChange:f,onBulkCategoryUpdate:m})=>{const p=E(),[o,i]=l.useState([]),[x,y]=l.useState({}),[b,s]=l.useState(!1),[h,S]=l.useState(""),[A]=l.useState("success");l.useEffect(()=>{p(q())},[p]);const j=C(X),U=t=>{y(t),f(t)},B=t=>{i(a=>a.includes(t)?a.filter(r=>r!==t):[...a,t])},D=async(t,a)=>{if(m)try{await m(t,a),i([]);const r=P(a);S(`Successfully assigned ${t.length} product(s) to category "${r}"`),s(!0)}catch{S("Failed to assign category to products"),s(!0)}},k=()=>{s(!1)},P=t=>{if(!t||!Array.isArray(j))return"-";const a=j.find(r=>r.id===t);return a?a.name:"-"},I=t=>"category"in t,N=[{id:"select",label:"",format:(t,a)=>a?e.jsx(F,{checked:o.includes(a.sku),onChange:()=>B(a.sku)}):null},{id:"sku",label:"SKU",filter:!0},{id:"name",label:"Name",filter:!0},{id:"categoryId",label:"Category",filter:!0,format:(t,a)=>{const r=a;return I(r)&&r.category?e.jsx(g,{label:r.category.name,size:"small"}):e.jsx(g,{label:P(t),size:"small"})},filterValue:t=>{const a=t;return I(a)&&a.category?a.category.name:P(t.categoryId)}},{id:"platform",label:"Platform",format:t=>{const a=t;return e.jsx(g,{label:a.toUpperCase(),color:t==="amazon"?"default":"primary"})},filter:!0},{id:"sellingPrice",label:"Selling Price",align:"right",format:t=>e.jsx(ie,{value:t})},{id:"actions",label:"Actions",align:"center",format:(t,a)=>v(a)}],v=t=>{var a,r;return e.jsxs(e.Fragment,{children:[e.jsx(O,{size:"small","aria-label":`edit-${t.sku}`,onClick:()=>c(t),children:e.jsx($,{})}),((a=t.metadata)==null?void 0:a.flipkartSerialNumber)&&e.jsx(le,{flipkartSerialNumber:t.metadata.flipkartSerialNumber}),((r=t.metadata)==null?void 0:r.amazonSerialNumber)&&e.jsx(ce,{amazonSerialNumber:t.metadata.amazonSerialNumber})]})};return e.jsxs(d,{sx:{width:"100%"},children:[e.jsx(re,{platform:x.platform,search:x.search,selectedProducts:o,categories:j,allProducts:u||n,onFilterChange:U,onBulkCategoryUpdate:D}),e.jsx(oe,{columns:N,data:n,defaultSortColumn:"sku",defaultSortDirection:"asc",rowsPerPageOptions:[10,25,50],defaultRowsPerPage:10}),e.jsx(z,{open:b,autoHideDuration:6e3,onClose:k,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(L,{onClose:k,severity:A,sx:{width:"100%"},children:h})})]})},Se=()=>{const n=E(),{items:u,filteredItems:c,loading:f}=C(s=>s.products),m=C(Y),[p,o]=Q.useState(null);l.useEffect(()=>{m&&n(Z({}))},[n,m]);const i=async(s,h)=>{try{await n(ee({file:s,updateExisting:h})).unwrap()}catch{}},x=async(s,h)=>{try{await n(se({sku:s,data:h})).unwrap(),o(null)}catch{}},y=async(s,h)=>{try{await n(te({skus:s,data:{categoryId:h}})).unwrap()}catch{}},b=s=>{n(ae(s))};return e.jsx(H,{maxWidth:"xl",sx:{py:3},children:e.jsxs(K,{sx:{p:3,mb:4,borderRadius:2},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",mb:3,justifyContent:"space-between"},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(_,{sx:{fontSize:32,mr:2,color:"primary.main"}}),e.jsx(w,{variant:"h4",component:"h1",sx:{fontWeight:"bold",color:"primary.dark"},children:"Product Management"}),e.jsx(g,{label:`${u.length} Products`,color:"primary",size:"medium",sx:{ml:2}})]}),e.jsx(de,{onImport:i})]}),e.jsx(G,{sx:{mb:3}}),e.jsx(d,{sx:{width:"100%"},children:f?e.jsx(d,{display:"flex",justifyContent:"center",alignItems:"center",m:4,children:e.jsx(J,{color:"primary",size:40,thickness:4})}):e.jsxs(d,{children:[e.jsx(w,{variant:"h6",sx:{mb:2,fontWeight:"bold",color:"primary.dark"},children:"Product Catalog"}),e.jsx(ue,{products:c,allProducts:u,onEdit:o,onFilterChange:b,onBulkCategoryUpdate:y})]})}),p&&e.jsx(ne,{product:p,onClose:()=>o(null),onSave:x})]})})};export{Se as ProductsPage,Se as default};
