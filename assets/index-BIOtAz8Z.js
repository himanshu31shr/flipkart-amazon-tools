const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/pdf-vendor-CApBJrGQ.js","assets/react-vendor-DYr15v6v.js","assets/index-DH0QK90Q.js","assets/mui-vendor-D4OjBZQt.js","assets/useEnhancedCamera-VSUB841b.js","assets/redux-vendor-CLOwJCHO.js","assets/firebase-vendor-OxXAdhiL.js","assets/utils-vendor-CFocuF-S.js","assets/dashboard.page-BQ8NLI-w.js","assets/FormattedCurrency-Cr38E1t8.js","assets/generateCategoricalChart-0pyt0Y-a.js","assets/home.page-BlOYehJ8.js","assets/pdfStorageService-CPryU-Rx.js","assets/AdapterDateFns-ChDwltzC.js","assets/endOfMonth-CrccTSkP.js","assets/transactionAnalytics.page-B630Xmtc.js","assets/DataTable-EonKnU6y.js","assets/products.page-DvfakXcm.js","assets/ProductTableToolbar-CAnoAnGG.js","assets/ActionButtons-BZGx5Hc7.js","assets/todaysOrder.page-QPGII2lt.js","assets/categories.page-B6yZrKD8.js","assets/categoryGroups.page-BlUKEHHr.js","assets/index.esm-Cqya02Iw.js","assets/index-DVotOe97.js","assets/uncategorized-products.page-DXBDwss6.js","assets/storage-management.page-Byecb2Q3.js","assets/health.page-CzQr08zB.js","assets/monitoring-dashboard.page-CG1HYxfv.js","assets/deployment-status.page-DOWKIg0I.js","assets/InventoryDashboard-ClFtREmj.js"])))=>i.map(i=>d[i]);
var ki=Object.defineProperty;var Oi=(n,e,t)=>e in n?ki(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Te=(n,e,t)=>Oi(n,typeof e!="symbol"?e+"":e,t);import{j as jsxRuntimeExports,B as Box,C as CircularProgress,A as Alert,I as IconButton,a as CloseIcon,S as Snackbar,F as Fade,b as ScannerIcon,W as Warning,E as Error$1,c as CheckCircle,u as useTheme,d as useMediaQuery,T as Tooltip,s as styled,e as AppBar$1,f as Toolbar,M as MenuIcon,g as ChevronLeftIcon,h as Typography,i as Switch,H as Hidden,k as Button,L as LogoutIcon,l as ListItemButton,m as alpha,n as ListItemIcon,o as ListItemText,D as Divider,p as List,q as Link,r as ListItem,t as DashboardIcon,v as ShoppingCartIcon,w as ExpandLessIcon,x as ExpandMoreIcon,y as Collapse,z as LabelIcon,G as CategoryIcon,J as GroupIcon,K as ManagementIcon,N as StorageIcon,O as Analytics,P as Drawer,Q as Container,R as ErrorOutline,U as Card,V as LockOutlinedIcon,X as TextField,Y as InputAdornment,Z as EmailOutlinedIcon,_ as VisibilityOffOutlinedIcon,$ as VisibilityOutlined,a0 as FormControlLabel,a1 as Checkbox,a2 as Paper,a3 as BugReportOutlined,a4 as RefreshOutlined,a5 as createTheme,a6 as ThemeProvider,a7 as CssBaseline}from"./mui-vendor-D4OjBZQt.js";import{e as requireReactDom,a as reactExports,g as getDefaultExportFromCjs,f as commonjsGlobal,h as getAugmentedNamespace,u as useLocation,N as Navigate,i as useNavigate,b as React,L as Link$1,j as Routes,k as Route,B as BrowserRouter}from"./react-vendor-DYr15v6v.js";import{i as isAction,a as isPlainObject$1,c as combineReducers,b as applyMiddleware,d as compose,e as createStore,u as useDispatch,f as useSelector,P as Provider_default}from"./redux-vendor-CLOwJCHO.js";import{_ as _registerComponent,C as Component,r as registerVersion,S as SDK_VERSION,a as _isFirebaseServerApp,F as FirebaseError,g as getApp,b as getModularInstance,c as _getProvider,d as getDefaultEmulatorHostnameAndPort,e as createMockUserToken,i as initializeApp,f as getAuth,h as initializeFirestore,j as enableIndexedDbPersistence,k as rn,l as collection,q as query,m as getDocs,n as doc,o as getDoc,s as setDoc,p as addDoc,u as updateDoc,T as Timestamp,t as deleteDoc,w as writeBatch,v as orderBy,x as where,y as runTransaction,z as getFirestore,A as createUserWithEmailAndPassword,B as setPersistence,D as browserLocalPersistence,E as browserSessionPersistence,G as signInWithEmailAndPassword,H as signOut,I as sendPasswordResetEmail,J as onAuthStateChanged}from"./firebase-vendor-OxXAdhiL.js";import{r as requirePapaparse_min,a as readSync,u as utils}from"./utils-vendor-CFocuF-S.js";import{_ as __vitePreload,P as PDFDocument}from"./pdf-vendor-CApBJrGQ.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function t(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=t(a);fetch(a.href,i)}})();var client={},hasRequiredClient;function requireClient(){if(hasRequiredClient)return client;hasRequiredClient=1;var n=requireReactDom();return client.createRoot=n.createRoot,client.hydrateRoot=n.hydrateRoot,client}var clientExports=requireClient();function _typeof$1(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_typeof$1=function(t){return typeof t}:_typeof$1=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof$1(n)}function _classCallCheck(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function _createClass(n,e,t){return e&&_defineProperties(n.prototype,e),n}function _possibleConstructorReturn(n,e){return e&&(_typeof$1(e)==="object"||typeof e=="function")?e:_assertThisInitialized(n)}function _getPrototypeOf(n){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(n)}function _assertThisInitialized(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function _inherits(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&_setPrototypeOf(n,e)}function _setPrototypeOf(n,e){return _setPrototypeOf=Object.setPrototypeOf||function(r,a){return r.__proto__=a,r},_setPrototypeOf(n,e)}function _defineProperty$3(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}var PersistGate=function(n){_inherits(e,n);function e(){var t,r;_classCallCheck(this,e);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=_possibleConstructorReturn(this,(t=_getPrototypeOf(e)).call.apply(t,[this].concat(i))),_defineProperty$3(_assertThisInitialized(r),"state",{bootstrapped:!1}),_defineProperty$3(_assertThisInitialized(r),"_unsubscribe",void 0),_defineProperty$3(_assertThisInitialized(r),"handlePersistorState",function(){var l=r.props.persistor,h=l.getState(),o=h.bootstrapped;o&&(r.props.onBeforeLift?Promise.resolve(r.props.onBeforeLift()).finally(function(){return r.setState({bootstrapped:!0})}):r.setState({bootstrapped:!0}),r._unsubscribe&&r._unsubscribe())}),r}return _createClass(e,[{key:"componentDidMount",value:function(){this._unsubscribe=this.props.persistor.subscribe(this.handlePersistorState),this.handlePersistorState()}},{key:"componentWillUnmount",value:function(){this._unsubscribe&&this._unsubscribe()}},{key:"render",value:function(){return typeof this.props.children=="function"?this.props.children(this.state.bootstrapped):this.state.bootstrapped?this.props.children:this.props.loading}}]),e}(reactExports.PureComponent);_defineProperty$3(PersistGate,"defaultProps",{children:null,loading:null});var NOTHING=Symbol.for("immer-nothing"),DRAFTABLE=Symbol.for("immer-draftable"),DRAFT_STATE=Symbol.for("immer-state");function die(n,...e){throw new Error(`[Immer] minified error nr: ${n}. Full error at: https://bit.ly/3cXEKWf`)}var getPrototypeOf=Object.getPrototypeOf;function isDraft(n){return!!n&&!!n[DRAFT_STATE]}function isDraftable(n){var e;return n?isPlainObject(n)||Array.isArray(n)||!!n[DRAFTABLE]||!!((e=n.constructor)!=null&&e[DRAFTABLE])||isMap(n)||isSet(n):!1}var objectCtorString=Object.prototype.constructor.toString();function isPlainObject(n){if(!n||typeof n!="object")return!1;const e=getPrototypeOf(n);if(e===null)return!0;const t=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return t===Object?!0:typeof t=="function"&&Function.toString.call(t)===objectCtorString}function each(n,e){getArchtype(n)===0?Reflect.ownKeys(n).forEach(t=>{e(t,n[t],n)}):n.forEach((t,r)=>e(r,t,n))}function getArchtype(n){const e=n[DRAFT_STATE];return e?e.type_:Array.isArray(n)?1:isMap(n)?2:isSet(n)?3:0}function has(n,e){return getArchtype(n)===2?n.has(e):Object.prototype.hasOwnProperty.call(n,e)}function set(n,e,t){const r=getArchtype(n);r===2?n.set(e,t):r===3?n.add(t):n[e]=t}function is(n,e){return n===e?n!==0||1/n===1/e:n!==n&&e!==e}function isMap(n){return n instanceof Map}function isSet(n){return n instanceof Set}function latest(n){return n.copy_||n.base_}function shallowCopy(n,e){if(isMap(n))return new Map(n);if(isSet(n))return new Set(n);if(Array.isArray(n))return Array.prototype.slice.call(n);const t=isPlainObject(n);if(e===!0||e==="class_only"&&!t){const r=Object.getOwnPropertyDescriptors(n);delete r[DRAFT_STATE];let a=Reflect.ownKeys(r);for(let i=0;i<a.length;i++){const c=a[i],l=r[c];l.writable===!1&&(l.writable=!0,l.configurable=!0),(l.get||l.set)&&(r[c]={configurable:!0,writable:!0,enumerable:l.enumerable,value:n[c]})}return Object.create(getPrototypeOf(n),r)}else{const r=getPrototypeOf(n);if(r!==null&&t)return{...n};const a=Object.create(r);return Object.assign(a,n)}}function freeze(n,e=!1){return isFrozen(n)||isDraft(n)||!isDraftable(n)||(getArchtype(n)>1&&(n.set=n.add=n.clear=n.delete=dontMutateFrozenCollections),Object.freeze(n),e&&Object.entries(n).forEach(([t,r])=>freeze(r,!0))),n}function dontMutateFrozenCollections(){die(2)}function isFrozen(n){return Object.isFrozen(n)}var plugins={};function getPlugin(n){const e=plugins[n];return e||die(0,n),e}var currentScope;function getCurrentScope(){return currentScope}function createScope(n,e){return{drafts_:[],parent_:n,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function usePatchesInScope(n,e){e&&(getPlugin("Patches"),n.patches_=[],n.inversePatches_=[],n.patchListener_=e)}function revokeScope(n){leaveScope(n),n.drafts_.forEach(revokeDraft),n.drafts_=null}function leaveScope(n){n===currentScope&&(currentScope=n.parent_)}function enterScope(n){return currentScope=createScope(currentScope,n)}function revokeDraft(n){const e=n[DRAFT_STATE];e.type_===0||e.type_===1?e.revoke_():e.revoked_=!0}function processResult(n,e){e.unfinalizedDrafts_=e.drafts_.length;const t=e.drafts_[0];return n!==void 0&&n!==t?(t[DRAFT_STATE].modified_&&(revokeScope(e),die(4)),isDraftable(n)&&(n=finalize(e,n),e.parent_||maybeFreeze(e,n)),e.patches_&&getPlugin("Patches").generateReplacementPatches_(t[DRAFT_STATE].base_,n,e.patches_,e.inversePatches_)):n=finalize(e,t,[]),revokeScope(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),n!==NOTHING?n:void 0}function finalize(n,e,t){if(isFrozen(e))return e;const r=e[DRAFT_STATE];if(!r)return each(e,(a,i)=>finalizeProperty(n,r,e,a,i,t)),e;if(r.scope_!==n)return e;if(!r.modified_)return maybeFreeze(n,r.base_,!0),r.base_;if(!r.finalized_){r.finalized_=!0,r.scope_.unfinalizedDrafts_--;const a=r.copy_;let i=a,c=!1;r.type_===3&&(i=new Set(a),a.clear(),c=!0),each(i,(l,h)=>finalizeProperty(n,r,a,l,h,t,c)),maybeFreeze(n,a,!1),t&&n.patches_&&getPlugin("Patches").generatePatches_(r,t,n.patches_,n.inversePatches_)}return r.copy_}function finalizeProperty(n,e,t,r,a,i,c){if(isDraft(a)){const l=i&&e&&e.type_!==3&&!has(e.assigned_,r)?i.concat(r):void 0,h=finalize(n,a,l);if(set(t,r,h),isDraft(h))n.canAutoFreeze_=!1;else return}else c&&t.add(a);if(isDraftable(a)&&!isFrozen(a)){if(!n.immer_.autoFreeze_&&n.unfinalizedDrafts_<1)return;finalize(n,a),(!e||!e.scope_.parent_)&&typeof r!="symbol"&&Object.prototype.propertyIsEnumerable.call(t,r)&&maybeFreeze(n,a)}}function maybeFreeze(n,e,t=!1){!n.parent_&&n.immer_.autoFreeze_&&n.canAutoFreeze_&&freeze(e,t)}function createProxyProxy(n,e){const t=Array.isArray(n),r={type_:t?1:0,scope_:e?e.scope_:getCurrentScope(),modified_:!1,finalized_:!1,assigned_:{},parent_:e,base_:n,draft_:null,copy_:null,revoke_:null,isManual_:!1};let a=r,i=objectTraps;t&&(a=[r],i=arrayTraps);const{revoke:c,proxy:l}=Proxy.revocable(a,i);return r.draft_=l,r.revoke_=c,l}var objectTraps={get(n,e){if(e===DRAFT_STATE)return n;const t=latest(n);if(!has(t,e))return readPropFromProto(n,t,e);const r=t[e];return n.finalized_||!isDraftable(r)?r:r===peek(n.base_,e)?(prepareCopy(n),n.copy_[e]=createProxy(r,n)):r},has(n,e){return e in latest(n)},ownKeys(n){return Reflect.ownKeys(latest(n))},set(n,e,t){const r=getDescriptorFromProto(latest(n),e);if(r!=null&&r.set)return r.set.call(n.draft_,t),!0;if(!n.modified_){const a=peek(latest(n),e),i=a==null?void 0:a[DRAFT_STATE];if(i&&i.base_===t)return n.copy_[e]=t,n.assigned_[e]=!1,!0;if(is(t,a)&&(t!==void 0||has(n.base_,e)))return!0;prepareCopy(n),markChanged(n)}return n.copy_[e]===t&&(t!==void 0||e in n.copy_)||Number.isNaN(t)&&Number.isNaN(n.copy_[e])||(n.copy_[e]=t,n.assigned_[e]=!0),!0},deleteProperty(n,e){return peek(n.base_,e)!==void 0||e in n.base_?(n.assigned_[e]=!1,prepareCopy(n),markChanged(n)):delete n.assigned_[e],n.copy_&&delete n.copy_[e],!0},getOwnPropertyDescriptor(n,e){const t=latest(n),r=Reflect.getOwnPropertyDescriptor(t,e);return r&&{writable:!0,configurable:n.type_!==1||e!=="length",enumerable:r.enumerable,value:t[e]}},defineProperty(){die(11)},getPrototypeOf(n){return getPrototypeOf(n.base_)},setPrototypeOf(){die(12)}},arrayTraps={};each(objectTraps,(n,e)=>{arrayTraps[n]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}});arrayTraps.deleteProperty=function(n,e){return arrayTraps.set.call(this,n,e,void 0)};arrayTraps.set=function(n,e,t){return objectTraps.set.call(this,n[0],e,t,n[0])};function peek(n,e){const t=n[DRAFT_STATE];return(t?latest(t):n)[e]}function readPropFromProto(n,e,t){var a;const r=getDescriptorFromProto(e,t);return r?"value"in r?r.value:(a=r.get)==null?void 0:a.call(n.draft_):void 0}function getDescriptorFromProto(n,e){if(!(e in n))return;let t=getPrototypeOf(n);for(;t;){const r=Object.getOwnPropertyDescriptor(t,e);if(r)return r;t=getPrototypeOf(t)}}function markChanged(n){n.modified_||(n.modified_=!0,n.parent_&&markChanged(n.parent_))}function prepareCopy(n){n.copy_||(n.copy_=shallowCopy(n.base_,n.scope_.immer_.useStrictShallowCopy_))}var Immer2=class{constructor(n){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,t,r)=>{if(typeof e=="function"&&typeof t!="function"){const i=t;t=e;const c=this;return function(h=i,...o){return c.produce(h,s=>t.call(this,s,...o))}}typeof t!="function"&&die(6),r!==void 0&&typeof r!="function"&&die(7);let a;if(isDraftable(e)){const i=enterScope(this),c=createProxy(e,void 0);let l=!0;try{a=t(c),l=!1}finally{l?revokeScope(i):leaveScope(i)}return usePatchesInScope(i,r),processResult(a,i)}else if(!e||typeof e!="object"){if(a=t(e),a===void 0&&(a=e),a===NOTHING&&(a=void 0),this.autoFreeze_&&freeze(a,!0),r){const i=[],c=[];getPlugin("Patches").generateReplacementPatches_(e,a,i,c),r(i,c)}return a}else die(1,e)},this.produceWithPatches=(e,t)=>{if(typeof e=="function")return(c,...l)=>this.produceWithPatches(c,h=>e(h,...l));let r,a;return[this.produce(e,t,(c,l)=>{r=c,a=l}),r,a]},typeof(n==null?void 0:n.autoFreeze)=="boolean"&&this.setAutoFreeze(n.autoFreeze),typeof(n==null?void 0:n.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(n.useStrictShallowCopy)}createDraft(n){isDraftable(n)||die(8),isDraft(n)&&(n=current(n));const e=enterScope(this),t=createProxy(n,void 0);return t[DRAFT_STATE].isManual_=!0,leaveScope(e),t}finishDraft(n,e){const t=n&&n[DRAFT_STATE];(!t||!t.isManual_)&&die(9);const{scope_:r}=t;return usePatchesInScope(r,e),processResult(void 0,r)}setAutoFreeze(n){this.autoFreeze_=n}setUseStrictShallowCopy(n){this.useStrictShallowCopy_=n}applyPatches(n,e){let t;for(t=e.length-1;t>=0;t--){const a=e[t];if(a.path.length===0&&a.op==="replace"){n=a.value;break}}t>-1&&(e=e.slice(t+1));const r=getPlugin("Patches").applyPatches_;return isDraft(n)?r(n,e):this.produce(n,a=>r(a,e))}};function createProxy(n,e){const t=isMap(n)?getPlugin("MapSet").proxyMap_(n,e):isSet(n)?getPlugin("MapSet").proxySet_(n,e):createProxyProxy(n,e);return(e?e.scope_:getCurrentScope()).drafts_.push(t),t}function current(n){return isDraft(n)||die(10,n),currentImpl(n)}function currentImpl(n){if(!isDraftable(n)||isFrozen(n))return n;const e=n[DRAFT_STATE];let t;if(e){if(!e.modified_)return e.base_;e.finalized_=!0,t=shallowCopy(n,e.scope_.immer_.useStrictShallowCopy_)}else t=shallowCopy(n,!0);return each(t,(r,a)=>{set(t,r,currentImpl(a))}),e&&(e.finalized_=!1),t}var immer=new Immer2,produce=immer.produce;immer.produceWithPatches.bind(immer);immer.setAutoFreeze.bind(immer);immer.setUseStrictShallowCopy.bind(immer);immer.applyPatches.bind(immer);immer.createDraft.bind(immer);immer.finishDraft.bind(immer);function assertIsFunction(n,e=`expected a function, instead received ${typeof n}`){if(typeof n!="function")throw new TypeError(e)}function assertIsObject(n,e=`expected an object, instead received ${typeof n}`){if(typeof n!="object")throw new TypeError(e)}function assertIsArrayOfFunctions(n,e="expected all items to be functions, instead received the following types: "){if(!n.every(t=>typeof t=="function")){const t=n.map(r=>typeof r=="function"?`function ${r.name||"unnamed"}()`:typeof r).join(", ");throw new TypeError(`${e}[${t}]`)}}var ensureIsArray=n=>Array.isArray(n)?n:[n];function getDependencies(n){const e=Array.isArray(n[0])?n[0]:n;return assertIsArrayOfFunctions(e,"createSelector expects all input-selectors to be functions, but received the following types: "),e}function collectInputSelectorResults(n,e){const t=[],{length:r}=n;for(let a=0;a<r;a++)t.push(n[a].apply(null,e));return t}var StrongRef=class{constructor(n){this.value=n}deref(){return this.value}},Ref=typeof WeakRef<"u"?WeakRef:StrongRef,UNTERMINATED=0,TERMINATED=1;function createCacheNode(){return{s:UNTERMINATED,v:void 0,o:null,p:null}}function weakMapMemoize(n,e={}){let t=createCacheNode();const{resultEqualityCheck:r}=e;let a,i=0;function c(){var f;let l=t;const{length:h}=arguments;for(let u=0,p=h;u<p;u++){const v=arguments[u];if(typeof v=="function"||typeof v=="object"&&v!==null){let g=l.o;g===null&&(l.o=g=new WeakMap);const A=g.get(v);A===void 0?(l=createCacheNode(),g.set(v,l)):l=A}else{let g=l.p;g===null&&(l.p=g=new Map);const A=g.get(v);A===void 0?(l=createCacheNode(),g.set(v,l)):l=A}}const o=l;let s;if(l.s===TERMINATED)s=l.v;else if(s=n.apply(null,arguments),i++,r){const u=((f=a==null?void 0:a.deref)==null?void 0:f.call(a))??a;u!=null&&r(u,s)&&(s=u,i!==0&&i--),a=typeof s=="object"&&s!==null||typeof s=="function"?new Ref(s):s}return o.s=TERMINATED,o.v=s,s}return c.clearCache=()=>{t=createCacheNode(),c.resetResultsCount()},c.resultsCount=()=>i,c.resetResultsCount=()=>{i=0},c}function createSelectorCreator(n,...e){const t=typeof n=="function"?{memoize:n,memoizeOptions:e}:n,r=(...a)=>{let i=0,c=0,l,h={},o=a.pop();typeof o=="object"&&(h=o,o=a.pop()),assertIsFunction(o,`createSelector expects an output function after the inputs, but received: [${typeof o}]`);const s={...t,...h},{memoize:f,memoizeOptions:u=[],argsMemoize:p=weakMapMemoize,argsMemoizeOptions:v=[]}=s,g=ensureIsArray(u),A=ensureIsArray(v),T=getDependencies(a),b=f(function(){return i++,o.apply(null,arguments)},...g),_=p(function(){c++;const m=collectInputSelectorResults(T,arguments);return l=b.apply(null,m),l},...A);return Object.assign(_,{resultFunc:o,memoizedResultFunc:b,dependencies:T,dependencyRecomputations:()=>c,resetDependencyRecomputations:()=>{c=0},lastResult:()=>l,recomputations:()=>i,resetRecomputations:()=>{i=0},memoize:f,argsMemoize:p})};return Object.assign(r,{withTypes:()=>r}),r}var createSelector=createSelectorCreator(weakMapMemoize),createStructuredSelector=Object.assign((n,e=createSelector)=>{assertIsObject(n,`createStructuredSelector expects first argument to be an object where each property is a selector, instead received a ${typeof n}`);const t=Object.keys(n),r=t.map(i=>n[i]);return e(r,(...i)=>i.reduce((c,l,h)=>(c[t[h]]=l,c),{}))},{withTypes:()=>createStructuredSelector});function createThunkMiddleware(n){return({dispatch:t,getState:r})=>a=>i=>typeof i=="function"?i(t,r,n):a(i)}var thunk=createThunkMiddleware(),withExtraArgument=createThunkMiddleware,composeWithDevTools=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?compose:compose.apply(null,arguments)},hasMatchFunction=n=>n&&typeof n.match=="function";function createAction(n,e){function t(...r){if(e){let a=e(...r);if(!a)throw new Error(formatProdErrorMessage(0));return{type:n,payload:a.payload,..."meta"in a&&{meta:a.meta},..."error"in a&&{error:a.error}}}return{type:n,payload:r[0]}}return t.toString=()=>`${n}`,t.type=n,t.match=r=>isAction(r)&&r.type===n,t}var Tuple=class cr extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,cr.prototype)}static get[Symbol.species](){return cr}concat(...e){return super.concat.apply(this,e)}prepend(...e){return e.length===1&&Array.isArray(e[0])?new cr(...e[0].concat(this)):new cr(...e.concat(this))}};function freezeDraftable(n){return isDraftable(n)?produce(n,()=>{}):n}function getOrInsertComputed(n,e,t){return n.has(e)?n.get(e):n.set(e,t(e)).get(e)}function isBoolean(n){return typeof n=="boolean"}var buildGetDefaultMiddleware=()=>function(e){const{thunk:t=!0,immutableCheck:r=!0,serializableCheck:a=!0,actionCreatorCheck:i=!0}=e??{};let c=new Tuple;return t&&(isBoolean(t)?c.push(thunk):c.push(withExtraArgument(t.extraArgument))),c},SHOULD_AUTOBATCH="RTK_autoBatch",createQueueWithTimer=n=>e=>{setTimeout(e,n)},autoBatchEnhancer=(n={type:"raf"})=>e=>(...t)=>{const r=e(...t);let a=!0,i=!1,c=!1;const l=new Set,h=n.type==="tick"?queueMicrotask:n.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:createQueueWithTimer(10):n.type==="callback"?n.queueNotification:createQueueWithTimer(n.timeout),o=()=>{c=!1,i&&(i=!1,l.forEach(s=>s()))};return Object.assign({},r,{subscribe(s){const f=()=>a&&s(),u=r.subscribe(f);return l.add(s),()=>{u(),l.delete(s)}},dispatch(s){var f;try{return a=!((f=s==null?void 0:s.meta)!=null&&f[SHOULD_AUTOBATCH]),i=!a,i&&(c||(c=!0,h(o))),r.dispatch(s)}finally{a=!0}}})},buildGetDefaultEnhancers=n=>function(t){const{autoBatch:r=!0}=t??{};let a=new Tuple(n);return r&&a.push(autoBatchEnhancer(typeof r=="object"?r:void 0)),a};function configureStore(n){const e=buildGetDefaultMiddleware(),{reducer:t=void 0,middleware:r,devTools:a=!0,preloadedState:i=void 0,enhancers:c=void 0}=n||{};let l;if(typeof t=="function")l=t;else if(isPlainObject$1(t))l=combineReducers(t);else throw new Error(formatProdErrorMessage(1));let h;typeof r=="function"?h=r(e):h=e();let o=compose;a&&(o=composeWithDevTools({trace:!1,...typeof a=="object"&&a}));const s=applyMiddleware(...h),f=buildGetDefaultEnhancers(s);let u=typeof c=="function"?c(f):f();const p=o(...u);return createStore(l,i,p)}function executeReducerBuilderCallback(n){const e={},t=[];let r;const a={addCase(i,c){const l=typeof i=="string"?i:i.type;if(!l)throw new Error(formatProdErrorMessage(28));if(l in e)throw new Error(formatProdErrorMessage(29));return e[l]=c,a},addMatcher(i,c){return t.push({matcher:i,reducer:c}),a},addDefaultCase(i){return r=i,a}};return n(a),[e,t,r]}function isStateFunction(n){return typeof n=="function"}function createReducer(n,e){let[t,r,a]=executeReducerBuilderCallback(e),i;if(isStateFunction(n))i=()=>freezeDraftable(n());else{const l=freezeDraftable(n);i=()=>l}function c(l=i(),h){let o=[t[h.type],...r.filter(({matcher:s})=>s(h)).map(({reducer:s})=>s)];return o.filter(s=>!!s).length===0&&(o=[a]),o.reduce((s,f)=>{if(f)if(isDraft(s)){const p=f(s,h);return p===void 0?s:p}else{if(isDraftable(s))return produce(s,u=>f(u,h));{const u=f(s,h);if(u===void 0){if(s===null)return s;throw Error("A case reducer on a non-draftable value must not return undefined")}return u}}return s},l)}return c.getInitialState=i,c}var matches=(n,e)=>hasMatchFunction(n)?n.match(e):n(e);function isAnyOf(...n){return e=>n.some(t=>matches(t,e))}var urlAlphabet="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",nanoid=(n=21)=>{let e="",t=n;for(;t--;)e+=urlAlphabet[Math.random()*64|0];return e},commonProperties=["name","message","stack","code"],RejectWithValue=class{constructor(n,e){Te(this,"_type");this.payload=n,this.meta=e}},FulfillWithMeta=class{constructor(n,e){Te(this,"_type");this.payload=n,this.meta=e}},miniSerializeError=n=>{if(typeof n=="object"&&n!==null){const e={};for(const t of commonProperties)typeof n[t]=="string"&&(e[t]=n[t]);return e}return{message:String(n)}},externalAbortMessage="External signal was aborted",createAsyncThunk=(()=>{function n(e,t,r){const a=createAction(e+"/fulfilled",(h,o,s,f)=>({payload:h,meta:{...f||{},arg:s,requestId:o,requestStatus:"fulfilled"}})),i=createAction(e+"/pending",(h,o,s)=>({payload:void 0,meta:{...s||{},arg:o,requestId:h,requestStatus:"pending"}})),c=createAction(e+"/rejected",(h,o,s,f,u)=>({payload:f,error:(r&&r.serializeError||miniSerializeError)(h||"Rejected"),meta:{...u||{},arg:s,requestId:o,rejectedWithValue:!!f,requestStatus:"rejected",aborted:(h==null?void 0:h.name)==="AbortError",condition:(h==null?void 0:h.name)==="ConditionError"}}));function l(h,{signal:o}={}){return(s,f,u)=>{const p=r!=null&&r.idGenerator?r.idGenerator(h):nanoid(),v=new AbortController;let g,A;function T(_){A=_,v.abort()}o&&(o.aborted?T(externalAbortMessage):o.addEventListener("abort",()=>T(externalAbortMessage),{once:!0}));const b=async function(){var m,S;let _;try{let C=(m=r==null?void 0:r.condition)==null?void 0:m.call(r,h,{getState:f,extra:u});if(isThenable(C)&&(C=await C),C===!1||v.signal.aborted)throw{name:"ConditionError",message:"Aborted due to condition callback returning false."};const x=new Promise((R,M)=>{g=()=>{M({name:"AbortError",message:A||"Aborted"})},v.signal.addEventListener("abort",g)});s(i(p,h,(S=r==null?void 0:r.getPendingMeta)==null?void 0:S.call(r,{requestId:p,arg:h},{getState:f,extra:u}))),_=await Promise.race([x,Promise.resolve(t(h,{dispatch:s,getState:f,extra:u,requestId:p,signal:v.signal,abort:T,rejectWithValue:(R,M)=>new RejectWithValue(R,M),fulfillWithValue:(R,M)=>new FulfillWithMeta(R,M)})).then(R=>{if(R instanceof RejectWithValue)throw R;return R instanceof FulfillWithMeta?a(R.payload,p,h,R.meta):a(R,p,h)})])}catch(C){_=C instanceof RejectWithValue?c(null,p,h,C.payload,C.meta):c(C,p,h)}finally{g&&v.signal.removeEventListener("abort",g)}return r&&!r.dispatchConditionRejection&&c.match(_)&&_.meta.condition||s(_),_}();return Object.assign(b,{abort:T,requestId:p,arg:h,unwrap(){return b.then(unwrapResult)}})}}return Object.assign(l,{pending:i,rejected:c,fulfilled:a,settled:isAnyOf(c,a),typePrefix:e})}return n.withTypes=()=>n,n})();function unwrapResult(n){if(n.meta&&n.meta.rejectedWithValue)throw n.payload;if(n.error)throw n.error;return n.payload}function isThenable(n){return n!==null&&typeof n=="object"&&typeof n.then=="function"}var asyncThunkSymbol=Symbol.for("rtk-slice-createasyncthunk");function getType(n,e){return`${n}/${e}`}function buildCreateSlice({creators:n}={}){var t;const e=(t=n==null?void 0:n.asyncThunk)==null?void 0:t[asyncThunkSymbol];return function(a){const{name:i,reducerPath:c=i}=a;if(!i)throw new Error(formatProdErrorMessage(11));const l=(typeof a.reducers=="function"?a.reducers(buildReducerCreators()):a.reducers)||{},h=Object.keys(l),o={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},s={addCase(w,m){const S=typeof w=="string"?w:w.type;if(!S)throw new Error(formatProdErrorMessage(12));if(S in o.sliceCaseReducersByType)throw new Error(formatProdErrorMessage(13));return o.sliceCaseReducersByType[S]=m,s},addMatcher(w,m){return o.sliceMatchers.push({matcher:w,reducer:m}),s},exposeAction(w,m){return o.actionCreators[w]=m,s},exposeCaseReducer(w,m){return o.sliceCaseReducersByName[w]=m,s}};h.forEach(w=>{const m=l[w],S={reducerName:w,type:getType(i,w),createNotation:typeof a.reducers=="function"};isAsyncThunkSliceReducerDefinition(m)?handleThunkCaseReducerDefinition(S,m,s,e):handleNormalReducerDefinition(S,m,s)});function f(){const[w={},m=[],S=void 0]=typeof a.extraReducers=="function"?executeReducerBuilderCallback(a.extraReducers):[a.extraReducers],C={...w,...o.sliceCaseReducersByType};return createReducer(a.initialState,x=>{for(let R in C)x.addCase(R,C[R]);for(let R of o.sliceMatchers)x.addMatcher(R.matcher,R.reducer);for(let R of m)x.addMatcher(R.matcher,R.reducer);S&&x.addDefaultCase(S)})}const u=w=>w,p=new Map,v=new WeakMap;let g;function A(w,m){return g||(g=f()),g(w,m)}function T(){return g||(g=f()),g.getInitialState()}function b(w,m=!1){function S(x){let R=x[w];return typeof R>"u"&&m&&(R=getOrInsertComputed(v,S,T)),R}function C(x=u){const R=getOrInsertComputed(p,m,()=>new WeakMap);return getOrInsertComputed(R,x,()=>{const M={};for(const[F,H]of Object.entries(a.selectors??{}))M[F]=wrapSelector(H,x,()=>getOrInsertComputed(v,x,T),m);return M})}return{reducerPath:w,getSelectors:C,get selectors(){return C(S)},selectSlice:S}}const _={name:i,reducer:A,actions:o.actionCreators,caseReducers:o.sliceCaseReducersByName,getInitialState:T,...b(c),injectInto(w,{reducerPath:m,...S}={}){const C=m??c;return w.inject({reducerPath:C,reducer:A},S),{..._,...b(C,!0)}}};return _}}function wrapSelector(n,e,t,r){function a(i,...c){let l=e(i);return typeof l>"u"&&r&&(l=t()),n(l,...c)}return a.unwrapped=n,a}var createSlice=buildCreateSlice();function buildReducerCreators(){function n(e,t){return{_reducerDefinitionType:"asyncThunk",payloadCreator:e,...t}}return n.withTypes=()=>n,{reducer(e){return Object.assign({[e.name](...t){return e(...t)}}[e.name],{_reducerDefinitionType:"reducer"})},preparedReducer(e,t){return{_reducerDefinitionType:"reducerWithPrepare",prepare:e,reducer:t}},asyncThunk:n}}function handleNormalReducerDefinition({type:n,reducerName:e,createNotation:t},r,a){let i,c;if("reducer"in r){if(t&&!isCaseReducerWithPrepareDefinition(r))throw new Error(formatProdErrorMessage(17));i=r.reducer,c=r.prepare}else i=r;a.addCase(n,i).exposeCaseReducer(e,i).exposeAction(e,c?createAction(n,c):createAction(n))}function isAsyncThunkSliceReducerDefinition(n){return n._reducerDefinitionType==="asyncThunk"}function isCaseReducerWithPrepareDefinition(n){return n._reducerDefinitionType==="reducerWithPrepare"}function handleThunkCaseReducerDefinition({type:n,reducerName:e},t,r,a){if(!a)throw new Error(formatProdErrorMessage(18));const{payloadCreator:i,fulfilled:c,pending:l,rejected:h,settled:o,options:s}=t,f=a(n,i,s);r.exposeAction(e,f),c&&r.addCase(f.fulfilled,c),l&&r.addCase(f.pending,l),h&&r.addCase(f.rejected,h),o&&r.addMatcher(f.settled,o),r.exposeCaseReducer(e,{fulfilled:c||noop,pending:l||noop,rejected:h||noop,settled:o||noop})}function noop(){}var task="task",listener="listener",completed="completed",cancelled="cancelled",taskCancelled=`task-${cancelled}`,taskCompleted=`task-${completed}`,listenerCancelled=`${listener}-${cancelled}`,listenerCompleted=`${listener}-${completed}`,TaskAbortError=class{constructor(n){Te(this,"name","TaskAbortError");Te(this,"message");this.code=n,this.message=`${task} ${cancelled} (reason: ${n})`}},assertFunction=(n,e)=>{if(typeof n!="function")throw new TypeError(formatProdErrorMessage(32))},noop2=()=>{},catchRejection=(n,e=noop2)=>(n.catch(e),n),addAbortSignalListener=(n,e)=>(n.addEventListener("abort",e,{once:!0}),()=>n.removeEventListener("abort",e)),abortControllerWithReason=(n,e)=>{const t=n.signal;t.aborted||("reason"in t||Object.defineProperty(t,"reason",{enumerable:!0,value:e,configurable:!0,writable:!0}),n.abort(e))},validateActive=n=>{if(n.aborted){const{reason:e}=n;throw new TaskAbortError(e)}};function raceWithSignal(n,e){let t=noop2;return new Promise((r,a)=>{const i=()=>a(new TaskAbortError(n.reason));if(n.aborted){i();return}t=addAbortSignalListener(n,i),e.finally(()=>t()).then(r,a)}).finally(()=>{t=noop2})}var runTask=async(n,e)=>{try{return await Promise.resolve(),{status:"ok",value:await n()}}catch(t){return{status:t instanceof TaskAbortError?"cancelled":"rejected",error:t}}finally{e==null||e()}},createPause=n=>e=>catchRejection(raceWithSignal(n,e).then(t=>(validateActive(n),t))),createDelay=n=>{const e=createPause(n);return t=>e(new Promise(r=>setTimeout(r,t)))},{assign}=Object,INTERNAL_NIL_TOKEN={},alm="listenerMiddleware",createFork=(n,e)=>{const t=r=>addAbortSignalListener(n,()=>abortControllerWithReason(r,n.reason));return(r,a)=>{assertFunction(r);const i=new AbortController;t(i);const c=runTask(async()=>{validateActive(n),validateActive(i.signal);const l=await r({pause:createPause(i.signal),delay:createDelay(i.signal),signal:i.signal});return validateActive(i.signal),l},()=>abortControllerWithReason(i,taskCompleted));return a!=null&&a.autoJoin&&e.push(c.catch(noop2)),{result:createPause(n)(c),cancel(){abortControllerWithReason(i,taskCancelled)}}}},createTakePattern=(n,e)=>{const t=async(r,a)=>{validateActive(e);let i=()=>{};const l=[new Promise((h,o)=>{let s=n({predicate:r,effect:(f,u)=>{u.unsubscribe(),h([f,u.getState(),u.getOriginalState()])}});i=()=>{s(),o()}})];a!=null&&l.push(new Promise(h=>setTimeout(h,a,null)));try{const h=await raceWithSignal(e,Promise.race(l));return validateActive(e),h}finally{i()}};return(r,a)=>catchRejection(t(r,a))},getListenerEntryPropsFrom=n=>{let{type:e,actionCreator:t,matcher:r,predicate:a,effect:i}=n;if(e)a=createAction(e).match;else if(t)e=t.type,a=t.match;else if(r)a=r;else if(!a)throw new Error(formatProdErrorMessage(21));return assertFunction(i),{predicate:a,type:e,effect:i}},createListenerEntry=assign(n=>{const{type:e,predicate:t,effect:r}=getListenerEntryPropsFrom(n);return{id:nanoid(),effect:r,type:e,predicate:t,pending:new Set,unsubscribe:()=>{throw new Error(formatProdErrorMessage(22))}}},{withTypes:()=>createListenerEntry}),findListenerEntry=(n,e)=>{const{type:t,effect:r,predicate:a}=getListenerEntryPropsFrom(e);return Array.from(n.values()).find(i=>(typeof t=="string"?i.type===t:i.predicate===a)&&i.effect===r)},cancelActiveListeners=n=>{n.pending.forEach(e=>{abortControllerWithReason(e,listenerCancelled)})},createClearListenerMiddleware=n=>()=>{n.forEach(cancelActiveListeners),n.clear()},safelyNotifyError=(n,e,t)=>{try{n(e,t)}catch(r){setTimeout(()=>{throw r},0)}},addListener=assign(createAction(`${alm}/add`),{withTypes:()=>addListener}),clearAllListeners=createAction(`${alm}/removeAll`),removeListener=assign(createAction(`${alm}/remove`),{withTypes:()=>removeListener}),defaultErrorHandler=(...n)=>{console.error(`${alm}/error`,...n)},createListenerMiddleware=(n={})=>{const e=new Map,{extra:t,onError:r=defaultErrorHandler}=n;assertFunction(r);const a=s=>(s.unsubscribe=()=>e.delete(s.id),e.set(s.id,s),f=>{s.unsubscribe(),f!=null&&f.cancelActive&&cancelActiveListeners(s)}),i=s=>{const f=findListenerEntry(e,s)??createListenerEntry(s);return a(f)};assign(i,{withTypes:()=>i});const c=s=>{const f=findListenerEntry(e,s);return f&&(f.unsubscribe(),s.cancelActive&&cancelActiveListeners(f)),!!f};assign(c,{withTypes:()=>c});const l=async(s,f,u,p)=>{const v=new AbortController,g=createTakePattern(i,v.signal),A=[];try{s.pending.add(v),await Promise.resolve(s.effect(f,assign({},u,{getOriginalState:p,condition:(T,b)=>g(T,b).then(Boolean),take:g,delay:createDelay(v.signal),pause:createPause(v.signal),extra:t,signal:v.signal,fork:createFork(v.signal,A),unsubscribe:s.unsubscribe,subscribe:()=>{e.set(s.id,s)},cancelActiveListeners:()=>{s.pending.forEach((T,b,_)=>{T!==v&&(abortControllerWithReason(T,listenerCancelled),_.delete(T))})},cancel:()=>{abortControllerWithReason(v,listenerCancelled),s.pending.delete(v)},throwIfCancelled:()=>{validateActive(v.signal)}})))}catch(T){T instanceof TaskAbortError||safelyNotifyError(r,T,{raisedBy:"effect"})}finally{await Promise.all(A),abortControllerWithReason(v,listenerCompleted),s.pending.delete(v)}},h=createClearListenerMiddleware(e);return{middleware:s=>f=>u=>{if(!isAction(u))return f(u);if(addListener.match(u))return i(u.payload);if(clearAllListeners.match(u)){h();return}if(removeListener.match(u))return c(u.payload);let p=s.getState();const v=()=>{if(p===INTERNAL_NIL_TOKEN)throw new Error(formatProdErrorMessage(23));return p};let g;try{if(g=f(u),e.size>0){const A=s.getState(),T=Array.from(e.values());for(const b of T){let _=!1;try{_=b.predicate(u,A,p)}catch(w){_=!1,safelyNotifyError(r,w,{raisedBy:"predicate"})}_&&l(b,u,s,v)}}}finally{p=INTERNAL_NIL_TOKEN}return g},startListening:i,stopListening:c,clearListeners:h}};function formatProdErrorMessage(n){return`Minified Redux Toolkit error #${n}; visit https://redux-toolkit.js.org/Errors?code=${n} for the full message or use the non-minified dev environment for full errors. `}var KEY_PREFIX="persist:",FLUSH="persist/FLUSH",REHYDRATE="persist/REHYDRATE",PAUSE="persist/PAUSE",PERSIST="persist/PERSIST",PURGE="persist/PURGE",REGISTER="persist/REGISTER",DEFAULT_VERSION=-1;function _typeof(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_typeof=function(t){return typeof t}:_typeof=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(n)}function ownKeys$2(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function _objectSpread$2(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ownKeys$2(t,!0).forEach(function(r){_defineProperty$2(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):ownKeys$2(t).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function _defineProperty$2(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function autoMergeLevel1(n,e,t,r){r.debug;var a=_objectSpread$2({},t);return n&&_typeof(n)==="object"&&Object.keys(n).forEach(function(i){i!=="_persist"&&e[i]===t[i]&&(a[i]=n[i])}),a}function createPersistoid(n){var e=n.blacklist||null,t=n.whitelist||null,r=n.transforms||[],a=n.throttle||0,i="".concat(n.keyPrefix!==void 0?n.keyPrefix:KEY_PREFIX).concat(n.key),c=n.storage,l;n.serialize===!1?l=function(m){return m}:typeof n.serialize=="function"?l=n.serialize:l=defaultSerialize;var h=n.writeFailHandler||null,o={},s={},f=[],u=null,p=null,v=function(m){Object.keys(m).forEach(function(S){T(S)&&o[S]!==m[S]&&f.indexOf(S)===-1&&f.push(S)}),Object.keys(o).forEach(function(S){m[S]===void 0&&T(S)&&f.indexOf(S)===-1&&o[S]!==void 0&&f.push(S)}),u===null&&(u=setInterval(g,a)),o=m};function g(){if(f.length===0){u&&clearInterval(u),u=null;return}var w=f.shift(),m=r.reduce(function(S,C){return C.in(S,w,o)},o[w]);if(m!==void 0)try{s[w]=l(m)}catch(S){console.error("redux-persist/createPersistoid: error serializing state",S)}else delete s[w];f.length===0&&A()}function A(){Object.keys(s).forEach(function(w){o[w]===void 0&&delete s[w]}),p=c.setItem(i,l(s)).catch(b)}function T(w){return!(t&&t.indexOf(w)===-1&&w!=="_persist"||e&&e.indexOf(w)!==-1)}function b(w){h&&h(w)}var _=function(){for(;f.length!==0;)g();return p||Promise.resolve()};return{update:v,flush:_}}function defaultSerialize(n){return JSON.stringify(n)}function getStoredState(n){var e=n.transforms||[],t="".concat(n.keyPrefix!==void 0?n.keyPrefix:KEY_PREFIX).concat(n.key),r=n.storage;n.debug;var a;return n.deserialize===!1?a=function(c){return c}:typeof n.deserialize=="function"?a=n.deserialize:a=defaultDeserialize,r.getItem(t).then(function(i){if(i)try{var c={},l=a(i);return Object.keys(l).forEach(function(h){c[h]=e.reduceRight(function(o,s){return s.out(o,h,l)},a(l[h]))}),c}catch(h){throw h}else return})}function defaultDeserialize(n){return JSON.parse(n)}function purgeStoredState(n){var e=n.storage,t="".concat(n.keyPrefix!==void 0?n.keyPrefix:KEY_PREFIX).concat(n.key);return e.removeItem(t,warnIfRemoveError)}function warnIfRemoveError(n){}function ownKeys$1(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function _objectSpread$1(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ownKeys$1(t,!0).forEach(function(r){_defineProperty$1(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):ownKeys$1(t).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function _defineProperty$1(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function _objectWithoutProperties(n,e){if(n==null)return{};var t=_objectWithoutPropertiesLoose(n,e),r,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);for(a=0;a<i.length;a++)r=i[a],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(t[r]=n[r])}return t}function _objectWithoutPropertiesLoose(n,e){if(n==null)return{};var t={},r=Object.keys(n),a,i;for(i=0;i<r.length;i++)a=r[i],!(e.indexOf(a)>=0)&&(t[a]=n[a]);return t}var DEFAULT_TIMEOUT=5e3;function persistReducer(n,e){var t=n.version!==void 0?n.version:DEFAULT_VERSION;n.debug;var r=n.stateReconciler===void 0?autoMergeLevel1:n.stateReconciler,a=n.getStoredState||getStoredState,i=n.timeout!==void 0?n.timeout:DEFAULT_TIMEOUT,c=null,l=!1,h=!0,o=function(f){return f._persist.rehydrated&&c&&!h&&c.update(f),f};return function(s,f){var u=s||{},p=u._persist,v=_objectWithoutProperties(u,["_persist"]),g=v;if(f.type===PERSIST){var A=!1,T=function(x,R){A||(f.rehydrate(n.key,x,R),A=!0)};if(i&&setTimeout(function(){!A&&T(void 0,new Error('redux-persist: persist timed out for persist key "'.concat(n.key,'"')))},i),h=!1,c||(c=createPersistoid(n)),p)return _objectSpread$1({},e(g,f),{_persist:p});if(typeof f.rehydrate!="function"||typeof f.register!="function")throw new Error("redux-persist: either rehydrate or register is not a function on the PERSIST action. This can happen if the action is being replayed. This is an unexplored use case, please open an issue and we will figure out a resolution.");return f.register(n.key),a(n).then(function(C){var x=n.migrate||function(R,M){return Promise.resolve(R)};x(C,t).then(function(R){T(R)},function(R){T(void 0,R)})},function(C){T(void 0,C)}),_objectSpread$1({},e(g,f),{_persist:{version:t,rehydrated:!1}})}else{if(f.type===PURGE)return l=!0,f.result(purgeStoredState(n)),_objectSpread$1({},e(g,f),{_persist:p});if(f.type===FLUSH)return f.result(c&&c.flush()),_objectSpread$1({},e(g,f),{_persist:p});if(f.type===PAUSE)h=!0;else if(f.type===REHYDRATE){if(l)return _objectSpread$1({},g,{_persist:_objectSpread$1({},p,{rehydrated:!0})});if(f.key===n.key){var b=e(g,f),_=f.payload,w=r!==!1&&_!==void 0?r(_,s,b,n):b,m=_objectSpread$1({},w,{_persist:_objectSpread$1({},p,{rehydrated:!0})});return o(m)}}}if(!p)return e(s,f);var S=e(g,f);return S===g?s:o(_objectSpread$1({},S,{_persist:p}))}}function _toConsumableArray(n){return _arrayWithoutHoles(n)||_iterableToArray(n)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(n){if(Symbol.iterator in Object(n)||Object.prototype.toString.call(n)==="[object Arguments]")return Array.from(n)}function _arrayWithoutHoles(n){if(Array.isArray(n)){for(var e=0,t=new Array(n.length);e<n.length;e++)t[e]=n[e];return t}}function ownKeys(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,r)}return t}function _objectSpread(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ownKeys(t,!0).forEach(function(r){_defineProperty(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):ownKeys(t).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function _defineProperty(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}var initialState$c={registry:[],bootstrapped:!1},persistorReducer=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:initialState$c,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case REGISTER:return _objectSpread({},e,{registry:[].concat(_toConsumableArray(e.registry),[t.key])});case REHYDRATE:var r=e.registry.indexOf(t.key),a=_toConsumableArray(e.registry);return a.splice(r,1),_objectSpread({},e,{registry:a,bootstrapped:a.length===0});default:return e}};function persistStore(n,e,t){var r=createStore(persistorReducer,initialState$c,void 0),a=function(h){r.dispatch({type:REGISTER,key:h})},i=function(h,o,s){var f={type:REHYDRATE,payload:o,err:s,key:h};n.dispatch(f),r.dispatch(f)},c=_objectSpread({},r,{purge:function(){var h=[];return n.dispatch({type:PURGE,result:function(s){h.push(s)}}),Promise.all(h)},flush:function(){var h=[];return n.dispatch({type:FLUSH,result:function(s){h.push(s)}}),Promise.all(h)},pause:function(){n.dispatch({type:PAUSE})},persist:function(){n.dispatch({type:PERSIST,register:a,rehydrate:i})}});return c.persist(),c}var storage$2={},createWebStorage={},getStorage$1={},hasRequiredGetStorage;function requireGetStorage(){if(hasRequiredGetStorage)return getStorage$1;hasRequiredGetStorage=1,getStorage$1.__esModule=!0,getStorage$1.default=a;function n(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?n=function(l){return typeof l}:n=function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l},n(i)}function e(){}var t={getItem:e,setItem:e,removeItem:e};function r(i){if((typeof self>"u"?"undefined":n(self))!=="object"||!(i in self))return!1;try{var c=self[i],l="redux-persist ".concat(i," test");c.setItem(l,"test"),c.getItem(l),c.removeItem(l)}catch{return!1}return!0}function a(i){var c="".concat(i,"Storage");return r(c)?self[c]:t}return getStorage$1}var hasRequiredCreateWebStorage;function requireCreateWebStorage(){if(hasRequiredCreateWebStorage)return createWebStorage;hasRequiredCreateWebStorage=1,createWebStorage.__esModule=!0,createWebStorage.default=t;var n=e(requireGetStorage());function e(r){return r&&r.__esModule?r:{default:r}}function t(r){var a=(0,n.default)(r);return{getItem:function(c){return new Promise(function(l,h){l(a.getItem(c))})},setItem:function(c,l){return new Promise(function(h,o){h(a.setItem(c,l))})},removeItem:function(c){return new Promise(function(l,h){l(a.removeItem(c))})}}}return createWebStorage}var hasRequiredStorage;function requireStorage(){if(hasRequiredStorage)return storage$2;hasRequiredStorage=1,storage$2.__esModule=!0,storage$2.default=void 0;var n=e(requireCreateWebStorage());function e(r){return r&&r.__esModule?r:{default:r}}var t=(0,n.default)("local");return storage$2.default=t,storage$2}var storageExports=requireStorage();const storage$1=getDefaultExportFromCjs(storageExports);var papaparse_minExports=requirePapaparse_min();const Papa=getDefaultExportFromCjs(papaparse_minExports);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DEFAULT_HOST="firebasestorage.googleapis.com",CONFIG_STORAGE_BUCKET_KEY="storageBucket",DEFAULT_MAX_OPERATION_RETRY_TIME=2*60*1e3,DEFAULT_MAX_UPLOAD_RETRY_TIME=10*60*1e3,DEFAULT_MIN_SLEEP_TIME_MILLIS=1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class StorageError extends FirebaseError{constructor(e,t,r=0){super(prependCode(e),`Firebase Storage: ${t} (${prependCode(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,StorageError.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return prependCode(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var StorageErrorCode;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(StorageErrorCode||(StorageErrorCode={}));function prependCode(n){return"storage/"+n}function unknown(){const n="An unknown error occurred, please check the error payload for server response.";return new StorageError(StorageErrorCode.UNKNOWN,n)}function objectNotFound(n){return new StorageError(StorageErrorCode.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function quotaExceeded(n){return new StorageError(StorageErrorCode.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function unauthenticated(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new StorageError(StorageErrorCode.UNAUTHENTICATED,n)}function unauthorizedApp(){return new StorageError(StorageErrorCode.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function unauthorized(n){return new StorageError(StorageErrorCode.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function retryLimitExceeded(){return new StorageError(StorageErrorCode.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function canceled(){return new StorageError(StorageErrorCode.CANCELED,"User canceled the upload/download.")}function invalidUrl(n){return new StorageError(StorageErrorCode.INVALID_URL,"Invalid URL '"+n+"'.")}function invalidDefaultBucket(n){return new StorageError(StorageErrorCode.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function noDefaultBucket(){return new StorageError(StorageErrorCode.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+CONFIG_STORAGE_BUCKET_KEY+"' property when initializing the app?")}function cannotSliceBlob(){return new StorageError(StorageErrorCode.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function serverFileWrongSize(){return new StorageError(StorageErrorCode.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}function noDownloadURL(){return new StorageError(StorageErrorCode.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function missingPolyFill(n){return new StorageError(StorageErrorCode.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function invalidArgument(n){return new StorageError(StorageErrorCode.INVALID_ARGUMENT,n)}function appDeleted(){return new StorageError(StorageErrorCode.APP_DELETED,"The Firebase app was deleted.")}function invalidRootOperation(n){return new StorageError(StorageErrorCode.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function invalidFormat(n,e){return new StorageError(StorageErrorCode.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function internalError(n){throw new StorageError(StorageErrorCode.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Location{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=Location.makeFromUrl(e,t)}catch{return new Location(e,"")}if(r.path==="")return r;throw invalidDefaultBucket(e)}static makeFromUrl(e,t){let r=null;const a="([A-Za-z0-9.\\-_]+)";function i(w){w.path.charAt(w.path.length-1)==="/"&&(w.path_=w.path_.slice(0,-1))}const c="(/(.*))?$",l=new RegExp("^gs://"+a+c,"i"),h={bucket:1,path:3};function o(w){w.path_=decodeURIComponent(w.path)}const s="v[A-Za-z0-9_]+",f=t.replace(/[.]/g,"\\."),u="(/([^?#]*).*)?$",p=new RegExp(`^https?://${f}/${s}/b/${a}/o${u}`,"i"),v={bucket:1,path:3},g=t===DEFAULT_HOST?"(?:storage.googleapis.com|storage.cloud.google.com)":t,A="([^?#]*)",T=new RegExp(`^https?://${g}/${a}/${A}`,"i"),_=[{regex:l,indices:h,postModify:i},{regex:p,indices:v,postModify:o},{regex:T,indices:{bucket:1,path:2},postModify:o}];for(let w=0;w<_.length;w++){const m=_[w],S=m.regex.exec(e);if(S){const C=S[m.indices.bucket];let x=S[m.indices.path];x||(x=""),r=new Location(C,x),m.postModify(r);break}}if(r==null)throw invalidUrl(e);return r}}class FailRequest{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function start(n,e,t){let r=1,a=null,i=null,c=!1,l=0;function h(){return l===2}let o=!1;function s(...A){o||(o=!0,e.apply(null,A))}function f(A){a=setTimeout(()=>{a=null,n(p,h())},A)}function u(){i&&clearTimeout(i)}function p(A,...T){if(o){u();return}if(A){u(),s.call(null,A,...T);return}if(h()||c){u(),s.call(null,A,...T);return}r<64&&(r*=2);let _;l===1?(l=2,_=0):_=(r+Math.random())*1e3,f(_)}let v=!1;function g(A){v||(v=!0,u(),!o&&(a!==null?(A||(l=2),clearTimeout(a),f(0)):A||(l=1)))}return f(0),i=setTimeout(()=>{c=!0,g(!0)},t),g}function stop(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function isJustDef(n){return n!==void 0}function isFunction(n){return typeof n=="function"}function isNonArrayObject(n){return typeof n=="object"&&!Array.isArray(n)}function isString(n){return typeof n=="string"||n instanceof String}function isNativeBlob(n){return isNativeBlobDefined()&&n instanceof Blob}function isNativeBlobDefined(){return typeof Blob<"u"}function validateNumber(n,e,t,r){if(r<e)throw invalidArgument(`Invalid value for '${n}'. Expected ${e} or greater.`);if(r>t)throw invalidArgument(`Invalid value for '${n}'. Expected ${t} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function makeUrl(n,e,t){let r=e;return t==null&&(r=`https://${e}`),`${t}://${r}/v0${n}`}function makeQueryString(n){const e=encodeURIComponent;let t="?";for(const r in n)if(n.hasOwnProperty(r)){const a=e(r)+"="+e(n[r]);t=t+a+"&"}return t=t.slice(0,-1),t}var ErrorCode;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(ErrorCode||(ErrorCode={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function isRetryStatusCode(n,e){const t=n>=500&&n<600,a=[408,429].indexOf(n)!==-1,i=e.indexOf(n)!==-1;return t||a||i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NetworkRequest{constructor(e,t,r,a,i,c,l,h,o,s,f,u=!0){this.url_=e,this.method_=t,this.headers_=r,this.body_=a,this.successCodes_=i,this.additionalRetryCodes_=c,this.callback_=l,this.errorCallback_=h,this.timeout_=o,this.progressCallback_=s,this.connectionFactory_=f,this.retry=u,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((p,v)=>{this.resolve_=p,this.reject_=v,this.start_()})}start_(){const e=(r,a)=>{if(a){r(!1,new RequestEndStatus(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const c=l=>{const h=l.loaded,o=l.lengthComputable?l.total:-1;this.progressCallback_!==null&&this.progressCallback_(h,o)};this.progressCallback_!==null&&i.addUploadProgressListener(c),i.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(c),this.pendingConnection_=null;const l=i.getErrorCode()===ErrorCode.NO_ERROR,h=i.getStatus();if(!l||isRetryStatusCode(h,this.additionalRetryCodes_)&&this.retry){const s=i.getErrorCode()===ErrorCode.ABORT;r(!1,new RequestEndStatus(!1,null,s));return}const o=this.successCodes_.indexOf(h)!==-1;r(!0,new RequestEndStatus(o,i))})},t=(r,a)=>{const i=this.resolve_,c=this.reject_,l=a.connection;if(a.wasSuccessCode)try{const h=this.callback_(l,l.getResponse());isJustDef(h)?i(h):i()}catch(h){c(h)}else if(l!==null){const h=unknown();h.serverResponse=l.getErrorText(),this.errorCallback_?c(this.errorCallback_(l,h)):c(h)}else if(a.canceled){const h=this.appDelete_?appDeleted():canceled();c(h)}else{const h=retryLimitExceeded();c(h)}};this.canceled_?t(!1,new RequestEndStatus(!1,null,!0)):this.backoffId_=start(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&stop(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class RequestEndStatus{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}}function addAuthHeader_(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function addVersionHeader_(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function addGmpidHeader_(n,e){e&&(n["X-Firebase-GMPID"]=e)}function addAppCheckHeader_(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function makeRequest(n,e,t,r,a,i,c=!0){const l=makeQueryString(n.urlParams),h=n.url+l,o=Object.assign({},n.headers);return addGmpidHeader_(o,e),addAuthHeader_(o,t),addVersionHeader_(o,i),addAppCheckHeader_(o,r),new NetworkRequest(h,n.method,o,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,a,c)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getBlobBuilder(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function getBlob$1(...n){const e=getBlobBuilder();if(e!==void 0){const t=new e;for(let r=0;r<n.length;r++)t.append(n[r]);return t.getBlob()}else{if(isNativeBlobDefined())return new Blob(n);throw new StorageError(StorageErrorCode.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function sliceBlob(n,e,t){return n.webkitSlice?n.webkitSlice(e,t):n.mozSlice?n.mozSlice(e,t):n.slice?n.slice(e,t):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function decodeBase64(n){if(typeof atob>"u")throw missingPolyFill("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const StringFormat={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class StringData{constructor(e,t){this.data=e,this.contentType=t||null}}function dataFromString(n,e){switch(n){case StringFormat.RAW:return new StringData(utf8Bytes_(e));case StringFormat.BASE64:case StringFormat.BASE64URL:return new StringData(base64Bytes_(n,e));case StringFormat.DATA_URL:return new StringData(dataURLBytes_(e),dataURLContentType_(e))}throw unknown()}function utf8Bytes_(n){const e=[];for(let t=0;t<n.length;t++){let r=n.charCodeAt(t);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(t<n.length-1&&(n.charCodeAt(t+1)&64512)===56320))e.push(239,191,189);else{const i=r,c=n.charCodeAt(++t);r=65536|(i&1023)<<10|c&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function percentEncodedBytes_(n){let e;try{e=decodeURIComponent(n)}catch{throw invalidFormat(StringFormat.DATA_URL,"Malformed data URL.")}return utf8Bytes_(e)}function base64Bytes_(n,e){switch(n){case StringFormat.BASE64:{const a=e.indexOf("-")!==-1,i=e.indexOf("_")!==-1;if(a||i)throw invalidFormat(n,"Invalid character '"+(a?"-":"_")+"' found: is it base64url encoded?");break}case StringFormat.BASE64URL:{const a=e.indexOf("+")!==-1,i=e.indexOf("/")!==-1;if(a||i)throw invalidFormat(n,"Invalid character '"+(a?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=decodeBase64(e)}catch(a){throw a.message.includes("polyfill")?a:invalidFormat(n,"Invalid character found")}const r=new Uint8Array(t.length);for(let a=0;a<t.length;a++)r[a]=t.charCodeAt(a);return r}class DataURLParts{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(t===null)throw invalidFormat(StringFormat.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=t[1]||null;r!=null&&(this.base64=endsWith(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}function dataURLBytes_(n){const e=new DataURLParts(n);return e.base64?base64Bytes_(StringFormat.BASE64,e.rest):percentEncodedBytes_(e.rest)}function dataURLContentType_(n){return new DataURLParts(n).contentType}function endsWith(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FbsBlob{constructor(e,t){let r=0,a="";isNativeBlob(e)?(this.data_=e,r=e.size,a=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=a}size(){return this.size_}type(){return this.type_}slice(e,t){if(isNativeBlob(this.data_)){const r=this.data_,a=sliceBlob(r,e,t);return a===null?null:new FbsBlob(a)}else{const r=new Uint8Array(this.data_.buffer,e,t-e);return new FbsBlob(r,!0)}}static getBlob(...e){if(isNativeBlobDefined()){const t=e.map(r=>r instanceof FbsBlob?r.data_:r);return new FbsBlob(getBlob$1.apply(null,t))}else{const t=e.map(c=>isString(c)?dataFromString(StringFormat.RAW,c).data:c.data_);let r=0;t.forEach(c=>{r+=c.byteLength});const a=new Uint8Array(r);let i=0;return t.forEach(c=>{for(let l=0;l<c.length;l++)a[i++]=c[l]}),new FbsBlob(a,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jsonObjectOrNull(n){let e;try{e=JSON.parse(n)}catch{return null}return isNonArrayObject(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function parent(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function child(n,e){const t=e.split("/").filter(r=>r.length>0).join("/");return n.length===0?t:n+"/"+t}function lastComponent(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function noXform_(n,e){return e}class Mapping{constructor(e,t,r,a){this.server=e,this.local=t||e,this.writable=!!r,this.xform=a||noXform_}}let mappings_=null;function xformPath(n){return!isString(n)||n.length<2?n:lastComponent(n)}function getMappings(){if(mappings_)return mappings_;const n=[];n.push(new Mapping("bucket")),n.push(new Mapping("generation")),n.push(new Mapping("metageneration")),n.push(new Mapping("name","fullPath",!0));function e(i,c){return xformPath(c)}const t=new Mapping("name");t.xform=e,n.push(t);function r(i,c){return c!==void 0?Number(c):c}const a=new Mapping("size");return a.xform=r,n.push(a),n.push(new Mapping("timeCreated")),n.push(new Mapping("updated")),n.push(new Mapping("md5Hash",null,!0)),n.push(new Mapping("cacheControl",null,!0)),n.push(new Mapping("contentDisposition",null,!0)),n.push(new Mapping("contentEncoding",null,!0)),n.push(new Mapping("contentLanguage",null,!0)),n.push(new Mapping("contentType",null,!0)),n.push(new Mapping("metadata","customMetadata",!0)),mappings_=n,mappings_}function addRef(n,e){function t(){const r=n.bucket,a=n.fullPath,i=new Location(r,a);return e._makeStorageReference(i)}Object.defineProperty(n,"ref",{get:t})}function fromResource(n,e,t){const r={};r.type="file";const a=t.length;for(let i=0;i<a;i++){const c=t[i];r[c.local]=c.xform(r,e[c.server])}return addRef(r,n),r}function fromResourceString(n,e,t){const r=jsonObjectOrNull(e);return r===null?null:fromResource(n,r,t)}function downloadUrlFromResourceString(n,e,t,r){const a=jsonObjectOrNull(e);if(a===null||!isString(a.downloadTokens))return null;const i=a.downloadTokens;if(i.length===0)return null;const c=encodeURIComponent;return i.split(",").map(o=>{const s=n.bucket,f=n.fullPath,u="/b/"+c(s)+"/o/"+c(f),p=makeUrl(u,t,r),v=makeQueryString({alt:"media",token:o});return p+v})[0]}function toResourceString(n,e){const t={},r=e.length;for(let a=0;a<r;a++){const i=e[a];i.writable&&(t[i.server]=n[i.local])}return JSON.stringify(t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PREFIXES_KEY="prefixes",ITEMS_KEY="items";function fromBackendResponse(n,e,t){const r={prefixes:[],items:[],nextPageToken:t.nextPageToken};if(t[PREFIXES_KEY])for(const a of t[PREFIXES_KEY]){const i=a.replace(/\/$/,""),c=n._makeStorageReference(new Location(e,i));r.prefixes.push(c)}if(t[ITEMS_KEY])for(const a of t[ITEMS_KEY]){const i=n._makeStorageReference(new Location(e,a.name));r.items.push(i)}return r}function fromResponseString(n,e,t){const r=jsonObjectOrNull(t);return r===null?null:fromBackendResponse(n,e,r)}class RequestInfo{constructor(e,t,r,a){this.url=e,this.method=t,this.handler=r,this.timeout=a,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function handlerCheck(n){if(!n)throw unknown()}function metadataHandler(n,e){function t(r,a){const i=fromResourceString(n,a,e);return handlerCheck(i!==null),i}return t}function listHandler(n,e){function t(r,a){const i=fromResponseString(n,e,a);return handlerCheck(i!==null),i}return t}function downloadUrlHandler(n,e){function t(r,a){const i=fromResourceString(n,a,e);return handlerCheck(i!==null),downloadUrlFromResourceString(i,a,n.host,n._protocol)}return t}function sharedErrorHandler(n){function e(t,r){let a;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?a=unauthorizedApp():a=unauthenticated():t.getStatus()===402?a=quotaExceeded(n.bucket):t.getStatus()===403?a=unauthorized(n.path):a=r,a.status=t.getStatus(),a.serverResponse=r.serverResponse,a}return e}function objectErrorHandler(n){const e=sharedErrorHandler(n);function t(r,a){let i=e(r,a);return r.getStatus()===404&&(i=objectNotFound(n.path)),i.serverResponse=a.serverResponse,i}return t}function getMetadata$2(n,e,t){const r=e.fullServerUrl(),a=makeUrl(r,n.host,n._protocol),i="GET",c=n.maxOperationRetryTime,l=new RequestInfo(a,i,metadataHandler(n,t),c);return l.errorHandler=objectErrorHandler(e),l}function list$2(n,e,t,r,a){const i={};e.isRoot?i.prefix="":i.prefix=e.path+"/",t.length>0&&(i.delimiter=t),r&&(i.pageToken=r),a&&(i.maxResults=a);const c=e.bucketOnlyServerUrl(),l=makeUrl(c,n.host,n._protocol),h="GET",o=n.maxOperationRetryTime,s=new RequestInfo(l,h,listHandler(n,e.bucket),o);return s.urlParams=i,s.errorHandler=sharedErrorHandler(e),s}function getDownloadUrl(n,e,t){const r=e.fullServerUrl(),a=makeUrl(r,n.host,n._protocol),i="GET",c=n.maxOperationRetryTime,l=new RequestInfo(a,i,downloadUrlHandler(n,t),c);return l.errorHandler=objectErrorHandler(e),l}function updateMetadata$2(n,e,t,r){const a=e.fullServerUrl(),i=makeUrl(a,n.host,n._protocol),c="PATCH",l=toResourceString(t,r),h={"Content-Type":"application/json; charset=utf-8"},o=n.maxOperationRetryTime,s=new RequestInfo(i,c,metadataHandler(n,r),o);return s.headers=h,s.body=l,s.errorHandler=objectErrorHandler(e),s}function deleteObject$2(n,e){const t=e.fullServerUrl(),r=makeUrl(t,n.host,n._protocol),a="DELETE",i=n.maxOperationRetryTime;function c(h,o){}const l=new RequestInfo(r,a,c,i);return l.successCodes=[200,204],l.errorHandler=objectErrorHandler(e),l}function determineContentType_(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function metadataForUpload_(n,e,t){const r=Object.assign({},t);return r.fullPath=n.path,r.size=e.size(),r.contentType||(r.contentType=determineContentType_(null,e)),r}function multipartUpload(n,e,t,r,a){const i=e.bucketOnlyServerUrl(),c={"X-Goog-Upload-Protocol":"multipart"};function l(){let _="";for(let w=0;w<2;w++)_=_+Math.random().toString().slice(2);return _}const h=l();c["Content-Type"]="multipart/related; boundary="+h;const o=metadataForUpload_(e,r,a),s=toResourceString(o,t),f="--"+h+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+s+`\r
--`+h+`\r
Content-Type: `+o.contentType+`\r
\r
`,u=`\r
--`+h+"--",p=FbsBlob.getBlob(f,r,u);if(p===null)throw cannotSliceBlob();const v={name:o.fullPath},g=makeUrl(i,n.host,n._protocol),A="POST",T=n.maxUploadRetryTime,b=new RequestInfo(g,A,metadataHandler(n,t),T);return b.urlParams=v,b.headers=c,b.body=p.uploadData(),b.errorHandler=sharedErrorHandler(e),b}class ResumableUploadStatus{constructor(e,t,r,a){this.current=e,this.total=t,this.finalized=!!r,this.metadata=a||null}}function checkResumeHeader_(n,e){let t=null;try{t=n.getResponseHeader("X-Goog-Upload-Status")}catch{handlerCheck(!1)}return handlerCheck(!!t&&(e||["active"]).indexOf(t)!==-1),t}function createResumableUpload(n,e,t,r,a){const i=e.bucketOnlyServerUrl(),c=metadataForUpload_(e,r,a),l={name:c.fullPath},h=makeUrl(i,n.host,n._protocol),o="POST",s={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":c.contentType,"Content-Type":"application/json; charset=utf-8"},f=toResourceString(c,t),u=n.maxUploadRetryTime;function p(g){checkResumeHeader_(g);let A;try{A=g.getResponseHeader("X-Goog-Upload-URL")}catch{handlerCheck(!1)}return handlerCheck(isString(A)),A}const v=new RequestInfo(h,o,p,u);return v.urlParams=l,v.headers=s,v.body=f,v.errorHandler=sharedErrorHandler(e),v}function getResumableUploadStatus(n,e,t,r){const a={"X-Goog-Upload-Command":"query"};function i(o){const s=checkResumeHeader_(o,["active","final"]);let f=null;try{f=o.getResponseHeader("X-Goog-Upload-Size-Received")}catch{handlerCheck(!1)}f||handlerCheck(!1);const u=Number(f);return handlerCheck(!isNaN(u)),new ResumableUploadStatus(u,r.size(),s==="final")}const c="POST",l=n.maxUploadRetryTime,h=new RequestInfo(t,c,i,l);return h.headers=a,h.errorHandler=sharedErrorHandler(e),h}const RESUMABLE_UPLOAD_CHUNK_SIZE=256*1024;function continueResumableUpload(n,e,t,r,a,i,c,l){const h=new ResumableUploadStatus(0,0);if(c?(h.current=c.current,h.total=c.total):(h.current=0,h.total=r.size()),r.size()!==h.total)throw serverFileWrongSize();const o=h.total-h.current;let s=o;a>0&&(s=Math.min(s,a));const f=h.current,u=f+s;let p="";s===0?p="finalize":o===s?p="upload, finalize":p="upload";const v={"X-Goog-Upload-Command":p,"X-Goog-Upload-Offset":`${h.current}`},g=r.slice(f,u);if(g===null)throw cannotSliceBlob();function A(w,m){const S=checkResumeHeader_(w,["active","final"]),C=h.current+s,x=r.size();let R;return S==="final"?R=metadataHandler(e,i)(w,m):R=null,new ResumableUploadStatus(C,x,S==="final",R)}const T="POST",b=e.maxUploadRetryTime,_=new RequestInfo(t,T,A,b);return _.headers=v,_.body=g.uploadData(),_.progressCallback=l||null,_.errorHandler=sharedErrorHandler(n),_}const TaskState={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function taskStateFromInternalTaskState(n){switch(n){case"running":case"pausing":case"canceling":return TaskState.RUNNING;case"paused":return TaskState.PAUSED;case"success":return TaskState.SUCCESS;case"canceled":return TaskState.CANCELED;case"error":return TaskState.ERROR;default:return TaskState.ERROR}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Observer{constructor(e,t,r){if(isFunction(e)||t!=null||r!=null)this.next=e,this.error=t??void 0,this.complete=r??void 0;else{const i=e;this.next=i.next,this.error=i.error,this.complete=i.complete}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function async(n){return(...e)=>{Promise.resolve().then(()=>n(...e))}}class XhrConnection{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=ErrorCode.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=ErrorCode.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=ErrorCode.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,r,a){if(this.sent_)throw internalError("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),a!==void 0)for(const i in a)a.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,a[i].toString());return r!==void 0?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw internalError("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw internalError("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw internalError("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw internalError("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class XhrTextConnection extends XhrConnection{initXhr(){this.xhr_.responseType="text"}}function newTextConnection(){return new XhrTextConnection}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UploadTask{isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}constructor(e,t,r=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=r,this._mappings=getMappings(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=a=>{if(this._request=void 0,this._chunkMultiplier=1,a._codeEquals(StorageErrorCode.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{const i=this.isExponentialBackoffExpired();if(isRetryStatusCode(a.status,[]))if(i)a=retryLimitExceeded();else{this.sleepTime=Math.max(this.sleepTime*2,DEFAULT_MIN_SLEEP_TIME_MILLIS),this._needToFetchStatus=!0,this.completeTransitions_();return}this._error=a,this._transition("error")}},this._metadataErrorHandler=a=>{this._request=void 0,a._codeEquals(StorageErrorCode.CANCELED)?this.completeTransitions_():(this._error=a,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((a,i)=>{this._resolve=a,this._reject=i,this._start()}),this._promise.then(null,()=>{})}_makeProgressCallback(){const e=this._transferred;return t=>this._updateProgress(e+t)}_shouldDoResumable(e){return e.size()>256*1024}_start(){this._state==="running"&&this._request===void 0&&(this._resumable?this._uploadUrl===void 0?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([t,r])=>{switch(this._state){case"running":e(t,r);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused");break}})}_createResumable(){this._resolveToken((e,t)=>{const r=createResumableUpload(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),a=this._ref.storage._makeRequest(r,newTextConnection,e,t);this._request=a,a.getPromise().then(i=>{this._request=void 0,this._uploadUrl=i,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const e=this._uploadUrl;this._resolveToken((t,r)=>{const a=getResumableUploadStatus(this._ref.storage,this._ref._location,e,this._blob),i=this._ref.storage._makeRequest(a,newTextConnection,t,r);this._request=i,i.getPromise().then(c=>{c=c,this._request=void 0,this._updateProgress(c.current),this._needToFetchStatus=!1,c.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const e=RESUMABLE_UPLOAD_CHUNK_SIZE*this._chunkMultiplier,t=new ResumableUploadStatus(this._transferred,this._blob.size()),r=this._uploadUrl;this._resolveToken((a,i)=>{let c;try{c=continueResumableUpload(this._ref._location,this._ref.storage,r,this._blob,e,this._mappings,t,this._makeProgressCallback())}catch(h){this._error=h,this._transition("error");return}const l=this._ref.storage._makeRequest(c,newTextConnection,a,i,!1);this._request=l,l.getPromise().then(h=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(h.current),h.finalized?(this._metadata=h.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){RESUMABLE_UPLOAD_CHUNK_SIZE*this._chunkMultiplier*2<32*1024*1024&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,t)=>{const r=getMetadata$2(this._ref.storage,this._ref._location,this._mappings),a=this._ref.storage._makeRequest(r,newTextConnection,e,t);this._request=a,a.getPromise().then(i=>{this._request=void 0,this._metadata=i,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,t)=>{const r=multipartUpload(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),a=this._ref.storage._makeRequest(r,newTextConnection,e,t);this._request=a,a.getPromise().then(i=>{this._request=void 0,this._metadata=i,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){const t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,this._request!==void 0?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":const t=this._state==="paused";this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=canceled(),this._state=e,this._notifyObservers();break;case"error":this._state=e,this._notifyObservers();break;case"success":this._state=e,this._notifyObservers();break}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start();break}}get snapshot(){const e=taskStateFromInternalTaskState(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,r,a){const i=new Observer(t||void 0,r||void 0,a||void 0);return this._addObserver(i),()=>{this._removeObserver(i)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const t=this._observers.indexOf(e);t!==-1&&this._observers.splice(t,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(t=>{this._notifyObserver(t)})}_finishPromise(){if(this._resolve!==void 0){let e=!0;switch(taskStateFromInternalTaskState(this._state)){case TaskState.SUCCESS:async(this._resolve.bind(null,this.snapshot))();break;case TaskState.CANCELED:case TaskState.ERROR:const t=this._reject;async(t.bind(null,this._error))();break;default:e=!1;break}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(taskStateFromInternalTaskState(this._state)){case TaskState.RUNNING:case TaskState.PAUSED:e.next&&async(e.next.bind(e,this.snapshot))();break;case TaskState.SUCCESS:e.complete&&async(e.complete.bind(e))();break;case TaskState.CANCELED:case TaskState.ERROR:e.error&&async(e.error.bind(e,this._error))();break;default:e.error&&async(e.error.bind(e,this._error))()}}resume(){const e=this._state==="paused"||this._state==="pausing";return e&&this._transition("running"),e}pause(){const e=this._state==="running";return e&&this._transition("pausing"),e}cancel(){const e=this._state==="running"||this._state==="pausing";return e&&this._transition("canceling"),e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Reference{constructor(e,t){this._service=e,t instanceof Location?this._location=t:this._location=Location.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Reference(e,t)}get root(){const e=new Location(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return lastComponent(this._location.path)}get storage(){return this._service}get parent(){const e=parent(this._location.path);if(e===null)return null;const t=new Location(this._location.bucket,e);return new Reference(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw invalidRootOperation(e)}}function uploadBytesResumable$1(n,e,t){return n._throwIfRoot("uploadBytesResumable"),new UploadTask(n,new FbsBlob(e),t)}function listAll$1(n){const e={prefixes:[],items:[]};return listAllHelper(n,e).then(()=>e)}async function listAllHelper(n,e,t){const a=await list$1(n,{pageToken:t});e.prefixes.push(...a.prefixes),e.items.push(...a.items),a.nextPageToken!=null&&await listAllHelper(n,e,a.nextPageToken)}function list$1(n,e){e!=null&&typeof e.maxResults=="number"&&validateNumber("options.maxResults",1,1e3,e.maxResults);const t=e||{},r=list$2(n.storage,n._location,"/",t.pageToken,t.maxResults);return n.storage.makeRequestWithTokens(r,newTextConnection)}function getMetadata$1(n){n._throwIfRoot("getMetadata");const e=getMetadata$2(n.storage,n._location,getMappings());return n.storage.makeRequestWithTokens(e,newTextConnection)}function updateMetadata$1(n,e){n._throwIfRoot("updateMetadata");const t=updateMetadata$2(n.storage,n._location,e,getMappings());return n.storage.makeRequestWithTokens(t,newTextConnection)}function getDownloadURL$1(n){n._throwIfRoot("getDownloadURL");const e=getDownloadUrl(n.storage,n._location,getMappings());return n.storage.makeRequestWithTokens(e,newTextConnection).then(t=>{if(t===null)throw noDownloadURL();return t})}function deleteObject$1(n){n._throwIfRoot("deleteObject");const e=deleteObject$2(n.storage,n._location);return n.storage.makeRequestWithTokens(e,newTextConnection)}function _getChild$1(n,e){const t=child(n._location.path,e),r=new Location(n._location.bucket,t);return new Reference(n.storage,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function isUrl(n){return/^[A-Za-z]+:\/\//.test(n)}function refFromURL(n,e){return new Reference(n,e)}function refFromPath(n,e){if(n instanceof FirebaseStorageImpl){const t=n;if(t._bucket==null)throw noDefaultBucket();const r=new Reference(t,t._bucket);return e!=null?refFromPath(r,e):r}else return e!==void 0?_getChild$1(n,e):n}function ref$1(n,e){if(e&&isUrl(e)){if(n instanceof FirebaseStorageImpl)return refFromURL(n,e);throw invalidArgument("To use ref(service, url), the first argument must be a Storage instance.")}else return refFromPath(n,e)}function extractBucket(n,e){const t=e==null?void 0:e[CONFIG_STORAGE_BUCKET_KEY];return t==null?null:Location.makeFromBucketSpec(t,n)}function connectStorageEmulator$1(n,e,t,r={}){n.host=`${e}:${t}`,n._protocol="http";const{mockUserToken:a}=r;a&&(n._overrideAuthToken=typeof a=="string"?a:createMockUserToken(a,n.app.options.projectId))}class FirebaseStorageImpl{constructor(e,t,r,a,i){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=a,this._firebaseVersion=i,this._bucket=null,this._host=DEFAULT_HOST,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=DEFAULT_MAX_OPERATION_RETRY_TIME,this._maxUploadRetryTime=DEFAULT_MAX_UPLOAD_RETRY_TIME,this._requests=new Set,a!=null?this._bucket=Location.makeFromBucketSpec(a,this._host):this._bucket=extractBucket(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Location.makeFromBucketSpec(this._url,e):this._bucket=extractBucket(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){validateNumber("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){validateNumber("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){if(_isFirebaseServerApp(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Reference(this,e)}_makeRequest(e,t,r,a,i=!0){if(this._deleted)return new FailRequest(appDeleted());{const c=makeRequest(e,this._appId,r,a,t,this._firebaseVersion,i);return this._requests.add(c),c.getPromise().then(()=>this._requests.delete(c),()=>this._requests.delete(c)),c}}async makeRequestWithTokens(e,t){const[r,a]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,a).getPromise()}}const name="@firebase/storage",version="0.13.7";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const STORAGE_TYPE="storage";function uploadBytesResumable(n,e,t){return n=getModularInstance(n),uploadBytesResumable$1(n,e,t)}function getMetadata(n){return n=getModularInstance(n),getMetadata$1(n)}function updateMetadata(n,e){return n=getModularInstance(n),updateMetadata$1(n,e)}function listAll(n){return n=getModularInstance(n),listAll$1(n)}function getDownloadURL(n){return n=getModularInstance(n),getDownloadURL$1(n)}function deleteObject(n){return n=getModularInstance(n),deleteObject$1(n)}function ref(n,e){return n=getModularInstance(n),ref$1(n,e)}function getStorage(n=getApp(),e){n=getModularInstance(n);const r=_getProvider(n,STORAGE_TYPE).getImmediate({identifier:e}),a=getDefaultEmulatorHostnameAndPort("storage");return a&&connectStorageEmulator(r,...a),r}function connectStorageEmulator(n,e,t,r={}){connectStorageEmulator$1(n,e,t,r)}function factory(n,{instanceIdentifier:e}){const t=n.getProvider("app").getImmediate(),r=n.getProvider("auth-internal"),a=n.getProvider("app-check-internal");return new FirebaseStorageImpl(t,r,a,e,SDK_VERSION)}function registerStorage(){_registerComponent(new Component(STORAGE_TYPE,factory,"PUBLIC").setMultipleInstances(!0)),registerVersion(name,version,""),registerVersion(name,version,"esm2017")}registerStorage();const firebaseConfig={apiKey:"AIzaSyCDgtC4qaL0cqSjEu7GS4CkTHtneuoz_TI",authDomain:"sacred-sutra.firebaseapp.com",projectId:"sacred-sutra",storageBucket:"sacred-sutra.firebasestorage.app",messagingSenderId:"676199421158",appId:"1:676199421158:web:ed2e9164f94a2e51165727",measurementId:"test-measurement-id"};let app,auth,db,storage;app=initializeApp(firebaseConfig),auth=getAuth(app),db=initializeFirestore(app,{cacheSizeBytes:rn,experimentalForceLongPolling:!0}),storage=getStorage(app),(async()=>{try{await enableIndexedDbPersistence(db,{forceOwnership:!1})}catch(e){if(typeof e=="object"&&e!==null&&"code"in e){const t=e;t.code==="failed-precondition"||t.code}}})();const lr=class lr{constructor(){Te(this,"db");this.db=db,this.enableOfflinePersistence()}async enableOfflinePersistence(){if(!lr.persistenceEnabled)try{await enableIndexedDbPersistence(this.db),lr.persistenceEnabled=!0}catch(e){e.code==="failed-precondition"||e.code}}handleError(e){throw e instanceof FirebaseError&&(e.code==="failed-precondition"||e.code),e}validateFirestoreData(e){const t=(r,a)=>{if(r===void 0)throw new Error(`Undefined value not allowed in Firestore at path: ${a}`);if(typeof r=="function")throw new Error(`Function values not allowed in Firestore at path: ${a}`);if(r&&typeof r=="object"){if(r.constructor&&r.constructor.name==="Timestamp"||r instanceof Date)return;if(!r.constructor||r.constructor===Object){const l=r;Object.keys(l).forEach(h=>{t(l[h],`${a}.${h}`)});return}const i=r.constructor.name;if(["GeoPoint","DocumentReference","Blob"].includes(i))return}Array.isArray(r)&&r.forEach((i,c)=>{t(i,`${a}[${c}]`)})};Object.keys(e).forEach(r=>{t(e[r],r)})}async getDocuments(e,t=[]){try{const r=collection(this.db,e),a=query(r,...t);return(await getDocs(a)).docs.map(c=>({...c.data(),id:c.id}))}catch(r){this.handleError(r)}}async getDocument(e,t){try{const r=doc(this.db,e,t),a=await getDoc(r);return a.exists()?a.data():void 0}catch(r){this.handleError(r)}}async setDocument(e,t,r){try{const a=doc(this.db,e,t);await setDoc(a,r,{merge:!0})}catch(a){this.handleError(a)}}async addDocument(e,t){try{return this.validateFirestoreData(t),{id:(await addDoc(collection(this.db,e),t)).id}}catch(r){throw this.handleError(r),r}}async updateDocument(e,t,r){try{const a=doc(this.db,e,t);await updateDoc(a,{...r,updatedAt:Timestamp.now()})}catch(a){this.handleError(a)}}async deleteDocument(e,t){try{const r=doc(this.db,e,t);await deleteDoc(r)}catch(r){this.handleError(r)}}async batchOperation(e,t,r,a){if(e.length<=500){const l=writeBatch(this.db);return e.forEach(h=>{const o=doc(this.db,t,a(h));switch(r){case"create":l.set(o,{...h,updatedAt:Timestamp.now(),createdAt:Timestamp.now()});break;case"update":l.update(o,{...h,updatedAt:Timestamp.now()});break;case"delete":l.delete(o);break}}),this.processBatchWithRetry(l)}const c=[];for(let l=0;l<e.length;l+=500)c.push(e.slice(l,l+500));for(let l=0;l<c.length;l++){const h=c[l],o=writeBatch(this.db);h.forEach(s=>{const f=doc(this.db,t,a(s));switch(r){case"create":o.set(f,{...s,updatedAt:Timestamp.now(),createdAt:Timestamp.now()});break;case"update":o.update(f,{...s,updatedAt:Timestamp.now()});break;case"delete":o.delete(f);break}}),await this.processBatchWithRetry(o),l<c.length-1&&await new Promise(s=>setTimeout(s,100))}}async processBatchWithRetry(e,t=3,r=0){try{await e.commit()}catch(a){if(a instanceof FirebaseError&&a.code==="unavailable"&&r<t)return await new Promise(i=>setTimeout(i,Math.pow(2,r)*1e3)),this.processBatchWithRetry(e,t,r+1);throw new Error("Service temporarily unavailable")}}};Te(lr,"persistenceEnabled",!1);let FirebaseService=lr;class InventoryDeductionValidationService{validateDeductionQuantity(e){const t=[],r=[];return e==null?{isValid:!0,errors:t,warnings:r}:typeof e!="number"||isNaN(e)?(t.push("Deduction quantity must be a valid number"),{isValid:!1,errors:t,warnings:r}):(e<=0&&t.push("Deduction quantity must be greater than 0"),e>1e4&&r.push("Deduction quantity is very large (>10,000) - please verify this is correct"),e%1!==0&&r.push("Non-integer deduction quantities may cause precision issues with piece-based inventory"),{isValid:t.length===0,errors:t,warnings:r})}validateCategoryDeductionConfig(e){const t=[],r=[];if(e.inventoryDeductionQuantity===null||e.inventoryDeductionQuantity===void 0)return{isValid:!0,errors:t,warnings:r};const a=this.validateDeductionQuantity(e.inventoryDeductionQuantity);if(t.push(...a.errors),r.push(...a.warnings),e.categoryGroupId||t.push("Category must be assigned to a category group to enable automatic inventory deduction"),e.inventoryType||r.push("Category should have an inventory type (weight or qty) defined for optimal deduction tracking"),e.inventoryUnit||r.push("Category should have an inventory unit (kg, g, or pcs) defined for optimal deduction tracking"),e.inventoryType&&e.inventoryUnit){const i=["kg","g"],c=["pcs"];e.inventoryType==="weight"&&!i.includes(e.inventoryUnit)&&r.push(`Inventory type is 'weight' but unit '${e.inventoryUnit}' is not a weight unit (kg, g)`),e.inventoryType==="qty"&&!c.includes(e.inventoryUnit)&&r.push(`Inventory type is 'qty' but unit '${e.inventoryUnit}' is not a quantity unit (pcs)`)}return e.inventoryType==="weight"&&e.inventoryDeductionQuantity&&(e.inventoryUnit==="kg"&&e.inventoryDeductionQuantity<.001&&r.push("Very small deduction quantities in kg may cause precision issues"),e.inventoryUnit==="g"&&e.inventoryDeductionQuantity>1e4&&r.push("Very large deduction quantities in grams - consider using kg units instead")),{isValid:t.length===0,errors:t,warnings:r}}validateMultipleCategoriesDeduction(e){const t=[],r=[];e.forEach((i,c)=>{const l=this.validateCategoryDeductionConfig(i),h=i.name||`Category ${c+1}`;l.errors.forEach(o=>{t.push(`[${h}] ${o}`)}),l.warnings.forEach(o=>{r.push(`[${h}] ${o}`)})});const a=e.filter(i=>i.inventoryDeductionQuantity!==null&&i.inventoryDeductionQuantity!==void 0);if(a.length>0){const i=new Map;a.forEach(c=>{c.categoryGroupId&&(i.has(c.categoryGroupId)||i.set(c.categoryGroupId,[]),i.get(c.categoryGroupId).push(c))}),i.forEach((c,l)=>{const h=new Set(c.map(s=>s.inventoryType).filter(Boolean)),o=new Set(c.map(s=>s.inventoryUnit).filter(Boolean));h.size>1&&r.push(`Category group ${l} contains categories with different inventory types (${Array.from(h).join(", ")}) - this may cause confusion`),o.size>1&&r.push(`Category group ${l} contains categories with different inventory units (${Array.from(o).join(", ")}) - ensure this is intentional`)})}return{isValid:t.length===0,errors:t,warnings:r}}isCategoryReadyForDeduction(e){return!!(e.inventoryDeductionQuantity&&e.inventoryDeductionQuantity>0&&e.categoryGroupId&&e.inventoryType&&e.inventoryUnit)}getValidationSummary(e){const t=this.validateCategoryDeductionConfig(e);return e.inventoryDeductionQuantity?t.isValid?`Ready for automatic deduction: ${e.inventoryDeductionQuantity} ${e.inventoryUnit||"units"} per product`:`Configuration issues: ${t.errors.join(", ")}`:"Automatic inventory deduction is disabled"}}const inventoryDeductionValidator=new InventoryDeductionValidationService;class CircularDependencyValidationService{validateLink(e,t,r){const a=[],i=[];if(e===t)return a.push("Cannot link a category to itself"),{isValid:!1,errors:a,warnings:i};r.find(s=>s.id===e)||a.push(`Source category with ID '${e}' not found`);const l=r.find(s=>s.id===t);if(l||a.push(`Target category with ID '${t}' not found`),a.length>0)return{isValid:!1,errors:a,warnings:i};(!l.inventoryDeductionQuantity||l.inventoryDeductionQuantity<=0)&&i.push(`Target category '${l.name}' has no inventory deduction quantity configured - cascade deduction will not occur`),l.categoryGroupId||i.push(`Target category '${l.name}' is not assigned to a category group - inventory deduction will not be possible`);const h=r.map(s=>{if(s.id===e){const f=s.linkedCategories||[],u={categoryId:t,isActive:!0,createdAt:new Date};return{...s,linkedCategories:[...f,u]}}return s}),o=this.checkCircularDependency(e,h);return o.isValid||a.push(...o.errors),i.push(...o.warnings),{isValid:a.length===0,errors:a,warnings:i}}checkCircularDependency(e,t,r=new Set,a=[]){var f;const i=[],c=[];if(a.length>100)return i.push("Dependency chain exceeded maximum depth of 100 - possible circular dependency"),{isValid:!1,errors:i,warnings:c};if(a.includes(e)){const u=a.indexOf(e),p=[...a.slice(u),e],v=this.getCategoryNames(p,t);return i.push(`Circular dependency detected: ${v.join(" → ")}`),{isValid:!1,errors:i,warnings:c}}if(r.has(e))return{isValid:!0,errors:i,warnings:c};const h=t.find(u=>u.id===e);if(!h)return{isValid:!0,errors:i,warnings:c};const o=[...a,e],s=((f=h.linkedCategories)==null?void 0:f.filter(u=>u.isActive!==!1))||[];for(const u of s){const p=this.checkCircularDependency(u.categoryId,t,r,o);p.isValid||i.push(...p.errors),c.push(...p.warnings)}if(r.add(e),o.length>5){const u=this.getCategoryNames(o,t);c.push(`Deep dependency chain detected (${o.length} levels): ${u.join(" → ")}`)}return{isValid:i.length===0,errors:i,warnings:c}}validateAllCategoryLinks(e){const t=[],r=[],a=Date.now();e.forEach(l=>{var h;if(l.id&&((h=l.linkedCategories)!=null&&h.length)){const o=this.checkCircularDependency(l.id,e),s=l.name||l.id;o.errors.forEach(f=>{t.push(`[${s}] ${f}`)}),o.warnings.forEach(f=>{r.push(`[${s}] ${f}`)})}});const i=Date.now()-a;i>500&&r.push(`Circular dependency validation took ${i}ms - consider simplifying category link structure for better performance`);const c=e.reduce((l,h)=>{var o;return l+(((o=h.linkedCategories)==null?void 0:o.length)||0)},0);return c>50&&r.push(`High number of category links (${c}) detected - monitor system performance with complex dependency chains`),{isValid:t.length===0,errors:t,warnings:r}}getDependencyChains(e,t,r=10){const a=[],i=(c,l,h)=>{var f;if(h>r){a.push(`${this.getCategoryNames(l,t).join(" → ")} → [...]`);return}const o=t.find(u=>u.id===c);if(!o||!((f=o.linkedCategories)!=null&&f.length)){l.length>1&&a.push(this.getCategoryNames(l,t).join(" → "));return}const s=o.linkedCategories.filter(u=>u.isActive!==!1);for(const u of s)i(u.categoryId,[...l,u.categoryId],h+1)};return i(e,[e],0),a}getCategoryNames(e,t){return e.map(r=>{const a=t.find(i=>i.id===r);return(a==null?void 0:a.name)||r})}getLinkValidationSummary(e,t){var h;if(!((h=e.linkedCategories)!=null&&h.length))return"No category links configured";const r=e.linkedCategories.filter(o=>o.isActive!==!1);if(r.length===0)return"All category links are disabled";const a=e.id?this.checkCircularDependency(e.id,t):{isValid:!0,errors:[],warnings:[]};if(!a.isValid)return`Link configuration has issues: ${a.errors[0]}`;const i=r.length,c=a.warnings.length;let l=`${i} active link${i!==1?"s":""}`;return c>0&&(l+=` (${c} warning${c!==1?"s":""})`),l}}const circularDependencyValidator=new CircularDependencyValidationService;class CategoryService extends FirebaseService{constructor(){super(...arguments);Te(this,"COLLECTION_NAME","categories")}async getCategories(){const t=await this.getDocuments(this.COLLECTION_NAME,[orderBy("name","asc")]);return!t||!Array.isArray(t)?[]:t}async getCategory(t){return this.getDocument(this.COLLECTION_NAME,t)}async createCategory(t){const r={name:t.name,description:t.description||"",tag:t.tag||"",categoryGroupId:t.categoryGroupId||null,createdAt:Timestamp.now(),updatedAt:Timestamp.now()};return(await this.addDocument(this.COLLECTION_NAME,r)).id}async updateCategory(t,r){const a={updatedAt:Timestamp.now()};r.name!==void 0&&(a.name=r.name),r.description!==void 0&&(a.description=r.description||""),r.tag!==void 0&&(a.tag=r.tag||""),r.categoryGroupId!==void 0&&(a.categoryGroupId=r.categoryGroupId||void 0),r.inventoryType!==void 0&&(a.inventoryType=r.inventoryType),r.inventoryUnit!==void 0&&(a.inventoryUnit=r.inventoryUnit),r.unitConversionRate!==void 0&&(a.unitConversionRate=r.unitConversionRate),r.inventoryDeductionQuantity!==void 0&&(a.inventoryDeductionQuantity=r.inventoryDeductionQuantity),r.linkedCategories!==void 0&&(a.linkedCategories=r.linkedCategories),await this.updateDocument(this.COLLECTION_NAME,t,a)}async deleteCategory(t){await this.deleteDocument(this.COLLECTION_NAME,t)}async isCategoryInUse(t){return(await this.getDocuments("products",[where("categoryId","==",t),orderBy("id","asc")])).length>0}async getCategoriesWithGroups(){const t=await this.getCategories(),r=[],a=await this.getDocuments("categoryGroups",[orderBy("name","asc")]);for(const i of t)if(i.categoryGroupId){const c=a.find(l=>l.id===i.categoryGroupId);c?r.push({...i,categoryGroup:c}):r.push(i)}else r.push(i);return r}async assignCategoryToGroup(t,r){await this.updateCategory(t,{categoryGroupId:r||void 0})}async getCategoriesByGroup(t){return this.getDocuments(this.COLLECTION_NAME,[where("categoryGroupId","==",t),orderBy("name","asc")])}async getUnassignedCategories(){return(await this.getCategories()).filter(r=>!r.categoryGroupId)}async assignMultipleCategoriesToGroup(t,r){const a=t.map(i=>this.updateCategory(i,{categoryGroupId:r||void 0}));await Promise.all(a)}async getCategoriesWithInventoryDeduction(){return(await this.getCategories()).filter(r=>r.inventoryDeductionQuantity!==null&&r.inventoryDeductionQuantity!==void 0&&r.inventoryDeductionQuantity>0)}validateInventoryDeductionConfig(t){return inventoryDeductionValidator.validateCategoryDeductionConfig(t)}async updateInventoryDeductionQuantity(t,r){if(r!==null){const a=inventoryDeductionValidator.validateDeductionQuantity(r);if(!a.isValid)throw new Error(`Invalid deduction quantity: ${a.errors.join(", ")}`)}await this.updateCategory(t,{inventoryDeductionQuantity:r||void 0,updatedAt:Timestamp.now()})}async getCategoriesWithDeductionByGroup(t){return(await this.getCategoriesByGroup(t)).filter(a=>a.inventoryDeductionQuantity!==null&&a.inventoryDeductionQuantity!==void 0&&a.inventoryDeductionQuantity>0)}async isCategoryReadyForDeduction(t){const r=await this.getCategory(t);return r?inventoryDeductionValidator.isCategoryReadyForDeduction(r):!1}async bulkUpdateDeductionQuantities(t){for(const a of t)if(a.quantity!==null){const i=inventoryDeductionValidator.validateDeductionQuantity(a.quantity);if(!i.isValid)throw new Error(`Invalid deduction quantity for category ${a.categoryId}: ${i.errors.join(", ")}`)}const r=t.map(a=>this.updateCategory(a.categoryId,{inventoryDeductionQuantity:a.quantity||void 0,updatedAt:Timestamp.now()}));await Promise.all(r)}async getDeductionValidationSummary(t){const r=await this.getCategory(t);return r?inventoryDeductionValidator.getValidationSummary(r):"Category not found"}async enableInventoryDeduction(t,r,a,i){const c=await this.getCategory(t);if(!c)return{isValid:!1,errors:["Category not found"],warnings:[]};const l={...c,inventoryDeductionQuantity:r,inventoryType:a||c.inventoryType,inventoryUnit:i||c.inventoryUnit},h=this.validateInventoryDeductionConfig(l);if(h.isValid){const o={inventoryDeductionQuantity:r};a&&(o.inventoryType=a),i&&(o.inventoryUnit=i),await this.updateCategory(t,o)}return h}async disableInventoryDeduction(t){await this.updateInventoryDeductionQuantity(t,null)}async addCategoryLink(t,r,a=!0){const i=await this.getCategories(),c=circularDependencyValidator.validateLink(t,r,i);if(!c.isValid)return c;const l=await this.getCategory(t);if(!l)return{isValid:!1,errors:[`Source category with ID '${t}' not found`],warnings:[]};const h=l.linkedCategories||[];if(h.some(u=>u.categoryId===r))return{isValid:!1,errors:["Link already exists between these categories"],warnings:[]};const s={categoryId:r,isActive:a,createdAt:Timestamp.now()},f=[...h,s];return await this.updateCategory(t,{linkedCategories:f}),{isValid:!0,errors:[],warnings:c.warnings}}async removeCategoryLink(t,r){const a=await this.getCategory(t);if(!a)return{isValid:!1,errors:[`Source category with ID '${t}' not found`],warnings:[]};const i=a.linkedCategories||[],c=i.findIndex(h=>h.categoryId===r);if(c===-1)return{isValid:!1,errors:["Link does not exist between these categories"],warnings:[]};const l=i.filter((h,o)=>o!==c);return await this.updateCategory(t,{linkedCategories:l}),{isValid:!0,errors:[],warnings:[]}}async updateCategoryLink(t,r,a){const i=await this.getCategory(t);if(!i)return{isValid:!1,errors:[`Source category with ID '${t}' not found`],warnings:[]};const c=i.linkedCategories||[],l=c.findIndex(o=>o.categoryId===r);if(l===-1)return{isValid:!1,errors:["Link does not exist between these categories"],warnings:[]};const h=[...c];return h[l]={...h[l],...a,categoryId:r},await this.updateCategory(t,{linkedCategories:h}),{isValid:!0,errors:[],warnings:[]}}async getLinkedCategories(t,r=!1){const a=await this.getCategory(t);if(!a||!a.linkedCategories)return[];const i=r?a.linkedCategories:a.linkedCategories.filter(l=>l.isActive!==!1),c=[];for(const l of i){const h=await this.getCategory(l.categoryId);h&&c.push(h)}return c}async getCategoriesLinkingTo(t,r=!1){const a=await this.getCategories(),i=[];for(const c of a)c.linkedCategories&&c.linkedCategories.some(h=>h.categoryId===t&&(r||h.isActive!==!1))&&i.push(c);return i}async getCategoryLinkDetails(t){const r=await this.getCategory(t);if(!r||!r.linkedCategories)return[];const a=[];for(const i of r.linkedCategories){const c=await this.getCategory(i.categoryId);a.push({...i,targetCategory:c})}return a}async validateCategoryLinks(t){if(t){const r=await this.getCategories();return circularDependencyValidator.checkCircularDependency(t,r)}else{const r=await this.getCategories();return circularDependencyValidator.validateAllCategoryLinks(r)}}async getCategoryLinkSummary(t){const r=await this.getCategory(t);if(!r)return"Category not found";const a=await this.getCategories();return circularDependencyValidator.getLinkValidationSummary(r,a)}async bulkAddCategoryLinks(t){const r=[];for(const a of t){const i=await this.addCategoryLink(a.sourceId,a.targetId,a.isActive);if(r.push(i),!i.isValid)break}return r}async setCategoryLinkActive(t,r,a){return this.updateCategoryLink(t,r,{isActive:a})}async getCategoriesWithCascadeDeduction(){return(await this.getCategories()).filter(r=>{var i;return(((i=r.linkedCategories)==null?void 0:i.filter(c=>c.isActive!==!1))||[]).length>0})}async getDependencyChains(t,r=10){const a=await this.getCategories();return circularDependencyValidator.getDependencyChains(t,a,r)}}class ProductService extends FirebaseService{constructor(){super();Te(this,"COLLECTION_NAME","products");Te(this,"categoryService");this.categoryService=new CategoryService}async parseProducts(t){if(this.isAmazonFormat(t))return this.parseAmazonProducts(t);if(this.isFlipkartFormat(t))return this.processFlipkartProducts(t);throw new Error("Unsupported file format")}async parseAmazonProducts(t){const r=await new Promise((a,i)=>{t||i(new Error("File is not set")),Papa.parse(t,{header:!0,complete:async c=>{const l=c.data;if(!Array.isArray(l)||l.length===0)throw new Error("File is empty");return a(l.filter(h=>h["seller-sku"]))},error:c=>{i(c)}})});return this.amazonAdapter(r)}async processFlipkartProducts(t){const r=await t.arrayBuffer(),a=readSync(r),i=a.Sheets[a.SheetNames[0]],c=utils.sheet_to_json(i);if(!Array.isArray(c)||c.length===0)throw new Error("File is empty");const l=c[0],o=l&&(l["Seller SKU Id"]==="Your Identifier for a product"||String(l["Product Title"]).includes("Title of your product"))?c.slice(1):c;if(o.length===0)throw new Error("File contains no product data");return this.flipkartAdapter(o)}isAmazonFormat(t){return t.type==="text/plain"}isFlipkartFormat(t){return t.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"||t.type==="application/vnd.ms-excel"}amazonAdapter(t){return t.map(r=>({sku:r["seller-sku"],name:r["item-name"],description:r["item-description"],platform:"amazon",sellingPrice:Number(r.price)||0,metadata:{listingStatus:"active",moq:"1",amazonSerialNumber:r.asin1},visibility:"visible"}))}flipkartAdapter(t){return t.map(r=>({sku:r["Seller SKU Id"],name:r["Product Title"],description:r["Product Title"]||"",sellingPrice:Number(r["Your Selling Price"])||0,platform:"flipkart",metadata:{listingStatus:r["Listing Status"],moq:r["Minimum Order Quantity"]||"1",flipkartSerialNumber:r["Flipkart Serial Number"]},visibility:"visible"}))}async saveProducts(t){const r=await this.getDocuments(this.COLLECTION_NAME),a=t.filter(i=>r.filter(c=>c.sku===i.sku&&c.platform===i.platform).length===0);return this.batchOperation(a,this.COLLECTION_NAME,"create",i=>i.sku)}async saveOrUpdateProducts(t,r=!1){const a=await this.getDocuments(this.COLLECTION_NAME),i=new Map;a.forEach(o=>{const s=`${o.sku}-${o.platform}`;i.set(s,o)});const c=[],l=[];t.forEach(o=>{const s=`${o.sku}-${o.platform}`,f=i.get(s);if(f){if(r){const u={sellingPrice:o.sellingPrice,metadata:{...f.metadata,listingStatus:o.metadata.listingStatus,moq:o.metadata.moq,updatedAt:Timestamp.now(),lastImportedFrom:o.platform==="amazon"?"Amazon Import":"Flipkart Import"}};o.platform==="amazon"&&o.metadata.amazonSerialNumber?u.metadata.amazonSerialNumber=o.metadata.amazonSerialNumber:o.platform==="flipkart"&&o.metadata.flipkartSerialNumber&&(u.metadata.flipkartSerialNumber=o.metadata.flipkartSerialNumber),(!f.description||f.description===f.name)&&(u.name=o.name),l.push({sku:o.sku,updateData:u})}}else c.push({...o,metadata:{...o.metadata,createdAt:Timestamp.now(),updatedAt:Timestamp.now(),lastImportedFrom:o.platform==="amazon"?"Amazon Import":"Flipkart Import"}})});const h=[];if(c.length>0&&h.push(this.batchOperation(c,this.COLLECTION_NAME,"create",o=>o.sku)),l.length>0){const o=l.map(({sku:s,updateData:f})=>this.updateDocument(this.COLLECTION_NAME,s,f));h.push(...o)}return await Promise.all(h),{created:c.length,updated:l.length}}async updateProduct(t,r){return this.updateDocument(this.COLLECTION_NAME,t,r)}async getProducts(t){const r=[];t!=null&&t.platform&&r.push(where("platform","==",t.platform)),t!=null&&t.search&&(r.push(where("name",">=",t.search)),r.push(where("name","<=",t.search+""))),t!=null&&t.visibility&&r.push(where("visibility","==",t.visibility)),t!=null&&t.categoryId&&r.push(where("categoryId","==",t.categoryId));const a=await this.getDocuments(this.COLLECTION_NAME,r);return!a||!Array.isArray(a)?[]:a.map(i=>({...i,sku:i.id??i.sku}))}async mapTransactionToProduct(t){return(await this.getDocuments(this.COLLECTION_NAME,[where("sku","==",t)]))[0]||null}async deleteProduct(t){return this.deleteDocument(this.COLLECTION_NAME,t)}async getProductDetails(t){const r=await this.getDocument(this.COLLECTION_NAME,t);if(!r)throw new Error(`Product with SKU ${t} not found`);return r}async getProductsWithCategoryGroups(t){const r={...t};delete r.groupId,delete r.groupFilter;const a=await this.getProducts(r),i=await this.categoryService.getCategoriesWithGroups(),c=new Map;i.forEach(h=>{h.id&&c.set(h.id,{id:h.id,name:h.name,categoryGroup:h.categoryGroup})});const l=a.map(h=>({...h,category:h.categoryId?c.get(h.categoryId):void 0}));return t!=null&&t.groupFilter&&t.groupFilter!=="all"?l.filter(h=>{var o,s,f,u,p,v;return t.groupFilter==="assigned"?(o=h.category)==null?void 0:o.categoryGroup:t.groupFilter==="unassigned"?!((s=h.category)!=null&&s.categoryGroup):t.groupId?((u=(f=h.category)==null?void 0:f.categoryGroup)==null?void 0:u.id)===t.groupId:((v=(p=h.category)==null?void 0:p.categoryGroup)==null?void 0:v.id)===t.groupFilter}):l}async getProductsByGroup(t){return this.getProductsWithCategoryGroups({groupFilter:t})}async getUnassignedProducts(){return this.getProductsWithCategoryGroups({groupFilter:"unassigned"})}}const CATEGORY_GROUP_COLORS=["#F44336","#E91E63","#9C27B0","#673AB7","#3F51B5","#2196F3","#03A9F4","#00BCD4","#009688","#4CAF50","#8BC34A","#CDDC39","#FFEB3B","#FFC107","#FF9800","#FF5722","#795548","#607D8B"];class CategoryGroupService extends FirebaseService{constructor(){super(...arguments);Te(this,"COLLECTION_NAME","categoryGroups");Te(this,"CATEGORIES_COLLECTION","categories");Te(this,"INVENTORY_MOVEMENTS_COLLECTION","inventoryMovements")}async getCategoryGroups(){return this.getDocuments(this.COLLECTION_NAME,[orderBy("name","asc")])}async getCategoryGroupsWithStats(){const t=await this.getCategoryGroups(),r=[];for(const a of t){const i=await this.getCategoryCountForGroup(a.id);r.push({...a,categoryCount:i})}return r}async getCategoryGroup(t){return this.getDocument(this.COLLECTION_NAME,t)}async createCategoryGroup(t){const r=this.validateCategoryGroup(t);if(!r.isValid)throw new Error(`Validation failed: ${Object.values(r.errors).join(", ")}`);if((await this.getCategoryGroups()).find(h=>h.name.toLowerCase()===t.name.toLowerCase()))throw new Error("A category group with this name already exists");const c={name:t.name.trim(),description:t.description.trim(),color:t.color,currentInventory:t.currentInventory||0,inventoryUnit:t.inventoryUnit||"pcs",inventoryType:t.inventoryType||"qty",minimumThreshold:t.minimumThreshold||0,createdAt:Timestamp.now(),updatedAt:Timestamp.now()};return(await this.addDocument(this.COLLECTION_NAME,c)).id}async updateCategoryGroup(t,r){if(Object.keys(r).length>0){const i=this.validateCategoryGroup(r);if(!i.isValid)throw new Error(`Validation failed: ${Object.values(i.errors).join(", ")}`)}if(r.name&&(await this.getCategoryGroups()).find(l=>l.id!==t&&l.name.toLowerCase()===r.name.toLowerCase()))throw new Error("A category group with this name already exists");const a={updatedAt:Timestamp.now()};r.name!==void 0&&(a.name=r.name.trim()),r.description!==void 0&&(a.description=r.description.trim()),r.color!==void 0&&(a.color=r.color),r.currentInventory!==void 0&&(a.currentInventory=r.currentInventory),r.inventoryUnit!==void 0&&(a.inventoryUnit=r.inventoryUnit),r.inventoryType!==void 0&&(a.inventoryType=r.inventoryType),r.minimumThreshold!==void 0&&(a.minimumThreshold=r.minimumThreshold),await this.updateDocument(this.COLLECTION_NAME,t,a)}async deleteCategoryGroup(t){if(await this.isCategoryGroupInUse(t))throw new Error("Cannot delete category group: it is currently assigned to categories");await this.deleteDocument(this.COLLECTION_NAME,t)}async initializeInventory(t,r,a){if(!await this.getCategoryGroup(t))throw new Error("Category group not found");if(r<0)throw new Error("Initial inventory cannot be negative");if(!["kg","g","pcs"].includes(a))throw new Error("Invalid unit. Must be kg, g, or pcs");const c=Timestamp.now();try{const l=writeBatch(this.db),h=doc(this.db,this.COLLECTION_NAME,t),o=a==="pcs"?"qty":"weight";l.update(h,{currentInventory:r,inventoryUnit:a,inventoryType:o,lastInventoryUpdate:c,updatedAt:c});const s=doc(collection(this.db,this.INVENTORY_MOVEMENTS_COLLECTION)),f={categoryGroupId:t,movementType:"initial",quantity:r,unit:a,previousInventory:0,newInventory:r,reason:"Initial inventory setup",notes:"System-generated initial inventory record",createdAt:c,updatedAt:c};l.set(s,f),await l.commit()}catch(l){throw new Error(`Failed to initialize inventory: ${l instanceof Error?l.message:"Unknown error"}`)}}async updateInventory(t,r,a,i={}){if(r<0)throw new Error("Quantity must be non-negative");if(!["deduction","addition","adjustment"].includes(a))throw new Error("Invalid movement type. Must be deduction, addition, or adjustment");const c=Timestamp.now();try{return await runTransaction(this.db,async h=>{const o=doc(this.db,this.COLLECTION_NAME,t),s=await h.get(o);if(!s.exists())throw new Error("Category group not found");const f=s.data();if(f.currentInventory===void 0||!f.inventoryUnit)throw new Error("Inventory tracking not initialized for this category group");const u=f.currentInventory;let p;switch(a){case"deduction":p=u-r;break;case"addition":p=u+r;break;case"adjustment":p=r;break;default:throw new Error("Invalid movement type")}p<0&&a==="deduction"&&console.warn(`Inventory for category group ${t} will become negative: ${p}`),h.update(o,{currentInventory:p,lastInventoryUpdate:c,updatedAt:c});const v=doc(collection(this.db,this.INVENTORY_MOVEMENTS_COLLECTION)),g={categoryGroupId:t,movementType:a,quantity:a==="adjustment"?Math.abs(p-u):r,unit:f.inventoryUnit,previousInventory:u,newInventory:p,createdAt:c,updatedAt:c,...i.transactionReference&&{transactionReference:i.transactionReference},...i.orderReference&&{orderReference:i.orderReference},...i.productSku&&{productSku:i.productSku},...i.platform&&{platform:i.platform},...i.reason&&{reason:i.reason},...i.notes&&{notes:i.notes},...i.adjustedBy&&{adjustedBy:i.adjustedBy}};return h.set(v,g),{newInventoryLevel:p,movementId:v.id}})}catch(l){throw new Error(`Failed to update inventory: ${l instanceof Error?l.message:"Unknown error"}`)}}async getInventoryHistory(t,r=50){try{return(await this.getDocuments(this.INVENTORY_MOVEMENTS_COLLECTION,[where("categoryGroupId","==",t),orderBy("createdAt","desc")])).slice(0,r)}catch(a){throw new Error(`Failed to retrieve inventory history: ${a instanceof Error?a.message:"Unknown error"}`)}}async isCategoryGroupInUse(t){return(await this.getDocuments(this.CATEGORIES_COLLECTION,[where("categoryGroupId","==",t)])).length>0}async getCategoryCountForGroup(t){return(await this.getDocuments(this.CATEGORIES_COLLECTION,[where("categoryGroupId","==",t)])).length}async assignCategoryToGroup(t,r){if(!await this.getCategoryGroup(r))throw new Error("Category group not found");await this.updateDocument(this.CATEGORIES_COLLECTION,t,{categoryGroupId:r,updatedAt:Timestamp.now()})}async removeCategoryFromGroup(t){await this.updateDocument(this.CATEGORIES_COLLECTION,t,{categoryGroupId:null,updatedAt:Timestamp.now()})}async assignMultipleCategoriesToGroup(t,r){if(!await this.getCategoryGroup(r))throw new Error("Category group not found");const i=t.map(c=>this.updateDocument(this.CATEGORIES_COLLECTION,c,{categoryGroupId:r,updatedAt:Timestamp.now()}));await Promise.all(i)}validateCategoryGroup(t){const r={};return t.name!==void 0&&(!t.name||t.name.trim().length===0?r.name="Name is required":t.name.trim().length>100&&(r.name="Name must be 100 characters or less")),t.description!==void 0&&t.description.length>500&&(r.description="Description must be 500 characters or less"),t.color!==void 0&&(t.color?this.isValidHexColor(t.color)||(r.color="Color must be a valid hex color"):r.color="Color is required"),{isValid:Object.keys(r).length===0,errors:r}}isValidHexColor(t){return/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(t)||CATEGORY_GROUP_COLORS.includes(t)}calculateAlertSeverity(t,r){if(r<=0)return t<0?"critical":"low";const a=t/r*100;return a<25?"critical":a<50?"high":a<75?"medium":"low"}async getCategoriesByGroup(t){return await this.getDocuments(this.CATEGORIES_COLLECTION,[where("categoryGroupId","==",t),orderBy("name","asc")])}async getUnassignedCategories(){return(await this.getDocuments(this.CATEGORIES_COLLECTION,[orderBy("name","asc")])).filter(r=>!r.categoryGroupId)}async checkThresholdAlerts(t){try{const r=await this.getCategoryGroup(t);if(!r)throw new Error("Category group not found");if(r.currentInventory===void 0||r.minimumThreshold===void 0)throw new Error("Inventory tracking not initialized for this category group");const a=r.currentInventory,i=r.minimumThreshold;if(a>=i)return null;const c=Timestamp.now();let l;a<0?l="negative_stock":a===0?l="zero_stock":l="low_stock";const h=this.calculateAlertSeverity(a,i);return{categoryGroupId:t,alertType:l,currentLevel:a,thresholdLevel:i,unit:r.inventoryUnit,severity:h,isActive:!0,createdAt:c}}catch(r){throw new Error(`Failed to check threshold alerts: ${r instanceof Error?r.message:"Unknown error"}`)}}}class InventoryService extends FirebaseService{constructor(){super();Te(this,"INVENTORY_MOVEMENTS_COLLECTION","inventoryMovements");Te(this,"INVENTORY_ALERTS_COLLECTION","inventoryAlerts");Te(this,"categoryGroupService");this.categoryGroupService=new CategoryGroupService}async deductInventoryFromOrder(t){const r={deductions:[],warnings:[],errors:[]};if(!t||t.length===0)return r;const a=new Map;for(const i of t){if(!i.categoryGroupId){r.errors.push({categoryGroupId:"unknown",error:"Missing category group mapping",requestedQuantity:i.quantity,reason:"Product SKU must be mapped to a category group before inventory deduction"});continue}a.has(i.categoryGroupId)||a.set(i.categoryGroupId,[]),a.get(i.categoryGroupId).push(i)}for(const[i,c]of a)try{const l=c.reduce((v,g)=>v+g.quantity,0),h=await this.categoryGroupService.getCategoryGroup(i);if(!h){for(const v of c)r.errors.push({categoryGroupId:i,error:"Category group not found",requestedQuantity:v.quantity,reason:"The specified category group does not exist in the system"});continue}if(h.currentInventory===void 0||!h.inventoryUnit){for(const v of c)r.errors.push({categoryGroupId:i,error:"Inventory tracking not initialized",requestedQuantity:v.quantity,reason:"Category group inventory tracking must be initialized before deductions"});continue}const o=c[0];if(c.some(v=>v.unit!==h.inventoryUnit)){for(const v of c)r.errors.push({categoryGroupId:i,error:"Unit mismatch",requestedQuantity:v.quantity,reason:`Order item unit (${v.unit}) does not match category group unit (${h.inventoryUnit})`});continue}const f=h.currentInventory,u=h.minimumThreshold||0;if(l>f){const v=`Insufficient inventory: requested ${l}${h.inventoryUnit}, available ${f}${h.inventoryUnit}`;for(const g of c)r.warnings.push({categoryGroupId:i,warning:v,requestedQuantity:g.quantity,availableQuantity:f})}const p=await this.categoryGroupService.updateInventory(i,l,"deduction",{transactionReference:o.transactionReference,orderReference:o.orderReference,productSku:c.map(v=>v.productSku).filter(Boolean).join(", "),platform:o.platform,reason:`Order processing deduction for ${c.length} item(s)`,notes:`SKUs: ${c.map(v=>v.productSku).filter(Boolean).join(", ")}`});for(const v of c)r.deductions.push({categoryGroupId:i,requestedQuantity:v.quantity,deductedQuantity:v.quantity,newInventoryLevel:p.newInventoryLevel,movementId:p.movementId});if(p.newInventoryLevel<u)try{const v=await this.categoryGroupService.checkThresholdAlerts(i);v&&console.warn(`Inventory threshold alert generated for category group ${i}:`,{alertType:v.alertType,currentLevel:v.currentLevel,thresholdLevel:v.thresholdLevel,severity:v.severity})}catch(v){console.warn(`Failed to generate threshold alert for category group ${i}:`,v)}}catch(l){const h=l instanceof Error?l.message:"Unknown error";for(const o of c)r.errors.push({categoryGroupId:i,error:`Deduction failed: ${h}`,requestedQuantity:o.quantity,reason:"Failed to process inventory deduction due to system error"})}return r}async adjustInventoryManually(t){if(!t.categoryGroupId)throw new Error("Category group ID is required for manual inventory adjustment");if(!t.adjustmentType)throw new Error("Adjustment type is required (increase, decrease, or set)");if(t.quantity<0)throw new Error("Quantity must be non-negative");if(!t.reason)throw new Error("Reason is required for manual inventory adjustment");if(!t.adjustedBy)throw new Error("User identifier is required for audit trail");try{const r=await this.categoryGroupService.getCategoryGroup(t.categoryGroupId);if(!r)throw new Error(`Category group with ID ${t.categoryGroupId} not found`);if(r.currentInventory===void 0||!r.inventoryUnit)throw new Error("Inventory tracking must be initialized for this category group before manual adjustments");let a,i,c;switch(t.adjustmentType){case"increase":a=r.currentInventory+t.quantity,i="addition",c=t.quantity;break;case"decrease":a=r.currentInventory-t.quantity,i="deduction",c=t.quantity;break;case"set":if(a=t.quantity,t.quantity>r.currentInventory)i="addition",c=t.quantity-r.currentInventory;else if(t.quantity<r.currentInventory)i="deduction",c=r.currentInventory-t.quantity;else return{newInventoryLevel:r.currentInventory,movementId:""};break;default:throw new Error(`Invalid adjustment type: ${t.adjustmentType}. Must be 'increase', 'decrease', or 'set'`)}if(a<0){const h=`Warning: Manual adjustment will result in negative inventory (${a}${r.inventoryUnit}) for category group ${t.categoryGroupId}`;console.warn(h)}const l=await this.categoryGroupService.updateInventory(t.categoryGroupId,c,i,{reason:`Manual adjustment: ${t.reason}`,notes:t.notes?`Manual adjustment notes: ${t.notes}`:`Manual ${t.adjustmentType} adjustment`,adjustedBy:t.adjustedBy});return console.info("Manual inventory adjustment completed successfully:",{categoryGroupId:t.categoryGroupId,adjustmentType:t.adjustmentType,quantity:t.quantity,actualQuantity:c,movementType:i,previousLevel:r.currentInventory,newLevel:l.newInventoryLevel,movementId:l.movementId,adjustedBy:t.adjustedBy,reason:t.reason}),l}catch(r){const a=r instanceof Error?r.message:"Unknown error during manual inventory adjustment";throw new Error(`Manual inventory adjustment failed: ${a}`)}}async getInventoryLevels(t){try{let r;if(t&&t.length>0){const l=t.map(o=>this.categoryGroupService.getCategoryGroup(o));r=(await Promise.all(l)).filter(o=>o!==null)}else r=await this.categoryGroupService.getCategoryGroups();const i=r.filter(l=>l!==void 0&&l.id!==void 0&&l.currentInventory!==void 0&&l.inventoryUnit!==void 0&&l.inventoryType!==void 0&&l.minimumThreshold!==void 0).map(l=>{const h=this.calculateInventoryStatus(l.currentInventory,l.minimumThreshold);return{categoryGroupId:l.id,name:l.name,currentInventory:l.currentInventory,inventoryUnit:l.inventoryUnit,inventoryType:l.inventoryType,minimumThreshold:l.minimumThreshold,status:h,lastInventoryUpdate:l.lastInventoryUpdate}}),c={negative_stock:0,zero_stock:1,low_stock:2,healthy:3};return i.sort((l,h)=>{const o=c[l.status]-c[h.status];return o!==0?o:l.name.localeCompare(h.name)}),i}catch(r){const a=r instanceof Error?r.message:"Unknown error";throw new Error(`Failed to retrieve inventory levels: ${a}`)}}calculateInventoryStatus(t,r){return t<0?"negative_stock":t===0?"zero_stock":t<r?"low_stock":"healthy"}convertToBaseUnit(t,r,a){if(typeof t!="number"||isNaN(t))throw new Error("Value must be a valid number");if(t<0)throw new Error("Value cannot be negative");if(!r||!a)throw new Error("Both fromUnit and type parameters are required");if(a==="weight"){if(!["kg","g"].includes(r))throw new Error(`Unit '${r}' is not compatible with inventory type 'weight'. Expected 'kg' or 'g'`)}else if(a==="qty"){if(r!=="pcs")throw new Error(`Unit '${r}' is not compatible with inventory type 'qty'. Expected 'pcs'`)}else throw new Error(`Invalid inventory type '${a}'. Expected 'weight' or 'qty'`);if(t===0)return 0;switch(r){case"kg":return t;case"g":return t/1e3;case"pcs":return t;default:throw new Error(`Unsupported unit conversion: '${r}'`)}}convertFromBaseUnit(t,r,a){if(typeof t!="number"||isNaN(t))throw new Error("Value must be a valid number");if(t<0)throw new Error("Value cannot be negative");if(!r||!a)throw new Error("Both toUnit and type parameters are required");if(a==="weight"){if(!["kg","g"].includes(r))throw new Error(`Target unit '${r}' is not compatible with inventory type 'weight'. Expected 'kg' or 'g'`)}else if(a==="qty"){if(r!=="pcs")throw new Error(`Target unit '${r}' is not compatible with inventory type 'qty'. Expected 'pcs'`)}else throw new Error(`Invalid inventory type '${a}'. Expected 'weight' or 'qty'`);if(t===0)return 0;switch(r){case"kg":return t;case"g":return t*1e3;case"pcs":return Math.round(t);default:throw new Error(`Unsupported target unit conversion: '${r}'`)}}async getInventoryMovements(t){try{const r=[];t.categoryGroupId&&r.push(where("categoryGroupId","==",t.categoryGroupId)),t.movementType&&r.push(where("movementType","==",t.movementType)),t.startDate&&r.push(where("createdAt",">=",t.startDate)),t.endDate&&r.push(where("createdAt","<=",t.endDate)),t.platform&&r.push(where("platform","==",t.platform)),t.adjustedBy&&r.push(where("adjustedBy","==",t.adjustedBy)),t.transactionReference&&r.push(where("transactionReference","==",t.transactionReference)),t.orderReference&&r.push(where("orderReference","==",t.orderReference)),t.productSku&&r.push(where("productSku","==",t.productSku)),t.reason&&r.push(where("reason","==",t.reason));let a=await this.getDocuments(this.INVENTORY_MOVEMENTS_COLLECTION,r);a.sort((l,h)=>{var f,u;const o=((f=l.createdAt)==null?void 0:f.toMillis())||0;return(((u=h.createdAt)==null?void 0:u.toMillis())||0)-o});const i=t.offset||0,c=t.limit||50;return i>0&&(a=a.slice(i)),c>0&&(a=a.slice(0,c)),a}catch(r){const a=r instanceof Error?r.message:"Unknown error";throw new Error(`Failed to retrieve inventory movements: ${a}`)}}async exportInventoryData(t=!1,r){var a,i,c,l,h,o;try{const s=await this.getInventoryLevels();let u=["CategoryGroupId","CategoryGroupName","CurrentInventory","InventoryUnit","InventoryType","MinimumThreshold","Status","LastUpdated"].join(",")+`
`;for(const p of s){const v=[p.categoryGroupId,`"${p.name}"`,p.currentInventory.toString(),p.inventoryUnit,p.inventoryType,p.minimumThreshold.toString(),p.status,((c=(i=(a=p.lastInventoryUpdate)==null?void 0:a.toDate)==null?void 0:i.call(a))==null?void 0:c.toISOString())||""];u+=v.join(",")+`
`}if(t){u+=`
--- INVENTORY MOVEMENTS ---
`,u+=`MovementId,CategoryGroupId,MovementType,Quantity,Unit,PreviousInventory,NewInventory,TransactionRef,OrderRef,ProductSku,Platform,Reason,Notes,AdjustedBy,CreatedAt
`;const p={limit:1e3,...r&&{startDate:r.startDate,endDate:r.endDate}},v=await this.getInventoryMovements(p);for(const g of v){const A=[g.id||"",g.categoryGroupId,g.movementType,g.quantity.toString(),g.unit,g.previousInventory.toString(),g.newInventory.toString(),g.transactionReference||"",g.orderReference||"",g.productSku||"",g.platform||"",g.reason||"",`"${g.notes||""}"`,g.adjustedBy||"",((o=(h=(l=g.createdAt)==null?void 0:l.toDate)==null?void 0:h.call(l))==null?void 0:o.toISOString())||""];u+=A.join(",")+`
`}}return u}catch(s){throw console.error("Error exporting inventory data:",s),new Error(`Failed to export inventory data: ${s instanceof Error?s.message:"Unknown error"}`)}}async importInventoryData(t,r={}){const a={success:!1,imported:0,errors:[],warnings:[],skipped:0};try{const i=t.split(`
`).filter(o=>o.trim());if(i.length<2)return a.errors.push("CSV must contain at least header and one data row"),a;const c=i[0].split(",").map(o=>o.trim()),l=["CategoryGroupId","CategoryGroupName","CurrentInventory","InventoryUnit","InventoryType","MinimumThreshold","Status","LastUpdated"],h=l.filter(o=>!c.includes(o));if(h.length>0)return a.errors.push(`Missing required headers: ${h.join(", ")}`),a;for(let o=1;o<i.length;o++){const s=i[o].trim();if(!s||s.startsWith("---"))continue;const f=this.parseCSVLine(s);if(f.length<l.length){a.warnings.push(`Row ${o+1}: Insufficient columns, skipping`),a.skipped++;continue}try{const u={categoryGroupId:f[0],name:f[1].replace(/"/g,""),currentInventory:parseFloat(f[2]),inventoryUnit:f[3],inventoryType:f[4],minimumThreshold:parseFloat(f[5])},p=this.validateUnitConsistency(u.inventoryType,u.inventoryUnit);if(!p.isValid){a.errors.push(`Row ${o+1}: ${p.error}`);continue}if(isNaN(u.currentInventory)||isNaN(u.minimumThreshold)){a.errors.push(`Row ${o+1}: Invalid numeric values for inventory or threshold`);continue}if(u.currentInventory<0){a.errors.push(`Row ${o+1}: Current inventory cannot be negative`);continue}if(r.validateOnly){a.imported++;continue}const v=await this.categoryGroupService.getCategoryGroup(u.categoryGroupId);if(!v){a.warnings.push(`Row ${o+1}: Category group ${u.categoryGroupId} not found, skipping`),a.skipped++;continue}r.updateExisting||v.currentInventory===void 0?(await this.categoryGroupService.updateInventory(u.categoryGroupId,u.currentInventory,"adjustment"),a.imported++):(a.warnings.push(`Row ${o+1}: Category group exists and updateExisting=false, skipping`),a.skipped++)}catch(u){a.errors.push(`Row ${o+1}: ${u instanceof Error?u.message:"Unknown error"}`)}}return a.success=a.errors.length===0,a}catch(i){return a.errors.push(`Import failed: ${i instanceof Error?i.message:"Unknown error"}`),a}}parseCSVLine(t){const r=[];let a="",i=!1;for(let c=0;c<t.length;c++){const l=t[c];l==='"'?i=!i:l===","&&!i?(r.push(a.trim()),a=""):a+=l}return r.push(a.trim()),r}validateUnitConsistency(t,r){if(t==="weight"){if(!["kg","g"].includes(r))return{isValid:!1,error:`Invalid unit '${r}' for weight-based inventory. Expected 'kg' or 'g'`}}else if(t==="qty"){if(r!=="pcs")return{isValid:!1,error:`Invalid unit '${r}' for quantity-based inventory. Expected 'pcs'`}}else return{isValid:!1,error:`Invalid inventory type '${t}'. Expected 'weight' or 'qty'`};return{isValid:!0}}}const initialState$b={items:[],filteredItems:[],loading:!1,error:null,filters:{},lastFetched:null,detailsCache:{},categories:[],categoriesLoading:!1,categoriesError:null,categoryProducts:[],categoryProductsLoading:!1,categoryProductsError:null,inventoryLevels:{},inventoryLoading:!1,inventoryError:null,productInventoryStatus:{},lowStockProducts:[],zeroStockProducts:[]},productService=new ProductService,categoryService$1=new CategoryService,inventoryService$3=new InventoryService,fetchProducts=createAsyncThunk("products/fetchProducts",async n=>await productService.getProductsWithCategoryGroups(n)),fetchProductDetails=createAsyncThunk("products/fetchDetails",async(n,{getState:e})=>{const t=e(),{detailsCache:r}=t.products;if(r[n])return{sku:n,details:r[n]};const a=await productService.getProductDetails(n);return{sku:n,details:a}}),importProducts=createAsyncThunk("products/importProducts",async({file:n,updateExisting:e=!1})=>{const t=await productService.parseProducts(n),r=await productService.saveOrUpdateProducts(t,e);return{products:t,summary:r,updateExisting:e}}),updateProduct=createAsyncThunk("products/updateProduct",async({sku:n,data:e})=>(await productService.updateProduct(n,e),{sku:n,data:e})),bulkUpdateProducts=createAsyncThunk("products/bulkUpdateProducts",async({skus:n,data:e})=>{const t=n.map(r=>productService.updateProduct(r,e));return await Promise.all(t),{skus:n,data:e}}),fetchCategories$1=createAsyncThunk("products/fetchCategories",async()=>await categoryService$1.getCategories()),addCategory=createAsyncThunk("products/addCategory",async n=>await categoryService$1.createCategory({name:n.name,description:n.description||"",tag:n.tag||""})),fetchProductsByCategory=createAsyncThunk("products/fetchProductsByCategory",async n=>await productService.getProductsWithCategoryGroups({categoryId:n})),fetchProductInventoryLevels=createAsyncThunk("products/fetchProductInventoryLevels",async()=>await inventoryService$3.getInventoryLevels()),updateProductWithInventorySync=createAsyncThunk("products/updateProductWithInventorySync",async({sku:n,data:e,syncInventory:t=!0})=>{await productService.updateProduct(n,e);let r=[];return t&&(r=await inventoryService$3.getInventoryLevels()),{sku:n,data:e,inventoryLevels:r}}),bulkUpdateProductsWithInventorySync=createAsyncThunk("products/bulkUpdateProductsWithInventorySync",async({skus:n,data:e,syncInventory:t=!0})=>{const r=n.map(i=>productService.updateProduct(i,e));await Promise.all(r);let a=[];return t&&(a=await inventoryService$3.getInventoryLevels()),{skus:n,data:e,inventoryLevels:a}}),productsSlice=createSlice({name:"products",initialState:initialState$b,reducers:{setFilters:(n,e)=>{n.filters={...n.filters,...e.payload},n.filteredItems=n.items.filter(t=>{if(n.filters.platform&&t.platform!==n.filters.platform)return!1;if(n.filters.search){const a=n.filters.search.toLowerCase();return t.sku.toLowerCase().includes(a)||t.name.toLowerCase().includes(a)||t.description&&t.description.toLowerCase().includes(a)}const r=n.filters;return!(r.categoryId&&t.categoryId!==r.categoryId)})},clearFilters:n=>{n.filters={},n.filteredItems=n.items},setOptimisticUpdate:(n,e)=>{n.items=e.payload,n.filteredItems=e.payload},clearCategoryProducts:n=>{n.categoryProducts=[],n.categoryProductsError=null},updateProductInventoryStatus:(n,e)=>{const{productSku:t,status:r}=e.payload;n.productInventoryStatus[t]=r,n.filteredItems=n.filteredItems.map(a=>a.sku===t?{...a,inventoryStatus:r}:a)},updateInventoryLevelsMapping:(n,e)=>{const t=e.payload;if(!t||!Array.isArray(t)){n.inventoryLevels={};return}n.inventoryLevels=t.reduce((i,c)=>(i[c.categoryGroupId]=c,i),{}),n.items.forEach(i=>{if(i.categoryGroupId&&n.inventoryLevels[i.categoryGroupId]){const c=n.inventoryLevels[i.categoryGroupId];n.productInventoryStatus[i.sku]=c.status}});const r=[],a=[];n.items.forEach(i=>{const c=n.productInventoryStatus[i.sku];c==="low_stock"?r.push(i):(c==="zero_stock"||c==="negative_stock")&&a.push(i)}),n.lowStockProducts=r,n.zeroStockProducts=a},clearInventoryError:n=>{n.inventoryError=null},filterProductsByInventoryStatus:(n,e)=>{const{status:t}=e.payload;t==="all"?n.filteredItems=n.items:n.filteredItems=n.items.filter(r=>n.productInventoryStatus[r.sku]===t)}},extraReducers:n=>{n.addCase(fetchProducts.pending,e=>{e.loading=!0,e.error=null}).addCase(fetchProducts.fulfilled,(e,t)=>{e.loading=!1,e.items=t.payload,e.filteredItems=t.payload.filter(r=>{if(e.filters.platform&&r.platform!==e.filters.platform)return!1;if(e.filters.search){const i=e.filters.search.toLowerCase();if(!r.sku.toLowerCase().includes(i)&&!r.name.toLowerCase().includes(i)&&!(r.description&&r.description.toLowerCase().includes(i)))return!1}const a=e.filters;return!(a.categoryId&&r.categoryId!==a.categoryId)}),e.lastFetched=Date.now()}).addCase(fetchProducts.rejected,(e,t)=>{e.loading=!1,e.error=t.error.message||"Failed to fetch products"}).addCase(fetchProductDetails.fulfilled,(e,t)=>{const{sku:r,details:a}=t.payload;e.detailsCache[r]=a}).addCase(importProducts.pending,e=>{e.loading=!0,e.error=null}).addCase(importProducts.fulfilled,(e,t)=>{e.loading=!1;const{products:r,updateExisting:a}=t.payload;if(a){const i=new Set(r.map(l=>`${l.sku}-${l.platform}`)),c=e.items.filter(l=>!i.has(`${l.sku}-${l.platform}`));e.items=[...c,...r]}else e.items=[...e.items,...r];e.filteredItems=e.items.filter(i=>{if(e.filters.platform&&i.platform!==e.filters.platform)return!1;if(e.filters.search){const l=e.filters.search.toLowerCase();if(!i.sku.toLowerCase().includes(l)&&!i.name.toLowerCase().includes(l)&&!(i.description&&i.description.toLowerCase().includes(l)))return!1}const c=e.filters;return!(c.categoryId&&i.categoryId!==c.categoryId)})}).addCase(importProducts.rejected,(e,t)=>{e.loading=!1,e.error=t.error.message||"Failed to import products"}).addCase(updateProduct.fulfilled,(e,t)=>{const{sku:r,data:a}=t.payload,i=e.items.findIndex(c=>c.sku===r);i!==-1&&(e.items[i]={...e.items[i],...a},e.filteredItems=e.items.filter(c=>{if(e.filters.platform&&c.platform!==e.filters.platform)return!1;if(e.filters.search){const h=e.filters.search.toLowerCase();if(!c.sku.toLowerCase().includes(h)&&!c.name.toLowerCase().includes(h)&&!(c.description&&c.description.toLowerCase().includes(h)))return!1}const l=e.filters;return!(l.categoryId&&c.categoryId!==l.categoryId)}))}).addCase(bulkUpdateProducts.fulfilled,(e,t)=>{const{skus:r,data:a}=t.payload;e.items=e.items.map(i=>r.includes(i.sku)?{...i,...a}:i),e.filteredItems=e.items.filter(i=>{if(e.filters.platform&&i.platform!==e.filters.platform)return!1;if(e.filters.search){const l=e.filters.search.toLowerCase();if(!i.sku.toLowerCase().includes(l)&&!i.name.toLowerCase().includes(l)&&!(i.description&&i.description.toLowerCase().includes(l)))return!1}const c=e.filters;return!(c.categoryId&&i.categoryId!==c.categoryId)})}).addCase(fetchCategories$1.pending,e=>{e.categoriesLoading=!0,e.categoriesError=null}).addCase(fetchCategories$1.fulfilled,(e,t)=>{e.categoriesLoading=!1,e.categories=t.payload}).addCase(fetchCategories$1.rejected,(e,t)=>{e.categoriesLoading=!1,e.categoriesError=t.error.message||"Failed to fetch categories"}).addCase(addCategory.pending,e=>{e.categoriesLoading=!0,e.categoriesError=null}).addCase(addCategory.fulfilled,e=>{e.categoriesLoading=!1}).addCase(addCategory.rejected,(e,t)=>{e.categoriesLoading=!1,e.categoriesError=t.error.message||"Failed to add category"}).addCase(fetchProductsByCategory.pending,e=>{e.categoryProductsLoading=!0,e.categoryProductsError=null}).addCase(fetchProductsByCategory.fulfilled,(e,t)=>{e.categoryProductsLoading=!1,e.categoryProducts=t.payload}).addCase(fetchProductsByCategory.rejected,(e,t)=>{e.categoryProductsLoading=!1,e.categoryProductsError=t.error.message||"Failed to fetch products for category"}).addCase(fetchProductInventoryLevels.pending,e=>{e.inventoryLoading=!0,e.inventoryError=null}).addCase(fetchProductInventoryLevels.fulfilled,(e,t)=>{e.inventoryLoading=!1,e.inventoryLevels=t.payload.reduce((i,c)=>(i[c.categoryGroupId]=c,i),{}),e.items.forEach(i=>{if(i.categoryGroupId&&e.inventoryLevels[i.categoryGroupId]){const c=e.inventoryLevels[i.categoryGroupId];e.productInventoryStatus[i.sku]=c.status}}),e.filteredItems=e.items.filter(i=>{if(e.filters.platform&&i.platform!==e.filters.platform)return!1;if(e.filters.search){const l=e.filters.search.toLowerCase();if(!i.sku.toLowerCase().includes(l)&&!i.name.toLowerCase().includes(l)&&!(i.description&&i.description.toLowerCase().includes(l)))return!1}const c=e.filters;return!(c.categoryId&&i.categoryId!==c.categoryId)});const r=[],a=[];e.items.forEach(i=>{const c=e.productInventoryStatus[i.sku];c==="low_stock"?r.push(i):(c==="zero_stock"||c==="negative_stock")&&a.push(i)}),e.lowStockProducts=r,e.zeroStockProducts=a}).addCase(fetchProductInventoryLevels.rejected,(e,t)=>{e.inventoryLoading=!1,e.inventoryError=t.error.message||"Failed to fetch product inventory levels"}).addCase(updateProductWithInventorySync.fulfilled,(e,t)=>{const{sku:r,data:a,inventoryLevels:i}=t.payload,c=e.items.findIndex(l=>l.sku===r);if(c!==-1){if(e.items[c]={...e.items[c],...a},i.length>0){e.inventoryLevels=i.reduce((h,o)=>(h[o.categoryGroupId]=o,h),{});const l=e.items[c];if(l.categoryGroupId&&e.inventoryLevels[l.categoryGroupId]){const h=e.inventoryLevels[l.categoryGroupId];e.productInventoryStatus[l.sku]=h.status}}e.filteredItems=e.items.filter(l=>{if(e.filters.platform&&l.platform!==e.filters.platform)return!1;if(e.filters.search){const o=e.filters.search.toLowerCase();if(!l.sku.toLowerCase().includes(o)&&!l.name.toLowerCase().includes(o)&&!(l.description&&l.description.toLowerCase().includes(o)))return!1}const h=e.filters;return!(h.categoryId&&l.categoryId!==h.categoryId)})}}).addCase(bulkUpdateProductsWithInventorySync.fulfilled,(e,t)=>{const{skus:r,data:a,inventoryLevels:i}=t.payload;e.items=e.items.map(c=>r.includes(c.sku)?{...c,...a}:c),i.length>0&&(e.inventoryLevels=i.reduce((c,l)=>(c[l.categoryGroupId]=l,c),{}),e.items.forEach(c=>{if(r.includes(c.sku)&&c.categoryGroupId&&e.inventoryLevels[c.categoryGroupId]){const l=e.inventoryLevels[c.categoryGroupId];e.productInventoryStatus[c.sku]=l.status}})),e.filteredItems=e.items.filter(c=>{if(e.filters.platform&&c.platform!==e.filters.platform)return!1;if(e.filters.search){const h=e.filters.search.toLowerCase();if(!c.sku.toLowerCase().includes(h)&&!c.name.toLowerCase().includes(h)&&!(c.description&&c.description.toLowerCase().includes(h)))return!1}const l=e.filters;return!(l.categoryId&&c.categoryId!==l.categoryId)})})}}),{setFilters,clearFilters,setOptimisticUpdate:setOptimisticUpdate$1,clearCategoryProducts,updateProductInventoryStatus,updateInventoryLevelsMapping,clearInventoryError:clearInventoryError$2,filterProductsByInventoryStatus}=productsSlice.actions,productsReducer=productsSlice.reducer,selectCategories=n=>n.products.categories,millisecondsInWeek=6048e5,millisecondsInDay=864e5,millisecondsInMinute=6e4,millisecondsInHour=36e5,millisecondsInSecond=1e3,minutesInMonth=43200,minutesInDay=1440,constructFromSymbol=Symbol.for("constructDateFrom");function constructFrom(n,e){return typeof n=="function"?n(e):n&&typeof n=="object"&&constructFromSymbol in n?n[constructFromSymbol](e):n instanceof Date?new n.constructor(e):new Date(e)}function toDate(n,e){return constructFrom(e||n,n)}let defaultOptions={};function getDefaultOptions(){return defaultOptions}function startOfWeek(n,e){var l,h,o,s;const t=getDefaultOptions(),r=(e==null?void 0:e.weekStartsOn)??((h=(l=e==null?void 0:e.locale)==null?void 0:l.options)==null?void 0:h.weekStartsOn)??t.weekStartsOn??((s=(o=t.locale)==null?void 0:o.options)==null?void 0:s.weekStartsOn)??0,a=toDate(n,e==null?void 0:e.in),i=a.getDay(),c=(i<r?7:0)+i-r;return a.setDate(a.getDate()-c),a.setHours(0,0,0,0),a}function startOfISOWeek(n,e){return startOfWeek(n,{...e,weekStartsOn:1})}function getISOWeekYear(n,e){const t=toDate(n,e==null?void 0:e.in),r=t.getFullYear(),a=constructFrom(t,0);a.setFullYear(r+1,0,4),a.setHours(0,0,0,0);const i=startOfISOWeek(a),c=constructFrom(t,0);c.setFullYear(r,0,4),c.setHours(0,0,0,0);const l=startOfISOWeek(c);return t.getTime()>=i.getTime()?r+1:t.getTime()>=l.getTime()?r:r-1}function getTimezoneOffsetInMilliseconds(n){const e=toDate(n),t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),+n-+t}function normalizeDates(n,...e){const t=constructFrom.bind(null,n||e.find(r=>typeof r=="object"));return e.map(t)}function startOfDay(n,e){const t=toDate(n,e==null?void 0:e.in);return t.setHours(0,0,0,0),t}function differenceInCalendarDays(n,e,t){const[r,a]=normalizeDates(t==null?void 0:t.in,n,e),i=startOfDay(r),c=startOfDay(a),l=+i-getTimezoneOffsetInMilliseconds(i),h=+c-getTimezoneOffsetInMilliseconds(c);return Math.round((l-h)/millisecondsInDay)}function startOfISOWeekYear(n,e){const t=getISOWeekYear(n,e),r=constructFrom(n,0);return r.setFullYear(t,0,4),r.setHours(0,0,0,0),startOfISOWeek(r)}function isDate(n){return n instanceof Date||typeof n=="object"&&Object.prototype.toString.call(n)==="[object Date]"}function isValid(n){return!(!isDate(n)&&typeof n!="number"||isNaN(+toDate(n)))}function startOfYear(n,e){const t=toDate(n,e==null?void 0:e.in);return t.setFullYear(t.getFullYear(),0,1),t.setHours(0,0,0,0),t}const formatDistanceLocale={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},formatDistance=(n,e,t)=>{let r;const a=formatDistanceLocale[n];return typeof a=="string"?r=a:e===1?r=a.one:r=a.other.replace("{{count}}",e.toString()),t!=null&&t.addSuffix?t.comparison&&t.comparison>0?"in "+r:r+" ago":r};function buildFormatLongFn(n){return(e={})=>{const t=e.width?String(e.width):n.defaultWidth;return n.formats[t]||n.formats[n.defaultWidth]}}const dateFormats={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},timeFormats={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},dateTimeFormats={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},formatLong={date:buildFormatLongFn({formats:dateFormats,defaultWidth:"full"}),time:buildFormatLongFn({formats:timeFormats,defaultWidth:"full"}),dateTime:buildFormatLongFn({formats:dateTimeFormats,defaultWidth:"full"})},formatRelativeLocale={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},formatRelative=(n,e,t,r)=>formatRelativeLocale[n];function buildLocalizeFn(n){return(e,t)=>{const r=t!=null&&t.context?String(t.context):"standalone";let a;if(r==="formatting"&&n.formattingValues){const c=n.defaultFormattingWidth||n.defaultWidth,l=t!=null&&t.width?String(t.width):c;a=n.formattingValues[l]||n.formattingValues[c]}else{const c=n.defaultWidth,l=t!=null&&t.width?String(t.width):n.defaultWidth;a=n.values[l]||n.values[c]}const i=n.argumentCallback?n.argumentCallback(e):e;return a[i]}}const eraValues={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},quarterValues={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},monthValues={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},dayValues={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},dayPeriodValues={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},formattingDayPeriodValues={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},ordinalNumber=(n,e)=>{const t=Number(n),r=t%100;if(r>20||r<10)switch(r%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},localize={ordinalNumber,era:buildLocalizeFn({values:eraValues,defaultWidth:"wide"}),quarter:buildLocalizeFn({values:quarterValues,defaultWidth:"wide",argumentCallback:n=>n-1}),month:buildLocalizeFn({values:monthValues,defaultWidth:"wide"}),day:buildLocalizeFn({values:dayValues,defaultWidth:"wide"}),dayPeriod:buildLocalizeFn({values:dayPeriodValues,defaultWidth:"wide",formattingValues:formattingDayPeriodValues,defaultFormattingWidth:"wide"})};function buildMatchFn(n){return(e,t={})=>{const r=t.width,a=r&&n.matchPatterns[r]||n.matchPatterns[n.defaultMatchWidth],i=e.match(a);if(!i)return null;const c=i[0],l=r&&n.parsePatterns[r]||n.parsePatterns[n.defaultParseWidth],h=Array.isArray(l)?findIndex(l,f=>f.test(c)):findKey(l,f=>f.test(c));let o;o=n.valueCallback?n.valueCallback(h):h,o=t.valueCallback?t.valueCallback(o):o;const s=e.slice(c.length);return{value:o,rest:s}}}function findKey(n,e){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&e(n[t]))return t}function findIndex(n,e){for(let t=0;t<n.length;t++)if(e(n[t]))return t}function buildMatchPatternFn(n){return(e,t={})=>{const r=e.match(n.matchPattern);if(!r)return null;const a=r[0],i=e.match(n.parsePattern);if(!i)return null;let c=n.valueCallback?n.valueCallback(i[0]):i[0];c=t.valueCallback?t.valueCallback(c):c;const l=e.slice(a.length);return{value:c,rest:l}}}const matchOrdinalNumberPattern=/^(\d+)(th|st|nd|rd)?/i,parseOrdinalNumberPattern=/\d+/i,matchEraPatterns={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},parseEraPatterns={any:[/^b/i,/^(a|c)/i]},matchQuarterPatterns={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},parseQuarterPatterns={any:[/1/i,/2/i,/3/i,/4/i]},matchMonthPatterns={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},parseMonthPatterns={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},matchDayPatterns={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},parseDayPatterns={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},matchDayPeriodPatterns={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},parseDayPeriodPatterns={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},match={ordinalNumber:buildMatchPatternFn({matchPattern:matchOrdinalNumberPattern,parsePattern:parseOrdinalNumberPattern,valueCallback:n=>parseInt(n,10)}),era:buildMatchFn({matchPatterns:matchEraPatterns,defaultMatchWidth:"wide",parsePatterns:parseEraPatterns,defaultParseWidth:"any"}),quarter:buildMatchFn({matchPatterns:matchQuarterPatterns,defaultMatchWidth:"wide",parsePatterns:parseQuarterPatterns,defaultParseWidth:"any",valueCallback:n=>n+1}),month:buildMatchFn({matchPatterns:matchMonthPatterns,defaultMatchWidth:"wide",parsePatterns:parseMonthPatterns,defaultParseWidth:"any"}),day:buildMatchFn({matchPatterns:matchDayPatterns,defaultMatchWidth:"wide",parsePatterns:parseDayPatterns,defaultParseWidth:"any"}),dayPeriod:buildMatchFn({matchPatterns:matchDayPeriodPatterns,defaultMatchWidth:"any",parsePatterns:parseDayPeriodPatterns,defaultParseWidth:"any"})},enUS={code:"en-US",formatDistance,formatLong,formatRelative,localize,match,options:{weekStartsOn:0,firstWeekContainsDate:1}};function getDayOfYear(n,e){const t=toDate(n,e==null?void 0:e.in);return differenceInCalendarDays(t,startOfYear(t))+1}function getISOWeek(n,e){const t=toDate(n,e==null?void 0:e.in),r=+startOfISOWeek(t)-+startOfISOWeekYear(t);return Math.round(r/millisecondsInWeek)+1}function getWeekYear(n,e){var s,f,u,p;const t=toDate(n,e==null?void 0:e.in),r=t.getFullYear(),a=getDefaultOptions(),i=(e==null?void 0:e.firstWeekContainsDate)??((f=(s=e==null?void 0:e.locale)==null?void 0:s.options)==null?void 0:f.firstWeekContainsDate)??a.firstWeekContainsDate??((p=(u=a.locale)==null?void 0:u.options)==null?void 0:p.firstWeekContainsDate)??1,c=constructFrom((e==null?void 0:e.in)||n,0);c.setFullYear(r+1,0,i),c.setHours(0,0,0,0);const l=startOfWeek(c,e),h=constructFrom((e==null?void 0:e.in)||n,0);h.setFullYear(r,0,i),h.setHours(0,0,0,0);const o=startOfWeek(h,e);return+t>=+l?r+1:+t>=+o?r:r-1}function startOfWeekYear(n,e){var l,h,o,s;const t=getDefaultOptions(),r=(e==null?void 0:e.firstWeekContainsDate)??((h=(l=e==null?void 0:e.locale)==null?void 0:l.options)==null?void 0:h.firstWeekContainsDate)??t.firstWeekContainsDate??((s=(o=t.locale)==null?void 0:o.options)==null?void 0:s.firstWeekContainsDate)??1,a=getWeekYear(n,e),i=constructFrom((e==null?void 0:e.in)||n,0);return i.setFullYear(a,0,r),i.setHours(0,0,0,0),startOfWeek(i,e)}function getWeek(n,e){const t=toDate(n,e==null?void 0:e.in),r=+startOfWeek(t,e)-+startOfWeekYear(t,e);return Math.round(r/millisecondsInWeek)+1}function addLeadingZeros(n,e){const t=n<0?"-":"",r=Math.abs(n).toString().padStart(e,"0");return t+r}const lightFormatters={y(n,e){const t=n.getFullYear(),r=t>0?t:1-t;return addLeadingZeros(e==="yy"?r%100:r,e.length)},M(n,e){const t=n.getMonth();return e==="M"?String(t+1):addLeadingZeros(t+1,2)},d(n,e){return addLeadingZeros(n.getDate(),e.length)},a(n,e){const t=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.toUpperCase();case"aaa":return t;case"aaaaa":return t[0];case"aaaa":default:return t==="am"?"a.m.":"p.m."}},h(n,e){return addLeadingZeros(n.getHours()%12||12,e.length)},H(n,e){return addLeadingZeros(n.getHours(),e.length)},m(n,e){return addLeadingZeros(n.getMinutes(),e.length)},s(n,e){return addLeadingZeros(n.getSeconds(),e.length)},S(n,e){const t=e.length,r=n.getMilliseconds(),a=Math.trunc(r*Math.pow(10,t-3));return addLeadingZeros(a,e.length)}},dayPeriodEnum={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},formatters={G:function(n,e,t){const r=n.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return t.era(r,{width:"abbreviated"});case"GGGGG":return t.era(r,{width:"narrow"});case"GGGG":default:return t.era(r,{width:"wide"})}},y:function(n,e,t){if(e==="yo"){const r=n.getFullYear(),a=r>0?r:1-r;return t.ordinalNumber(a,{unit:"year"})}return lightFormatters.y(n,e)},Y:function(n,e,t,r){const a=getWeekYear(n,r),i=a>0?a:1-a;if(e==="YY"){const c=i%100;return addLeadingZeros(c,2)}return e==="Yo"?t.ordinalNumber(i,{unit:"year"}):addLeadingZeros(i,e.length)},R:function(n,e){const t=getISOWeekYear(n);return addLeadingZeros(t,e.length)},u:function(n,e){const t=n.getFullYear();return addLeadingZeros(t,e.length)},Q:function(n,e,t){const r=Math.ceil((n.getMonth()+1)/3);switch(e){case"Q":return String(r);case"QQ":return addLeadingZeros(r,2);case"Qo":return t.ordinalNumber(r,{unit:"quarter"});case"QQQ":return t.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return t.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return t.quarter(r,{width:"wide",context:"formatting"})}},q:function(n,e,t){const r=Math.ceil((n.getMonth()+1)/3);switch(e){case"q":return String(r);case"qq":return addLeadingZeros(r,2);case"qo":return t.ordinalNumber(r,{unit:"quarter"});case"qqq":return t.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return t.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return t.quarter(r,{width:"wide",context:"standalone"})}},M:function(n,e,t){const r=n.getMonth();switch(e){case"M":case"MM":return lightFormatters.M(n,e);case"Mo":return t.ordinalNumber(r+1,{unit:"month"});case"MMM":return t.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return t.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return t.month(r,{width:"wide",context:"formatting"})}},L:function(n,e,t){const r=n.getMonth();switch(e){case"L":return String(r+1);case"LL":return addLeadingZeros(r+1,2);case"Lo":return t.ordinalNumber(r+1,{unit:"month"});case"LLL":return t.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return t.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return t.month(r,{width:"wide",context:"standalone"})}},w:function(n,e,t,r){const a=getWeek(n,r);return e==="wo"?t.ordinalNumber(a,{unit:"week"}):addLeadingZeros(a,e.length)},I:function(n,e,t){const r=getISOWeek(n);return e==="Io"?t.ordinalNumber(r,{unit:"week"}):addLeadingZeros(r,e.length)},d:function(n,e,t){return e==="do"?t.ordinalNumber(n.getDate(),{unit:"date"}):lightFormatters.d(n,e)},D:function(n,e,t){const r=getDayOfYear(n);return e==="Do"?t.ordinalNumber(r,{unit:"dayOfYear"}):addLeadingZeros(r,e.length)},E:function(n,e,t){const r=n.getDay();switch(e){case"E":case"EE":case"EEE":return t.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return t.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return t.day(r,{width:"short",context:"formatting"});case"EEEE":default:return t.day(r,{width:"wide",context:"formatting"})}},e:function(n,e,t,r){const a=n.getDay(),i=(a-r.weekStartsOn+8)%7||7;switch(e){case"e":return String(i);case"ee":return addLeadingZeros(i,2);case"eo":return t.ordinalNumber(i,{unit:"day"});case"eee":return t.day(a,{width:"abbreviated",context:"formatting"});case"eeeee":return t.day(a,{width:"narrow",context:"formatting"});case"eeeeee":return t.day(a,{width:"short",context:"formatting"});case"eeee":default:return t.day(a,{width:"wide",context:"formatting"})}},c:function(n,e,t,r){const a=n.getDay(),i=(a-r.weekStartsOn+8)%7||7;switch(e){case"c":return String(i);case"cc":return addLeadingZeros(i,e.length);case"co":return t.ordinalNumber(i,{unit:"day"});case"ccc":return t.day(a,{width:"abbreviated",context:"standalone"});case"ccccc":return t.day(a,{width:"narrow",context:"standalone"});case"cccccc":return t.day(a,{width:"short",context:"standalone"});case"cccc":default:return t.day(a,{width:"wide",context:"standalone"})}},i:function(n,e,t){const r=n.getDay(),a=r===0?7:r;switch(e){case"i":return String(a);case"ii":return addLeadingZeros(a,e.length);case"io":return t.ordinalNumber(a,{unit:"day"});case"iii":return t.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return t.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return t.day(r,{width:"short",context:"formatting"});case"iiii":default:return t.day(r,{width:"wide",context:"formatting"})}},a:function(n,e,t){const a=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"aaa":return t.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return t.dayPeriod(a,{width:"narrow",context:"formatting"});case"aaaa":default:return t.dayPeriod(a,{width:"wide",context:"formatting"})}},b:function(n,e,t){const r=n.getHours();let a;switch(r===12?a=dayPeriodEnum.noon:r===0?a=dayPeriodEnum.midnight:a=r/12>=1?"pm":"am",e){case"b":case"bb":return t.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"bbb":return t.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return t.dayPeriod(a,{width:"narrow",context:"formatting"});case"bbbb":default:return t.dayPeriod(a,{width:"wide",context:"formatting"})}},B:function(n,e,t){const r=n.getHours();let a;switch(r>=17?a=dayPeriodEnum.evening:r>=12?a=dayPeriodEnum.afternoon:r>=4?a=dayPeriodEnum.morning:a=dayPeriodEnum.night,e){case"B":case"BB":case"BBB":return t.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"BBBBB":return t.dayPeriod(a,{width:"narrow",context:"formatting"});case"BBBB":default:return t.dayPeriod(a,{width:"wide",context:"formatting"})}},h:function(n,e,t){if(e==="ho"){let r=n.getHours()%12;return r===0&&(r=12),t.ordinalNumber(r,{unit:"hour"})}return lightFormatters.h(n,e)},H:function(n,e,t){return e==="Ho"?t.ordinalNumber(n.getHours(),{unit:"hour"}):lightFormatters.H(n,e)},K:function(n,e,t){const r=n.getHours()%12;return e==="Ko"?t.ordinalNumber(r,{unit:"hour"}):addLeadingZeros(r,e.length)},k:function(n,e,t){let r=n.getHours();return r===0&&(r=24),e==="ko"?t.ordinalNumber(r,{unit:"hour"}):addLeadingZeros(r,e.length)},m:function(n,e,t){return e==="mo"?t.ordinalNumber(n.getMinutes(),{unit:"minute"}):lightFormatters.m(n,e)},s:function(n,e,t){return e==="so"?t.ordinalNumber(n.getSeconds(),{unit:"second"}):lightFormatters.s(n,e)},S:function(n,e){return lightFormatters.S(n,e)},X:function(n,e,t){const r=n.getTimezoneOffset();if(r===0)return"Z";switch(e){case"X":return formatTimezoneWithOptionalMinutes(r);case"XXXX":case"XX":return formatTimezone(r);case"XXXXX":case"XXX":default:return formatTimezone(r,":")}},x:function(n,e,t){const r=n.getTimezoneOffset();switch(e){case"x":return formatTimezoneWithOptionalMinutes(r);case"xxxx":case"xx":return formatTimezone(r);case"xxxxx":case"xxx":default:return formatTimezone(r,":")}},O:function(n,e,t){const r=n.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+formatTimezoneShort(r,":");case"OOOO":default:return"GMT"+formatTimezone(r,":")}},z:function(n,e,t){const r=n.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+formatTimezoneShort(r,":");case"zzzz":default:return"GMT"+formatTimezone(r,":")}},t:function(n,e,t){const r=Math.trunc(+n/1e3);return addLeadingZeros(r,e.length)},T:function(n,e,t){return addLeadingZeros(+n,e.length)}};function formatTimezoneShort(n,e=""){const t=n>0?"-":"+",r=Math.abs(n),a=Math.trunc(r/60),i=r%60;return i===0?t+String(a):t+String(a)+e+addLeadingZeros(i,2)}function formatTimezoneWithOptionalMinutes(n,e){return n%60===0?(n>0?"-":"+")+addLeadingZeros(Math.abs(n)/60,2):formatTimezone(n,e)}function formatTimezone(n,e=""){const t=n>0?"-":"+",r=Math.abs(n),a=addLeadingZeros(Math.trunc(r/60),2),i=addLeadingZeros(r%60,2);return t+a+e+i}const dateLongFormatter=(n,e)=>{switch(n){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},timeLongFormatter=(n,e)=>{switch(n){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},dateTimeLongFormatter=(n,e)=>{const t=n.match(/(P+)(p+)?/)||[],r=t[1],a=t[2];if(!a)return dateLongFormatter(n,e);let i;switch(r){case"P":i=e.dateTime({width:"short"});break;case"PP":i=e.dateTime({width:"medium"});break;case"PPP":i=e.dateTime({width:"long"});break;case"PPPP":default:i=e.dateTime({width:"full"});break}return i.replace("{{date}}",dateLongFormatter(r,e)).replace("{{time}}",timeLongFormatter(a,e))},longFormatters={p:timeLongFormatter,P:dateTimeLongFormatter},dayOfYearTokenRE=/^D+$/,weekYearTokenRE=/^Y+$/,throwTokens=["D","DD","YY","YYYY"];function isProtectedDayOfYearToken(n){return dayOfYearTokenRE.test(n)}function isProtectedWeekYearToken(n){return weekYearTokenRE.test(n)}function warnOrThrowProtectedError(n,e,t){const r=message(n,e,t);if(console.warn(r),throwTokens.includes(n))throw new RangeError(r)}function message(n,e,t){const r=n[0]==="Y"?"years":"days of the month";return`Use \`${n.toLowerCase()}\` instead of \`${n}\` (in \`${e}\`) for formatting ${r} to the input \`${t}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const formattingTokensRegExp=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,longFormattingTokensRegExp=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,escapedStringRegExp=/^'([^]*?)'?$/,doubleQuoteRegExp=/''/g,unescapedLatinCharacterRegExp=/[a-zA-Z]/;function format(n,e,t){var s,f,u,p,v,g,A,T;const r=getDefaultOptions(),a=(t==null?void 0:t.locale)??r.locale??enUS,i=(t==null?void 0:t.firstWeekContainsDate)??((f=(s=t==null?void 0:t.locale)==null?void 0:s.options)==null?void 0:f.firstWeekContainsDate)??r.firstWeekContainsDate??((p=(u=r.locale)==null?void 0:u.options)==null?void 0:p.firstWeekContainsDate)??1,c=(t==null?void 0:t.weekStartsOn)??((g=(v=t==null?void 0:t.locale)==null?void 0:v.options)==null?void 0:g.weekStartsOn)??r.weekStartsOn??((T=(A=r.locale)==null?void 0:A.options)==null?void 0:T.weekStartsOn)??0,l=toDate(n,t==null?void 0:t.in);if(!isValid(l))throw new RangeError("Invalid time value");let h=e.match(longFormattingTokensRegExp).map(b=>{const _=b[0];if(_==="p"||_==="P"){const w=longFormatters[_];return w(b,a.formatLong)}return b}).join("").match(formattingTokensRegExp).map(b=>{if(b==="''")return{isToken:!1,value:"'"};const _=b[0];if(_==="'")return{isToken:!1,value:cleanEscapedString(b)};if(formatters[_])return{isToken:!0,value:b};if(_.match(unescapedLatinCharacterRegExp))throw new RangeError("Format string contains an unescaped latin alphabet character `"+_+"`");return{isToken:!1,value:b}});a.localize.preprocessor&&(h=a.localize.preprocessor(l,h));const o={firstWeekContainsDate:i,weekStartsOn:c,locale:a};return h.map(b=>{if(!b.isToken)return b.value;const _=b.value;(!(t!=null&&t.useAdditionalWeekYearTokens)&&isProtectedWeekYearToken(_)||!(t!=null&&t.useAdditionalDayOfYearTokens)&&isProtectedDayOfYearToken(_))&&warnOrThrowProtectedError(_,e,String(n));const w=formatters[_[0]];return w(l,_,a.localize,o)}).join("")}function cleanEscapedString(n){const e=n.match(escapedStringRegExp);return e?e[1].replace(doubleQuoteRegExp,"'"):n}var barcodes={},CODE39={},Barcode={},hasRequiredBarcode;function requireBarcode(){if(hasRequiredBarcode)return Barcode;hasRequiredBarcode=1,Object.defineProperty(Barcode,"__esModule",{value:!0});function n(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}var e=function t(r,a){n(this,t),this.data=r,this.text=a.text||r,this.options=a};return Barcode.default=e,Barcode}var hasRequiredCODE39;function requireCODE39(){if(hasRequiredCODE39)return CODE39;hasRequiredCODE39=1,Object.defineProperty(CODE39,"__esModule",{value:!0}),CODE39.CODE39=void 0;var n=function(){function g(A,T){for(var b=0;b<T.length;b++){var _=T[b];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(A,_.key,_)}}return function(A,T,b){return T&&g(A.prototype,T),b&&g(A,b),A}}(),e=requireBarcode(),t=r(e);function r(g){return g&&g.__esModule?g:{default:g}}function a(g,A){if(!(g instanceof A))throw new TypeError("Cannot call a class as a function")}function i(g,A){if(!g)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return A&&(typeof A=="object"||typeof A=="function")?A:g}function c(g,A){if(typeof A!="function"&&A!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof A);g.prototype=Object.create(A&&A.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),A&&(Object.setPrototypeOf?Object.setPrototypeOf(g,A):g.__proto__=A)}var l=function(g){c(A,g);function A(T,b){return a(this,A),T=T.toUpperCase(),b.mod43&&(T+=u(v(T))),i(this,(A.__proto__||Object.getPrototypeOf(A)).call(this,T,b))}return n(A,[{key:"encode",value:function(){for(var b=s("*"),_=0;_<this.data.length;_++)b+=s(this.data[_])+"0";return b+=s("*"),{data:b,text:this.text}}},{key:"valid",value:function(){return this.data.search(/^[0-9A-Z\-\.\ \$\/\+\%]+$/)!==-1}}]),A}(t.default),h=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","-","."," ","$","/","+","%","*"],o=[20957,29783,23639,30485,20951,29813,23669,20855,29789,23645,29975,23831,30533,22295,30149,24005,21623,29981,23837,22301,30023,23879,30545,22343,30161,24017,21959,30065,23921,22385,29015,18263,29141,17879,29045,18293,17783,29021,18269,17477,17489,17681,20753,35770];function s(g){return f(p(g))}function f(g){return o[g].toString(2)}function u(g){return h[g]}function p(g){return h.indexOf(g)}function v(g){for(var A=0,T=0;T<g.length;T++)A+=p(g[T]);return A=A%43,A}return CODE39.CODE39=l,CODE39}var CODE128$1={},CODE128_AUTO={},CODE128={},constants$3={},hasRequiredConstants$3;function requireConstants$3(){if(hasRequiredConstants$3)return constants$3;hasRequiredConstants$3=1,Object.defineProperty(constants$3,"__esModule",{value:!0});var n;function e(h,o,s){return o in h?Object.defineProperty(h,o,{value:s,enumerable:!0,configurable:!0,writable:!0}):h[o]=s,h}var t=constants$3.SET_A=0,r=constants$3.SET_B=1,a=constants$3.SET_C=2;constants$3.SHIFT=98;var i=constants$3.START_A=103,c=constants$3.START_B=104,l=constants$3.START_C=105;return constants$3.MODULO=103,constants$3.STOP=106,constants$3.FNC1=207,constants$3.SET_BY_CODE=(n={},e(n,i,t),e(n,c,r),e(n,l,a),n),constants$3.SWAP={101:t,100:r,99:a},constants$3.A_START_CHAR="Ð",constants$3.B_START_CHAR="Ñ",constants$3.C_START_CHAR="Ò",constants$3.A_CHARS="[\0-_È-Ï]",constants$3.B_CHARS="[ -È-Ï]",constants$3.C_CHARS="(Ï*[0-9]{2}Ï*)",constants$3.BARS=[11011001100,11001101100,11001100110,10010011e3,10010001100,10001001100,10011001e3,10011000100,10001100100,11001001e3,11001000100,11000100100,10110011100,10011011100,10011001110,10111001100,10011101100,10011100110,11001110010,11001011100,11001001110,11011100100,11001110100,11101101110,11101001100,11100101100,11100100110,11101100100,11100110100,11100110010,11011011e3,11011000110,11000110110,10100011e3,10001011e3,10001000110,10110001e3,10001101e3,10001100010,11010001e3,11000101e3,11000100010,10110111e3,10110001110,10001101110,10111011e3,10111000110,10001110110,11101110110,11010001110,11000101110,11011101e3,11011100010,11011101110,11101011e3,11101000110,11100010110,11101101e3,11101100010,11100011010,11101111010,11001000010,11110001010,1010011e4,10100001100,1001011e4,10010000110,10000101100,10000100110,1011001e4,10110000100,1001101e4,10011000010,10000110100,10000110010,11000010010,1100101e4,11110111010,11000010100,10001111010,10100111100,10010111100,10010011110,10111100100,10011110100,10011110010,11110100100,11110010100,11110010010,11011011110,11011110110,11110110110,10101111e3,10100011110,10001011110,10111101e3,10111100010,11110101e3,11110100010,10111011110,10111101110,11101011110,11110101110,11010000100,1101001e4,11010011100,1100011101011],constants$3}var hasRequiredCODE128$1;function requireCODE128$1(){if(hasRequiredCODE128$1)return CODE128;hasRequiredCODE128$1=1,Object.defineProperty(CODE128,"__esModule",{value:!0});var n=function(){function o(s,f){for(var u=0;u<f.length;u++){var p=f[u];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(s,p.key,p)}}return function(s,f,u){return f&&o(s.prototype,f),u&&o(s,u),s}}(),e=requireBarcode(),t=a(e),r=requireConstants$3();function a(o){return o&&o.__esModule?o:{default:o}}function i(o,s){if(!(o instanceof s))throw new TypeError("Cannot call a class as a function")}function c(o,s){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s&&(typeof s=="object"||typeof s=="function")?s:o}function l(o,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof s);o.prototype=Object.create(s&&s.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),s&&(Object.setPrototypeOf?Object.setPrototypeOf(o,s):o.__proto__=s)}var h=function(o){l(s,o);function s(f,u){i(this,s);var p=c(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,f.substring(1),u));return p.bytes=f.split("").map(function(v){return v.charCodeAt(0)}),p}return n(s,[{key:"valid",value:function(){return/^[\x00-\x7F\xC8-\xD3]+$/.test(this.data)}},{key:"encode",value:function(){var u=this.bytes,p=u.shift()-105,v=r.SET_BY_CODE[p];if(v===void 0)throw new RangeError("The encoding does not start with a start character.");this.shouldEncodeAsEan128()===!0&&u.unshift(r.FNC1);var g=s.next(u,1,v);return{text:this.text===this.data?this.text.replace(/[^\x20-\x7E]/g,""):this.text,data:s.getBar(p)+g.result+s.getBar((g.checksum+p)%r.MODULO)+s.getBar(r.STOP)}}},{key:"shouldEncodeAsEan128",value:function(){var u=this.options.ean128||!1;return typeof u=="string"&&(u=u.toLowerCase()==="true"),u}}],[{key:"getBar",value:function(u){return r.BARS[u]?r.BARS[u].toString():""}},{key:"correctIndex",value:function(u,p){if(p===r.SET_A){var v=u.shift();return v<32?v+64:v-32}else return p===r.SET_B?u.shift()-32:(u.shift()-48)*10+u.shift()-48}},{key:"next",value:function(u,p,v){if(!u.length)return{result:"",checksum:0};var g=void 0,A=void 0;if(u[0]>=200){A=u.shift()-105;var T=r.SWAP[A];T!==void 0?g=s.next(u,p+1,T):((v===r.SET_A||v===r.SET_B)&&A===r.SHIFT&&(u[0]=v===r.SET_A?u[0]>95?u[0]-96:u[0]:u[0]<32?u[0]+96:u[0]),g=s.next(u,p+1,v))}else A=s.correctIndex(u,v),g=s.next(u,p+1,v);var b=s.getBar(A),_=A*p;return{result:b+g.result,checksum:_+g.checksum}}}]),s}(t.default);return CODE128.default=h,CODE128}var auto={},hasRequiredAuto;function requireAuto(){if(hasRequiredAuto)return auto;hasRequiredAuto=1,Object.defineProperty(auto,"__esModule",{value:!0});var n=requireConstants$3(),e=function(l){return l.match(new RegExp("^"+n.A_CHARS+"*"))[0].length},t=function(l){return l.match(new RegExp("^"+n.B_CHARS+"*"))[0].length},r=function(l){return l.match(new RegExp("^"+n.C_CHARS+"*"))[0]};function a(c,l){var h=l?n.A_CHARS:n.B_CHARS,o=c.match(new RegExp("^("+h+"+?)(([0-9]{2}){2,})([^0-9]|$)"));if(o)return o[1]+"Ì"+i(c.substring(o[1].length));var s=c.match(new RegExp("^"+h+"+"))[0];return s.length===c.length?c:s+String.fromCharCode(l?205:206)+a(c.substring(s.length),!l)}function i(c){var l=r(c),h=l.length;if(h===c.length)return c;c=c.substring(h);var o=e(c)>=t(c);return l+String.fromCharCode(o?206:205)+a(c,o)}return auto.default=function(c){var l=void 0,h=r(c).length;if(h>=2)l=n.C_START_CHAR+i(c);else{var o=e(c)>t(c);l=(o?n.A_START_CHAR:n.B_START_CHAR)+a(c,o)}return l.replace(/[\xCD\xCE]([^])[\xCD\xCE]/,function(s,f){return"Ë"+f})},auto}var hasRequiredCODE128_AUTO;function requireCODE128_AUTO(){if(hasRequiredCODE128_AUTO)return CODE128_AUTO;hasRequiredCODE128_AUTO=1,Object.defineProperty(CODE128_AUTO,"__esModule",{value:!0});var n=requireCODE128$1(),e=a(n),t=requireAuto(),r=a(t);function a(o){return o&&o.__esModule?o:{default:o}}function i(o,s){if(!(o instanceof s))throw new TypeError("Cannot call a class as a function")}function c(o,s){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s&&(typeof s=="object"||typeof s=="function")?s:o}function l(o,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof s);o.prototype=Object.create(s&&s.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),s&&(Object.setPrototypeOf?Object.setPrototypeOf(o,s):o.__proto__=s)}var h=function(o){l(s,o);function s(f,u){if(i(this,s),/^[\x00-\x7F\xC8-\xD3]+$/.test(f))var p=c(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,(0,r.default)(f),u));else var p=c(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,f,u));return c(p)}return s}(e.default);return CODE128_AUTO.default=h,CODE128_AUTO}var CODE128A={},hasRequiredCODE128A;function requireCODE128A(){if(hasRequiredCODE128A)return CODE128A;hasRequiredCODE128A=1,Object.defineProperty(CODE128A,"__esModule",{value:!0});var n=function(){function o(s,f){for(var u=0;u<f.length;u++){var p=f[u];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(s,p.key,p)}}return function(s,f,u){return f&&o(s.prototype,f),u&&o(s,u),s}}(),e=requireCODE128$1(),t=a(e),r=requireConstants$3();function a(o){return o&&o.__esModule?o:{default:o}}function i(o,s){if(!(o instanceof s))throw new TypeError("Cannot call a class as a function")}function c(o,s){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s&&(typeof s=="object"||typeof s=="function")?s:o}function l(o,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof s);o.prototype=Object.create(s&&s.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),s&&(Object.setPrototypeOf?Object.setPrototypeOf(o,s):o.__proto__=s)}var h=function(o){l(s,o);function s(f,u){return i(this,s),c(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,r.A_START_CHAR+f,u))}return n(s,[{key:"valid",value:function(){return new RegExp("^"+r.A_CHARS+"+$").test(this.data)}}]),s}(t.default);return CODE128A.default=h,CODE128A}var CODE128B={},hasRequiredCODE128B;function requireCODE128B(){if(hasRequiredCODE128B)return CODE128B;hasRequiredCODE128B=1,Object.defineProperty(CODE128B,"__esModule",{value:!0});var n=function(){function o(s,f){for(var u=0;u<f.length;u++){var p=f[u];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(s,p.key,p)}}return function(s,f,u){return f&&o(s.prototype,f),u&&o(s,u),s}}(),e=requireCODE128$1(),t=a(e),r=requireConstants$3();function a(o){return o&&o.__esModule?o:{default:o}}function i(o,s){if(!(o instanceof s))throw new TypeError("Cannot call a class as a function")}function c(o,s){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s&&(typeof s=="object"||typeof s=="function")?s:o}function l(o,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof s);o.prototype=Object.create(s&&s.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),s&&(Object.setPrototypeOf?Object.setPrototypeOf(o,s):o.__proto__=s)}var h=function(o){l(s,o);function s(f,u){return i(this,s),c(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,r.B_START_CHAR+f,u))}return n(s,[{key:"valid",value:function(){return new RegExp("^"+r.B_CHARS+"+$").test(this.data)}}]),s}(t.default);return CODE128B.default=h,CODE128B}var CODE128C={},hasRequiredCODE128C;function requireCODE128C(){if(hasRequiredCODE128C)return CODE128C;hasRequiredCODE128C=1,Object.defineProperty(CODE128C,"__esModule",{value:!0});var n=function(){function o(s,f){for(var u=0;u<f.length;u++){var p=f[u];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(s,p.key,p)}}return function(s,f,u){return f&&o(s.prototype,f),u&&o(s,u),s}}(),e=requireCODE128$1(),t=a(e),r=requireConstants$3();function a(o){return o&&o.__esModule?o:{default:o}}function i(o,s){if(!(o instanceof s))throw new TypeError("Cannot call a class as a function")}function c(o,s){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s&&(typeof s=="object"||typeof s=="function")?s:o}function l(o,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof s);o.prototype=Object.create(s&&s.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),s&&(Object.setPrototypeOf?Object.setPrototypeOf(o,s):o.__proto__=s)}var h=function(o){l(s,o);function s(f,u){return i(this,s),c(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,r.C_START_CHAR+f,u))}return n(s,[{key:"valid",value:function(){return new RegExp("^"+r.C_CHARS+"+$").test(this.data)}}]),s}(t.default);return CODE128C.default=h,CODE128C}var hasRequiredCODE128;function requireCODE128(){if(hasRequiredCODE128)return CODE128$1;hasRequiredCODE128=1,Object.defineProperty(CODE128$1,"__esModule",{value:!0}),CODE128$1.CODE128C=CODE128$1.CODE128B=CODE128$1.CODE128A=CODE128$1.CODE128=void 0;var n=requireCODE128_AUTO(),e=h(n),t=requireCODE128A(),r=h(t),a=requireCODE128B(),i=h(a),c=requireCODE128C(),l=h(c);function h(o){return o&&o.__esModule?o:{default:o}}return CODE128$1.CODE128=e.default,CODE128$1.CODE128A=r.default,CODE128$1.CODE128B=i.default,CODE128$1.CODE128C=l.default,CODE128$1}var EAN_UPC={},EAN13={},constants$2={},hasRequiredConstants$2;function requireConstants$2(){return hasRequiredConstants$2||(hasRequiredConstants$2=1,Object.defineProperty(constants$2,"__esModule",{value:!0}),constants$2.SIDE_BIN="101",constants$2.MIDDLE_BIN="01010",constants$2.BINARIES={L:["0001101","0011001","0010011","0111101","0100011","0110001","0101111","0111011","0110111","0001011"],G:["0100111","0110011","0011011","0100001","0011101","0111001","0000101","0010001","0001001","0010111"],R:["1110010","1100110","1101100","1000010","1011100","1001110","1010000","1000100","1001000","1110100"],O:["0001101","0011001","0010011","0111101","0100011","0110001","0101111","0111011","0110111","0001011"],E:["0100111","0110011","0011011","0100001","0011101","0111001","0000101","0010001","0001001","0010111"]},constants$2.EAN2_STRUCTURE=["LL","LG","GL","GG"],constants$2.EAN5_STRUCTURE=["GGLLL","GLGLL","GLLGL","GLLLG","LGGLL","LLGGL","LLLGG","LGLGL","LGLLG","LLGLG"],constants$2.EAN13_STRUCTURE=["LLLLLL","LLGLGG","LLGGLG","LLGGGL","LGLLGG","LGGLLG","LGGGLL","LGLGLG","LGLGGL","LGGLGL"]),constants$2}var EAN={},encoder={},hasRequiredEncoder;function requireEncoder(){if(hasRequiredEncoder)return encoder;hasRequiredEncoder=1,Object.defineProperty(encoder,"__esModule",{value:!0});var n=requireConstants$2(),e=function(r,a,i){var c=r.split("").map(function(h,o){return n.BINARIES[a[o]]}).map(function(h,o){return h?h[r[o]]:""});if(i){var l=r.length-1;c=c.map(function(h,o){return o<l?h+i:h})}return c.join("")};return encoder.default=e,encoder}var hasRequiredEAN;function requireEAN(){if(hasRequiredEAN)return EAN;hasRequiredEAN=1,Object.defineProperty(EAN,"__esModule",{value:!0});var n=function(){function f(u,p){for(var v=0;v<p.length;v++){var g=p[v];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(u,g.key,g)}}return function(u,p,v){return p&&f(u.prototype,p),v&&f(u,v),u}}(),e=requireConstants$2(),t=requireEncoder(),r=c(t),a=requireBarcode(),i=c(a);function c(f){return f&&f.__esModule?f:{default:f}}function l(f,u){if(!(f instanceof u))throw new TypeError("Cannot call a class as a function")}function h(f,u){if(!f)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return u&&(typeof u=="object"||typeof u=="function")?u:f}function o(f,u){if(typeof u!="function"&&u!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof u);f.prototype=Object.create(u&&u.prototype,{constructor:{value:f,enumerable:!1,writable:!0,configurable:!0}}),u&&(Object.setPrototypeOf?Object.setPrototypeOf(f,u):f.__proto__=u)}var s=function(f){o(u,f);function u(p,v){l(this,u);var g=h(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,p,v));return g.fontSize=!v.flat&&v.fontSize>v.width*10?v.width*10:v.fontSize,g.guardHeight=v.height+g.fontSize/2+v.textMargin,g}return n(u,[{key:"encode",value:function(){return this.options.flat?this.encodeFlat():this.encodeGuarded()}},{key:"leftText",value:function(v,g){return this.text.substr(v,g)}},{key:"leftEncode",value:function(v,g){return(0,r.default)(v,g)}},{key:"rightText",value:function(v,g){return this.text.substr(v,g)}},{key:"rightEncode",value:function(v,g){return(0,r.default)(v,g)}},{key:"encodeGuarded",value:function(){var v={fontSize:this.fontSize},g={height:this.guardHeight};return[{data:e.SIDE_BIN,options:g},{data:this.leftEncode(),text:this.leftText(),options:v},{data:e.MIDDLE_BIN,options:g},{data:this.rightEncode(),text:this.rightText(),options:v},{data:e.SIDE_BIN,options:g}]}},{key:"encodeFlat",value:function(){var v=[e.SIDE_BIN,this.leftEncode(),e.MIDDLE_BIN,this.rightEncode(),e.SIDE_BIN];return{data:v.join(""),text:this.text}}}]),u}(i.default);return EAN.default=s,EAN}var hasRequiredEAN13;function requireEAN13(){if(hasRequiredEAN13)return EAN13;hasRequiredEAN13=1,Object.defineProperty(EAN13,"__esModule",{value:!0});var n=function(){function f(u,p){for(var v=0;v<p.length;v++){var g=p[v];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(u,g.key,g)}}return function(u,p,v){return p&&f(u.prototype,p),v&&f(u,v),u}}(),e=function f(u,p,v){u===null&&(u=Function.prototype);var g=Object.getOwnPropertyDescriptor(u,p);if(g===void 0){var A=Object.getPrototypeOf(u);return A===null?void 0:f(A,p,v)}else{if("value"in g)return g.value;var T=g.get;return T===void 0?void 0:T.call(v)}},t=requireConstants$2(),r=requireEAN(),a=i(r);function i(f){return f&&f.__esModule?f:{default:f}}function c(f,u){if(!(f instanceof u))throw new TypeError("Cannot call a class as a function")}function l(f,u){if(!f)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return u&&(typeof u=="object"||typeof u=="function")?u:f}function h(f,u){if(typeof u!="function"&&u!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof u);f.prototype=Object.create(u&&u.prototype,{constructor:{value:f,enumerable:!1,writable:!0,configurable:!0}}),u&&(Object.setPrototypeOf?Object.setPrototypeOf(f,u):f.__proto__=u)}var o=function(u){var p=u.substr(0,12).split("").map(function(v){return+v}).reduce(function(v,g,A){return A%2?v+g*3:v+g},0);return(10-p%10)%10},s=function(f){h(u,f);function u(p,v){c(this,u),p.search(/^[0-9]{12}$/)!==-1&&(p+=o(p));var g=l(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,p,v));return g.lastChar=v.lastChar,g}return n(u,[{key:"valid",value:function(){return this.data.search(/^[0-9]{13}$/)!==-1&&+this.data[12]===o(this.data)}},{key:"leftText",value:function(){return e(u.prototype.__proto__||Object.getPrototypeOf(u.prototype),"leftText",this).call(this,1,6)}},{key:"leftEncode",value:function(){var v=this.data.substr(1,6),g=t.EAN13_STRUCTURE[this.data[0]];return e(u.prototype.__proto__||Object.getPrototypeOf(u.prototype),"leftEncode",this).call(this,v,g)}},{key:"rightText",value:function(){return e(u.prototype.__proto__||Object.getPrototypeOf(u.prototype),"rightText",this).call(this,7,6)}},{key:"rightEncode",value:function(){var v=this.data.substr(7,6);return e(u.prototype.__proto__||Object.getPrototypeOf(u.prototype),"rightEncode",this).call(this,v,"RRRRRR")}},{key:"encodeGuarded",value:function(){var v=e(u.prototype.__proto__||Object.getPrototypeOf(u.prototype),"encodeGuarded",this).call(this);return this.options.displayValue&&(v.unshift({data:"000000000000",text:this.text.substr(0,1),options:{textAlign:"left",fontSize:this.fontSize}}),this.options.lastChar&&(v.push({data:"00"}),v.push({data:"00000",text:this.options.lastChar,options:{fontSize:this.fontSize}}))),v}}]),u}(a.default);return EAN13.default=s,EAN13}var EAN8={},hasRequiredEAN8;function requireEAN8(){if(hasRequiredEAN8)return EAN8;hasRequiredEAN8=1,Object.defineProperty(EAN8,"__esModule",{value:!0});var n=function(){function s(f,u){for(var p=0;p<u.length;p++){var v=u[p];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(f,v.key,v)}}return function(f,u,p){return u&&s(f.prototype,u),p&&s(f,p),f}}(),e=function s(f,u,p){f===null&&(f=Function.prototype);var v=Object.getOwnPropertyDescriptor(f,u);if(v===void 0){var g=Object.getPrototypeOf(f);return g===null?void 0:s(g,u,p)}else{if("value"in v)return v.value;var A=v.get;return A===void 0?void 0:A.call(p)}},t=requireEAN(),r=a(t);function a(s){return s&&s.__esModule?s:{default:s}}function i(s,f){if(!(s instanceof f))throw new TypeError("Cannot call a class as a function")}function c(s,f){if(!s)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return f&&(typeof f=="object"||typeof f=="function")?f:s}function l(s,f){if(typeof f!="function"&&f!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof f);s.prototype=Object.create(f&&f.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),f&&(Object.setPrototypeOf?Object.setPrototypeOf(s,f):s.__proto__=f)}var h=function(f){var u=f.substr(0,7).split("").map(function(p){return+p}).reduce(function(p,v,g){return g%2?p+v:p+v*3},0);return(10-u%10)%10},o=function(s){l(f,s);function f(u,p){return i(this,f),u.search(/^[0-9]{7}$/)!==-1&&(u+=h(u)),c(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,u,p))}return n(f,[{key:"valid",value:function(){return this.data.search(/^[0-9]{8}$/)!==-1&&+this.data[7]===h(this.data)}},{key:"leftText",value:function(){return e(f.prototype.__proto__||Object.getPrototypeOf(f.prototype),"leftText",this).call(this,0,4)}},{key:"leftEncode",value:function(){var p=this.data.substr(0,4);return e(f.prototype.__proto__||Object.getPrototypeOf(f.prototype),"leftEncode",this).call(this,p,"LLLL")}},{key:"rightText",value:function(){return e(f.prototype.__proto__||Object.getPrototypeOf(f.prototype),"rightText",this).call(this,4,4)}},{key:"rightEncode",value:function(){var p=this.data.substr(4,4);return e(f.prototype.__proto__||Object.getPrototypeOf(f.prototype),"rightEncode",this).call(this,p,"RRRR")}}]),f}(r.default);return EAN8.default=o,EAN8}var EAN5={},hasRequiredEAN5;function requireEAN5(){if(hasRequiredEAN5)return EAN5;hasRequiredEAN5=1,Object.defineProperty(EAN5,"__esModule",{value:!0});var n=function(){function u(p,v){for(var g=0;g<v.length;g++){var A=v[g];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(p,A.key,A)}}return function(p,v,g){return v&&u(p.prototype,v),g&&u(p,g),p}}(),e=requireConstants$2(),t=requireEncoder(),r=c(t),a=requireBarcode(),i=c(a);function c(u){return u&&u.__esModule?u:{default:u}}function l(u,p){if(!(u instanceof p))throw new TypeError("Cannot call a class as a function")}function h(u,p){if(!u)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return p&&(typeof p=="object"||typeof p=="function")?p:u}function o(u,p){if(typeof p!="function"&&p!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof p);u.prototype=Object.create(p&&p.prototype,{constructor:{value:u,enumerable:!1,writable:!0,configurable:!0}}),p&&(Object.setPrototypeOf?Object.setPrototypeOf(u,p):u.__proto__=p)}var s=function(p){var v=p.split("").map(function(g){return+g}).reduce(function(g,A,T){return T%2?g+A*9:g+A*3},0);return v%10},f=function(u){o(p,u);function p(v,g){return l(this,p),h(this,(p.__proto__||Object.getPrototypeOf(p)).call(this,v,g))}return n(p,[{key:"valid",value:function(){return this.data.search(/^[0-9]{5}$/)!==-1}},{key:"encode",value:function(){var g=e.EAN5_STRUCTURE[s(this.data)];return{data:"1011"+(0,r.default)(this.data,g,"01"),text:this.text}}}]),p}(i.default);return EAN5.default=f,EAN5}var EAN2={},hasRequiredEAN2;function requireEAN2(){if(hasRequiredEAN2)return EAN2;hasRequiredEAN2=1,Object.defineProperty(EAN2,"__esModule",{value:!0});var n=function(){function f(u,p){for(var v=0;v<p.length;v++){var g=p[v];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(u,g.key,g)}}return function(u,p,v){return p&&f(u.prototype,p),v&&f(u,v),u}}(),e=requireConstants$2(),t=requireEncoder(),r=c(t),a=requireBarcode(),i=c(a);function c(f){return f&&f.__esModule?f:{default:f}}function l(f,u){if(!(f instanceof u))throw new TypeError("Cannot call a class as a function")}function h(f,u){if(!f)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return u&&(typeof u=="object"||typeof u=="function")?u:f}function o(f,u){if(typeof u!="function"&&u!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof u);f.prototype=Object.create(u&&u.prototype,{constructor:{value:f,enumerable:!1,writable:!0,configurable:!0}}),u&&(Object.setPrototypeOf?Object.setPrototypeOf(f,u):f.__proto__=u)}var s=function(f){o(u,f);function u(p,v){return l(this,u),h(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,p,v))}return n(u,[{key:"valid",value:function(){return this.data.search(/^[0-9]{2}$/)!==-1}},{key:"encode",value:function(){var v=e.EAN2_STRUCTURE[parseInt(this.data)%4];return{data:"1011"+(0,r.default)(this.data,v,"01"),text:this.text}}}]),u}(i.default);return EAN2.default=s,EAN2}var UPC={},hasRequiredUPC;function requireUPC(){if(hasRequiredUPC)return UPC;hasRequiredUPC=1,Object.defineProperty(UPC,"__esModule",{value:!0});var n=function(){function f(u,p){for(var v=0;v<p.length;v++){var g=p[v];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(u,g.key,g)}}return function(u,p,v){return p&&f(u.prototype,p),v&&f(u,v),u}}();UPC.checksum=s;var e=requireEncoder(),t=i(e),r=requireBarcode(),a=i(r);function i(f){return f&&f.__esModule?f:{default:f}}function c(f,u){if(!(f instanceof u))throw new TypeError("Cannot call a class as a function")}function l(f,u){if(!f)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return u&&(typeof u=="object"||typeof u=="function")?u:f}function h(f,u){if(typeof u!="function"&&u!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof u);f.prototype=Object.create(u&&u.prototype,{constructor:{value:f,enumerable:!1,writable:!0,configurable:!0}}),u&&(Object.setPrototypeOf?Object.setPrototypeOf(f,u):f.__proto__=u)}var o=function(f){h(u,f);function u(p,v){c(this,u),p.search(/^[0-9]{11}$/)!==-1&&(p+=s(p));var g=l(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,p,v));return g.displayValue=v.displayValue,v.fontSize>v.width*10?g.fontSize=v.width*10:g.fontSize=v.fontSize,g.guardHeight=v.height+g.fontSize/2+v.textMargin,g}return n(u,[{key:"valid",value:function(){return this.data.search(/^[0-9]{12}$/)!==-1&&this.data[11]==s(this.data)}},{key:"encode",value:function(){return this.options.flat?this.flatEncoding():this.guardedEncoding()}},{key:"flatEncoding",value:function(){var v="";return v+="101",v+=(0,t.default)(this.data.substr(0,6),"LLLLLL"),v+="01010",v+=(0,t.default)(this.data.substr(6,6),"RRRRRR"),v+="101",{data:v,text:this.text}}},{key:"guardedEncoding",value:function(){var v=[];return this.displayValue&&v.push({data:"00000000",text:this.text.substr(0,1),options:{textAlign:"left",fontSize:this.fontSize}}),v.push({data:"101"+(0,t.default)(this.data[0],"L"),options:{height:this.guardHeight}}),v.push({data:(0,t.default)(this.data.substr(1,5),"LLLLL"),text:this.text.substr(1,5),options:{fontSize:this.fontSize}}),v.push({data:"01010",options:{height:this.guardHeight}}),v.push({data:(0,t.default)(this.data.substr(6,5),"RRRRR"),text:this.text.substr(6,5),options:{fontSize:this.fontSize}}),v.push({data:(0,t.default)(this.data[11],"R")+"101",options:{height:this.guardHeight}}),this.displayValue&&v.push({data:"00000000",text:this.text.substr(11,1),options:{textAlign:"right",fontSize:this.fontSize}}),v}}]),u}(a.default);function s(f){var u=0,p;for(p=1;p<11;p+=2)u+=parseInt(f[p]);for(p=0;p<11;p+=2)u+=parseInt(f[p])*3;return(10-u%10)%10}return UPC.default=o,UPC}var UPCE={},hasRequiredUPCE;function requireUPCE(){if(hasRequiredUPCE)return UPCE;hasRequiredUPCE=1,Object.defineProperty(UPCE,"__esModule",{value:!0});var n=function(){function v(g,A){for(var T=0;T<A.length;T++){var b=A[T];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(g,b.key,b)}}return function(g,A,T){return A&&v(g.prototype,A),T&&v(g,T),g}}(),e=requireEncoder(),t=c(e),r=requireBarcode(),a=c(r),i=requireUPC();function c(v){return v&&v.__esModule?v:{default:v}}function l(v,g){if(!(v instanceof g))throw new TypeError("Cannot call a class as a function")}function h(v,g){if(!v)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return g&&(typeof g=="object"||typeof g=="function")?g:v}function o(v,g){if(typeof g!="function"&&g!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof g);v.prototype=Object.create(g&&g.prototype,{constructor:{value:v,enumerable:!1,writable:!0,configurable:!0}}),g&&(Object.setPrototypeOf?Object.setPrototypeOf(v,g):v.__proto__=g)}var s=["XX00000XXX","XX10000XXX","XX20000XXX","XXX00000XX","XXXX00000X","XXXXX00005","XXXXX00006","XXXXX00007","XXXXX00008","XXXXX00009"],f=[["EEEOOO","OOOEEE"],["EEOEOO","OOEOEE"],["EEOOEO","OOEEOE"],["EEOOOE","OOEEEO"],["EOEEOO","OEOOEE"],["EOOEEO","OEEOOE"],["EOOOEE","OEEEOO"],["EOEOEO","OEOEOE"],["EOEOOE","OEOEEO"],["EOOEOE","OEEOEO"]],u=function(v){o(g,v);function g(A,T){l(this,g);var b=h(this,(g.__proto__||Object.getPrototypeOf(g)).call(this,A,T));if(b.isValid=!1,A.search(/^[0-9]{6}$/)!==-1)b.middleDigits=A,b.upcA=p(A,"0"),b.text=T.text||""+b.upcA[0]+A+b.upcA[b.upcA.length-1],b.isValid=!0;else if(A.search(/^[01][0-9]{7}$/)!==-1)if(b.middleDigits=A.substring(1,A.length-1),b.upcA=p(b.middleDigits,A[0]),b.upcA[b.upcA.length-1]===A[A.length-1])b.isValid=!0;else return h(b);else return h(b);return b.displayValue=T.displayValue,T.fontSize>T.width*10?b.fontSize=T.width*10:b.fontSize=T.fontSize,b.guardHeight=T.height+b.fontSize/2+T.textMargin,b}return n(g,[{key:"valid",value:function(){return this.isValid}},{key:"encode",value:function(){return this.options.flat?this.flatEncoding():this.guardedEncoding()}},{key:"flatEncoding",value:function(){var T="";return T+="101",T+=this.encodeMiddleDigits(),T+="010101",{data:T,text:this.text}}},{key:"guardedEncoding",value:function(){var T=[];return this.displayValue&&T.push({data:"00000000",text:this.text[0],options:{textAlign:"left",fontSize:this.fontSize}}),T.push({data:"101",options:{height:this.guardHeight}}),T.push({data:this.encodeMiddleDigits(),text:this.text.substring(1,7),options:{fontSize:this.fontSize}}),T.push({data:"010101",options:{height:this.guardHeight}}),this.displayValue&&T.push({data:"00000000",text:this.text[7],options:{textAlign:"right",fontSize:this.fontSize}}),T}},{key:"encodeMiddleDigits",value:function(){var T=this.upcA[0],b=this.upcA[this.upcA.length-1],_=f[parseInt(b)][parseInt(T)];return(0,t.default)(this.middleDigits,_)}}]),g}(a.default);function p(v,g){for(var A=parseInt(v[v.length-1]),T=s[A],b="",_=0,w=0;w<T.length;w++){var m=T[w];m==="X"?b+=v[_++]:b+=m}return b=""+g+b,""+b+(0,i.checksum)(b)}return UPCE.default=u,UPCE}var hasRequiredEAN_UPC;function requireEAN_UPC(){if(hasRequiredEAN_UPC)return EAN_UPC;hasRequiredEAN_UPC=1,Object.defineProperty(EAN_UPC,"__esModule",{value:!0}),EAN_UPC.UPCE=EAN_UPC.UPC=EAN_UPC.EAN2=EAN_UPC.EAN5=EAN_UPC.EAN8=EAN_UPC.EAN13=void 0;var n=requireEAN13(),e=u(n),t=requireEAN8(),r=u(t),a=requireEAN5(),i=u(a),c=requireEAN2(),l=u(c),h=requireUPC(),o=u(h),s=requireUPCE(),f=u(s);function u(p){return p&&p.__esModule?p:{default:p}}return EAN_UPC.EAN13=e.default,EAN_UPC.EAN8=r.default,EAN_UPC.EAN5=i.default,EAN_UPC.EAN2=l.default,EAN_UPC.UPC=o.default,EAN_UPC.UPCE=f.default,EAN_UPC}var ITF$1={},ITF={},constants$1={},hasRequiredConstants$1;function requireConstants$1(){return hasRequiredConstants$1||(hasRequiredConstants$1=1,Object.defineProperty(constants$1,"__esModule",{value:!0}),constants$1.START_BIN="1010",constants$1.END_BIN="11101",constants$1.BINARIES=["00110","10001","01001","11000","00101","10100","01100","00011","10010","01010"]),constants$1}var hasRequiredITF$1;function requireITF$1(){if(hasRequiredITF$1)return ITF;hasRequiredITF$1=1,Object.defineProperty(ITF,"__esModule",{value:!0});var n=function(){function o(s,f){for(var u=0;u<f.length;u++){var p=f[u];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(s,p.key,p)}}return function(s,f,u){return f&&o(s.prototype,f),u&&o(s,u),s}}(),e=requireConstants$1(),t=requireBarcode(),r=a(t);function a(o){return o&&o.__esModule?o:{default:o}}function i(o,s){if(!(o instanceof s))throw new TypeError("Cannot call a class as a function")}function c(o,s){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s&&(typeof s=="object"||typeof s=="function")?s:o}function l(o,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof s);o.prototype=Object.create(s&&s.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),s&&(Object.setPrototypeOf?Object.setPrototypeOf(o,s):o.__proto__=s)}var h=function(o){l(s,o);function s(){return i(this,s),c(this,(s.__proto__||Object.getPrototypeOf(s)).apply(this,arguments))}return n(s,[{key:"valid",value:function(){return this.data.search(/^([0-9]{2})+$/)!==-1}},{key:"encode",value:function(){var u=this,p=this.data.match(/.{2}/g).map(function(v){return u.encodePair(v)}).join("");return{data:e.START_BIN+p+e.END_BIN,text:this.text}}},{key:"encodePair",value:function(u){var p=e.BINARIES[u[1]];return e.BINARIES[u[0]].split("").map(function(v,g){return(v==="1"?"111":"1")+(p[g]==="1"?"000":"0")}).join("")}}]),s}(r.default);return ITF.default=h,ITF}var ITF14={},hasRequiredITF14;function requireITF14(){if(hasRequiredITF14)return ITF14;hasRequiredITF14=1,Object.defineProperty(ITF14,"__esModule",{value:!0});var n=function(){function o(s,f){for(var u=0;u<f.length;u++){var p=f[u];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(s,p.key,p)}}return function(s,f,u){return f&&o(s.prototype,f),u&&o(s,u),s}}(),e=requireITF$1(),t=r(e);function r(o){return o&&o.__esModule?o:{default:o}}function a(o,s){if(!(o instanceof s))throw new TypeError("Cannot call a class as a function")}function i(o,s){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s&&(typeof s=="object"||typeof s=="function")?s:o}function c(o,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof s);o.prototype=Object.create(s&&s.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),s&&(Object.setPrototypeOf?Object.setPrototypeOf(o,s):o.__proto__=s)}var l=function(s){var f=s.substr(0,13).split("").map(function(u){return parseInt(u,10)}).reduce(function(u,p,v){return u+p*(3-v%2*2)},0);return Math.ceil(f/10)*10-f},h=function(o){c(s,o);function s(f,u){return a(this,s),f.search(/^[0-9]{13}$/)!==-1&&(f+=l(f)),i(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,f,u))}return n(s,[{key:"valid",value:function(){return this.data.search(/^[0-9]{14}$/)!==-1&&+this.data[13]===l(this.data)}}]),s}(t.default);return ITF14.default=h,ITF14}var hasRequiredITF;function requireITF(){if(hasRequiredITF)return ITF$1;hasRequiredITF=1,Object.defineProperty(ITF$1,"__esModule",{value:!0}),ITF$1.ITF14=ITF$1.ITF=void 0;var n=requireITF$1(),e=a(n),t=requireITF14(),r=a(t);function a(i){return i&&i.__esModule?i:{default:i}}return ITF$1.ITF=e.default,ITF$1.ITF14=r.default,ITF$1}var MSI$1={},MSI={},hasRequiredMSI$1;function requireMSI$1(){if(hasRequiredMSI$1)return MSI;hasRequiredMSI$1=1,Object.defineProperty(MSI,"__esModule",{value:!0});var n=function(){function o(s,f){for(var u=0;u<f.length;u++){var p=f[u];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(s,p.key,p)}}return function(s,f,u){return f&&o(s.prototype,f),u&&o(s,u),s}}(),e=requireBarcode(),t=r(e);function r(o){return o&&o.__esModule?o:{default:o}}function a(o,s){if(!(o instanceof s))throw new TypeError("Cannot call a class as a function")}function i(o,s){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s&&(typeof s=="object"||typeof s=="function")?s:o}function c(o,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof s);o.prototype=Object.create(s&&s.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),s&&(Object.setPrototypeOf?Object.setPrototypeOf(o,s):o.__proto__=s)}var l=function(o){c(s,o);function s(f,u){return a(this,s),i(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,f,u))}return n(s,[{key:"encode",value:function(){for(var u="110",p=0;p<this.data.length;p++){var v=parseInt(this.data[p]),g=v.toString(2);g=h(g,4-g.length);for(var A=0;A<g.length;A++)u+=g[A]=="0"?"100":"110"}return u+="1001",{data:u,text:this.text}}},{key:"valid",value:function(){return this.data.search(/^[0-9]+$/)!==-1}}]),s}(t.default);function h(o,s){for(var f=0;f<s;f++)o="0"+o;return o}return MSI.default=l,MSI}var MSI10={},checksums={},hasRequiredChecksums;function requireChecksums(){if(hasRequiredChecksums)return checksums;hasRequiredChecksums=1,Object.defineProperty(checksums,"__esModule",{value:!0}),checksums.mod10=n,checksums.mod11=e;function n(t){for(var r=0,a=0;a<t.length;a++){var i=parseInt(t[a]);(a+t.length)%2===0?r+=i:r+=i*2%10+Math.floor(i*2/10)}return(10-r%10)%10}function e(t){for(var r=0,a=[2,3,4,5,6,7],i=0;i<t.length;i++){var c=parseInt(t[t.length-1-i]);r+=a[i%a.length]*c}return(11-r%11)%11}return checksums}var hasRequiredMSI10;function requireMSI10(){if(hasRequiredMSI10)return MSI10;hasRequiredMSI10=1,Object.defineProperty(MSI10,"__esModule",{value:!0});var n=requireMSI$1(),e=r(n),t=requireChecksums();function r(h){return h&&h.__esModule?h:{default:h}}function a(h,o){if(!(h instanceof o))throw new TypeError("Cannot call a class as a function")}function i(h,o){if(!h)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&(typeof o=="object"||typeof o=="function")?o:h}function c(h,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof o);h.prototype=Object.create(o&&o.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(h,o):h.__proto__=o)}var l=function(h){c(o,h);function o(s,f){return a(this,o),i(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,s+(0,t.mod10)(s),f))}return o}(e.default);return MSI10.default=l,MSI10}var MSI11={},hasRequiredMSI11;function requireMSI11(){if(hasRequiredMSI11)return MSI11;hasRequiredMSI11=1,Object.defineProperty(MSI11,"__esModule",{value:!0});var n=requireMSI$1(),e=r(n),t=requireChecksums();function r(h){return h&&h.__esModule?h:{default:h}}function a(h,o){if(!(h instanceof o))throw new TypeError("Cannot call a class as a function")}function i(h,o){if(!h)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&(typeof o=="object"||typeof o=="function")?o:h}function c(h,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof o);h.prototype=Object.create(o&&o.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(h,o):h.__proto__=o)}var l=function(h){c(o,h);function o(s,f){return a(this,o),i(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,s+(0,t.mod11)(s),f))}return o}(e.default);return MSI11.default=l,MSI11}var MSI1010={},hasRequiredMSI1010;function requireMSI1010(){if(hasRequiredMSI1010)return MSI1010;hasRequiredMSI1010=1,Object.defineProperty(MSI1010,"__esModule",{value:!0});var n=requireMSI$1(),e=r(n),t=requireChecksums();function r(h){return h&&h.__esModule?h:{default:h}}function a(h,o){if(!(h instanceof o))throw new TypeError("Cannot call a class as a function")}function i(h,o){if(!h)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&(typeof o=="object"||typeof o=="function")?o:h}function c(h,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof o);h.prototype=Object.create(o&&o.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(h,o):h.__proto__=o)}var l=function(h){c(o,h);function o(s,f){return a(this,o),s+=(0,t.mod10)(s),s+=(0,t.mod10)(s),i(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,s,f))}return o}(e.default);return MSI1010.default=l,MSI1010}var MSI1110={},hasRequiredMSI1110;function requireMSI1110(){if(hasRequiredMSI1110)return MSI1110;hasRequiredMSI1110=1,Object.defineProperty(MSI1110,"__esModule",{value:!0});var n=requireMSI$1(),e=r(n),t=requireChecksums();function r(h){return h&&h.__esModule?h:{default:h}}function a(h,o){if(!(h instanceof o))throw new TypeError("Cannot call a class as a function")}function i(h,o){if(!h)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&(typeof o=="object"||typeof o=="function")?o:h}function c(h,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof o);h.prototype=Object.create(o&&o.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(h,o):h.__proto__=o)}var l=function(h){c(o,h);function o(s,f){return a(this,o),s+=(0,t.mod11)(s),s+=(0,t.mod10)(s),i(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,s,f))}return o}(e.default);return MSI1110.default=l,MSI1110}var hasRequiredMSI;function requireMSI(){if(hasRequiredMSI)return MSI$1;hasRequiredMSI=1,Object.defineProperty(MSI$1,"__esModule",{value:!0}),MSI$1.MSI1110=MSI$1.MSI1010=MSI$1.MSI11=MSI$1.MSI10=MSI$1.MSI=void 0;var n=requireMSI$1(),e=s(n),t=requireMSI10(),r=s(t),a=requireMSI11(),i=s(a),c=requireMSI1010(),l=s(c),h=requireMSI1110(),o=s(h);function s(f){return f&&f.__esModule?f:{default:f}}return MSI$1.MSI=e.default,MSI$1.MSI10=r.default,MSI$1.MSI11=i.default,MSI$1.MSI1010=l.default,MSI$1.MSI1110=o.default,MSI$1}var pharmacode={},hasRequiredPharmacode;function requirePharmacode(){if(hasRequiredPharmacode)return pharmacode;hasRequiredPharmacode=1,Object.defineProperty(pharmacode,"__esModule",{value:!0}),pharmacode.pharmacode=void 0;var n=function(){function h(o,s){for(var f=0;f<s.length;f++){var u=s[f];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(o,u.key,u)}}return function(o,s,f){return s&&h(o.prototype,s),f&&h(o,f),o}}(),e=requireBarcode(),t=r(e);function r(h){return h&&h.__esModule?h:{default:h}}function a(h,o){if(!(h instanceof o))throw new TypeError("Cannot call a class as a function")}function i(h,o){if(!h)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&(typeof o=="object"||typeof o=="function")?o:h}function c(h,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof o);h.prototype=Object.create(o&&o.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(h,o):h.__proto__=o)}var l=function(h){c(o,h);function o(s,f){a(this,o);var u=i(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,s,f));return u.number=parseInt(s,10),u}return n(o,[{key:"encode",value:function(){for(var f=this.number,u="";!isNaN(f)&&f!=0;)f%2===0?(u="11100"+u,f=(f-2)/2):(u="100"+u,f=(f-1)/2);return u=u.slice(0,-2),{data:u,text:this.text}}},{key:"valid",value:function(){return this.number>=3&&this.number<=131070}}]),o}(t.default);return pharmacode.pharmacode=l,pharmacode}var codabar={},hasRequiredCodabar;function requireCodabar(){if(hasRequiredCodabar)return codabar;hasRequiredCodabar=1,Object.defineProperty(codabar,"__esModule",{value:!0}),codabar.codabar=void 0;var n=function(){function h(o,s){for(var f=0;f<s.length;f++){var u=s[f];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(o,u.key,u)}}return function(o,s,f){return s&&h(o.prototype,s),f&&h(o,f),o}}(),e=requireBarcode(),t=r(e);function r(h){return h&&h.__esModule?h:{default:h}}function a(h,o){if(!(h instanceof o))throw new TypeError("Cannot call a class as a function")}function i(h,o){if(!h)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&(typeof o=="object"||typeof o=="function")?o:h}function c(h,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof o);h.prototype=Object.create(o&&o.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(h,o):h.__proto__=o)}var l=function(h){c(o,h);function o(s,f){a(this,o),s.search(/^[0-9\-\$\:\.\+\/]+$/)===0&&(s="A"+s+"A");var u=i(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,s.toUpperCase(),f));return u.text=u.options.text||u.text.replace(/[A-D]/g,""),u}return n(o,[{key:"valid",value:function(){return this.data.search(/^[A-D][0-9\-\$\:\.\+\/]+[A-D]$/)!==-1}},{key:"encode",value:function(){for(var f=[],u=this.getEncodings(),p=0;p<this.data.length;p++)f.push(u[this.data.charAt(p)]),p!==this.data.length-1&&f.push("0");return{text:this.text,data:f.join("")}}},{key:"getEncodings",value:function(){return{0:"101010011",1:"101011001",2:"101001011",3:"110010101",4:"101101001",5:"110101001",6:"100101011",7:"100101101",8:"100110101",9:"110100101","-":"101001101",$:"101100101",":":"1101011011","/":"1101101011",".":"1101101101","+":"1011011011",A:"1011001001",B:"1001001011",C:"1010010011",D:"1010011001"}}}]),o}(t.default);return codabar.codabar=l,codabar}var CODE93$1={},CODE93={},constants={},hasRequiredConstants;function requireConstants(){return hasRequiredConstants||(hasRequiredConstants=1,Object.defineProperty(constants,"__esModule",{value:!0}),constants.SYMBOLS=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","-","."," ","$","/","+","%","($)","(%)","(/)","(+)","ÿ"],constants.BINARIES=["100010100","101001000","101000100","101000010","100101000","100100100","100100010","101010000","100010010","100001010","110101000","110100100","110100010","110010100","110010010","110001010","101101000","101100100","101100010","100110100","100011010","101011000","101001100","101000110","100101100","100010110","110110100","110110010","110101100","110100110","110010110","110011010","101101100","101100110","100110110","100111010","100101110","111010100","111010010","111001010","101101110","101110110","110101110","100100110","111011010","111010110","100110010","101011110"],constants.MULTI_SYMBOLS={"\0":["(%)","U"],"":["($)","A"],"":["($)","B"],"":["($)","C"],"":["($)","D"],"":["($)","E"],"":["($)","F"],"\x07":["($)","G"],"\b":["($)","H"],"	":["($)","I"],"\n":["($)","J"],"\v":["($)","K"],"\f":["($)","L"],"\r":["($)","M"],"":["($)","N"],"":["($)","O"],"":["($)","P"],"":["($)","Q"],"":["($)","R"],"":["($)","S"],"":["($)","T"],"":["($)","U"],"":["($)","V"],"":["($)","W"],"":["($)","X"],"":["($)","Y"],"":["($)","Z"],"\x1B":["(%)","A"],"":["(%)","B"],"":["(%)","C"],"":["(%)","D"],"":["(%)","E"],"!":["(/)","A"],'"':["(/)","B"],"#":["(/)","C"],"&":["(/)","F"],"'":["(/)","G"],"(":["(/)","H"],")":["(/)","I"],"*":["(/)","J"],",":["(/)","L"],":":["(/)","Z"],";":["(%)","F"],"<":["(%)","G"],"=":["(%)","H"],">":["(%)","I"],"?":["(%)","J"],"@":["(%)","V"],"[":["(%)","K"],"\\":["(%)","L"],"]":["(%)","M"],"^":["(%)","N"],_:["(%)","O"],"`":["(%)","W"],a:["(+)","A"],b:["(+)","B"],c:["(+)","C"],d:["(+)","D"],e:["(+)","E"],f:["(+)","F"],g:["(+)","G"],h:["(+)","H"],i:["(+)","I"],j:["(+)","J"],k:["(+)","K"],l:["(+)","L"],m:["(+)","M"],n:["(+)","N"],o:["(+)","O"],p:["(+)","P"],q:["(+)","Q"],r:["(+)","R"],s:["(+)","S"],t:["(+)","T"],u:["(+)","U"],v:["(+)","V"],w:["(+)","W"],x:["(+)","X"],y:["(+)","Y"],z:["(+)","Z"],"{":["(%)","P"],"|":["(%)","Q"],"}":["(%)","R"],"~":["(%)","S"],"":["(%)","T"]}),constants}var hasRequiredCODE93$1;function requireCODE93$1(){if(hasRequiredCODE93$1)return CODE93;hasRequiredCODE93$1=1,Object.defineProperty(CODE93,"__esModule",{value:!0});var n=function(){function o(s,f){for(var u=0;u<f.length;u++){var p=f[u];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(s,p.key,p)}}return function(s,f,u){return f&&o(s.prototype,f),u&&o(s,u),s}}(),e=requireConstants(),t=requireBarcode(),r=a(t);function a(o){return o&&o.__esModule?o:{default:o}}function i(o,s){if(!(o instanceof s))throw new TypeError("Cannot call a class as a function")}function c(o,s){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s&&(typeof s=="object"||typeof s=="function")?s:o}function l(o,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof s);o.prototype=Object.create(s&&s.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),s&&(Object.setPrototypeOf?Object.setPrototypeOf(o,s):o.__proto__=s)}var h=function(o){l(s,o);function s(f,u){return i(this,s),c(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,f,u))}return n(s,[{key:"valid",value:function(){return/^[0-9A-Z\-. $/+%]+$/.test(this.data)}},{key:"encode",value:function(){var u=this.data.split("").flatMap(function(A){return e.MULTI_SYMBOLS[A]||A}),p=u.map(function(A){return s.getEncoding(A)}).join(""),v=s.checksum(u,20),g=s.checksum(u.concat(v),15);return{text:this.text,data:s.getEncoding("ÿ")+p+s.getEncoding(v)+s.getEncoding(g)+s.getEncoding("ÿ")+"1"}}}],[{key:"getEncoding",value:function(u){return e.BINARIES[s.symbolValue(u)]}},{key:"getSymbol",value:function(u){return e.SYMBOLS[u]}},{key:"symbolValue",value:function(u){return e.SYMBOLS.indexOf(u)}},{key:"checksum",value:function(u,p){var v=u.slice().reverse().reduce(function(g,A,T){var b=T%p+1;return g+s.symbolValue(A)*b},0);return s.getSymbol(v%47)}}]),s}(r.default);return CODE93.default=h,CODE93}var CODE93FullASCII={},hasRequiredCODE93FullASCII;function requireCODE93FullASCII(){if(hasRequiredCODE93FullASCII)return CODE93FullASCII;hasRequiredCODE93FullASCII=1,Object.defineProperty(CODE93FullASCII,"__esModule",{value:!0});var n=function(){function h(o,s){for(var f=0;f<s.length;f++){var u=s[f];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(o,u.key,u)}}return function(o,s,f){return s&&h(o.prototype,s),f&&h(o,f),o}}(),e=requireCODE93$1(),t=r(e);function r(h){return h&&h.__esModule?h:{default:h}}function a(h,o){if(!(h instanceof o))throw new TypeError("Cannot call a class as a function")}function i(h,o){if(!h)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&(typeof o=="object"||typeof o=="function")?o:h}function c(h,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof o);h.prototype=Object.create(o&&o.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(h,o):h.__proto__=o)}var l=function(h){c(o,h);function o(s,f){return a(this,o),i(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,s,f))}return n(o,[{key:"valid",value:function(){return/^[\x00-\x7f]+$/.test(this.data)}}]),o}(t.default);return CODE93FullASCII.default=l,CODE93FullASCII}var hasRequiredCODE93;function requireCODE93(){if(hasRequiredCODE93)return CODE93$1;hasRequiredCODE93=1,Object.defineProperty(CODE93$1,"__esModule",{value:!0}),CODE93$1.CODE93FullASCII=CODE93$1.CODE93=void 0;var n=requireCODE93$1(),e=a(n),t=requireCODE93FullASCII(),r=a(t);function a(i){return i&&i.__esModule?i:{default:i}}return CODE93$1.CODE93=e.default,CODE93$1.CODE93FullASCII=r.default,CODE93$1}var GenericBarcode={},hasRequiredGenericBarcode;function requireGenericBarcode(){if(hasRequiredGenericBarcode)return GenericBarcode;hasRequiredGenericBarcode=1,Object.defineProperty(GenericBarcode,"__esModule",{value:!0}),GenericBarcode.GenericBarcode=void 0;var n=function(){function h(o,s){for(var f=0;f<s.length;f++){var u=s[f];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(o,u.key,u)}}return function(o,s,f){return s&&h(o.prototype,s),f&&h(o,f),o}}(),e=requireBarcode(),t=r(e);function r(h){return h&&h.__esModule?h:{default:h}}function a(h,o){if(!(h instanceof o))throw new TypeError("Cannot call a class as a function")}function i(h,o){if(!h)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&(typeof o=="object"||typeof o=="function")?o:h}function c(h,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof o);h.prototype=Object.create(o&&o.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(h,o):h.__proto__=o)}var l=function(h){c(o,h);function o(s,f){return a(this,o),i(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,s,f))}return n(o,[{key:"encode",value:function(){return{data:"10101010101010101010101010101010101010101",text:this.text}}},{key:"valid",value:function(){return!0}}]),o}(t.default);return GenericBarcode.GenericBarcode=l,GenericBarcode}var hasRequiredBarcodes;function requireBarcodes(){if(hasRequiredBarcodes)return barcodes;hasRequiredBarcodes=1,Object.defineProperty(barcodes,"__esModule",{value:!0});var n=requireCODE39(),e=requireCODE128(),t=requireEAN_UPC(),r=requireITF(),a=requireMSI(),i=requirePharmacode(),c=requireCodabar(),l=requireCODE93(),h=requireGenericBarcode();return barcodes.default={CODE39:n.CODE39,CODE128:e.CODE128,CODE128A:e.CODE128A,CODE128B:e.CODE128B,CODE128C:e.CODE128C,EAN13:t.EAN13,EAN8:t.EAN8,EAN5:t.EAN5,EAN2:t.EAN2,UPC:t.UPC,UPCE:t.UPCE,ITF14:r.ITF14,ITF:r.ITF,MSI:a.MSI,MSI10:a.MSI10,MSI11:a.MSI11,MSI1010:a.MSI1010,MSI1110:a.MSI1110,pharmacode:i.pharmacode,codabar:c.codabar,CODE93:l.CODE93,CODE93FullASCII:l.CODE93FullASCII,GenericBarcode:h.GenericBarcode},barcodes}var merge={},hasRequiredMerge;function requireMerge(){if(hasRequiredMerge)return merge;hasRequiredMerge=1,Object.defineProperty(merge,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e};return merge.default=function(e,t){return n({},e,t)},merge}var linearizeEncodings={},hasRequiredLinearizeEncodings;function requireLinearizeEncodings(){if(hasRequiredLinearizeEncodings)return linearizeEncodings;hasRequiredLinearizeEncodings=1,Object.defineProperty(linearizeEncodings,"__esModule",{value:!0}),linearizeEncodings.default=n;function n(e){var t=[];function r(a){if(Array.isArray(a))for(var i=0;i<a.length;i++)r(a[i]);else a.text=a.text||"",a.data=a.data||"",t.push(a)}return r(e),t}return linearizeEncodings}var fixOptions={},hasRequiredFixOptions;function requireFixOptions(){if(hasRequiredFixOptions)return fixOptions;hasRequiredFixOptions=1,Object.defineProperty(fixOptions,"__esModule",{value:!0}),fixOptions.default=n;function n(e){return e.marginTop=e.marginTop||e.margin,e.marginBottom=e.marginBottom||e.margin,e.marginRight=e.marginRight||e.margin,e.marginLeft=e.marginLeft||e.margin,e}return fixOptions}var getRenderProperties={},getOptionsFromElement={},optionsFromStrings={},hasRequiredOptionsFromStrings;function requireOptionsFromStrings(){if(hasRequiredOptionsFromStrings)return optionsFromStrings;hasRequiredOptionsFromStrings=1,Object.defineProperty(optionsFromStrings,"__esModule",{value:!0}),optionsFromStrings.default=n;function n(e){var t=["width","height","textMargin","fontSize","margin","marginTop","marginBottom","marginLeft","marginRight"];for(var r in t)t.hasOwnProperty(r)&&(r=t[r],typeof e[r]=="string"&&(e[r]=parseInt(e[r],10)));return typeof e.displayValue=="string"&&(e.displayValue=e.displayValue!="false"),e}return optionsFromStrings}var defaults={},hasRequiredDefaults;function requireDefaults(){if(hasRequiredDefaults)return defaults;hasRequiredDefaults=1,Object.defineProperty(defaults,"__esModule",{value:!0});var n={width:2,height:100,format:"auto",displayValue:!0,fontOptions:"",font:"monospace",text:void 0,textAlign:"center",textPosition:"bottom",textMargin:2,fontSize:20,background:"#ffffff",lineColor:"#000000",margin:10,marginTop:void 0,marginBottom:void 0,marginLeft:void 0,marginRight:void 0,valid:function(){}};return defaults.default=n,defaults}var hasRequiredGetOptionsFromElement;function requireGetOptionsFromElement(){if(hasRequiredGetOptionsFromElement)return getOptionsFromElement;hasRequiredGetOptionsFromElement=1,Object.defineProperty(getOptionsFromElement,"__esModule",{value:!0});var n=requireOptionsFromStrings(),e=a(n),t=requireDefaults(),r=a(t);function a(c){return c&&c.__esModule?c:{default:c}}function i(c){var l={};for(var h in r.default)r.default.hasOwnProperty(h)&&(c.hasAttribute("jsbarcode-"+h.toLowerCase())&&(l[h]=c.getAttribute("jsbarcode-"+h.toLowerCase())),c.hasAttribute("data-"+h.toLowerCase())&&(l[h]=c.getAttribute("data-"+h.toLowerCase())));return l.value=c.getAttribute("jsbarcode-value")||c.getAttribute("data-value"),l=(0,e.default)(l),l}return getOptionsFromElement.default=i,getOptionsFromElement}var renderers={},canvas={},shared={},hasRequiredShared;function requireShared(){if(hasRequiredShared)return shared;hasRequiredShared=1,Object.defineProperty(shared,"__esModule",{value:!0}),shared.getTotalWidthOfEncodings=shared.calculateEncodingAttributes=shared.getBarcodePadding=shared.getEncodingHeight=shared.getMaximumHeightOfEncodings=void 0;var n=requireMerge(),e=t(n);function t(o){return o&&o.__esModule?o:{default:o}}function r(o,s){return s.height+(s.displayValue&&o.text.length>0?s.fontSize+s.textMargin:0)+s.marginTop+s.marginBottom}function a(o,s,f){if(f.displayValue&&s<o){if(f.textAlign=="center")return Math.floor((o-s)/2);if(f.textAlign=="left")return 0;if(f.textAlign=="right")return Math.floor(o-s)}return 0}function i(o,s,f){for(var u=0;u<o.length;u++){var p=o[u],v=(0,e.default)(s,p.options),g;v.displayValue?g=h(p.text,v,f):g=0;var A=p.data.length*v.width;p.width=Math.ceil(Math.max(g,A)),p.height=r(p,v),p.barcodePadding=a(g,A,v)}}function c(o){for(var s=0,f=0;f<o.length;f++)s+=o[f].width;return s}function l(o){for(var s=0,f=0;f<o.length;f++)o[f].height>s&&(s=o[f].height);return s}function h(o,s,f){var u;if(f)u=f;else if(typeof document<"u")u=document.createElement("canvas").getContext("2d");else return 0;u.font=s.fontOptions+" "+s.fontSize+"px "+s.font;var p=u.measureText(o);if(!p)return 0;var v=p.width;return v}return shared.getMaximumHeightOfEncodings=l,shared.getEncodingHeight=r,shared.getBarcodePadding=a,shared.calculateEncodingAttributes=i,shared.getTotalWidthOfEncodings=c,shared}var hasRequiredCanvas;function requireCanvas(){if(hasRequiredCanvas)return canvas;hasRequiredCanvas=1,Object.defineProperty(canvas,"__esModule",{value:!0});var n=function(){function l(h,o){for(var s=0;s<o.length;s++){var f=o[s];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(h,f.key,f)}}return function(h,o,s){return o&&l(h.prototype,o),s&&l(h,s),h}}(),e=requireMerge(),t=a(e),r=requireShared();function a(l){return l&&l.__esModule?l:{default:l}}function i(l,h){if(!(l instanceof h))throw new TypeError("Cannot call a class as a function")}var c=function(){function l(h,o,s){i(this,l),this.canvas=h,this.encodings=o,this.options=s}return n(l,[{key:"render",value:function(){if(!this.canvas.getContext)throw new Error("The browser does not support canvas.");this.prepareCanvas();for(var o=0;o<this.encodings.length;o++){var s=(0,t.default)(this.options,this.encodings[o].options);this.drawCanvasBarcode(s,this.encodings[o]),this.drawCanvasText(s,this.encodings[o]),this.moveCanvasDrawing(this.encodings[o])}this.restoreCanvas()}},{key:"prepareCanvas",value:function(){var o=this.canvas.getContext("2d");o.save(),(0,r.calculateEncodingAttributes)(this.encodings,this.options,o);var s=(0,r.getTotalWidthOfEncodings)(this.encodings),f=(0,r.getMaximumHeightOfEncodings)(this.encodings);this.canvas.width=s+this.options.marginLeft+this.options.marginRight,this.canvas.height=f,o.clearRect(0,0,this.canvas.width,this.canvas.height),this.options.background&&(o.fillStyle=this.options.background,o.fillRect(0,0,this.canvas.width,this.canvas.height)),o.translate(this.options.marginLeft,0)}},{key:"drawCanvasBarcode",value:function(o,s){var f=this.canvas.getContext("2d"),u=s.data,p;o.textPosition=="top"?p=o.marginTop+o.fontSize+o.textMargin:p=o.marginTop,f.fillStyle=o.lineColor;for(var v=0;v<u.length;v++){var g=v*o.width+s.barcodePadding;u[v]==="1"?f.fillRect(g,p,o.width,o.height):u[v]&&f.fillRect(g,p,o.width,o.height*u[v])}}},{key:"drawCanvasText",value:function(o,s){var f=this.canvas.getContext("2d"),u=o.fontOptions+" "+o.fontSize+"px "+o.font;if(o.displayValue){var p,v;o.textPosition=="top"?v=o.marginTop+o.fontSize-o.textMargin:v=o.height+o.textMargin+o.marginTop+o.fontSize,f.font=u,o.textAlign=="left"||s.barcodePadding>0?(p=0,f.textAlign="left"):o.textAlign=="right"?(p=s.width-1,f.textAlign="right"):(p=s.width/2,f.textAlign="center"),f.fillText(s.text,p,v)}}},{key:"moveCanvasDrawing",value:function(o){var s=this.canvas.getContext("2d");s.translate(o.width,0)}},{key:"restoreCanvas",value:function(){var o=this.canvas.getContext("2d");o.restore()}}]),l}();return canvas.default=c,canvas}var svg={},hasRequiredSvg;function requireSvg(){if(hasRequiredSvg)return svg;hasRequiredSvg=1,Object.defineProperty(svg,"__esModule",{value:!0});var n=function(){function h(o,s){for(var f=0;f<s.length;f++){var u=s[f];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(o,u.key,u)}}return function(o,s,f){return s&&h(o.prototype,s),f&&h(o,f),o}}(),e=requireMerge(),t=a(e),r=requireShared();function a(h){return h&&h.__esModule?h:{default:h}}function i(h,o){if(!(h instanceof o))throw new TypeError("Cannot call a class as a function")}var c="http://www.w3.org/2000/svg",l=function(){function h(o,s,f){i(this,h),this.svg=o,this.encodings=s,this.options=f,this.document=f.xmlDocument||document}return n(h,[{key:"render",value:function(){var s=this.options.marginLeft;this.prepareSVG();for(var f=0;f<this.encodings.length;f++){var u=this.encodings[f],p=(0,t.default)(this.options,u.options),v=this.createGroup(s,p.marginTop,this.svg);this.setGroupOptions(v,p),this.drawSvgBarcode(v,p,u),this.drawSVGText(v,p,u),s+=u.width}}},{key:"prepareSVG",value:function(){for(;this.svg.firstChild;)this.svg.removeChild(this.svg.firstChild);(0,r.calculateEncodingAttributes)(this.encodings,this.options);var s=(0,r.getTotalWidthOfEncodings)(this.encodings),f=(0,r.getMaximumHeightOfEncodings)(this.encodings),u=s+this.options.marginLeft+this.options.marginRight;this.setSvgAttributes(u,f),this.options.background&&this.drawRect(0,0,u,f,this.svg).setAttribute("style","fill:"+this.options.background+";")}},{key:"drawSvgBarcode",value:function(s,f,u){var p=u.data,v;f.textPosition=="top"?v=f.fontSize+f.textMargin:v=0;for(var g=0,A=0,T=0;T<p.length;T++)A=T*f.width+u.barcodePadding,p[T]==="1"?g++:g>0&&(this.drawRect(A-f.width*g,v,f.width*g,f.height,s),g=0);g>0&&this.drawRect(A-f.width*(g-1),v,f.width*g,f.height,s)}},{key:"drawSVGText",value:function(s,f,u){var p=this.document.createElementNS(c,"text");if(f.displayValue){var v,g;p.setAttribute("style","font:"+f.fontOptions+" "+f.fontSize+"px "+f.font),f.textPosition=="top"?g=f.fontSize-f.textMargin:g=f.height+f.textMargin+f.fontSize,f.textAlign=="left"||u.barcodePadding>0?(v=0,p.setAttribute("text-anchor","start")):f.textAlign=="right"?(v=u.width-1,p.setAttribute("text-anchor","end")):(v=u.width/2,p.setAttribute("text-anchor","middle")),p.setAttribute("x",v),p.setAttribute("y",g),p.appendChild(this.document.createTextNode(u.text)),s.appendChild(p)}}},{key:"setSvgAttributes",value:function(s,f){var u=this.svg;u.setAttribute("width",s+"px"),u.setAttribute("height",f+"px"),u.setAttribute("x","0px"),u.setAttribute("y","0px"),u.setAttribute("viewBox","0 0 "+s+" "+f),u.setAttribute("xmlns",c),u.setAttribute("version","1.1"),u.setAttribute("style","transform: translate(0,0)")}},{key:"createGroup",value:function(s,f,u){var p=this.document.createElementNS(c,"g");return p.setAttribute("transform","translate("+s+", "+f+")"),u.appendChild(p),p}},{key:"setGroupOptions",value:function(s,f){s.setAttribute("style","fill:"+f.lineColor+";")}},{key:"drawRect",value:function(s,f,u,p,v){var g=this.document.createElementNS(c,"rect");return g.setAttribute("x",s),g.setAttribute("y",f),g.setAttribute("width",u),g.setAttribute("height",p),v.appendChild(g),g}}]),h}();return svg.default=l,svg}var object={},hasRequiredObject;function requireObject(){if(hasRequiredObject)return object;hasRequiredObject=1,Object.defineProperty(object,"__esModule",{value:!0});var n=function(){function r(a,i){for(var c=0;c<i.length;c++){var l=i[c];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(a,l.key,l)}}return function(a,i,c){return i&&r(a.prototype,i),c&&r(a,c),a}}();function e(r,a){if(!(r instanceof a))throw new TypeError("Cannot call a class as a function")}var t=function(){function r(a,i,c){e(this,r),this.object=a,this.encodings=i,this.options=c}return n(r,[{key:"render",value:function(){this.object.encodings=this.encodings}}]),r}();return object.default=t,object}var hasRequiredRenderers;function requireRenderers(){if(hasRequiredRenderers)return renderers;hasRequiredRenderers=1,Object.defineProperty(renderers,"__esModule",{value:!0});var n=requireCanvas(),e=c(n),t=requireSvg(),r=c(t),a=requireObject(),i=c(a);function c(l){return l&&l.__esModule?l:{default:l}}return renderers.default={CanvasRenderer:e.default,SVGRenderer:r.default,ObjectRenderer:i.default},renderers}var exceptions={},hasRequiredExceptions;function requireExceptions(){if(hasRequiredExceptions)return exceptions;hasRequiredExceptions=1,Object.defineProperty(exceptions,"__esModule",{value:!0});function n(c,l){if(!(c instanceof l))throw new TypeError("Cannot call a class as a function")}function e(c,l){if(!c)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return l&&(typeof l=="object"||typeof l=="function")?l:c}function t(c,l){if(typeof l!="function"&&l!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof l);c.prototype=Object.create(l&&l.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),l&&(Object.setPrototypeOf?Object.setPrototypeOf(c,l):c.__proto__=l)}var r=function(c){t(l,c);function l(h,o){n(this,l);var s=e(this,(l.__proto__||Object.getPrototypeOf(l)).call(this));return s.name="InvalidInputException",s.symbology=h,s.input=o,s.message='"'+s.input+'" is not a valid input for '+s.symbology,s}return l}(Error),a=function(c){t(l,c);function l(){n(this,l);var h=e(this,(l.__proto__||Object.getPrototypeOf(l)).call(this));return h.name="InvalidElementException",h.message="Not supported type to render on",h}return l}(Error),i=function(c){t(l,c);function l(){n(this,l);var h=e(this,(l.__proto__||Object.getPrototypeOf(l)).call(this));return h.name="NoElementException",h.message="No element to render on.",h}return l}(Error);return exceptions.InvalidInputException=r,exceptions.InvalidElementException=a,exceptions.NoElementException=i,exceptions}var hasRequiredGetRenderProperties;function requireGetRenderProperties(){if(hasRequiredGetRenderProperties)return getRenderProperties;hasRequiredGetRenderProperties=1,Object.defineProperty(getRenderProperties,"__esModule",{value:!0});var n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},e=requireGetOptionsFromElement(),t=c(e),r=requireRenderers(),a=c(r),i=requireExceptions();function c(s){return s&&s.__esModule?s:{default:s}}function l(s){if(typeof s=="string")return h(s);if(Array.isArray(s)){for(var f=[],u=0;u<s.length;u++)f.push(l(s[u]));return f}else{if(typeof HTMLCanvasElement<"u"&&s instanceof HTMLImageElement)return o(s);if(s&&s.nodeName&&s.nodeName.toLowerCase()==="svg"||typeof SVGElement<"u"&&s instanceof SVGElement)return{element:s,options:(0,t.default)(s),renderer:a.default.SVGRenderer};if(typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement)return{element:s,options:(0,t.default)(s),renderer:a.default.CanvasRenderer};if(s&&s.getContext)return{element:s,renderer:a.default.CanvasRenderer};if(s&&(typeof s>"u"?"undefined":n(s))==="object"&&!s.nodeName)return{element:s,renderer:a.default.ObjectRenderer};throw new i.InvalidElementException}}function h(s){var f=document.querySelectorAll(s);if(f.length!==0){for(var u=[],p=0;p<f.length;p++)u.push(l(f[p]));return u}}function o(s){var f=document.createElement("canvas");return{element:f,options:(0,t.default)(s),renderer:a.default.CanvasRenderer,afterRender:function(){s.setAttribute("src",f.toDataURL())}}}return getRenderProperties.default=l,getRenderProperties}var ErrorHandler={},hasRequiredErrorHandler;function requireErrorHandler(){if(hasRequiredErrorHandler)return ErrorHandler;hasRequiredErrorHandler=1,Object.defineProperty(ErrorHandler,"__esModule",{value:!0});var n=function(){function r(a,i){for(var c=0;c<i.length;c++){var l=i[c];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(a,l.key,l)}}return function(a,i,c){return i&&r(a.prototype,i),c&&r(a,c),a}}();function e(r,a){if(!(r instanceof a))throw new TypeError("Cannot call a class as a function")}var t=function(){function r(a){e(this,r),this.api=a}return n(r,[{key:"handleCatch",value:function(i){if(i.name==="InvalidInputException")if(this.api._options.valid!==this.api._defaults.valid)this.api._options.valid(!1);else throw i.message;else throw i;this.api.render=function(){}}},{key:"wrapBarcodeCall",value:function(i){try{var c=i.apply(void 0,arguments);return this.api._options.valid(!0),c}catch(l){return this.handleCatch(l),this.api}}}]),r}();return ErrorHandler.default=t,ErrorHandler}var JsBarcode_1,hasRequiredJsBarcode;function requireJsBarcode(){if(hasRequiredJsBarcode)return JsBarcode_1;hasRequiredJsBarcode=1;var n=requireBarcodes(),e=T(n),t=requireMerge(),r=T(t),a=requireLinearizeEncodings(),i=T(a),c=requireFixOptions(),l=T(c),h=requireGetRenderProperties(),o=T(h),s=requireOptionsFromStrings(),f=T(s),u=requireErrorHandler(),p=T(u),v=requireExceptions(),g=requireDefaults(),A=T(g);function T(R){return R&&R.__esModule?R:{default:R}}var b=function(){},_=function(M,F,H){var V=new b;if(typeof M>"u")throw Error("No element to render on was provided.");return V._renderProperties=(0,o.default)(M),V._encodings=[],V._options=A.default,V._errorHandler=new p.default(V),typeof F<"u"&&(H=H||{},H.format||(H.format=C()),V.options(H)[H.format](F,H).render()),V};_.getModule=function(R){return e.default[R]};for(var w in e.default)e.default.hasOwnProperty(w)&&m(e.default,w);function m(R,M){b.prototype[M]=b.prototype[M.toUpperCase()]=b.prototype[M.toLowerCase()]=function(F,H){var V=this;return V._errorHandler.wrapBarcodeCall(function(){H.text=typeof H.text>"u"?void 0:""+H.text;var X=(0,r.default)(V._options,H);X=(0,f.default)(X);var K=R[M],q=S(F,K,X);return V._encodings.push(q),V})}}function S(R,M,F){R=""+R;var H=new M(R,F);if(!H.valid())throw new v.InvalidInputException(H.constructor.name,R);var V=H.encode();V=(0,i.default)(V);for(var X=0;X<V.length;X++)V[X].options=(0,r.default)(F,V[X].options);return V}function C(){return e.default.CODE128?"CODE128":Object.keys(e.default)[0]}b.prototype.options=function(R){return this._options=(0,r.default)(this._options,R),this},b.prototype.blank=function(R){var M=new Array(R+1).join("0");return this._encodings.push({data:M}),this},b.prototype.init=function(){if(this._renderProperties){Array.isArray(this._renderProperties)||(this._renderProperties=[this._renderProperties]);var R;for(var M in this._renderProperties){R=this._renderProperties[M];var F=(0,r.default)(this._options,R.options);F.format=="auto"&&(F.format=C()),this._errorHandler.wrapBarcodeCall(function(){var H=F.value,V=e.default[F.format.toUpperCase()],X=S(H,V,F);x(R,X,F)})}}},b.prototype.render=function(){if(!this._renderProperties)throw new v.NoElementException;if(Array.isArray(this._renderProperties))for(var R=0;R<this._renderProperties.length;R++)x(this._renderProperties[R],this._encodings,this._options);else x(this._renderProperties,this._encodings,this._options);return this},b.prototype._defaults=A.default;function x(R,M,F){M=(0,i.default)(M);for(var H=0;H<M.length;H++)M[H].options=(0,r.default)(F,M[H].options),(0,l.default)(M[H].options);(0,l.default)(F);var V=R.renderer,X=new V(R.element,M,F);X.render(),R.afterRender&&R.afterRender()}return typeof window<"u"&&(window.JsBarcode=_),typeof jQuery<"u"&&(jQuery.fn.JsBarcode=function(R,M){var F=[];return jQuery(this).each(function(){F.push(this)}),_(F,R,M)}),JsBarcode_1=_,JsBarcode_1}var JsBarcodeExports=requireJsBarcode();const JsBarcode=getDefaultExportFromCjs(JsBarcodeExports);class BarcodeService extends FirebaseService{constructor(){super();Te(this,"COLLECTION_NAME","order-barcodes");Te(this,"DEFAULT_QR_SIZE",64);Te(this,"MAX_RETRY_ATTEMPTS",5)}getCompactDateFormat(t){const r=new Date(t+"T00:00:00"),a=r.getFullYear().toString().slice(-2),i=new Date(r.getFullYear(),0,1),c=r.getTime()-i.getTime(),h=(Math.floor(c/(1e3*60*60*24))+1).toString().padStart(3,"0");return`${a}${h}`}parseCompactDateFormat(t){if(t.length!==5)return null;const r=parseInt(t.substring(0,2),10),a=parseInt(t.substring(2,5),10);if(isNaN(r)||isNaN(a)||a<1||a>366)return null;const i=2e3+r,c=new Date(i,0,1),l=new Date(c.getTime()+(a-1)*24*60*60*1e3);return l.getFullYear()!==i?null:format(l,"yyyy-MM-dd")}async generateUniqueBarcodeId(t,r=this.MAX_RETRY_ATTEMPTS){try{const c=(await this.getDocuments(this.COLLECTION_NAME,[where("dateDocId","==",t)])).length+1;for(let l=0;l<r;l++){const h=String(c+l),s=`${this.getCompactDateFormat(t)}${h}`;if(!await this.getDocument(this.COLLECTION_NAME,s))return s}throw new Error(`Failed to generate unique barcode ID after ${r} attempts for date ${t} (starting from sequence ${c})`)}catch{for(let a=1;a<=r;a++){const i=String(a),l=`${this.getCompactDateFormat(t)}${i}`;if(!await this.getDocument(this.COLLECTION_NAME,l))return l}throw new Error(`Failed to generate unique barcode ID after ${r} attempts for date ${t}`)}}generateBarcode(t,r=2,a=100){try{const i=document.createElement("canvas");return JsBarcode(i,t,{format:"CODE128",width:r,height:a,displayValue:!0,fontSize:16,textAlign:"center",textPosition:"bottom"}),i.toDataURL("image/png")}catch(i){throw new Error(`Failed to generate barcode for ${t}: ${i}`)}}validateBarcodeId(t){const r=/^BC_(\d{4}-\d{2}-\d{2})_(\d{3})$/,a=t.match(r);if(!a)return{isValid:!1,error:"Invalid barcode format. Expected: BC_YYYY-MM-DD_XXX"};const[,i,c]=a,l=parseInt(c,10);return/^\d{4}-\d{2}-\d{2}$/.test(i)?{isValid:!0,date:i,sequence:l}:{isValid:!1,error:"Invalid date format in barcode"}}async generateBarcodeForOrder(t,r,a,i,c={date:t}){try{const l=await this.generateUniqueBarcodeId(c.date,c.maxRetries||this.MAX_RETRY_ATTEMPTS),h=this.generateBarcode(l),o=new Date().toISOString(),s={barcodeId:l,dateDocId:t,orderIndex:r,orderId:i,isCompleted:!1,metadata:{...a,generatedAt:o},createdAt:Timestamp.now(),updatedAt:Timestamp.now()};return await this.setDocument(this.COLLECTION_NAME,l,s),{barcodeId:l,qrCodeDataUrl:h,qrCodeContent:l,generatedAt:o}}catch(l){throw new Error(`Failed to generate barcode for order: ${l}`)}}async lookupBarcode(t){try{const r=this.validateBarcodeFormat(t);if(!r.isValid)return{success:!1,error:r.error,errorType:"INVALID_BARCODE"};const a=await this.getDocument(this.COLLECTION_NAME,t);return a?a.isCompleted?{success:!1,error:"Order already completed",errorType:"ALREADY_COMPLETED"}:{success:!0,barcodeId:t,orderData:{productName:a.metadata.productName,sku:a.metadata.sku,quantity:a.metadata.quantity,platform:a.metadata.platform,dateDocId:a.dateDocId,orderIndex:a.orderIndex}}:{success:!1,error:"Barcode not found",errorType:"NOT_FOUND"}}catch(r){return{success:!1,error:`Failed to lookup barcode: ${r}`,errorType:"NETWORK_ERROR"}}}async markOrderCompleted(t,r){try{const a=new Date().toISOString();return await this.updateDocument(this.COLLECTION_NAME,t,{isCompleted:!0,completedAt:a,completedBy:r}),!0}catch(a){throw new Error(`Failed to mark order as completed: ${a}`)}}async getBarcodesForDate(t){try{return await this.getDocuments(this.COLLECTION_NAME,[where("dateDocId","==",t)])}catch(r){throw new Error(`Failed to get barcodes for date ${t}: ${r}`)}}async getCompletionStats(t){try{const r=await this.getBarcodesForDate(t),a=r.length,i=r.filter(h=>h.isCompleted).length,c=a-i,l=a>0?i/a*100:0;return{total:a,completed:i,pending:c,completionRate:Math.round(l*100)/100}}catch(r){throw new Error(`Failed to get completion stats for ${t}: ${r}`)}}async batchGenerateBarcodes(t,r={date:format(new Date,"yyyy-MM-dd")}){const a=[];for(const i of t)try{const c=await this.generateBarcodeForOrder(i.dateDocId,i.orderIndex,i.metadata,i.orderId,r);a.push(c)}catch{}return a}async getCompletionStatistics(t){try{const r=await this.getDocuments(this.COLLECTION_NAME,[where("dateDocId","==",t)]),a=r.length,i=r.filter(s=>s.isCompleted).length,c=a-i,l=a>0?i/a*100:0,h={};r.filter(s=>s.isCompleted&&s.completedBy).forEach(s=>{const f=s.completedBy;h[f]=(h[f]||0)+1});const o=Object.entries(h).map(([s,f])=>({userId:s,count:f})).sort((s,f)=>f.count-s.count).slice(0,10);return{total:a,completed:i,pending:c,completionRate:Math.round(l*100)/100,topCompletors:o}}catch(r){throw new Error(r instanceof Error?r.message:"Unknown error occurred")}}async lookupBarcodeForProductIdentification(t){try{const r=this.validateBarcodeFormat(t);if(!r.isValid)return{success:!1,error:r.error};const a=await this.getDocument(this.COLLECTION_NAME,t);return a?{success:!0,sku:a.metadata.sku,productName:a.metadata.productName,platform:a.metadata.platform}:{success:!1,error:"Barcode not found"}}catch(r){return{success:!1,error:`Failed to lookup barcode for product identification: ${r}`}}}validateBarcodeFormat(t){if(!t||typeof t!="string")return{isValid:!1,error:"Invalid barcode format. Expected: YYDDDN (6-8 digits)"};const r=/^(\d{5})(\d+)$/,a=t.match(r);if(!a)return{isValid:!1,error:"Invalid barcode format. Expected: YYDDDN (6-8 digits)"};const[,i,c]=a,l=this.parseCompactDateFormat(i);if(!l)return{isValid:!1,error:"Invalid date format in barcode"};const h=parseInt(c,10);return isNaN(h)||h<1?{isValid:!1,error:"Invalid sequence format in barcode"}:{isValid:!0,date:l,sequence:h}}}class TodaysOrder extends FirebaseService{constructor(){super();Te(this,"COLLECTION_NAME","active-orders");Te(this,"productService");Te(this,"categoryService");Te(this,"products",[]);Te(this,"categories",[]);this.productService=new ProductService,this.categoryService=new CategoryService}removeUndefinedValues(t){const r={};for(const[a,i]of Object.entries(t))i!=null&&(r[a]=i);return r}removeUndefinedKeys(t){const r={name:t.name,quantity:t.quantity,type:t.type};return t.SKU!==void 0&&(r.SKU=t.SKU),t.orderId!==void 0&&(r.orderId=t.orderId),t.batchInfo!==void 0&&(r.batchInfo=t.batchInfo),t.createdAt!==void 0&&(r.createdAt=t.createdAt),t.category!==void 0&&(r.category=t.category),t.categoryId!==void 0&&(r.categoryId=t.categoryId),t.isCompleted!==void 0&&(r.isCompleted=t.isCompleted),t.completedAt!==void 0&&(r.completedAt=t.completedAt),t.completedBy!==void 0&&(r.completedBy=t.completedBy),r}cleanOrders(t){return t.map(r=>this.removeUndefinedKeys(r))}async mapProductsToActiveOrder(){this.products=await this.productService.getProducts({}),this.categories=await this.categoryService.getCategories()}getCategoryName(t){if(!t)return;const r=this.categories.find(a=>a.id===t);return r==null?void 0:r.name}mapProductToOrder(t){const r=this.products.find(a=>a.sku===t.SKU&&a.platform===t.type);r&&(t.product=r,t.category=this.getCategoryName(r.categoryId))}async syncCompletionStatus(t,r){try{const i=await new BarcodeService().getBarcodesForDate(r),c=new Map;i.forEach(l=>{const h={isCompleted:l.isCompleted,completedAt:l.completedAt,completedBy:l.completedBy};if(l.orderId){const f=`orderId:${l.orderId}`;c.set(f,h)}const o=`product:${l.metadata.productName}|${l.metadata.sku||""}|${l.metadata.quantity}`;c.set(o,h);const s=`basic:${l.metadata.productName}|${l.metadata.sku||""}`;c.set(s,h)}),t.forEach(l=>{let h=null;if(l.orderId){const o=`orderId:${l.orderId}`;h=c.get(o)}if(!h){const o=`product:${l.name}|${l.SKU||""}|${parseInt(l.quantity,10)||1}`;h=c.get(o)}if(!h){const o=`basic:${l.name}|${l.SKU||""}`;h=c.get(o)}h&&(l.isCompleted=h.isCompleted,l.completedAt=h.completedAt,l.completedBy=h.completedBy)})}catch(a){console.warn(`Failed to sync completion status for date ${r}:`,a)}}async getTodaysOrders(){await this.mapProductsToActiveOrder();const t=await this.getDocument(this.COLLECTION_NAME,format(new Date,"yyyy-MM-dd"));return t&&(t.orders.forEach(r=>{this.mapProductToOrder(r)}),await this.syncCompletionStatus(t.orders,t.id)),t}async getOrdersForDate(t){await this.mapProductsToActiveOrder();const r=await this.getDocument(this.COLLECTION_NAME,t);return r&&(r.orders.forEach(a=>{this.mapProductToOrder(a)}),await this.syncCompletionStatus(r.orders,r.id)),r}async getLastThirtyDaysOrders(){await this.mapProductsToActiveOrder();const t=[];for(let r=29;r>=0;r--){const a=new Date;a.setDate(a.getDate()-r);const i=format(a,"yyyy-MM-dd");try{const c=await this.getDocument(this.COLLECTION_NAME,i);c?(c.orders.forEach(l=>{this.mapProductToOrder(l)}),await this.syncCompletionStatus(c.orders,c.id),t.push(c)):t.push({id:i,orders:[],date:i})}catch{t.push({id:i,orders:[],date:i})}}return t}async checkInventoryForOrders(t){for(const r of t)try{if(!r.SKU)return!0}catch{return!0}return!0}async updateTodaysOrder(t){const r=await this.getTodaysOrders();if(r){const a=this.removeUndefinedValues({...t,orders:[...this.cleanOrders(r.orders),...this.cleanOrders(t.orders)]});await this.updateDocument(this.COLLECTION_NAME,r.id,a)}else{const a=this.removeUndefinedValues({...t,orders:this.cleanOrders(t.orders)});await this.batchOperation([a],this.COLLECTION_NAME,"create",i=>i.id)}return await this.getTodaysOrders()}async updateOrdersForDate(t,r){const a=await this.getOrdersForDate(r);if(a){const i=this.removeUndefinedValues({...t,id:r,date:r,orders:[...this.cleanOrders(a.orders),...this.cleanOrders(t.orders).filter(c=>!this.cleanOrders(a.orders).some(l=>l.orderId===c.orderId))]});await this.updateDocument(this.COLLECTION_NAME,a.id,i)}else{const i=this.removeUndefinedValues({...t,id:r,date:r,orders:this.cleanOrders(t.orders)});await this.batchOperation([i],this.COLLECTION_NAME,"create",c=>c.id)}return await this.getOrdersForDate(r)}}const CACHE_DURATIONS$1={orders:1*60*1e3,transactions:15*60*1e3},shouldFetchData$1=(n,e,t,r=!0)=>r?!n||e.length===0?!0:Date.now()-n>t:!1;class BatchService{constructor(){Te(this,"COLLECTION_NAME","batches")}async createBatch(e){try{if(!getAuth().currentUser)return{success:!1,error:"User must be authenticated to create batches",batchId:e.batchId};const a=getFirestore(),i=collection(a,this.COLLECTION_NAME),c={...e,uploadedAt:Timestamp.fromDate(new Date(e.uploadedAt)),metadata:{...e.metadata,processedAt:Timestamp.fromDate(new Date(e.metadata.processedAt))}},l=await addDoc(i,c);return{success:!0,batchId:e.batchId,firestoreDocId:l.id}}catch(t){return console.error("Error creating batch:",t),{success:!1,error:t instanceof Error?t.message:"Unknown error occurred",batchId:e.batchId}}}async getBatch(e){try{if(!getAuth().currentUser)return{success:!1,error:"User must be authenticated to retrieve batches"};const a=getFirestore(),i=collection(a,this.COLLECTION_NAME),c=query(i,where("batchId","==",e)),l=await getDocs(c);if(l.empty)return{success:!1,error:"Batch not found"};const o=l.docs[0].data();return{success:!0,batch:{...o,uploadedAt:o.uploadedAt.toDate().toISOString(),metadata:{...o.metadata,processedAt:o.metadata.processedAt.toDate().toISOString()}}}}catch(t){return console.error("Error retrieving batch:",t),{success:!1,error:t instanceof Error?t.message:"Unknown error occurred"}}}async getBatchesForDate(e){try{if(!getAuth().currentUser)return{success:!1,error:"User must be authenticated to retrieve batches",batches:[]};const a=getFirestore(),i=collection(a,this.COLLECTION_NAME),c=query(i,where("metadata.selectedDate","==",e),orderBy("uploadedAt","desc")),l=await getDocs(c);return l.empty?{success:!0,batches:[]}:{success:!0,batches:l.docs.map(o=>{const s=o.data();return{...s,uploadedAt:s.uploadedAt.toDate().toISOString(),metadata:{...s.metadata,processedAt:s.metadata.processedAt.toDate().toISOString()}}})}}catch(t){return console.error("Error retrieving batches for date:",t),{success:!1,error:t instanceof Error?t.message:"Unknown error occurred",batches:[]}}}async updateBatchOrderCount(e,t){try{if(!getAuth().currentUser)return{success:!1,error:"User must be authenticated to update batches"};const i=getFirestore(),c=collection(i,this.COLLECTION_NAME),l=query(c,where("batchId","==",e)),h=await getDocs(l);if(h.empty)return{success:!1,error:"Batch not found"};const o=h.docs[0];return await updateDoc(doc(i,this.COLLECTION_NAME,o.id),{orderCount:t}),{success:!0,batchId:e}}catch(r){return console.error("Error updating batch order count:",r),{success:!1,error:r instanceof Error?r.message:"Unknown error occurred"}}}async deleteBatch(e){try{if(!getAuth().currentUser)return{success:!1,error:"User must be authenticated to delete batches"};const a=getFirestore(),i=collection(a,this.COLLECTION_NAME),c=query(i,where("batchId","==",e)),l=await getDocs(c);if(l.empty)return{success:!1,error:"Batch not found"};const h=l.docs[0];return await deleteDoc(doc(a,this.COLLECTION_NAME,h.id)),{success:!0,batchId:e}}catch(t){return console.error("Error deleting batch:",t),{success:!1,error:t instanceof Error?t.message:"Unknown error occurred"}}}async getBatchesForUser(e){try{if(!getAuth().currentUser)return{success:!1,error:"User must be authenticated to retrieve user batches",batches:[]};const a=getFirestore(),i=collection(a,this.COLLECTION_NAME),c=query(i,where("metadata.userId","==",e),orderBy("uploadedAt","desc")),l=await getDocs(c);return l.empty?{success:!0,batches:[]}:{success:!0,batches:l.docs.map(o=>{const s=o.data();return{...s,uploadedAt:s.uploadedAt.toDate().toISOString(),metadata:{...s.metadata,processedAt:s.metadata.processedAt.toDate().toISOString()}}})}}catch(t){return console.error("Error retrieving user batches:",t),{success:!1,error:t instanceof Error?t.message:"Unknown error occurred",batches:[]}}}}const batchService=new BatchService,initialState$a={items:[],loading:!1,error:null,lastFetched:null,pendingUpdates:{},batchFilter:null,platformFilter:"all",completionFilter:"all",batches:[],batchesLoading:!1,selectedDate:null},orderService$1=new TodaysOrder,barcodeService=new BarcodeService,fetchOrders=createAsyncThunk("orders/fetchOrders",async(n,{getState:e})=>{const t=e(),{lastFetched:r,items:a}=t.orders,{isAuthenticated:i}=t.auth;if(!shouldFetchData$1(r,a,CACHE_DURATIONS$1.orders,i))return a;const c=await orderService$1.getTodaysOrders();return(c==null?void 0:c.orders)||[]}),fetchOrdersForDate=createAsyncThunk("orders/fetchOrdersForDate",async n=>{const e=await orderService$1.getOrdersForDate(n);return(e==null?void 0:e.orders)||[]});createAsyncThunk("orders/fetchAllOrders",async(n,{getState:e})=>{const t=e(),{lastFetched:r,items:a}=t.orders,{isAuthenticated:i}=t.auth;return shouldFetchData$1(r,a,CACHE_DURATIONS$1.orders,i)?(await orderService$1.getLastThirtyDaysOrders()).reduce((h,o)=>[...h,...o.orders.map(s=>({...s,createdAt:o.date}))],[]):a});const updateOrders=createAsyncThunk("orders/updateOrders",async({orders:n,date:e},{dispatch:t})=>{t(setPendingUpdate({date:e,orders:n}));try{return await orderService$1.updateTodaysOrder({orders:n,date:e,id:e}),{orders:n,date:e}}catch(r){throw t(clearPendingUpdate(e)),r}}),fetchBatchesForDate=createAsyncThunk("orders/fetchBatchesForDate",async n=>{const e=await batchService.getBatchesForDate(n);if(e.success)return e.batches||[];throw new Error(e.error||"Failed to fetch batches")}),fetchBatchesForToday=createAsyncThunk("orders/fetchBatchesForToday",async()=>{const n=new Date().toISOString().split("T")[0],e=await batchService.getBatchesForDate(n);if(e.success)return e.batches||[];throw new Error(e.error||"Failed to fetch batches for today")}),completeOrderByBarcode=createAsyncThunk("orders/completeOrderByBarcode",async({barcodeId:n,completedBy:e},{dispatch:t})=>{const r=await barcodeService.lookupBarcode(n);if(!r.success||!r.orderData)throw new Error(r.error||"Order not found");if(await barcodeService.markOrderCompleted(n,e||"Scanner")){const i=new Date().toISOString();return t(markOrderCompleted({productName:r.orderData.productName,sku:r.orderData.sku,dateDocId:r.orderData.dateDocId,orderIndex:r.orderData.orderIndex,completedAt:i,completedBy:e||"Scanner"})),{success:!0,orderData:r.orderData,completedAt:i,completedBy:e||"Scanner"}}throw new Error("Failed to mark order as completed")}),ordersSlice=createSlice({name:"orders",initialState:initialState$a,reducers:{setPendingUpdate:(n,e)=>{const{date:t,orders:r}=e.payload;n.pendingUpdates[t]=r},clearPendingUpdate:(n,e)=>{const t=e.payload;delete n.pendingUpdates[t]},setBatchFilter:(n,e)=>{n.batchFilter=e.payload},clearBatchFilter:n=>{n.batchFilter=null},setPlatformFilter:(n,e)=>{n.platformFilter=e.payload},clearPlatformFilter:n=>{n.platformFilter="all"},setCompletionFilter:(n,e)=>{n.completionFilter=e.payload},clearCompletionFilter:n=>{n.completionFilter="all"},clearAllFilters:n=>{n.batchFilter=null,n.platformFilter="all",n.completionFilter="all"},markOrderCompleted:(n,e)=>{const{productName:t,sku:r,orderIndex:a,completedAt:i,completedBy:c}=e.payload;if(a>=0&&a<n.items.length){const l=n.items[a];l.name===t&&(!r||l.SKU===r)&&(l.isCompleted=!0,l.completedAt=i,l.completedBy=c)}},markOrderPending:(n,e)=>{const{productName:t,sku:r,dateDocId:a}=e.payload,i=n.items.find(c=>c.name===t&&(r?c.SKU===r:!0)&&c.createdAt===a);i&&(i.isCompleted=!1,i.completedAt=void 0,i.completedBy=void 0)},setSelectedDate:(n,e)=>{n.selectedDate=e.payload}},extraReducers:n=>{n.addCase(fetchOrders.pending,e=>{e.items.length===0&&(e.loading=!0),e.error=null}).addCase(fetchOrders.fulfilled,(e,t)=>{e.loading=!1,e.items=t.payload,e.lastFetched=Date.now()}).addCase(fetchOrders.rejected,(e,t)=>{e.loading=!1,e.error=t.error.message||"Failed to fetch orders"}).addCase(fetchOrdersForDate.pending,e=>{e.loading=!0,e.error=null}).addCase(fetchOrdersForDate.fulfilled,(e,t)=>{e.loading=!1,e.items=t.payload,e.lastFetched=Date.now()}).addCase(fetchOrdersForDate.rejected,(e,t)=>{e.loading=!1,e.error=t.error.message||"Failed to fetch orders for date"}).addCase(updateOrders.fulfilled,(e,t)=>{const{date:r}=t.payload;delete e.pendingUpdates[r],e.lastFetched=null}).addCase(fetchBatchesForDate.pending,e=>{e.batchesLoading=!0,e.error=null}).addCase(fetchBatchesForDate.fulfilled,(e,t)=>{e.batchesLoading=!1,e.batches=t.payload}).addCase(fetchBatchesForDate.rejected,(e,t)=>{e.batchesLoading=!1,e.error=t.error.message||"Failed to fetch batches for date"}).addCase(fetchBatchesForToday.pending,e=>{e.batchesLoading=!0,e.error=null}).addCase(fetchBatchesForToday.fulfilled,(e,t)=>{e.batchesLoading=!1,e.batches=t.payload}).addCase(fetchBatchesForToday.rejected,(e,t)=>{e.batchesLoading=!1,e.error=t.error.message||"Failed to fetch batches for today"}).addCase(completeOrderByBarcode.pending,e=>{e.error=null}).addCase(completeOrderByBarcode.fulfilled,e=>{e.error=null}).addCase(completeOrderByBarcode.rejected,(e,t)=>{e.error=t.error.message||"Failed to complete order"})}}),{setPendingUpdate,clearPendingUpdate,setBatchFilter,clearBatchFilter,setPlatformFilter,clearPlatformFilter,setCompletionFilter,clearCompletionFilter,clearAllFilters,markOrderCompleted,markOrderPending,setSelectedDate:setSelectedDate$1}=ordersSlice.actions,ordersReducer=ordersSlice.reducer,selectFilteredOrders=createSelector([n=>n.orders.items,n=>n.orders.batchFilter,n=>n.orders.platformFilter,n=>n.orders.completionFilter],(n,e,t,r)=>{let a=n;return t&&t!=="all"&&(a=a.filter(i=>i.type===t)),e&&e!=="all"&&(a=a.filter(i=>{var c;return((c=i.batchInfo)==null?void 0:c.batchId)===e})),r&&r!=="all"&&(r==="completed"?a=a.filter(i=>i.isCompleted===!0):r==="pending"&&(a=a.filter(i=>i.isCompleted!==!0))),a});createSelector([selectFilteredOrders],n=>{const e={};return n.forEach(t=>{var a;const r=((a=t.batchInfo)==null?void 0:a.batchId)||"no-batch";e[r]||(e[r]=[]),e[r].push(t)}),e});createSelector([selectFilteredOrders],n=>{const e=n.length,t=n.filter(i=>i.isCompleted===!0).length,r=e-t,a=e>0?t/e*100:0;return{total:e,completed:t,pending:r,completionRate:Math.round(a*100)/100}});createSelector([n=>n.orders.items],n=>n.filter(e=>e.isCompleted===!0));createSelector([n=>n.orders.items],n=>n.filter(e=>e.isCompleted!==!0));class TransactionService extends FirebaseService{constructor(){super(...arguments);Te(this,"COLLECTION_NAME","transactions")}async saveTransactions(t){if(t.length===0)return;const r=this.removeDuplicatesFromArray(t),a=await this.getExistingHashes(r.map(c=>c.hash)),i=r.filter(c=>!a.includes(c.hash));i.length!==0&&await this.batchOperation(i,this.COLLECTION_NAME,"create",c=>c.hash)}async getTransactions(){try{return await this.getDocuments(this.COLLECTION_NAME)}catch(t){throw this.handleError(t)}}async getExistingHashes(t){if(t.length===0)return[];try{const a=[];for(let c=0;c<t.length;c+=10)a.push(t.slice(c,c+10));return(await Promise.all(a.map(c=>this.getDocuments(this.COLLECTION_NAME,[where("hash","in",c)])))).flat().map(c=>c.hash)}catch(r){throw this.handleError(r)}}removeDuplicatesFromArray(t){const r=new Set;return t.filter(a=>r.has(a.hash)?!1:(r.add(a.hash),!0))}}const initialState$9={items:[],loading:!1,error:null,lastFetched:null,pendingTransactions:{},transactionInventoryImpacts:{},inventoryMovements:[],inventoryLoading:!1,inventoryError:null,processingInventoryDeductions:{},inventoryDeductionErrors:{},lastInventorySync:null,inventorySyncInProgress:!1},transactionService=new TransactionService,inventoryService$2=new InventoryService,fetchTransactions=createAsyncThunk("transactions/fetchTransactions",async(n,{getState:e})=>{const t=e(),{lastFetched:r,items:a}=t.transactions,{isAuthenticated:i}=t.auth;return shouldFetchData$1(r,a,CACHE_DURATIONS$1.transactions,i)?await transactionService.getTransactions():a}),saveTransactions=createAsyncThunk("transactions/saveTransactions",async(n,{dispatch:e,getState:t})=>{const a=t().transactions.items,i=[...a,...n];e(setOptimisticUpdate(i));try{return await transactionService.saveTransactions(n),n}catch(c){throw e(setOptimisticUpdate(a)),c}}),saveTransactionsWithInventoryDeduction=createAsyncThunk("transactions/saveTransactionsWithInventoryDeduction",async(n,{dispatch:e,getState:t})=>{const{transactions:r,deductInventory:a=!0,inventoryItems:i}=n,l=t().transactions.items,h=[...l,...r];e(setOptimisticUpdate(h));try{await transactionService.saveTransactions(r);const o={};if(a&&i&&i.length>0)for(const s of r){const f=i.filter(u=>u.transactionReference===s.id);if(f.length>0){const u=await inventoryService$2.deductInventoryFromOrder(f);s.id&&(o[s.id]=u)}}return{transactions:r,inventoryDeductionResults:o}}catch(o){throw e(setOptimisticUpdate(l)),o}}),processTransactionInventoryDeduction=createAsyncThunk("transactions/processTransactionInventoryDeduction",async n=>{const{transactionId:e,inventoryItems:t}=n,r=await inventoryService$2.deductInventoryFromOrder(t);return{transactionId:e,deductionResult:r}}),fetchTransactionInventoryMovements=createAsyncThunk("transactions/fetchTransactionInventoryMovements",async n=>{const e=await inventoryService$2.getInventoryMovements({transactionReference:n});return{transactionId:n,movements:e}}),syncTransactionInventoryImpacts=createAsyncThunk("transactions/syncTransactionInventoryImpacts",async(n,{getState:e})=>{const t=e(),{items:r}=t.transactions,a=r.map(async c=>{const l=await inventoryService$2.getInventoryMovements({transactionReference:c.id});return{transactionId:c.id,movements:l}});return await Promise.all(a)}),transactionsSlice=createSlice({name:"transactions",initialState:initialState$9,reducers:{setOptimisticUpdate:(n,e)=>{n.items=e.payload},updateTransactionInventoryImpact:(n,e)=>{const{transactionId:t,deductionResult:r}=e.payload;n.transactionInventoryImpacts[t]=r},setInventoryDeductionProcessing:(n,e)=>{const{transactionId:t,isProcessing:r}=e.payload;n.processingInventoryDeductions[t]=r},setInventoryDeductionError:(n,e)=>{const{transactionId:t,error:r}=e.payload;n.inventoryDeductionErrors[t]=r,n.processingInventoryDeductions[t]=!1},clearInventoryDeductionError:(n,e)=>{const t=e.payload;delete n.inventoryDeductionErrors[t]},clearInventoryError:n=>{n.inventoryError=null},updateInventoryMovements:(n,e)=>{n.inventoryMovements=e.payload},addInventoryMovements:(n,e)=>{const t=new Set(n.inventoryMovements.map(a=>a.id).filter(Boolean)),r=e.payload.filter(a=>a.id&&!t.has(a.id));n.inventoryMovements=[...n.inventoryMovements,...r]},setInventorySyncInProgress:(n,e)=>{n.inventorySyncInProgress=e.payload}},extraReducers:n=>{n.addCase(fetchTransactions.pending,e=>{e.items.length===0&&(e.loading=!0),e.error=null}).addCase(fetchTransactions.fulfilled,(e,t)=>{e.loading=!1,e.items=t.payload,e.lastFetched=Date.now()}).addCase(fetchTransactions.rejected,(e,t)=>{e.loading=!1,e.error=t.error.message||"Failed to fetch transactions"}).addCase(saveTransactions.fulfilled,(e,t)=>{e.items=[...e.items,...t.payload],e.lastFetched=Date.now()}).addCase(saveTransactionsWithInventoryDeduction.pending,e=>{e.loading=!0,e.error=null,e.inventoryLoading=!0,e.inventoryError=null}).addCase(saveTransactionsWithInventoryDeduction.fulfilled,(e,t)=>{const{transactions:r,inventoryDeductionResults:a}=t.payload;e.loading=!1,e.inventoryLoading=!1,e.items=[...e.items,...r],e.lastFetched=Date.now(),Object.entries(a).forEach(([i,c])=>{e.transactionInventoryImpacts[i]=c}),e.lastInventorySync=Date.now()}).addCase(saveTransactionsWithInventoryDeduction.rejected,(e,t)=>{e.loading=!1,e.inventoryLoading=!1,e.error=t.error.message||"Failed to save transactions with inventory deduction",e.inventoryError=t.error.message||"Failed to process inventory deductions"}).addCase(processTransactionInventoryDeduction.pending,(e,t)=>{const r=t.meta.arg.transactionId;e.processingInventoryDeductions[r]=!0,delete e.inventoryDeductionErrors[r]}).addCase(processTransactionInventoryDeduction.fulfilled,(e,t)=>{const{transactionId:r,deductionResult:a}=t.payload;e.processingInventoryDeductions[r]=!1,e.transactionInventoryImpacts[r]=a}).addCase(processTransactionInventoryDeduction.rejected,(e,t)=>{const r=t.meta.arg.transactionId;e.processingInventoryDeductions[r]=!1,e.inventoryDeductionErrors[r]=t.error.message||"Failed to process inventory deduction"}).addCase(fetchTransactionInventoryMovements.pending,e=>{e.inventoryLoading=!0,e.inventoryError=null}).addCase(fetchTransactionInventoryMovements.fulfilled,(e,t)=>{e.inventoryLoading=!1;const{movements:r}=t.payload,a=new Set(e.inventoryMovements.map(c=>c.id).filter(Boolean)),i=r.filter(c=>c.id&&!a.has(c.id));e.inventoryMovements=[...e.inventoryMovements,...i]}).addCase(fetchTransactionInventoryMovements.rejected,(e,t)=>{e.inventoryLoading=!1,e.inventoryError=t.error.message||"Failed to fetch transaction inventory movements"}).addCase(syncTransactionInventoryImpacts.pending,e=>{e.inventorySyncInProgress=!0,e.inventoryError=null}).addCase(syncTransactionInventoryImpacts.fulfilled,(e,t)=>{e.inventorySyncInProgress=!1;const r=[];t.payload.forEach(({movements:a})=>{r.push(...a)}),e.inventoryMovements=r,e.lastInventorySync=Date.now()}).addCase(syncTransactionInventoryImpacts.rejected,(e,t)=>{e.inventorySyncInProgress=!1,e.inventoryError=t.error.message||"Failed to sync transaction inventory impacts"})}}),{setOptimisticUpdate,updateTransactionInventoryImpact,setInventoryDeductionProcessing,setInventoryDeductionError,clearInventoryDeductionError,clearInventoryError:clearInventoryError$1,updateInventoryMovements,addInventoryMovements,setInventorySyncInProgress}=transactionsSlice.actions,transactionsReducer=transactionsSlice.reducer;class AuthService{constructor(){Te(this,"auth");Te(this,"db");this.auth=auth,this.db=db}async signUp(e,t){try{const r=await createUserWithEmailAndPassword(this.auth,e,t);return await setDoc(doc(this.db,"users",r.user.uid),{email:e,role:"user",createdAt:new Date,lastLoginAt:new Date}),r.user}catch(r){const a=r instanceof Error?r.message:"Unknown error";throw new Error(`Sign up failed: ${a}`)}}async signIn(e,t,r=!1){try{await setPersistence(this.auth,r?browserLocalPersistence:browserSessionPersistence);const a=await signInWithEmailAndPassword(this.auth,e,t);if(a.user)for(let i=1;i<=3;i++)try{await this.updateLastLogin(a.user.uid);break}catch{if(i===3)break;await new Promise(c=>setTimeout(c,i*1e3))}return a.user}catch(a){const i=a instanceof Error?a.message:"Unknown error";throw new Error(`Sign in failed: ${i}`)}}async updateLastLogin(e,t=3){for(let r=1;r<=t;r++)try{await setDoc(doc(this.db,"users",e),{lastLoginAt:new Date},{merge:!0});return}catch{if(r===t)return;await new Promise(a=>setTimeout(a,Math.pow(2,r-1)*100))}}async signOut(){try{await signOut(this.auth)}catch(e){const t=e instanceof Error?e.message:"Unknown error";throw new Error(`Sign out failed: ${t}`)}}async resetPassword(e){try{await sendPasswordResetEmail(this.auth,e)}catch(t){const r=t instanceof Error?t.message:"Unknown error";throw new Error(`Password reset failed: ${r}`)}}async getCurrentUser(){return this.auth.currentUser}async getUserData(e){try{const t=await getDoc(doc(this.db,"users",e));return t.exists()?t.data():null}catch(t){const r=t instanceof Error?t.message:"Unknown error";throw new Error(`Failed to get user data: ${r}`)}}onAuthStateChanged(e){return onAuthStateChanged(this.auth,e)}}const initialState$8={user:null,loading:!1,error:null,isAuthenticated:!1,authStateLoaded:!1,isLoading:!1},authService=new AuthService,initializeAuthState=createAsyncThunk("auth/initializeAuthState",async(n,{dispatch:e})=>new Promise(t=>authService.onAuthStateChanged(a=>{e(setAuthState({user:a,isAuthenticated:!!a,authStateLoaded:!0})),t(a)}))),login=createAsyncThunk("auth/login",async({email:n,password:e,rememberMe:t=!1})=>await authService.signIn(n,e,t)),logout=createAsyncThunk("auth/logout",async()=>{await authService.signOut()}),resetPassword=createAsyncThunk("auth/resetPassword",async n=>(await authService.resetPassword(n),"Password reset email sent")),authSlice=createSlice({name:"auth",initialState:initialState$8,reducers:{setUser:(n,e)=>{n.user=e.payload,n.isAuthenticated=!!e.payload},setAuthState:(n,e)=>{const{user:t,isAuthenticated:r,authStateLoaded:a}=e.payload;n.user=t,n.isAuthenticated=r,n.isLoading=!1,n.authStateLoaded=a},clearError:n=>{n.error=null},initializeAuth:n=>{n.isLoading=!0,n.authStateLoaded=!1}},extraReducers:n=>{n.addCase(initializeAuthState.fulfilled,(e,t)=>{e.user=t.payload,e.isAuthenticated=!!t.payload,e.authStateLoaded=!0}).addCase(login.pending,e=>{e.loading=!0,e.error=null}).addCase(login.fulfilled,(e,t)=>{e.loading=!1,e.user=t.payload,e.isAuthenticated=!0}).addCase(login.rejected,(e,t)=>{e.loading=!1,e.error=t.error.message||"Failed to login",e.isAuthenticated=!1}).addCase(logout.fulfilled,e=>{e.user=null,e.isAuthenticated=!1}).addCase(resetPassword.pending,e=>{e.loading=!0,e.error=null}).addCase(resetPassword.fulfilled,(e,t)=>{e.loading=!1,e.error=t.payload}).addCase(resetPassword.rejected,(e,t)=>{e.loading=!1,e.error=t.error.message||"Failed to send reset password email"})}}),{setUser,setAuthState,clearError:clearError$2}=authSlice.actions,authReducer=authSlice.reducer,selectIsAuthenticated=n=>n.auth.isAuthenticated,selectAuthStateLoaded=n=>n.auth.authStateLoaded,selectUser=n=>n.auth.user;function commonjsRequire(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var pdf={exports:{}},dommatrix$1={exports:{}};/*!
* DOMMatrix v1.0.3 (https://thednp.github.io/dommatrix/)
* Copyright 2022 © thednp
* Licensed under MIT (https://github.com/thednp/DOMMatrix/blob/master/LICENSE)
*/var dommatrix=dommatrix$1.exports,hasRequiredDommatrix;function requireDommatrix(){return hasRequiredDommatrix||(hasRequiredDommatrix=1,function(n,e){(function(t,r){n.exports=r()})(dommatrix,function(){function t(b){var _=new v,w=Array.from(b);if(!w.every(function(W){return!Number.isNaN(W)}))throw TypeError('CSSMatrix: "'+b+'" must only have numbers.');if(w.length===16){var m=w[0],S=w[1],C=w[2],x=w[3],R=w[4],M=w[5],F=w[6],H=w[7],V=w[8],X=w[9],K=w[10],q=w[11],U=w[12],B=w[13],N=w[14],Q=w[15];_.m11=m,_.a=m,_.m21=R,_.c=R,_.m31=V,_.m41=U,_.e=U,_.m12=S,_.b=S,_.m22=M,_.d=M,_.m32=X,_.m42=B,_.f=B,_.m13=C,_.m23=F,_.m33=K,_.m43=N,_.m14=x,_.m24=H,_.m34=q,_.m44=Q}else if(w.length===6){var ce=w[0],pe=w[1],Re=w[2],Y=w[3],O=w[4],D=w[5];_.m11=ce,_.a=ce,_.m12=pe,_.b=pe,_.m21=Re,_.c=Re,_.m22=Y,_.d=Y,_.m41=O,_.e=O,_.m42=D,_.f=D}else throw new TypeError("CSSMatrix: expecting an Array of 6/16 values.");return _}function r(b){var _=Object.keys(new v);if(typeof b=="object"&&_.every(function(w){return w in b}))return t([b.m11,b.m12,b.m13,b.m14,b.m21,b.m22,b.m23,b.m24,b.m31,b.m32,b.m33,b.m34,b.m41,b.m42,b.m43,b.m44]);throw TypeError('CSSMatrix: "'+JSON.stringify(b)+'" is not a DOMMatrix / CSSMatrix / JSON compatible object.')}function a(b){if(typeof b!="string")throw TypeError('CSSMatrix: "'+b+'" is not a string.');var _=String(b).replace(/\s/g,""),w=new v,m='CSSMatrix: invalid transform string "'+b+'"';return _.split(")").filter(function(S){return S}).forEach(function(S){var C=S.split("("),x=C[0],R=C[1];if(!R)throw TypeError(m);var M=R.split(",").map(function(O){return O.includes("rad")?parseFloat(O)*(180/Math.PI):parseFloat(O)}),F=M[0],H=M[1],V=M[2],X=M[3],K=[F,H,V],q=[F,H,V,X];if(x==="perspective"&&F&&[H,V].every(function(O){return O===void 0}))w.m34=-1/F;else if(x.includes("matrix")&&[6,16].includes(M.length)&&M.every(function(O){return!Number.isNaN(+O)})){var U=M.map(function(O){return Math.abs(O)<1e-6?0:O});w=w.multiply(t(U))}else if(x==="translate3d"&&K.every(function(O){return!Number.isNaN(+O)}))w=w.translate(F,H,V);else if(x==="translate"&&F&&V===void 0)w=w.translate(F,H||0,0);else if(x==="rotate3d"&&q.every(function(O){return!Number.isNaN(+O)})&&X)w=w.rotateAxisAngle(F,H,V,X);else if(x==="rotate"&&F&&[H,V].every(function(O){return O===void 0}))w=w.rotate(0,0,F);else if(x==="scale3d"&&K.every(function(O){return!Number.isNaN(+O)})&&K.some(function(O){return O!==1}))w=w.scale(F,H,V);else if(x==="scale"&&!Number.isNaN(F)&&F!==1&&V===void 0){var B=Number.isNaN(+H),N=B?F:H;w=w.scale(F,N,1)}else if(x==="skew"&&(F||!Number.isNaN(F)&&H)&&V===void 0)w=w.skew(F,H||0);else if(/[XYZ]/.test(x)&&F&&[H,V].every(function(O){return O===void 0})&&["translate","rotate","scale","skew"].some(function(O){return x.includes(O)}))if(["skewX","skewY"].includes(x))w=w[x](F);else{var Q=x.replace(/[XYZ]/,""),ce=x.replace(Q,""),pe=["X","Y","Z"].indexOf(ce),Re=Q==="scale"?1:0,Y=[pe===0?F:Re,pe===1?F:Re,pe===2?F:Re];w=w[Q].apply(w,Y)}else throw TypeError(m)}),w}function i(b,_){return _?[b.a,b.b,b.c,b.d,b.e,b.f]:[b.m11,b.m12,b.m13,b.m14,b.m21,b.m22,b.m23,b.m24,b.m31,b.m32,b.m33,b.m34,b.m41,b.m42,b.m43,b.m44]}function c(b,_,w){var m=new v;return m.m41=b,m.e=b,m.m42=_,m.f=_,m.m43=w,m}function l(b,_,w){var m=new v,S=Math.PI/180,C=b*S,x=_*S,R=w*S,M=Math.cos(C),F=-Math.sin(C),H=Math.cos(x),V=-Math.sin(x),X=Math.cos(R),K=-Math.sin(R),q=H*X,U=-H*K;m.m11=q,m.a=q,m.m12=U,m.b=U,m.m13=V;var B=F*V*X+M*K;m.m21=B,m.c=B;var N=M*X-F*V*K;return m.m22=N,m.d=N,m.m23=-F*H,m.m31=F*K-M*V*X,m.m32=F*X+M*V*K,m.m33=M*H,m}function h(b,_,w,m){var S=new v,C=Math.sqrt(b*b+_*_+w*w);if(C===0)return S;var x=b/C,R=_/C,M=w/C,F=m*(Math.PI/360),H=Math.sin(F),V=Math.cos(F),X=H*H,K=x*x,q=R*R,U=M*M,B=1-2*(q+U)*X;S.m11=B,S.a=B;var N=2*(x*R*X+M*H*V);S.m12=N,S.b=N,S.m13=2*(x*M*X-R*H*V);var Q=2*(R*x*X-M*H*V);S.m21=Q,S.c=Q;var ce=1-2*(U+K)*X;return S.m22=ce,S.d=ce,S.m23=2*(R*M*X+x*H*V),S.m31=2*(M*x*X+R*H*V),S.m32=2*(M*R*X-x*H*V),S.m33=1-2*(K+q)*X,S}function o(b,_,w){var m=new v;return m.m11=b,m.a=b,m.m22=_,m.d=_,m.m33=w,m}function s(b,_){var w=new v;if(b){var m=b*Math.PI/180,S=Math.tan(m);w.m21=S,w.c=S}if(_){var C=_*Math.PI/180,x=Math.tan(C);w.m12=x,w.b=x}return w}function f(b){return s(b,0)}function u(b){return s(0,b)}function p(b,_){var w=_.m11*b.m11+_.m12*b.m21+_.m13*b.m31+_.m14*b.m41,m=_.m11*b.m12+_.m12*b.m22+_.m13*b.m32+_.m14*b.m42,S=_.m11*b.m13+_.m12*b.m23+_.m13*b.m33+_.m14*b.m43,C=_.m11*b.m14+_.m12*b.m24+_.m13*b.m34+_.m14*b.m44,x=_.m21*b.m11+_.m22*b.m21+_.m23*b.m31+_.m24*b.m41,R=_.m21*b.m12+_.m22*b.m22+_.m23*b.m32+_.m24*b.m42,M=_.m21*b.m13+_.m22*b.m23+_.m23*b.m33+_.m24*b.m43,F=_.m21*b.m14+_.m22*b.m24+_.m23*b.m34+_.m24*b.m44,H=_.m31*b.m11+_.m32*b.m21+_.m33*b.m31+_.m34*b.m41,V=_.m31*b.m12+_.m32*b.m22+_.m33*b.m32+_.m34*b.m42,X=_.m31*b.m13+_.m32*b.m23+_.m33*b.m33+_.m34*b.m43,K=_.m31*b.m14+_.m32*b.m24+_.m33*b.m34+_.m34*b.m44,q=_.m41*b.m11+_.m42*b.m21+_.m43*b.m31+_.m44*b.m41,U=_.m41*b.m12+_.m42*b.m22+_.m43*b.m32+_.m44*b.m42,B=_.m41*b.m13+_.m42*b.m23+_.m43*b.m33+_.m44*b.m43,N=_.m41*b.m14+_.m42*b.m24+_.m43*b.m34+_.m44*b.m44;return t([w,m,S,C,x,R,M,F,H,V,X,K,q,U,B,N])}var v=function(){for(var _=[],w=arguments.length;w--;)_[w]=arguments[w];var m=this;if(m.a=1,m.b=0,m.c=0,m.d=1,m.e=0,m.f=0,m.m11=1,m.m12=0,m.m13=0,m.m14=0,m.m21=0,m.m22=1,m.m23=0,m.m24=0,m.m31=0,m.m32=0,m.m33=1,m.m34=0,m.m41=0,m.m42=0,m.m43=0,m.m44=1,_.length){var S=[16,6].some(function(C){return C===_.length})?_:_[0];return m.setMatrixValue(S)}return m},g={isIdentity:{configurable:!0},is2D:{configurable:!0}};g.isIdentity.get=function(){var b=this;return b.m11===1&&b.m12===0&&b.m13===0&&b.m14===0&&b.m21===0&&b.m22===1&&b.m23===0&&b.m24===0&&b.m31===0&&b.m32===0&&b.m33===1&&b.m34===0&&b.m41===0&&b.m42===0&&b.m43===0&&b.m44===1},g.is2D.get=function(){var b=this;return b.m31===0&&b.m32===0&&b.m33===1&&b.m34===0&&b.m43===0&&b.m44===1},v.prototype.setMatrixValue=function(_){var w=this;return typeof _=="string"&&_.length&&_!=="none"?a(_):[Array,Float64Array,Float32Array].some(function(m){return _ instanceof m})?t(_):[v,DOMMatrix,Object].some(function(m){return _ instanceof m})?r(_):w},v.prototype.toFloat32Array=function(_){return Float32Array.from(i(this,_))},v.prototype.toFloat64Array=function(_){return Float64Array.from(i(this,_))},v.prototype.toString=function(){var _=this,w=_.is2D,m=_.toFloat64Array(w).join(", "),S=w?"matrix":"matrix3d";return S+"("+m+")"},v.prototype.toJSON=function(){var _=this,w=_.is2D,m=_.isIdentity;return Object.assign({},_,{is2D:w,isIdentity:m})},v.prototype.multiply=function(_){return p(this,_)},v.prototype.translate=function(_,w,m){var S=_,C=w,x=m;return C===void 0&&(C=0),x===void 0&&(x=0),p(this,c(S,C,x))},v.prototype.scale=function(_,w,m){var S=_,C=w,x=m;return C===void 0&&(C=_),x===void 0&&(x=1),p(this,o(S,C,x))},v.prototype.rotate=function(_,w,m){var S=_,C=w||0,x=m||0;return typeof _=="number"&&w===void 0&&m===void 0&&(x=S,S=0,C=0),p(this,l(S,C,x))},v.prototype.rotateAxisAngle=function(_,w,m,S){if([_,w,m,S].some(function(C){return Number.isNaN(+C)}))throw new TypeError("CSSMatrix: expecting 4 values");return p(this,h(_,w,m,S))},v.prototype.skewX=function(_){return p(this,f(_))},v.prototype.skewY=function(_){return p(this,u(_))},v.prototype.skew=function(_,w){return p(this,s(_,w))},v.prototype.transformPoint=function(_){var w=this,m=w.m11*_.x+w.m21*_.y+w.m31*_.z+w.m41*_.w,S=w.m12*_.x+w.m22*_.y+w.m32*_.z+w.m42*_.w,C=w.m13*_.x+w.m23*_.y+w.m33*_.z+w.m43*_.w,x=w.m14*_.x+w.m24*_.y+w.m34*_.z+w.m44*_.w;return _ instanceof DOMPoint?new DOMPoint(m,S,C,x):{x:m,y:S,z:C,w:x}},Object.defineProperties(v.prototype,g),Object.assign(v,{Translate:c,Rotate:l,RotateAxisAngle:h,Scale:o,SkewX:f,SkewY:u,Skew:s,Multiply:p,fromArray:t,fromMatrix:r,fromString:a,toArray:i});var A="1.0.3",T=A;return Object.assign(v,{Version:T}),v})}(dommatrix$1)),dommatrix$1.exports}var ponyfill$1={exports:{}};/**
 * @license
 * web-streams-polyfill v3.3.3
 * Copyright 2024 Mattias Buelens, Diwank Singh Tomer and other contributors.
 * This code is released under the MIT license.
 * SPDX-License-Identifier: MIT
 */var ponyfill=ponyfill$1.exports,hasRequiredPonyfill;function requirePonyfill(){return hasRequiredPonyfill||(hasRequiredPonyfill=1,function(n,e){(function(t,r){r(e)})(ponyfill,function(t){var r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol:function(d){return"Symbol(".concat(d,")")};function a(d,y){var I={label:0,sent:function(){if(re[0]&1)throw re[1];return re[1]},trys:[],ops:[]},$,J,re,fe;return fe={next:xe(0),throw:xe(1),return:xe(2)},typeof Symbol=="function"&&(fe[Symbol.iterator]=function(){return this}),fe;function xe(Ce){return function(Ue){return ke([Ce,Ue])}}function ke(Ce){if($)throw new TypeError("Generator is already executing.");for(;fe&&(fe=0,Ce[0]&&(I=0)),I;)try{if($=1,J&&(re=Ce[0]&2?J.return:Ce[0]?J.throw||((re=J.return)&&re.call(J),0):J.next)&&!(re=re.call(J,Ce[1])).done)return re;switch(J=0,re&&(Ce=[Ce[0]&2,re.value]),Ce[0]){case 0:case 1:re=Ce;break;case 4:return I.label++,{value:Ce[1],done:!1};case 5:I.label++,J=Ce[1],Ce=[0];continue;case 7:Ce=I.ops.pop(),I.trys.pop();continue;default:if(re=I.trys,!(re=re.length>0&&re[re.length-1])&&(Ce[0]===6||Ce[0]===2)){I=0;continue}if(Ce[0]===3&&(!re||Ce[1]>re[0]&&Ce[1]<re[3])){I.label=Ce[1];break}if(Ce[0]===6&&I.label<re[1]){I.label=re[1],re=Ce;break}if(re&&I.label<re[2]){I.label=re[2],I.ops.push(Ce);break}re[2]&&I.ops.pop(),I.trys.pop();continue}Ce=y.call(d,I)}catch(Ue){Ce=[6,Ue],J=0}finally{$=re=0}if(Ce[0]&5)throw Ce[1];return{value:Ce[0]?Ce[1]:void 0,done:!0}}}function i(d){var y=typeof Symbol=="function"&&Symbol.iterator,I=y&&d[y],$=0;if(I)return I.call(d);if(d&&typeof d.length=="number")return{next:function(){return d&&$>=d.length&&(d=void 0),{value:d&&d[$++],done:!d}}};throw new TypeError(y?"Object is not iterable.":"Symbol.iterator is not defined.")}function c(d){return this instanceof c?(this.v=d,this):new c(d)}function l(d,y,I){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var $=I.apply(d,y||[]),J,re=[];return J={},fe("next"),fe("throw"),fe("return"),J[Symbol.asyncIterator]=function(){return this},J;function fe(He){$[He]&&(J[He]=function(st){return new Promise(function(ft,mt){re.push([He,st,ft,mt])>1||xe(He,st)})})}function xe(He,st){try{ke($[He](st))}catch(ft){ze(re[0][3],ft)}}function ke(He){He.value instanceof c?Promise.resolve(He.value.v).then(Ce,Ue):ze(re[0][2],He)}function Ce(He){xe("next",He)}function Ue(He){xe("throw",He)}function ze(He,st){He(st),re.shift(),re.length&&xe(re[0][0],re[0][1])}}function h(d){var y,I;return y={},$("next"),$("throw",function(J){throw J}),$("return"),y[Symbol.iterator]=function(){return this},y;function $(J,re){y[J]=d[J]?function(fe){return(I=!I)?{value:c(d[J](fe)),done:!1}:re?re(fe):fe}:re}}function o(d){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var y=d[Symbol.asyncIterator],I;return y?y.call(d):(d=typeof i=="function"?i(d):d[Symbol.iterator](),I={},$("next"),$("throw"),$("return"),I[Symbol.asyncIterator]=function(){return this},I);function $(re){I[re]=d[re]&&function(fe){return new Promise(function(xe,ke){fe=d[re](fe),J(xe,ke,fe.done,fe.value)})}}function J(re,fe,xe,ke){Promise.resolve(ke).then(function(Ce){re({value:Ce,done:xe})},fe)}}typeof SuppressedError=="function"&&SuppressedError;function s(){}function f(d){return typeof d=="object"&&d!==null||typeof d=="function"}var u=s;function p(d,y){try{Object.defineProperty(d,"name",{value:y,configurable:!0})}catch{}}var v=Promise,g=Promise.prototype.then,A=Promise.reject.bind(v);function T(d){return new v(d)}function b(d){return T(function(y){return y(d)})}function _(d){return A(d)}function w(d,y,I){return g.call(d,y,I)}function m(d,y,I){w(w(d,y,I),void 0,u)}function S(d,y){m(d,y)}function C(d,y){m(d,void 0,y)}function x(d,y,I){return w(d,y,I)}function R(d){w(d,void 0,u)}var M=function(d){if(typeof queueMicrotask=="function")M=queueMicrotask;else{var y=b(void 0);M=function(I){return w(y,I)}}return M(d)};function F(d,y,I){if(typeof d!="function")throw new TypeError("Argument is not a function");return Function.prototype.apply.call(d,y,I)}function H(d,y,I){try{return b(F(d,y,I))}catch($){return _($)}}var V=16384,X=function(){function d(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}return Object.defineProperty(d.prototype,"length",{get:function(){return this._size},enumerable:!1,configurable:!0}),d.prototype.push=function(y){var I=this._back,$=I;I._elements.length===V-1&&($={_elements:[],_next:void 0}),I._elements.push(y),$!==I&&(this._back=$,I._next=$),++this._size},d.prototype.shift=function(){var y=this._front,I=y,$=this._cursor,J=$+1,re=y._elements,fe=re[$];return J===V&&(I=y._next,J=0),--this._size,this._cursor=J,y!==I&&(this._front=I),re[$]=void 0,fe},d.prototype.forEach=function(y){for(var I=this._cursor,$=this._front,J=$._elements;(I!==J.length||$._next!==void 0)&&!(I===J.length&&($=$._next,J=$._elements,I=0,J.length===0));)y(J[I]),++I},d.prototype.peek=function(){var y=this._front,I=this._cursor;return y._elements[I]},d}(),K=r("[[AbortSteps]]"),q=r("[[ErrorSteps]]"),U=r("[[CancelSteps]]"),B=r("[[PullSteps]]"),N=r("[[ReleaseSteps]]");function Q(d,y){d._ownerReadableStream=y,y._reader=d,y._state==="readable"?Y(d):y._state==="closed"?D(d):O(d,y._storedError)}function ce(d,y){var I=d._ownerReadableStream;return bt(I,y)}function pe(d){var y=d._ownerReadableStream;y._state==="readable"?W(d,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):G(d,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),y._readableStreamController[N](),y._reader=void 0,d._ownerReadableStream=void 0}function Re(d){return new TypeError("Cannot "+d+" a stream using a released reader")}function Y(d){d._closedPromise=T(function(y,I){d._closedPromise_resolve=y,d._closedPromise_reject=I})}function O(d,y){Y(d),W(d,y)}function D(d){Y(d),E(d)}function W(d,y){d._closedPromise_reject!==void 0&&(R(d._closedPromise),d._closedPromise_reject(y),d._closedPromise_resolve=void 0,d._closedPromise_reject=void 0)}function G(d,y){O(d,y)}function E(d){d._closedPromise_resolve!==void 0&&(d._closedPromise_resolve(void 0),d._closedPromise_resolve=void 0,d._closedPromise_reject=void 0)}var P=Number.isFinite||function(d){return typeof d=="number"&&isFinite(d)},k=Math.trunc||function(d){return d<0?Math.ceil(d):Math.floor(d)};function L(d){return typeof d=="object"||typeof d=="function"}function j(d,y){if(d!==void 0&&!L(d))throw new TypeError("".concat(y," is not an object."))}function z(d,y){if(typeof d!="function")throw new TypeError("".concat(y," is not a function."))}function Z(d){return typeof d=="object"&&d!==null||typeof d=="function"}function te(d,y){if(!Z(d))throw new TypeError("".concat(y," is not an object."))}function ie(d,y,I){if(d===void 0)throw new TypeError("Parameter ".concat(y," is required in '").concat(I,"'."))}function le(d,y,I){if(d===void 0)throw new TypeError("".concat(y," is required in '").concat(I,"'."))}function se(d){return Number(d)}function ue(d){return d===0?0:d}function me(d){return ue(k(d))}function be(d,y){var I=0,$=Number.MAX_SAFE_INTEGER,J=Number(d);if(J=ue(J),!P(J))throw new TypeError("".concat(y," is not a finite number"));if(J=me(J),J<I||J>$)throw new TypeError("".concat(y," is outside the accepted range of ").concat(I," to ").concat($,", inclusive"));return!P(J)||J===0?0:J}function we(d,y){if(!kt(d))throw new TypeError("".concat(y," is not a ReadableStream."))}function Ae(d){return new Oe(d)}function Fe(d,y){d._reader._readRequests.push(y)}function _e(d,y,I){var $=d._reader,J=$._readRequests.shift();I?J._closeSteps():J._chunkSteps(y)}function Ve(d){return d._reader._readRequests.length}function Qe(d){var y=d._reader;return!(y===void 0||!Ee(y))}var Oe=function(){function d(y){if(ie(y,1,"ReadableStreamDefaultReader"),we(y,"First parameter"),Ot(y))throw new TypeError("This stream has already been locked for exclusive reading by another reader");Q(this,y),this._readRequests=new X}return Object.defineProperty(d.prototype,"closed",{get:function(){return Ee(this)?this._closedPromise:_(Ke("closed"))},enumerable:!1,configurable:!0}),d.prototype.cancel=function(y){return y===void 0&&(y=void 0),Ee(this)?this._ownerReadableStream===void 0?_(Re("cancel")):ce(this,y):_(Ke("cancel"))},d.prototype.read=function(){if(!Ee(this))return _(Ke("read"));if(this._ownerReadableStream===void 0)return _(Re("read from"));var y,I,$=T(function(re,fe){y=re,I=fe}),J={_chunkSteps:function(re){return y({value:re,done:!1})},_closeSteps:function(){return y({value:void 0,done:!0})},_errorSteps:function(re){return I(re)}};return ae(this,J),$},d.prototype.releaseLock=function(){if(!Ee(this))throw Ke("releaseLock");this._ownerReadableStream!==void 0&&ve(this)},d}();Object.defineProperties(Oe.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),p(Oe.prototype.cancel,"cancel"),p(Oe.prototype.read,"read"),p(Oe.prototype.releaseLock,"releaseLock"),typeof r.toStringTag=="symbol"&&Object.defineProperty(Oe.prototype,r.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});function Ee(d){return!f(d)||!Object.prototype.hasOwnProperty.call(d,"_readRequests")?!1:d instanceof Oe}function ae(d,y){var I=d._ownerReadableStream;I._disturbed=!0,I._state==="closed"?y._closeSteps():I._state==="errored"?y._errorSteps(I._storedError):I._readableStreamController[B](y)}function ve(d){pe(d);var y=new TypeError("Reader was released");Le(d,y)}function Le(d,y){var I=d._readRequests;d._readRequests=new X,I.forEach(function($){$._errorSteps(y)})}function Ke(d){return new TypeError("ReadableStreamDefaultReader.prototype.".concat(d," can only be used on a ReadableStreamDefaultReader"))}var ye,Pe,Ne;function de(d){return d.slice()}function ee(d,y,I,$,J){new Uint8Array(d).set(new Uint8Array(I,$,J),y)}var ne=function(d){return typeof d.transfer=="function"?ne=function(y){return y.transfer()}:typeof structuredClone=="function"?ne=function(y){return structuredClone(y,{transfer:[y]})}:ne=function(y){return y},ne(d)},ge=function(d){return typeof d.detached=="boolean"?ge=function(y){return y.detached}:ge=function(y){return y.byteLength===0},ge(d)};function De(d,y,I){if(d.slice)return d.slice(y,I);var $=I-y,J=new ArrayBuffer($);return ee(J,0,d,y,$),J}function je(d,y){var I=d[y];if(I!=null){if(typeof I!="function")throw new TypeError("".concat(String(y)," is not a function"));return I}}function he(d){var y,I=(y={},y[r.iterator]=function(){return d.iterator},y),$=function(){return l(this,arguments,function(){return a(this,function(re){switch(re.label){case 0:return[5,i(h(o(I)))];case 1:return[4,c.apply(void 0,[re.sent()])];case 2:return[4,c.apply(void 0,[re.sent()])];case 3:return[2,re.sent()]}})})}(),J=$.next;return{iterator:$,nextMethod:J,done:!1}}var oe=(Ne=(ye=r.asyncIterator)!==null&&ye!==void 0?ye:(Pe=r.for)===null||Pe===void 0?void 0:Pe.call(r,"Symbol.asyncIterator"))!==null&&Ne!==void 0?Ne:"@@asyncIterator";function Se(d,y,I){if(y===void 0&&(y="sync"),I===void 0)if(y==="async"){if(I=je(d,oe),I===void 0){var $=je(d,r.iterator),J=Se(d,"sync",$);return he(J)}}else I=je(d,r.iterator);if(I===void 0)throw new TypeError("The object is not iterable");var re=F(I,d,[]);if(!f(re))throw new TypeError("The iterator method must return an object");var fe=re.next;return{iterator:re,nextMethod:fe,done:!1}}function Ie(d){var y=F(d.nextMethod,d.iterator,[]);if(!f(y))throw new TypeError("The iterator.next() method must return an object");return y}function Be(d){return!!d.done}function Ge(d){return d.value}var $e,qe=($e={},$e[oe]=function(){return this},$e);Object.defineProperty(qe,oe,{enumerable:!1});var Me=function(){function d(y,I){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=y,this._preventCancel=I}return d.prototype.next=function(){var y=this,I=function(){return y._nextSteps()};return this._ongoingPromise=this._ongoingPromise?x(this._ongoingPromise,I,I):I(),this._ongoingPromise},d.prototype.return=function(y){var I=this,$=function(){return I._returnSteps(y)};return this._ongoingPromise?x(this._ongoingPromise,$,$):$()},d.prototype._nextSteps=function(){var y=this;if(this._isFinished)return Promise.resolve({value:void 0,done:!0});var I=this._reader,$,J,re=T(function(xe,ke){$=xe,J=ke}),fe={_chunkSteps:function(xe){y._ongoingPromise=void 0,M(function(){return $({value:xe,done:!1})})},_closeSteps:function(){y._ongoingPromise=void 0,y._isFinished=!0,pe(I),$({value:void 0,done:!0})},_errorSteps:function(xe){y._ongoingPromise=void 0,y._isFinished=!0,pe(I),J(xe)}};return ae(I,fe),re},d.prototype._returnSteps=function(y){if(this._isFinished)return Promise.resolve({value:y,done:!0});this._isFinished=!0;var I=this._reader;if(!this._preventCancel){var $=ce(I,y);return pe(I),x($,function(){return{value:y,done:!0}})}return pe(I),b({value:y,done:!0})},d}(),Ye={next:function(){return Xe(this)?this._asyncIteratorImpl.next():_(Ze("next"))},return:function(d){return Xe(this)?this._asyncIteratorImpl.return(d):_(Ze("return"))}};Object.setPrototypeOf(Ye,qe);function it(d,y){var I=Ae(d),$=new Me(I,y),J=Object.create(Ye);return J._asyncIteratorImpl=$,J}function Xe(d){if(!f(d)||!Object.prototype.hasOwnProperty.call(d,"_asyncIteratorImpl"))return!1;try{return d._asyncIteratorImpl instanceof Me}catch{return!1}}function Ze(d){return new TypeError("ReadableStreamAsyncIterator.".concat(d," can only be used on a ReadableSteamAsyncIterator"))}var ot=Number.isNaN||function(d){return d!==d};function et(d){return!(typeof d!="number"||ot(d)||d<0)}function ct(d){var y=De(d.buffer,d.byteOffset,d.byteOffset+d.byteLength);return new Uint8Array(y)}function rt(d){var y=d._queue.shift();return d._queueTotalSize-=y.size,d._queueTotalSize<0&&(d._queueTotalSize=0),y.value}function yt(d,y,I){if(!et(I)||I===1/0)throw new RangeError("Size must be a finite, non-NaN, non-negative number.");d._queue.push({value:y,size:I}),d._queueTotalSize+=I}function Tt(d){var y=d._queue.peek();return y.value}function dt(d){d._queue=new X,d._queueTotalSize=0}function Mt(d){return d===DataView}function qt(d){return Mt(d.constructor)}function Lt(d){return Mt(d)?1:d.BYTES_PER_ELEMENT}var ht=function(){function d(){throw new TypeError("Illegal constructor")}return Object.defineProperty(d.prototype,"view",{get:function(){if(!Mr(this))throw Ur("view");return this._view},enumerable:!1,configurable:!0}),d.prototype.respond=function(y){if(!Mr(this))throw Ur("respond");if(ie(y,1,"respond"),y=be(y,"First parameter"),this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(ge(this._view.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be used as a response");fr(this._associatedReadableByteStreamController,y)},d.prototype.respondWithNewView=function(y){if(!Mr(this))throw Ur("respondWithNewView");if(ie(y,1,"respondWithNewView"),!ArrayBuffer.isView(y))throw new TypeError("You can only respond with array buffer views");if(this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(ge(y.buffer))throw new TypeError("The given view's buffer has been detached and so cannot be used as a response");pr(this._associatedReadableByteStreamController,y)},d}();Object.defineProperties(ht.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}}),p(ht.prototype.respond,"respond"),p(ht.prototype.respondWithNewView,"respondWithNewView"),typeof r.toStringTag=="symbol"&&Object.defineProperty(ht.prototype,r.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});var At=function(){function d(){throw new TypeError("Illegal constructor")}return Object.defineProperty(d.prototype,"byobRequest",{get:function(){if(!Nt(this))throw er("byobRequest");return Br(this)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"desiredSize",{get:function(){if(!Nt(this))throw er("desiredSize");return mn(this)},enumerable:!1,configurable:!0}),d.prototype.close=function(){if(!Nt(this))throw er("close");if(this._closeRequested)throw new TypeError("The stream has already been closed; do not close it again!");var y=this._controlledReadableByteStream._state;if(y!=="readable")throw new TypeError("The stream (in ".concat(y," state) is not in the readable state and cannot be closed"));Zt(this)},d.prototype.enqueue=function(y){if(!Nt(this))throw er("enqueue");if(ie(y,1,"enqueue"),!ArrayBuffer.isView(y))throw new TypeError("chunk must be an array buffer view");if(y.byteLength===0)throw new TypeError("chunk must have non-zero byteLength");if(y.buffer.byteLength===0)throw new TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw new TypeError("stream is closed or draining");var I=this._controlledReadableByteStream._state;if(I!=="readable")throw new TypeError("The stream (in ".concat(I," state) is not in the readable state and cannot be enqueued to"));hr(this,y)},d.prototype.error=function(y){if(y===void 0&&(y=void 0),!Nt(this))throw er("error");gt(this,y)},d.prototype[U]=function(y){sn(this),dt(this);var I=this._cancelAlgorithm(y);return dr(this),I},d.prototype[B]=function(y){var I=this._controlledReadableByteStream;if(this._queueTotalSize>0){gn(this,y);return}var $=this._autoAllocateChunkSize;if($!==void 0){var J=void 0;try{J=new ArrayBuffer($)}catch(fe){y._errorSteps(fe);return}var re={buffer:J,bufferByteLength:$,byteOffset:0,byteLength:$,bytesFilled:0,minimumFill:1,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(re)}Fe(I,y),jt(this)},d.prototype[N]=function(){if(this._pendingPullIntos.length>0){var y=this._pendingPullIntos.peek();y.readerType="none",this._pendingPullIntos=new X,this._pendingPullIntos.push(y)}},d}();Object.defineProperties(At.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}}),p(At.prototype.close,"close"),p(At.prototype.enqueue,"enqueue"),p(At.prototype.error,"error"),typeof r.toStringTag=="symbol"&&Object.defineProperty(At.prototype,r.toStringTag,{value:"ReadableByteStreamController",configurable:!0});function Nt(d){return!f(d)||!Object.prototype.hasOwnProperty.call(d,"_controlledReadableByteStream")?!1:d instanceof At}function Mr(d){return!f(d)||!Object.prototype.hasOwnProperty.call(d,"_associatedReadableByteStreamController")?!1:d instanceof ht}function jt(d){var y=ca(d);if(y){if(d._pulling){d._pullAgain=!0;return}d._pulling=!0;var I=d._pullAlgorithm();m(I,function(){return d._pulling=!1,d._pullAgain&&(d._pullAgain=!1,jt(d)),null},function($){return gt(d,$),null})}}function sn(d){Nr(d),d._pendingPullIntos=new X}function Lr(d,y){var I=!1;d._state==="closed"&&(I=!0);var $=cn(y);y.readerType==="default"?_e(d,$,I):pa(d,$,I)}function cn(d){var y=d.bytesFilled,I=d.elementSize;return new d.viewConstructor(d.buffer,d.byteOffset,y/I)}function ur(d,y,I,$){d._queue.push({buffer:y,byteOffset:I,byteLength:$}),d._queueTotalSize+=$}function ln(d,y,I,$){var J;try{J=De(y,I,I+$)}catch(re){throw gt(d,re),re}ur(d,J,0,$)}function un(d,y){y.bytesFilled>0&&ln(d,y.buffer,y.byteOffset,y.bytesFilled),zt(d)}function dn(d,y){var I=Math.min(d._queueTotalSize,y.byteLength-y.bytesFilled),$=y.bytesFilled+I,J=I,re=!1,fe=$%y.elementSize,xe=$-fe;xe>=y.minimumFill&&(J=xe-y.bytesFilled,re=!0);for(var ke=d._queue;J>0;){var Ce=ke.peek(),Ue=Math.min(J,Ce.byteLength),ze=y.byteOffset+y.bytesFilled;ee(y.buffer,ze,Ce.buffer,Ce.byteOffset,Ue),Ce.byteLength===Ue?ke.shift():(Ce.byteOffset+=Ue,Ce.byteLength-=Ue),d._queueTotalSize-=Ue,hn(d,Ue,y),J-=Ue}return re}function hn(d,y,I){I.bytesFilled+=y}function fn(d){d._queueTotalSize===0&&d._closeRequested?(dr(d),or(d._controlledReadableByteStream)):jt(d)}function Nr(d){d._byobRequest!==null&&(d._byobRequest._associatedReadableByteStreamController=void 0,d._byobRequest._view=null,d._byobRequest=null)}function jr(d){for(;d._pendingPullIntos.length>0;){if(d._queueTotalSize===0)return;var y=d._pendingPullIntos.peek();dn(d,y)&&(zt(d),Lr(d._controlledReadableByteStream,y))}}function aa(d){for(var y=d._controlledReadableByteStream._reader;y._readRequests.length>0;){if(d._queueTotalSize===0)return;var I=y._readRequests.shift();gn(d,I)}}function ia(d,y,I,$){var J=d._controlledReadableByteStream,re=y.constructor,fe=Lt(re),xe=y.byteOffset,ke=y.byteLength,Ce=I*fe,Ue;try{Ue=ne(y.buffer)}catch(mt){$._errorSteps(mt);return}var ze={buffer:Ue,bufferByteLength:Ue.byteLength,byteOffset:xe,byteLength:ke,bytesFilled:0,minimumFill:Ce,elementSize:fe,viewConstructor:re,readerType:"byob"};if(d._pendingPullIntos.length>0){d._pendingPullIntos.push(ze),bn(J,$);return}if(J._state==="closed"){var He=new re(ze.buffer,ze.byteOffset,0);$._closeSteps(He);return}if(d._queueTotalSize>0){if(dn(d,ze)){var st=cn(ze);fn(d),$._chunkSteps(st);return}if(d._closeRequested){var ft=new TypeError("Insufficient bytes to fill elements in the given buffer");gt(d,ft),$._errorSteps(ft);return}}d._pendingPullIntos.push(ze),bn(J,$),jt(d)}function oa(d,y){y.readerType==="none"&&zt(d);var I=d._controlledReadableByteStream;if($r(I))for(;Sn(I)>0;){var $=zt(d);Lr(I,$)}}function sa(d,y,I){if(hn(d,y,I),I.readerType==="none"){un(d,I),jr(d);return}if(!(I.bytesFilled<I.minimumFill)){zt(d);var $=I.bytesFilled%I.elementSize;if($>0){var J=I.byteOffset+I.bytesFilled;ln(d,I.buffer,J-$,$)}I.bytesFilled-=$,Lr(d._controlledReadableByteStream,I),jr(d)}}function pn(d,y){var I=d._pendingPullIntos.peek();Nr(d);var $=d._controlledReadableByteStream._state;$==="closed"?oa(d,I):sa(d,y,I),jt(d)}function zt(d){var y=d._pendingPullIntos.shift();return y}function ca(d){var y=d._controlledReadableByteStream;if(y._state!=="readable"||d._closeRequested||!d._started)return!1;if(Qe(y)&&Ve(y)>0||$r(y)&&Sn(y)>0)return!0;var I=mn(d);return I>0}function dr(d){d._pullAlgorithm=void 0,d._cancelAlgorithm=void 0}function Zt(d){var y=d._controlledReadableByteStream;if(!(d._closeRequested||y._state!=="readable")){if(d._queueTotalSize>0){d._closeRequested=!0;return}if(d._pendingPullIntos.length>0){var I=d._pendingPullIntos.peek();if(I.bytesFilled%I.elementSize!==0){var $=new TypeError("Insufficient bytes to fill elements in the given buffer");throw gt(d,$),$}}dr(d),or(y)}}function hr(d,y){var I=d._controlledReadableByteStream;if(!(d._closeRequested||I._state!=="readable")){var $=y.buffer,J=y.byteOffset,re=y.byteLength;if(ge($))throw new TypeError("chunk's buffer is detached and so cannot be enqueued");var fe=ne($);if(d._pendingPullIntos.length>0){var xe=d._pendingPullIntos.peek();if(ge(xe.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be filled with an enqueued chunk");Nr(d),xe.buffer=ne(xe.buffer),xe.readerType==="none"&&un(d,xe)}if(Qe(I))if(aa(d),Ve(I)===0)ur(d,fe,J,re);else{d._pendingPullIntos.length>0&&zt(d);var ke=new Uint8Array(fe,J,re);_e(I,ke,!1)}else $r(I)?(ur(d,fe,J,re),jr(d)):ur(d,fe,J,re);jt(d)}}function gt(d,y){var I=d._controlledReadableByteStream;I._state==="readable"&&(sn(d),dt(d),dr(d),qn(I,y))}function gn(d,y){var I=d._queue.shift();d._queueTotalSize-=I.byteLength,fn(d);var $=new Uint8Array(I.buffer,I.byteOffset,I.byteLength);y._chunkSteps($)}function Br(d){if(d._byobRequest===null&&d._pendingPullIntos.length>0){var y=d._pendingPullIntos.peek(),I=new Uint8Array(y.buffer,y.byteOffset+y.bytesFilled,y.byteLength-y.bytesFilled),$=Object.create(ht.prototype);ua($,d,I),d._byobRequest=$}return d._byobRequest}function mn(d){var y=d._controlledReadableByteStream._state;return y==="errored"?null:y==="closed"?0:d._strategyHWM-d._queueTotalSize}function fr(d,y){var I=d._pendingPullIntos.peek(),$=d._controlledReadableByteStream._state;if($==="closed"){if(y!==0)throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(y===0)throw new TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(I.bytesFilled+y>I.byteLength)throw new RangeError("bytesWritten out of range")}I.buffer=ne(I.buffer),pn(d,y)}function pr(d,y){var I=d._pendingPullIntos.peek(),$=d._controlledReadableByteStream._state;if($==="closed"){if(y.byteLength!==0)throw new TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(y.byteLength===0)throw new TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(I.byteOffset+I.bytesFilled!==y.byteOffset)throw new RangeError("The region specified by view does not match byobRequest");if(I.bufferByteLength!==y.buffer.byteLength)throw new RangeError("The buffer of view has different capacity than byobRequest");if(I.bytesFilled+y.byteLength>I.byteLength)throw new RangeError("The region specified by view is larger than byobRequest");var J=y.byteLength;I.buffer=ne(y.buffer),pn(d,J)}function yn(d,y,I,$,J,re,fe){y._controlledReadableByteStream=d,y._pullAgain=!1,y._pulling=!1,y._byobRequest=null,y._queue=y._queueTotalSize=void 0,dt(y),y._closeRequested=!1,y._started=!1,y._strategyHWM=re,y._pullAlgorithm=$,y._cancelAlgorithm=J,y._autoAllocateChunkSize=fe,y._pendingPullIntos=new X,d._readableStreamController=y;var xe=I();m(b(xe),function(){return y._started=!0,jt(y),null},function(ke){return gt(y,ke),null})}function la(d,y,I){var $=Object.create(At.prototype),J,re,fe;y.start!==void 0?J=function(){return y.start($)}:J=function(){},y.pull!==void 0?re=function(){return y.pull($)}:re=function(){return b(void 0)},y.cancel!==void 0?fe=function(ke){return y.cancel(ke)}:fe=function(){return b(void 0)};var xe=y.autoAllocateChunkSize;if(xe===0)throw new TypeError("autoAllocateChunkSize must be greater than 0");yn(d,$,J,re,fe,I,xe)}function ua(d,y,I){d._associatedReadableByteStreamController=y,d._view=I}function Ur(d){return new TypeError("ReadableStreamBYOBRequest.prototype.".concat(d," can only be used on a ReadableStreamBYOBRequest"))}function er(d){return new TypeError("ReadableByteStreamController.prototype.".concat(d," can only be used on a ReadableByteStreamController"))}function da(d,y){j(d,y);var I=d==null?void 0:d.mode;return{mode:I===void 0?void 0:ha(I,"".concat(y," has member 'mode' that"))}}function ha(d,y){if(d="".concat(d),d!=="byob")throw new TypeError("".concat(y," '").concat(d,"' is not a valid enumeration value for ReadableStreamReaderMode"));return d}function fa(d,y){var I;j(d,y);var $=(I=d==null?void 0:d.min)!==null&&I!==void 0?I:1;return{min:be($,"".concat(y," has member 'min' that"))}}function vn(d){return new Pt(d)}function bn(d,y){d._reader._readIntoRequests.push(y)}function pa(d,y,I){var $=d._reader,J=$._readIntoRequests.shift();I?J._closeSteps(y):J._chunkSteps(y)}function Sn(d){return d._reader._readIntoRequests.length}function $r(d){var y=d._reader;return!(y===void 0||!Bt(y))}var Pt=function(){function d(y){if(ie(y,1,"ReadableStreamBYOBReader"),we(y,"First parameter"),Ot(y))throw new TypeError("This stream has already been locked for exclusive reading by another reader");if(!Nt(y._readableStreamController))throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");Q(this,y),this._readIntoRequests=new X}return Object.defineProperty(d.prototype,"closed",{get:function(){return Bt(this)?this._closedPromise:_(gr("closed"))},enumerable:!1,configurable:!0}),d.prototype.cancel=function(y){return y===void 0&&(y=void 0),Bt(this)?this._ownerReadableStream===void 0?_(Re("cancel")):ce(this,y):_(gr("cancel"))},d.prototype.read=function(y,I){if(I===void 0&&(I={}),!Bt(this))return _(gr("read"));if(!ArrayBuffer.isView(y))return _(new TypeError("view must be an array buffer view"));if(y.byteLength===0)return _(new TypeError("view must have non-zero byteLength"));if(y.buffer.byteLength===0)return _(new TypeError("view's buffer must have non-zero byteLength"));if(ge(y.buffer))return _(new TypeError("view's buffer has been detached"));var $;try{$=fa(I,"options")}catch(Ce){return _(Ce)}var J=$.min;if(J===0)return _(new TypeError("options.min must be greater than 0"));if(qt(y)){if(J>y.byteLength)return _(new RangeError("options.min must be less than or equal to view's byteLength"))}else if(J>y.length)return _(new RangeError("options.min must be less than or equal to view's length"));if(this._ownerReadableStream===void 0)return _(Re("read from"));var re,fe,xe=T(function(Ce,Ue){re=Ce,fe=Ue}),ke={_chunkSteps:function(Ce){return re({value:Ce,done:!1})},_closeSteps:function(Ce){return re({value:Ce,done:!0})},_errorSteps:function(Ce){return fe(Ce)}};return _n(this,y,J,ke),xe},d.prototype.releaseLock=function(){if(!Bt(this))throw gr("releaseLock");this._ownerReadableStream!==void 0&&ga(this)},d}();Object.defineProperties(Pt.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),p(Pt.prototype.cancel,"cancel"),p(Pt.prototype.read,"read"),p(Pt.prototype.releaseLock,"releaseLock"),typeof r.toStringTag=="symbol"&&Object.defineProperty(Pt.prototype,r.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});function Bt(d){return!f(d)||!Object.prototype.hasOwnProperty.call(d,"_readIntoRequests")?!1:d instanceof Pt}function _n(d,y,I,$){var J=d._ownerReadableStream;J._disturbed=!0,J._state==="errored"?$._errorSteps(J._storedError):ia(J._readableStreamController,y,I,$)}function ga(d){pe(d);var y=new TypeError("Reader was released");wn(d,y)}function wn(d,y){var I=d._readIntoRequests;d._readIntoRequests=new X,I.forEach(function($){$._errorSteps(y)})}function gr(d){return new TypeError("ReadableStreamBYOBReader.prototype.".concat(d," can only be used on a ReadableStreamBYOBReader"))}function tr(d,y){var I=d.highWaterMark;if(I===void 0)return y;if(ot(I)||I<0)throw new RangeError("Invalid highWaterMark");return I}function mr(d){var y=d.size;return y||function(){return 1}}function yr(d,y){j(d,y);var I=d==null?void 0:d.highWaterMark,$=d==null?void 0:d.size;return{highWaterMark:I===void 0?void 0:se(I),size:$===void 0?void 0:ma($,"".concat(y," has member 'size' that"))}}function ma(d,y){return z(d,y),function(I){return se(d(I))}}function ya(d,y){j(d,y);var I=d==null?void 0:d.abort,$=d==null?void 0:d.close,J=d==null?void 0:d.start,re=d==null?void 0:d.type,fe=d==null?void 0:d.write;return{abort:I===void 0?void 0:va(I,d,"".concat(y," has member 'abort' that")),close:$===void 0?void 0:ba($,d,"".concat(y," has member 'close' that")),start:J===void 0?void 0:Sa(J,d,"".concat(y," has member 'start' that")),write:fe===void 0?void 0:_a(fe,d,"".concat(y," has member 'write' that")),type:re}}function va(d,y,I){return z(d,I),function($){return H(d,y,[$])}}function ba(d,y,I){return z(d,I),function(){return H(d,y,[])}}function Sa(d,y,I){return z(d,I),function($){return F(d,y,[$])}}function _a(d,y,I){return z(d,I),function($,J){return H(d,y,[$,J])}}function En(d,y){if(!Ht(d))throw new TypeError("".concat(y," is not a WritableStream."))}function wa(d){if(typeof d!="object"||d===null)return!1;try{return typeof d.aborted=="boolean"}catch{return!1}}var Ea=typeof AbortController=="function";function Aa(){if(Ea)return new AbortController}var It=function(){function d(y,I){y===void 0&&(y={}),I===void 0&&(I={}),y===void 0?y=null:te(y,"First parameter");var $=yr(I,"Second parameter"),J=ya(y,"First parameter");Cn(this);var re=J.type;if(re!==void 0)throw new RangeError("Invalid type is specified");var fe=mr($),xe=tr($,1);ja(this,J,xe,fe)}return Object.defineProperty(d.prototype,"locked",{get:function(){if(!Ht(this))throw wr("locked");return Vt(this)},enumerable:!1,configurable:!0}),d.prototype.abort=function(y){return y===void 0&&(y=void 0),Ht(this)?Vt(this)?_(new TypeError("Cannot abort a stream that already has a writer")):vr(this,y):_(wr("abort"))},d.prototype.close=function(){return Ht(this)?Vt(this)?_(new TypeError("Cannot close a stream that already has a writer")):St(this)?_(new TypeError("Cannot close an already-closing stream")):xn(this):_(wr("close"))},d.prototype.getWriter=function(){if(!Ht(this))throw wr("getWriter");return An(this)},d}();Object.defineProperties(It.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}}),p(It.prototype.abort,"abort"),p(It.prototype.close,"close"),p(It.prototype.getWriter,"getWriter"),typeof r.toStringTag=="symbol"&&Object.defineProperty(It.prototype,r.toStringTag,{value:"WritableStream",configurable:!0});function An(d){return new Ct(d)}function Ca(d,y,I,$,J,re){J===void 0&&(J=1),re===void 0&&(re=function(){return 1});var fe=Object.create(It.prototype);Cn(fe);var xe=Object.create(Xt.prototype);return On(fe,xe,d,y,I,$,J,re),fe}function Cn(d){d._state="writable",d._storedError=void 0,d._writer=void 0,d._writableStreamController=void 0,d._writeRequests=new X,d._inFlightWriteRequest=void 0,d._closeRequest=void 0,d._inFlightCloseRequest=void 0,d._pendingAbortRequest=void 0,d._backpressure=!1}function Ht(d){return!f(d)||!Object.prototype.hasOwnProperty.call(d,"_writableStreamController")?!1:d instanceof It}function Vt(d){return d._writer!==void 0}function vr(d,y){var I;if(d._state==="closed"||d._state==="errored")return b(void 0);d._writableStreamController._abortReason=y,(I=d._writableStreamController._abortController)===null||I===void 0||I.abort(y);var $=d._state;if($==="closed"||$==="errored")return b(void 0);if(d._pendingAbortRequest!==void 0)return d._pendingAbortRequest._promise;var J=!1;$==="erroring"&&(J=!0,y=void 0);var re=T(function(fe,xe){d._pendingAbortRequest={_promise:void 0,_resolve:fe,_reject:xe,_reason:y,_wasAlreadyErroring:J}});return d._pendingAbortRequest._promise=re,J||Gr(d,y),re}function xn(d){var y=d._state;if(y==="closed"||y==="errored")return _(new TypeError("The stream (in ".concat(y," state) is not in the writable state and cannot be closed")));var I=T(function(J,re){var fe={_resolve:J,_reject:re};d._closeRequest=fe}),$=d._writer;return $!==void 0&&d._backpressure&&y==="writable"&&Qr($),Ba(d._writableStreamController),I}function xa(d){var y=T(function(I,$){var J={_resolve:I,_reject:$};d._writeRequests.push(J)});return y}function Wr(d,y){var I=d._state;if(I==="writable"){Gr(d,y);return}qr(d)}function Gr(d,y){var I=d._writableStreamController;d._state="erroring",d._storedError=y;var $=d._writer;$!==void 0&&Tn($,y),!ka(d)&&I._started&&qr(d)}function qr(d){d._state="errored",d._writableStreamController[q]();var y=d._storedError;if(d._writeRequests.forEach(function(J){J._reject(y)}),d._writeRequests=new X,d._pendingAbortRequest===void 0){br(d);return}var I=d._pendingAbortRequest;if(d._pendingAbortRequest=void 0,I._wasAlreadyErroring){I._reject(y),br(d);return}var $=d._writableStreamController[K](I._reason);m($,function(){return I._resolve(),br(d),null},function(J){return I._reject(J),br(d),null})}function Ra(d){d._inFlightWriteRequest._resolve(void 0),d._inFlightWriteRequest=void 0}function Ta(d,y){d._inFlightWriteRequest._reject(y),d._inFlightWriteRequest=void 0,Wr(d,y)}function Pa(d){d._inFlightCloseRequest._resolve(void 0),d._inFlightCloseRequest=void 0;var y=d._state;y==="erroring"&&(d._storedError=void 0,d._pendingAbortRequest!==void 0&&(d._pendingAbortRequest._resolve(),d._pendingAbortRequest=void 0)),d._state="closed";var I=d._writer;I!==void 0&&Ln(I)}function Ia(d,y){d._inFlightCloseRequest._reject(y),d._inFlightCloseRequest=void 0,d._pendingAbortRequest!==void 0&&(d._pendingAbortRequest._reject(y),d._pendingAbortRequest=void 0),Wr(d,y)}function St(d){return!(d._closeRequest===void 0&&d._inFlightCloseRequest===void 0)}function ka(d){return!(d._inFlightWriteRequest===void 0&&d._inFlightCloseRequest===void 0)}function Oa(d){d._inFlightCloseRequest=d._closeRequest,d._closeRequest=void 0}function Da(d){d._inFlightWriteRequest=d._writeRequests.shift()}function br(d){d._closeRequest!==void 0&&(d._closeRequest._reject(d._storedError),d._closeRequest=void 0);var y=d._writer;y!==void 0&&Yr(y,d._storedError)}function zr(d,y){var I=d._writer;I!==void 0&&y!==d._backpressure&&(y?Ha(I):Qr(I)),d._backpressure=y}var Ct=function(){function d(y){if(ie(y,1,"WritableStreamDefaultWriter"),En(y,"First parameter"),Vt(y))throw new TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=y,y._writer=this;var I=y._state;if(I==="writable")!St(y)&&y._backpressure?Ar(this):Nn(this),Er(this);else if(I==="erroring")Kr(this,y._storedError),Er(this);else if(I==="closed")Nn(this),qa(this);else{var $=y._storedError;Kr(this,$),Mn(this,$)}}return Object.defineProperty(d.prototype,"closed",{get:function(){return Ut(this)?this._closedPromise:_($t("closed"))},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"desiredSize",{get:function(){if(!Ut(this))throw $t("desiredSize");if(this._ownerWritableStream===void 0)throw nr("desiredSize");return Na(this)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"ready",{get:function(){return Ut(this)?this._readyPromise:_($t("ready"))},enumerable:!1,configurable:!0}),d.prototype.abort=function(y){return y===void 0&&(y=void 0),Ut(this)?this._ownerWritableStream===void 0?_(nr("abort")):Fa(this,y):_($t("abort"))},d.prototype.close=function(){if(!Ut(this))return _($t("close"));var y=this._ownerWritableStream;return y===void 0?_(nr("close")):St(y)?_(new TypeError("Cannot close an already-closing stream")):Rn(this)},d.prototype.releaseLock=function(){if(!Ut(this))throw $t("releaseLock");var y=this._ownerWritableStream;y!==void 0&&Pn(this)},d.prototype.write=function(y){return y===void 0&&(y=void 0),Ut(this)?this._ownerWritableStream===void 0?_(nr("write to")):In(this,y):_($t("write"))},d}();Object.defineProperties(Ct.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}}),p(Ct.prototype.abort,"abort"),p(Ct.prototype.close,"close"),p(Ct.prototype.releaseLock,"releaseLock"),p(Ct.prototype.write,"write"),typeof r.toStringTag=="symbol"&&Object.defineProperty(Ct.prototype,r.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});function Ut(d){return!f(d)||!Object.prototype.hasOwnProperty.call(d,"_ownerWritableStream")?!1:d instanceof Ct}function Fa(d,y){var I=d._ownerWritableStream;return vr(I,y)}function Rn(d){var y=d._ownerWritableStream;return xn(y)}function Ma(d){var y=d._ownerWritableStream,I=y._state;return St(y)||I==="closed"?b(void 0):I==="errored"?_(y._storedError):Rn(d)}function La(d,y){d._closedPromiseState==="pending"?Yr(d,y):za(d,y)}function Tn(d,y){d._readyPromiseState==="pending"?jn(d,y):Va(d,y)}function Na(d){var y=d._ownerWritableStream,I=y._state;return I==="errored"||I==="erroring"?null:I==="closed"?0:Dn(y._writableStreamController)}function Pn(d){var y=d._ownerWritableStream,I=new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");Tn(d,I),La(d,I),y._writer=void 0,d._ownerWritableStream=void 0}function In(d,y){var I=d._ownerWritableStream,$=I._writableStreamController,J=Ua($,y);if(I!==d._ownerWritableStream)return _(nr("write to"));var re=I._state;if(re==="errored")return _(I._storedError);if(St(I)||re==="closed")return _(new TypeError("The stream is closing or closed and cannot be written to"));if(re==="erroring")return _(I._storedError);var fe=xa(I);return $a($,y,J),fe}var kn={},Xt=function(){function d(){throw new TypeError("Illegal constructor")}return Object.defineProperty(d.prototype,"abortReason",{get:function(){if(!Hr(this))throw Xr("abortReason");return this._abortReason},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"signal",{get:function(){if(!Hr(this))throw Xr("signal");if(this._abortController===void 0)throw new TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal},enumerable:!1,configurable:!0}),d.prototype.error=function(y){if(y===void 0&&(y=void 0),!Hr(this))throw Xr("error");var I=this._controlledWritableStream._state;I==="writable"&&Fn(this,y)},d.prototype[K]=function(y){var I=this._abortAlgorithm(y);return Sr(this),I},d.prototype[q]=function(){dt(this)},d}();Object.defineProperties(Xt.prototype,{abortReason:{enumerable:!0},signal:{enumerable:!0},error:{enumerable:!0}}),typeof r.toStringTag=="symbol"&&Object.defineProperty(Xt.prototype,r.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});function Hr(d){return!f(d)||!Object.prototype.hasOwnProperty.call(d,"_controlledWritableStream")?!1:d instanceof Xt}function On(d,y,I,$,J,re,fe,xe){y._controlledWritableStream=d,d._writableStreamController=y,y._queue=void 0,y._queueTotalSize=void 0,dt(y),y._abortReason=void 0,y._abortController=Aa(),y._started=!1,y._strategySizeAlgorithm=xe,y._strategyHWM=fe,y._writeAlgorithm=$,y._closeAlgorithm=J,y._abortAlgorithm=re;var ke=Vr(y);zr(d,ke);var Ce=I(),Ue=b(Ce);m(Ue,function(){return y._started=!0,_r(y),null},function(ze){return y._started=!0,Wr(d,ze),null})}function ja(d,y,I,$){var J=Object.create(Xt.prototype),re,fe,xe,ke;y.start!==void 0?re=function(){return y.start(J)}:re=function(){},y.write!==void 0?fe=function(Ce){return y.write(Ce,J)}:fe=function(){return b(void 0)},y.close!==void 0?xe=function(){return y.close()}:xe=function(){return b(void 0)},y.abort!==void 0?ke=function(Ce){return y.abort(Ce)}:ke=function(){return b(void 0)},On(d,J,re,fe,xe,ke,I,$)}function Sr(d){d._writeAlgorithm=void 0,d._closeAlgorithm=void 0,d._abortAlgorithm=void 0,d._strategySizeAlgorithm=void 0}function Ba(d){yt(d,kn,0),_r(d)}function Ua(d,y){try{return d._strategySizeAlgorithm(y)}catch(I){return rr(d,I),1}}function Dn(d){return d._strategyHWM-d._queueTotalSize}function $a(d,y,I){try{yt(d,y,I)}catch(re){rr(d,re);return}var $=d._controlledWritableStream;if(!St($)&&$._state==="writable"){var J=Vr(d);zr($,J)}_r(d)}function _r(d){var y=d._controlledWritableStream;if(d._started&&y._inFlightWriteRequest===void 0){var I=y._state;if(I==="erroring"){qr(y);return}if(d._queue.length!==0){var $=Tt(d);$===kn?Wa(d):Ga(d,$)}}}function rr(d,y){d._controlledWritableStream._state==="writable"&&Fn(d,y)}function Wa(d){var y=d._controlledWritableStream;Oa(y),rt(d);var I=d._closeAlgorithm();Sr(d),m(I,function(){return Pa(y),null},function($){return Ia(y,$),null})}function Ga(d,y){var I=d._controlledWritableStream;Da(I);var $=d._writeAlgorithm(y);m($,function(){Ra(I);var J=I._state;if(rt(d),!St(I)&&J==="writable"){var re=Vr(d);zr(I,re)}return _r(d),null},function(J){return I._state==="writable"&&Sr(d),Ta(I,J),null})}function Vr(d){var y=Dn(d);return y<=0}function Fn(d,y){var I=d._controlledWritableStream;Sr(d),Gr(I,y)}function wr(d){return new TypeError("WritableStream.prototype.".concat(d," can only be used on a WritableStream"))}function Xr(d){return new TypeError("WritableStreamDefaultController.prototype.".concat(d," can only be used on a WritableStreamDefaultController"))}function $t(d){return new TypeError("WritableStreamDefaultWriter.prototype.".concat(d," can only be used on a WritableStreamDefaultWriter"))}function nr(d){return new TypeError("Cannot "+d+" a stream using a released writer")}function Er(d){d._closedPromise=T(function(y,I){d._closedPromise_resolve=y,d._closedPromise_reject=I,d._closedPromiseState="pending"})}function Mn(d,y){Er(d),Yr(d,y)}function qa(d){Er(d),Ln(d)}function Yr(d,y){d._closedPromise_reject!==void 0&&(R(d._closedPromise),d._closedPromise_reject(y),d._closedPromise_resolve=void 0,d._closedPromise_reject=void 0,d._closedPromiseState="rejected")}function za(d,y){Mn(d,y)}function Ln(d){d._closedPromise_resolve!==void 0&&(d._closedPromise_resolve(void 0),d._closedPromise_resolve=void 0,d._closedPromise_reject=void 0,d._closedPromiseState="resolved")}function Ar(d){d._readyPromise=T(function(y,I){d._readyPromise_resolve=y,d._readyPromise_reject=I}),d._readyPromiseState="pending"}function Kr(d,y){Ar(d),jn(d,y)}function Nn(d){Ar(d),Qr(d)}function jn(d,y){d._readyPromise_reject!==void 0&&(R(d._readyPromise),d._readyPromise_reject(y),d._readyPromise_resolve=void 0,d._readyPromise_reject=void 0,d._readyPromiseState="rejected")}function Ha(d){Ar(d)}function Va(d,y){Kr(d,y)}function Qr(d){d._readyPromise_resolve!==void 0&&(d._readyPromise_resolve(void 0),d._readyPromise_resolve=void 0,d._readyPromise_reject=void 0,d._readyPromiseState="fulfilled")}function Xa(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof commonjsGlobal<"u")return commonjsGlobal}var Jr=Xa();function Ya(d){if(!(typeof d=="function"||typeof d=="object")||d.name!=="DOMException")return!1;try{return new d,!0}catch{return!1}}function Ka(){var d=Jr==null?void 0:Jr.DOMException;return Ya(d)?d:void 0}function Qa(){var d=function(I,$){this.message=I||"",this.name=$||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return p(d,"DOMException"),d.prototype=Object.create(Error.prototype),Object.defineProperty(d.prototype,"constructor",{value:d,writable:!0,configurable:!0}),d}var Ja=Ka()||Qa();function Bn(d,y,I,$,J,re){var fe=Ae(d),xe=An(y);d._disturbed=!0;var ke=!1,Ce=b(void 0);return T(function(Ue,ze){var He;if(re!==void 0){if(He=function(){var We=re.reason!==void 0?re.reason:new Ja("Aborted","AbortError"),Je=[];$||Je.push(function(){return y._state==="writable"?vr(y,We):b(void 0)}),J||Je.push(function(){return d._state==="readable"?bt(d,We):b(void 0)}),pt(function(){return Promise.all(Je.map(function(at){return at()}))},!0,We)},re.aborted){He();return}re.addEventListener("abort",He)}function st(){return T(function(We,Je){function at(Et){Et?We():w(ft(),at,Je)}at(!1)})}function ft(){return ke?b(!0):w(xe._readyPromise,function(){return T(function(We,Je){ae(fe,{_chunkSteps:function(at){Ce=w(In(xe,at),void 0,s),We(!1)},_closeSteps:function(){return We(!0)},_errorSteps:Je})})})}if(lt(d,fe._closedPromise,function(We){return $?Rt(!0,We):pt(function(){return vr(y,We)},!0,We),null}),lt(y,xe._closedPromise,function(We){return J?Rt(!0,We):pt(function(){return bt(d,We)},!0,We),null}),wt(d,fe._closedPromise,function(){return I?Rt():pt(function(){return Ma(xe)}),null}),St(y)||y._state==="closed"){var mt=new TypeError("the destination writable stream closed before all data could be piped to it");J?Rt(!0,mt):pt(function(){return bt(d,mt)},!0,mt)}R(st());function _t(){var We=Ce;return w(Ce,function(){return We!==Ce?_t():void 0})}function lt(We,Je,at){We._state==="errored"?at(We._storedError):C(Je,at)}function wt(We,Je,at){We._state==="closed"?at():S(Je,at)}function pt(We,Je,at){if(ke)return;ke=!0,y._state==="writable"&&!St(y)?S(_t(),Et):Et();function Et(){return m(We(),function(){return nt(Je,at)},function(Ft){return nt(!0,Ft)}),null}}function Rt(We,Je){ke||(ke=!0,y._state==="writable"&&!St(y)?S(_t(),function(){return nt(We,Je)}):nt(We,Je))}function nt(We,Je){return Pn(xe),pe(fe),re!==void 0&&re.removeEventListener("abort",He),We?ze(Je):Ue(void 0),null}})}var xt=function(){function d(){throw new TypeError("Illegal constructor")}return Object.defineProperty(d.prototype,"desiredSize",{get:function(){if(!Cr(this))throw Rr("desiredSize");return Zr(this)},enumerable:!1,configurable:!0}),d.prototype.close=function(){if(!Cr(this))throw Rr("close");if(!Kt(this))throw new TypeError("The stream is not in a state that permits close");Wt(this)},d.prototype.enqueue=function(y){if(y===void 0&&(y=void 0),!Cr(this))throw Rr("enqueue");if(!Kt(this))throw new TypeError("The stream is not in a state that permits enqueue");return Yt(this,y)},d.prototype.error=function(y){if(y===void 0&&(y=void 0),!Cr(this))throw Rr("error");vt(this,y)},d.prototype[U]=function(y){dt(this);var I=this._cancelAlgorithm(y);return xr(this),I},d.prototype[B]=function(y){var I=this._controlledReadableStream;if(this._queue.length>0){var $=rt(this);this._closeRequested&&this._queue.length===0?(xr(this),or(I)):ar(this),y._chunkSteps($)}else Fe(I,y),ar(this)},d.prototype[N]=function(){},d}();Object.defineProperties(xt.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}}),p(xt.prototype.close,"close"),p(xt.prototype.enqueue,"enqueue"),p(xt.prototype.error,"error"),typeof r.toStringTag=="symbol"&&Object.defineProperty(xt.prototype,r.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});function Cr(d){return!f(d)||!Object.prototype.hasOwnProperty.call(d,"_controlledReadableStream")?!1:d instanceof xt}function ar(d){var y=Un(d);if(y){if(d._pulling){d._pullAgain=!0;return}d._pulling=!0;var I=d._pullAlgorithm();m(I,function(){return d._pulling=!1,d._pullAgain&&(d._pullAgain=!1,ar(d)),null},function($){return vt(d,$),null})}}function Un(d){var y=d._controlledReadableStream;if(!Kt(d)||!d._started)return!1;if(Ot(y)&&Ve(y)>0)return!0;var I=Zr(d);return I>0}function xr(d){d._pullAlgorithm=void 0,d._cancelAlgorithm=void 0,d._strategySizeAlgorithm=void 0}function Wt(d){if(Kt(d)){var y=d._controlledReadableStream;d._closeRequested=!0,d._queue.length===0&&(xr(d),or(y))}}function Yt(d,y){if(Kt(d)){var I=d._controlledReadableStream;if(Ot(I)&&Ve(I)>0)_e(I,y,!1);else{var $=void 0;try{$=d._strategySizeAlgorithm(y)}catch(J){throw vt(d,J),J}try{yt(d,y,$)}catch(J){throw vt(d,J),J}}ar(d)}}function vt(d,y){var I=d._controlledReadableStream;I._state==="readable"&&(dt(d),xr(d),qn(I,y))}function Zr(d){var y=d._controlledReadableStream._state;return y==="errored"?null:y==="closed"?0:d._strategyHWM-d._queueTotalSize}function Za(d){return!Un(d)}function Kt(d){var y=d._controlledReadableStream._state;return!d._closeRequested&&y==="readable"}function $n(d,y,I,$,J,re,fe){y._controlledReadableStream=d,y._queue=void 0,y._queueTotalSize=void 0,dt(y),y._started=!1,y._closeRequested=!1,y._pullAgain=!1,y._pulling=!1,y._strategySizeAlgorithm=fe,y._strategyHWM=re,y._pullAlgorithm=$,y._cancelAlgorithm=J,d._readableStreamController=y;var xe=I();m(b(xe),function(){return y._started=!0,ar(y),null},function(ke){return vt(y,ke),null})}function ei(d,y,I,$){var J=Object.create(xt.prototype),re,fe,xe;y.start!==void 0?re=function(){return y.start(J)}:re=function(){},y.pull!==void 0?fe=function(){return y.pull(J)}:fe=function(){return b(void 0)},y.cancel!==void 0?xe=function(ke){return y.cancel(ke)}:xe=function(){return b(void 0)},$n(d,J,re,fe,xe,I,$)}function Rr(d){return new TypeError("ReadableStreamDefaultController.prototype.".concat(d," can only be used on a ReadableStreamDefaultController"))}function ti(d,y){return Nt(d._readableStreamController)?ni(d):ri(d)}function ri(d,y){var I=Ae(d),$=!1,J=!1,re=!1,fe=!1,xe,ke,Ce,Ue,ze,He=T(function(lt){ze=lt});function st(){if($)return J=!0,b(void 0);$=!0;var lt={_chunkSteps:function(wt){M(function(){J=!1;var pt=wt,Rt=wt;re||Yt(Ce._readableStreamController,pt),fe||Yt(Ue._readableStreamController,Rt),$=!1,J&&st()})},_closeSteps:function(){$=!1,re||Wt(Ce._readableStreamController),fe||Wt(Ue._readableStreamController),(!re||!fe)&&ze(void 0)},_errorSteps:function(){$=!1}};return ae(I,lt),b(void 0)}function ft(lt){if(re=!0,xe=lt,fe){var wt=de([xe,ke]),pt=bt(d,wt);ze(pt)}return He}function mt(lt){if(fe=!0,ke=lt,re){var wt=de([xe,ke]),pt=bt(d,wt);ze(pt)}return He}function _t(){}return Ce=ir(_t,st,ft),Ue=ir(_t,st,mt),C(I._closedPromise,function(lt){return vt(Ce._readableStreamController,lt),vt(Ue._readableStreamController,lt),(!re||!fe)&&ze(void 0),null}),[Ce,Ue]}function ni(d){var y=Ae(d),I=!1,$=!1,J=!1,re=!1,fe=!1,xe,ke,Ce,Ue,ze,He=T(function(nt){ze=nt});function st(nt){C(nt._closedPromise,function(We){return nt!==y||(gt(Ce._readableStreamController,We),gt(Ue._readableStreamController,We),(!re||!fe)&&ze(void 0)),null})}function ft(){Bt(y)&&(pe(y),y=Ae(d),st(y));var nt={_chunkSteps:function(We){M(function(){$=!1,J=!1;var Je=We,at=We;if(!re&&!fe)try{at=ct(We)}catch(Et){gt(Ce._readableStreamController,Et),gt(Ue._readableStreamController,Et),ze(bt(d,Et));return}re||hr(Ce._readableStreamController,Je),fe||hr(Ue._readableStreamController,at),I=!1,$?_t():J&&lt()})},_closeSteps:function(){I=!1,re||Zt(Ce._readableStreamController),fe||Zt(Ue._readableStreamController),Ce._readableStreamController._pendingPullIntos.length>0&&fr(Ce._readableStreamController,0),Ue._readableStreamController._pendingPullIntos.length>0&&fr(Ue._readableStreamController,0),(!re||!fe)&&ze(void 0)},_errorSteps:function(){I=!1}};ae(y,nt)}function mt(nt,We){Ee(y)&&(pe(y),y=vn(d),st(y));var Je=We?Ue:Ce,at=We?Ce:Ue,Et={_chunkSteps:function(Ft){M(function(){$=!1,J=!1;var Jt=We?fe:re,sr=We?re:fe;if(sr)Jt||pr(Je._readableStreamController,Ft);else{var na=void 0;try{na=ct(Ft)}catch(on){gt(Je._readableStreamController,on),gt(at._readableStreamController,on),ze(bt(d,on));return}Jt||pr(Je._readableStreamController,Ft),hr(at._readableStreamController,na)}I=!1,$?_t():J&&lt()})},_closeSteps:function(Ft){I=!1;var Jt=We?fe:re,sr=We?re:fe;Jt||Zt(Je._readableStreamController),sr||Zt(at._readableStreamController),Ft!==void 0&&(Jt||pr(Je._readableStreamController,Ft),!sr&&at._readableStreamController._pendingPullIntos.length>0&&fr(at._readableStreamController,0)),(!Jt||!sr)&&ze(void 0)},_errorSteps:function(){I=!1}};_n(y,nt,1,Et)}function _t(){if(I)return $=!0,b(void 0);I=!0;var nt=Br(Ce._readableStreamController);return nt===null?ft():mt(nt._view,!1),b(void 0)}function lt(){if(I)return J=!0,b(void 0);I=!0;var nt=Br(Ue._readableStreamController);return nt===null?ft():mt(nt._view,!0),b(void 0)}function wt(nt){if(re=!0,xe=nt,fe){var We=de([xe,ke]),Je=bt(d,We);ze(Je)}return He}function pt(nt){if(fe=!0,ke=nt,re){var We=de([xe,ke]),Je=bt(d,We);ze(Je)}return He}function Rt(){}return Ce=Gn(Rt,_t,wt),Ue=Gn(Rt,lt,pt),st(y),[Ce,Ue]}function ai(d){return f(d)&&typeof d.getReader<"u"}function ii(d){return ai(d)?si(d.getReader()):oi(d)}function oi(d){var y,I=Se(d,"async"),$=s;function J(){var fe;try{fe=Ie(I)}catch(ke){return _(ke)}var xe=b(fe);return x(xe,function(ke){if(!f(ke))throw new TypeError("The promise returned by the iterator.next() method must fulfill with an object");var Ce=Be(ke);if(Ce)Wt(y._readableStreamController);else{var Ue=Ge(ke);Yt(y._readableStreamController,Ue)}})}function re(fe){var xe=I.iterator,ke;try{ke=je(xe,"return")}catch(ze){return _(ze)}if(ke===void 0)return b(void 0);var Ce;try{Ce=F(ke,xe,[fe])}catch(ze){return _(ze)}var Ue=b(Ce);return x(Ue,function(ze){if(!f(ze))throw new TypeError("The promise returned by the iterator.return() method must fulfill with an object")})}return y=ir($,J,re,0),y}function si(d){var y,I=s;function $(){var re;try{re=d.read()}catch(fe){return _(fe)}return x(re,function(fe){if(!f(fe))throw new TypeError("The promise returned by the reader.read() method must fulfill with an object");if(fe.done)Wt(y._readableStreamController);else{var xe=fe.value;Yt(y._readableStreamController,xe)}})}function J(re){try{return b(d.cancel(re))}catch(fe){return _(fe)}}return y=ir(I,$,J,0),y}function ci(d,y){j(d,y);var I=d,$=I==null?void 0:I.autoAllocateChunkSize,J=I==null?void 0:I.cancel,re=I==null?void 0:I.pull,fe=I==null?void 0:I.start,xe=I==null?void 0:I.type;return{autoAllocateChunkSize:$===void 0?void 0:be($,"".concat(y," has member 'autoAllocateChunkSize' that")),cancel:J===void 0?void 0:li(J,I,"".concat(y," has member 'cancel' that")),pull:re===void 0?void 0:ui(re,I,"".concat(y," has member 'pull' that")),start:fe===void 0?void 0:di(fe,I,"".concat(y," has member 'start' that")),type:xe===void 0?void 0:hi(xe,"".concat(y," has member 'type' that"))}}function li(d,y,I){return z(d,I),function($){return H(d,y,[$])}}function ui(d,y,I){return z(d,I),function($){return H(d,y,[$])}}function di(d,y,I){return z(d,I),function($){return F(d,y,[$])}}function hi(d,y){if(d="".concat(d),d!=="bytes")throw new TypeError("".concat(y," '").concat(d,"' is not a valid enumeration value for ReadableStreamType"));return d}function fi(d,y){j(d,y);var I=d==null?void 0:d.preventCancel;return{preventCancel:!!I}}function Wn(d,y){j(d,y);var I=d==null?void 0:d.preventAbort,$=d==null?void 0:d.preventCancel,J=d==null?void 0:d.preventClose,re=d==null?void 0:d.signal;return re!==void 0&&pi(re,"".concat(y," has member 'signal' that")),{preventAbort:!!I,preventCancel:!!$,preventClose:!!J,signal:re}}function pi(d,y){if(!wa(d))throw new TypeError("".concat(y," is not an AbortSignal."))}function gi(d,y){j(d,y);var I=d==null?void 0:d.readable;le(I,"readable","ReadableWritablePair"),we(I,"".concat(y," has member 'readable' that"));var $=d==null?void 0:d.writable;return le($,"writable","ReadableWritablePair"),En($,"".concat(y," has member 'writable' that")),{readable:I,writable:$}}var ut=function(){function d(y,I){y===void 0&&(y={}),I===void 0&&(I={}),y===void 0?y=null:te(y,"First parameter");var $=yr(I,"Second parameter"),J=ci(y,"First parameter");if(en(this),J.type==="bytes"){if($.size!==void 0)throw new RangeError("The strategy for a byte stream cannot have a size function");var re=tr($,0);la(this,J,re)}else{var fe=mr($),re=tr($,1);ei(this,J,re,fe)}}return Object.defineProperty(d.prototype,"locked",{get:function(){if(!kt(this))throw Gt("locked");return Ot(this)},enumerable:!1,configurable:!0}),d.prototype.cancel=function(y){return y===void 0&&(y=void 0),kt(this)?Ot(this)?_(new TypeError("Cannot cancel a stream that already has a reader")):bt(this,y):_(Gt("cancel"))},d.prototype.getReader=function(y){if(y===void 0&&(y=void 0),!kt(this))throw Gt("getReader");var I=da(y,"First parameter");return I.mode===void 0?Ae(this):vn(this)},d.prototype.pipeThrough=function(y,I){if(I===void 0&&(I={}),!kt(this))throw Gt("pipeThrough");ie(y,1,"pipeThrough");var $=gi(y,"First parameter"),J=Wn(I,"Second parameter");if(Ot(this))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(Vt($.writable))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");var re=Bn(this,$.writable,J.preventClose,J.preventAbort,J.preventCancel,J.signal);return R(re),$.readable},d.prototype.pipeTo=function(y,I){if(I===void 0&&(I={}),!kt(this))return _(Gt("pipeTo"));if(y===void 0)return _("Parameter 1 is required in 'pipeTo'.");if(!Ht(y))return _(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));var $;try{$=Wn(I,"Second parameter")}catch(J){return _(J)}return Ot(this)?_(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):Vt(y)?_(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):Bn(this,y,$.preventClose,$.preventAbort,$.preventCancel,$.signal)},d.prototype.tee=function(){if(!kt(this))throw Gt("tee");var y=ti(this);return de(y)},d.prototype.values=function(y){if(y===void 0&&(y=void 0),!kt(this))throw Gt("values");var I=fi(y,"First parameter");return it(this,I.preventCancel)},d.prototype[oe]=function(y){return this.values(y)},d.from=function(y){return ii(y)},d}();Object.defineProperties(ut,{from:{enumerable:!0}}),Object.defineProperties(ut.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}}),p(ut.from,"from"),p(ut.prototype.cancel,"cancel"),p(ut.prototype.getReader,"getReader"),p(ut.prototype.pipeThrough,"pipeThrough"),p(ut.prototype.pipeTo,"pipeTo"),p(ut.prototype.tee,"tee"),p(ut.prototype.values,"values"),typeof r.toStringTag=="symbol"&&Object.defineProperty(ut.prototype,r.toStringTag,{value:"ReadableStream",configurable:!0}),Object.defineProperty(ut.prototype,oe,{value:ut.prototype.values,writable:!0,configurable:!0});function ir(d,y,I,$,J){$===void 0&&($=1),J===void 0&&(J=function(){return 1});var re=Object.create(ut.prototype);en(re);var fe=Object.create(xt.prototype);return $n(re,fe,d,y,I,$,J),re}function Gn(d,y,I){var $=Object.create(ut.prototype);en($);var J=Object.create(At.prototype);return yn($,J,d,y,I,0,void 0),$}function en(d){d._state="readable",d._reader=void 0,d._storedError=void 0,d._disturbed=!1}function kt(d){return!f(d)||!Object.prototype.hasOwnProperty.call(d,"_readableStreamController")?!1:d instanceof ut}function Ot(d){return d._reader!==void 0}function bt(d,y){if(d._disturbed=!0,d._state==="closed")return b(void 0);if(d._state==="errored")return _(d._storedError);or(d);var I=d._reader;if(I!==void 0&&Bt(I)){var $=I._readIntoRequests;I._readIntoRequests=new X,$.forEach(function(re){re._closeSteps(void 0)})}var J=d._readableStreamController[U](y);return x(J,s)}function or(d){d._state="closed";var y=d._reader;if(y!==void 0&&(E(y),Ee(y))){var I=y._readRequests;y._readRequests=new X,I.forEach(function($){$._closeSteps()})}}function qn(d,y){d._state="errored",d._storedError=y;var I=d._reader;I!==void 0&&(W(I,y),Ee(I)?Le(I,y):wn(I,y))}function Gt(d){return new TypeError("ReadableStream.prototype.".concat(d," can only be used on a ReadableStream"))}function zn(d,y){j(d,y);var I=d==null?void 0:d.highWaterMark;return le(I,"highWaterMark","QueuingStrategyInit"),{highWaterMark:se(I)}}var Hn=function(d){return d.byteLength};p(Hn,"size");var Tr=function(){function d(y){ie(y,1,"ByteLengthQueuingStrategy"),y=zn(y,"First parameter"),this._byteLengthQueuingStrategyHighWaterMark=y.highWaterMark}return Object.defineProperty(d.prototype,"highWaterMark",{get:function(){if(!Xn(this))throw Vn("highWaterMark");return this._byteLengthQueuingStrategyHighWaterMark},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"size",{get:function(){if(!Xn(this))throw Vn("size");return Hn},enumerable:!1,configurable:!0}),d}();Object.defineProperties(Tr.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof r.toStringTag=="symbol"&&Object.defineProperty(Tr.prototype,r.toStringTag,{value:"ByteLengthQueuingStrategy",configurable:!0});function Vn(d){return new TypeError("ByteLengthQueuingStrategy.prototype.".concat(d," can only be used on a ByteLengthQueuingStrategy"))}function Xn(d){return!f(d)||!Object.prototype.hasOwnProperty.call(d,"_byteLengthQueuingStrategyHighWaterMark")?!1:d instanceof Tr}var Yn=function(){return 1};p(Yn,"size");var Pr=function(){function d(y){ie(y,1,"CountQueuingStrategy"),y=zn(y,"First parameter"),this._countQueuingStrategyHighWaterMark=y.highWaterMark}return Object.defineProperty(d.prototype,"highWaterMark",{get:function(){if(!Qn(this))throw Kn("highWaterMark");return this._countQueuingStrategyHighWaterMark},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"size",{get:function(){if(!Qn(this))throw Kn("size");return Yn},enumerable:!1,configurable:!0}),d}();Object.defineProperties(Pr.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof r.toStringTag=="symbol"&&Object.defineProperty(Pr.prototype,r.toStringTag,{value:"CountQueuingStrategy",configurable:!0});function Kn(d){return new TypeError("CountQueuingStrategy.prototype.".concat(d," can only be used on a CountQueuingStrategy"))}function Qn(d){return!f(d)||!Object.prototype.hasOwnProperty.call(d,"_countQueuingStrategyHighWaterMark")?!1:d instanceof Pr}function mi(d,y){j(d,y);var I=d==null?void 0:d.cancel,$=d==null?void 0:d.flush,J=d==null?void 0:d.readableType,re=d==null?void 0:d.start,fe=d==null?void 0:d.transform,xe=d==null?void 0:d.writableType;return{cancel:I===void 0?void 0:Si(I,d,"".concat(y," has member 'cancel' that")),flush:$===void 0?void 0:yi($,d,"".concat(y," has member 'flush' that")),readableType:J,start:re===void 0?void 0:vi(re,d,"".concat(y," has member 'start' that")),transform:fe===void 0?void 0:bi(fe,d,"".concat(y," has member 'transform' that")),writableType:xe}}function yi(d,y,I){return z(d,I),function($){return H(d,y,[$])}}function vi(d,y,I){return z(d,I),function($){return F(d,y,[$])}}function bi(d,y,I){return z(d,I),function($,J){return H(d,y,[$,J])}}function Si(d,y,I){return z(d,I),function($){return H(d,y,[$])}}var Ir=function(){function d(y,I,$){y===void 0&&(y={}),I===void 0&&(I={}),$===void 0&&($={}),y===void 0&&(y=null);var J=yr(I,"Second parameter"),re=yr($,"Third parameter"),fe=mi(y,"First parameter");if(fe.readableType!==void 0)throw new RangeError("Invalid readableType specified");if(fe.writableType!==void 0)throw new RangeError("Invalid writableType specified");var xe=tr(re,0),ke=mr(re),Ce=tr(J,1),Ue=mr(J),ze,He=T(function(st){ze=st});_i(this,He,Ce,Ue,xe,ke),Ei(this,fe),fe.start!==void 0?ze(fe.start(this._transformStreamController)):ze(void 0)}return Object.defineProperty(d.prototype,"readable",{get:function(){if(!Jn(this))throw ra("readable");return this._readable},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"writable",{get:function(){if(!Jn(this))throw ra("writable");return this._writable},enumerable:!1,configurable:!0}),d}();Object.defineProperties(Ir.prototype,{readable:{enumerable:!0},writable:{enumerable:!0}}),typeof r.toStringTag=="symbol"&&Object.defineProperty(Ir.prototype,r.toStringTag,{value:"TransformStream",configurable:!0});function _i(d,y,I,$,J,re){function fe(){return y}function xe(He){return xi(d,He)}function ke(He){return Ri(d,He)}function Ce(){return Ti(d)}d._writable=Ca(fe,xe,Ce,ke,I,$);function Ue(){return Pi(d)}function ze(He){return Ii(d,He)}d._readable=ir(fe,Ue,ze,J,re),d._backpressure=void 0,d._backpressureChangePromise=void 0,d._backpressureChangePromise_resolve=void 0,kr(d,!0),d._transformStreamController=void 0}function Jn(d){return!f(d)||!Object.prototype.hasOwnProperty.call(d,"_transformStreamController")?!1:d instanceof Ir}function Zn(d,y){vt(d._readable._readableStreamController,y),tn(d,y)}function tn(d,y){Dr(d._transformStreamController),rr(d._writable._writableStreamController,y),nn(d)}function nn(d){d._backpressure&&kr(d,!1)}function kr(d,y){d._backpressureChangePromise!==void 0&&d._backpressureChangePromise_resolve(),d._backpressureChangePromise=T(function(I){d._backpressureChangePromise_resolve=I}),d._backpressure=y}var Dt=function(){function d(){throw new TypeError("Illegal constructor")}return Object.defineProperty(d.prototype,"desiredSize",{get:function(){if(!Or(this))throw Fr("desiredSize");var y=this._controlledTransformStream._readable._readableStreamController;return Zr(y)},enumerable:!1,configurable:!0}),d.prototype.enqueue=function(y){if(y===void 0&&(y=void 0),!Or(this))throw Fr("enqueue");ea(this,y)},d.prototype.error=function(y){if(y===void 0&&(y=void 0),!Or(this))throw Fr("error");Ai(this,y)},d.prototype.terminate=function(){if(!Or(this))throw Fr("terminate");Ci(this)},d}();Object.defineProperties(Dt.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}}),p(Dt.prototype.enqueue,"enqueue"),p(Dt.prototype.error,"error"),p(Dt.prototype.terminate,"terminate"),typeof r.toStringTag=="symbol"&&Object.defineProperty(Dt.prototype,r.toStringTag,{value:"TransformStreamDefaultController",configurable:!0});function Or(d){return!f(d)||!Object.prototype.hasOwnProperty.call(d,"_controlledTransformStream")?!1:d instanceof Dt}function wi(d,y,I,$,J){y._controlledTransformStream=d,d._transformStreamController=y,y._transformAlgorithm=I,y._flushAlgorithm=$,y._cancelAlgorithm=J,y._finishPromise=void 0,y._finishPromise_resolve=void 0,y._finishPromise_reject=void 0}function Ei(d,y){var I=Object.create(Dt.prototype),$,J,re;y.transform!==void 0?$=function(fe){return y.transform(fe,I)}:$=function(fe){try{return ea(I,fe),b(void 0)}catch(xe){return _(xe)}},y.flush!==void 0?J=function(){return y.flush(I)}:J=function(){return b(void 0)},y.cancel!==void 0?re=function(fe){return y.cancel(fe)}:re=function(){return b(void 0)},wi(d,I,$,J,re)}function Dr(d){d._transformAlgorithm=void 0,d._flushAlgorithm=void 0,d._cancelAlgorithm=void 0}function ea(d,y){var I=d._controlledTransformStream,$=I._readable._readableStreamController;if(!Kt($))throw new TypeError("Readable side is not in a state that permits enqueue");try{Yt($,y)}catch(re){throw tn(I,re),I._readable._storedError}var J=Za($);J!==I._backpressure&&kr(I,!0)}function Ai(d,y){Zn(d._controlledTransformStream,y)}function ta(d,y){var I=d._transformAlgorithm(y);return x(I,void 0,function($){throw Zn(d._controlledTransformStream,$),$})}function Ci(d){var y=d._controlledTransformStream,I=y._readable._readableStreamController;Wt(I);var $=new TypeError("TransformStream terminated");tn(y,$)}function xi(d,y){var I=d._transformStreamController;if(d._backpressure){var $=d._backpressureChangePromise;return x($,function(){var J=d._writable,re=J._state;if(re==="erroring")throw J._storedError;return ta(I,y)})}return ta(I,y)}function Ri(d,y){var I=d._transformStreamController;if(I._finishPromise!==void 0)return I._finishPromise;var $=d._readable;I._finishPromise=T(function(re,fe){I._finishPromise_resolve=re,I._finishPromise_reject=fe});var J=I._cancelAlgorithm(y);return Dr(I),m(J,function(){return $._state==="errored"?Qt(I,$._storedError):(vt($._readableStreamController,y),an(I)),null},function(re){return vt($._readableStreamController,re),Qt(I,re),null}),I._finishPromise}function Ti(d){var y=d._transformStreamController;if(y._finishPromise!==void 0)return y._finishPromise;var I=d._readable;y._finishPromise=T(function(J,re){y._finishPromise_resolve=J,y._finishPromise_reject=re});var $=y._flushAlgorithm();return Dr(y),m($,function(){return I._state==="errored"?Qt(y,I._storedError):(Wt(I._readableStreamController),an(y)),null},function(J){return vt(I._readableStreamController,J),Qt(y,J),null}),y._finishPromise}function Pi(d){return kr(d,!1),d._backpressureChangePromise}function Ii(d,y){var I=d._transformStreamController;if(I._finishPromise!==void 0)return I._finishPromise;var $=d._writable;I._finishPromise=T(function(re,fe){I._finishPromise_resolve=re,I._finishPromise_reject=fe});var J=I._cancelAlgorithm(y);return Dr(I),m(J,function(){return $._state==="errored"?Qt(I,$._storedError):(rr($._writableStreamController,y),nn(d),an(I)),null},function(re){return rr($._writableStreamController,re),nn(d),Qt(I,re),null}),I._finishPromise}function Fr(d){return new TypeError("TransformStreamDefaultController.prototype.".concat(d," can only be used on a TransformStreamDefaultController"))}function an(d){d._finishPromise_resolve!==void 0&&(d._finishPromise_resolve(),d._finishPromise_resolve=void 0,d._finishPromise_reject=void 0)}function Qt(d,y){d._finishPromise_reject!==void 0&&(R(d._finishPromise),d._finishPromise_reject(y),d._finishPromise_resolve=void 0,d._finishPromise_reject=void 0)}function ra(d){return new TypeError("TransformStream.prototype.".concat(d," can only be used on a TransformStream"))}t.ByteLengthQueuingStrategy=Tr,t.CountQueuingStrategy=Pr,t.ReadableByteStreamController=At,t.ReadableStream=ut,t.ReadableStreamBYOBReader=Pt,t.ReadableStreamBYOBRequest=ht,t.ReadableStreamDefaultController=xt,t.ReadableStreamDefaultReader=Oe,t.TransformStream=Ir,t.TransformStreamDefaultController=Dt,t.WritableStream=It,t.WritableStreamDefaultController=Xt,t.WritableStreamDefaultWriter=Ct})}(ponyfill$1,ponyfill$1.exports)),ponyfill$1.exports}const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$7=getAugmentedNamespace(__viteBrowserExternal$1);var hasRequiredPdf;function requirePdf(){return hasRequiredPdf||(hasRequiredPdf=1,function(module,exports){(function(e,t){module.exports=t()})(globalThis,()=>(()=>{var __webpack_modules__=[,(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.VerbosityLevel=e.Util=e.UnknownErrorException=e.UnexpectedResponseException=e.UNSUPPORTED_FEATURES=e.TextRenderingMode=e.StreamType=e.RenderingIntentFlag=e.PermissionFlag=e.PasswordResponses=e.PasswordException=e.PageActionEventType=e.OPS=e.MissingPDFException=e.LINE_FACTOR=e.LINE_DESCENT_FACTOR=e.InvalidPDFException=e.ImageKind=e.IDENTITY_MATRIX=e.FormatError=e.FontType=e.FeatureTest=e.FONT_IDENTITY_MATRIX=e.DocumentActionEventType=e.CMapCompressionType=e.BaseException=e.AnnotationType=e.AnnotationStateModelType=e.AnnotationReviewState=e.AnnotationReplyType=e.AnnotationMode=e.AnnotationMarkedState=e.AnnotationFlag=e.AnnotationFieldFlag=e.AnnotationEditorType=e.AnnotationEditorPrefix=e.AnnotationEditorParamsType=e.AnnotationBorderStyleType=e.AnnotationActionEventType=e.AbortException=void 0,e.arrayByteLength=ie,e.arraysToBytes=le,e.assert=Re,e.bytesToString=Z,e.createPromiseCapability=Ne,e.createValidAbsoluteUrl=O,e.escapeString=Oe,e.getModificationDate=Pe,e.getVerbosityLevel=N,e.info=Q,e.isArrayBuffer=Ke,e.isArrayEqual=ye,e.isAscii=Ee,e.objectFromMap=me,e.objectSize=ue,e.setVerbosityLevel=B,e.shadow=D,e.string32=se,e.stringToBytes=te,e.stringToPDFString=Qe,e.stringToUTF16BEString=ae,e.stringToUTF8String=ve,e.unreachable=pe,e.utf8StringToString=Le,e.warn=ce,t(2);const r=[1,0,0,1,0,0];e.IDENTITY_MATRIX=r;const a=[.001,0,0,.001,0,0];e.FONT_IDENTITY_MATRIX=a;const i=1.35;e.LINE_FACTOR=i;const c=.35;e.LINE_DESCENT_FACTOR=c;const l={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};e.RenderingIntentFlag=l;const h={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};e.AnnotationMode=h;const o="pdfjs_internal_editor_";e.AnnotationEditorPrefix=o;const s={DISABLE:-1,NONE:0,FREETEXT:3,INK:15};e.AnnotationEditorType=s;const f={FREETEXT_SIZE:1,FREETEXT_COLOR:2,FREETEXT_OPACITY:3,INK_COLOR:11,INK_THICKNESS:12,INK_OPACITY:13};e.AnnotationEditorParamsType=f;const u={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};e.PermissionFlag=u;const p={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};e.TextRenderingMode=p;const v={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};e.ImageKind=v;const g={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};e.AnnotationType=g;const A={MARKED:"Marked",REVIEW:"Review"};e.AnnotationStateModelType=A;const T={MARKED:"Marked",UNMARKED:"Unmarked"};e.AnnotationMarkedState=T;const b={ACCEPTED:"Accepted",REJECTED:"Rejected",CANCELLED:"Cancelled",COMPLETED:"Completed",NONE:"None"};e.AnnotationReviewState=b;const _={GROUP:"Group",REPLY:"R"};e.AnnotationReplyType=_;const w={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};e.AnnotationFlag=w;const m={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};e.AnnotationFieldFlag=m;const S={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};e.AnnotationBorderStyleType=S;const C={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};e.AnnotationActionEventType=C;const x={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};e.DocumentActionEventType=x;const R={O:"PageOpen",C:"PageClose"};e.PageActionEventType=R;const M={UNKNOWN:"UNKNOWN",FLATE:"FLATE",LZW:"LZW",DCT:"DCT",JPX:"JPX",JBIG:"JBIG",A85:"A85",AHX:"AHX",CCF:"CCF",RLX:"RLX"};e.StreamType=M;const F={UNKNOWN:"UNKNOWN",TYPE1:"TYPE1",TYPE1STANDARD:"TYPE1STANDARD",TYPE1C:"TYPE1C",CIDFONTTYPE0:"CIDFONTTYPE0",CIDFONTTYPE0C:"CIDFONTTYPE0C",TRUETYPE:"TRUETYPE",CIDFONTTYPE2:"CIDFONTTYPE2",TYPE3:"TYPE3",OPENTYPE:"OPENTYPE",TYPE0:"TYPE0",MMTYPE1:"MMTYPE1"};e.FontType=F;const H={ERRORS:0,WARNINGS:1,INFOS:5};e.VerbosityLevel=H;const V={NONE:0,BINARY:1,STREAM:2};e.CMapCompressionType=V;const X={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotations:78,endAnnotations:79,beginAnnotation:80,endAnnotation:81,paintJpegXObject:82,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};e.OPS=X;const K={unknown:"unknown",forms:"forms",javaScript:"javaScript",signatures:"signatures",smask:"smask",shadingPattern:"shadingPattern",font:"font",errorTilingPattern:"errorTilingPattern",errorExtGState:"errorExtGState",errorXObject:"errorXObject",errorFontLoadType3:"errorFontLoadType3",errorFontState:"errorFontState",errorFontMissing:"errorFontMissing",errorFontTranslate:"errorFontTranslate",errorColorSpace:"errorColorSpace",errorOperatorList:"errorOperatorList",errorFontToUnicode:"errorFontToUnicode",errorFontLoadNative:"errorFontLoadNative",errorFontBuildPath:"errorFontBuildPath",errorFontGetPath:"errorFontGetPath",errorMarkedContent:"errorMarkedContent",errorContentSubStream:"errorContentSubStream"};e.UNSUPPORTED_FEATURES=K;const q={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};e.PasswordResponses=q;let U=H.WARNINGS;function B(de){Number.isInteger(de)&&(U=de)}function N(){return U}function Q(de){U>=H.INFOS&&console.log(`Info: ${de}`)}function ce(de){U>=H.WARNINGS&&console.log(`Warning: ${de}`)}function pe(de){throw new Error(de)}function Re(de,ee){de||pe(ee)}function Y(de){if(!de)return!1;switch(de.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function O(de){let ee=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,ne=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(!de)return null;try{if(ne&&typeof de=="string"){if(ne.addDefaultProtocol&&de.startsWith("www.")){const De=de.match(/\./g);De&&De.length>=2&&(de=`http://${de}`)}if(ne.tryConvertEncoding)try{de=ve(de)}catch{}}const ge=ee?new URL(de,ee):new URL(de);if(Y(ge))return ge}catch{}return null}function D(de,ee,ne){return Object.defineProperty(de,ee,{value:ne,enumerable:!0,configurable:!0,writable:!1}),ne}const W=function(){function ee(ne,ge){this.constructor===ee&&pe("Cannot initialize BaseException."),this.message=ne,this.name=ge}return ee.prototype=new Error,ee.constructor=ee,ee}();e.BaseException=W;class G extends W{constructor(ee,ne){super(ee,"PasswordException"),this.code=ne}}e.PasswordException=G;class E extends W{constructor(ee,ne){super(ee,"UnknownErrorException"),this.details=ne}}e.UnknownErrorException=E;class P extends W{constructor(ee){super(ee,"InvalidPDFException")}}e.InvalidPDFException=P;class k extends W{constructor(ee){super(ee,"MissingPDFException")}}e.MissingPDFException=k;class L extends W{constructor(ee,ne){super(ee,"UnexpectedResponseException"),this.status=ne}}e.UnexpectedResponseException=L;class j extends W{constructor(ee){super(ee,"FormatError")}}e.FormatError=j;class z extends W{constructor(ee){super(ee,"AbortException")}}e.AbortException=z;function Z(de){(typeof de!="object"||de===null||de.length===void 0)&&pe("Invalid argument for bytesToString");const ee=de.length,ne=8192;if(ee<ne)return String.fromCharCode.apply(null,de);const ge=[];for(let De=0;De<ee;De+=ne){const je=Math.min(De+ne,ee),he=de.subarray(De,je);ge.push(String.fromCharCode.apply(null,he))}return ge.join("")}function te(de){typeof de!="string"&&pe("Invalid argument for stringToBytes");const ee=de.length,ne=new Uint8Array(ee);for(let ge=0;ge<ee;++ge)ne[ge]=de.charCodeAt(ge)&255;return ne}function ie(de){if(de.length!==void 0)return de.length;if(de.byteLength!==void 0)return de.byteLength;pe("Invalid argument for arrayByteLength")}function le(de){const ee=de.length;if(ee===1&&de[0]instanceof Uint8Array)return de[0];let ne=0;for(let je=0;je<ee;je++)ne+=ie(de[je]);let ge=0;const De=new Uint8Array(ne);for(let je=0;je<ee;je++){let he=de[je];he instanceof Uint8Array||(typeof he=="string"?he=te(he):he=new Uint8Array(he));const oe=he.byteLength;De.set(he,ge),ge+=oe}return De}function se(de){return String.fromCharCode(de>>24&255,de>>16&255,de>>8&255,de&255)}function ue(de){return Object.keys(de).length}function me(de){const ee=Object.create(null);for(const[ne,ge]of de)ee[ne]=ge;return ee}function be(){const de=new Uint8Array(4);return de[0]=1,new Uint32Array(de.buffer,0,1)[0]===1}function we(){try{return new Function(""),!0}catch{return!1}}class Ae{static get isLittleEndian(){return D(this,"isLittleEndian",be())}static get isEvalSupported(){return D(this,"isEvalSupported",we())}static get isOffscreenCanvasSupported(){return D(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}}e.FeatureTest=Ae;const Fe=[...Array(256).keys()].map(de=>de.toString(16).padStart(2,"0"));class _e{static makeHexColor(ee,ne,ge){return`#${Fe[ee]}${Fe[ne]}${Fe[ge]}`}static scaleMinMax(ee,ne){let ge;ee[0]?(ee[0]<0&&(ge=ne[0],ne[0]=ne[1],ne[1]=ge),ne[0]*=ee[0],ne[1]*=ee[0],ee[3]<0&&(ge=ne[2],ne[2]=ne[3],ne[3]=ge),ne[2]*=ee[3],ne[3]*=ee[3]):(ge=ne[0],ne[0]=ne[2],ne[2]=ge,ge=ne[1],ne[1]=ne[3],ne[3]=ge,ee[1]<0&&(ge=ne[2],ne[2]=ne[3],ne[3]=ge),ne[2]*=ee[1],ne[3]*=ee[1],ee[2]<0&&(ge=ne[0],ne[0]=ne[1],ne[1]=ge),ne[0]*=ee[2],ne[1]*=ee[2]),ne[0]+=ee[4],ne[1]+=ee[4],ne[2]+=ee[5],ne[3]+=ee[5]}static transform(ee,ne){return[ee[0]*ne[0]+ee[2]*ne[1],ee[1]*ne[0]+ee[3]*ne[1],ee[0]*ne[2]+ee[2]*ne[3],ee[1]*ne[2]+ee[3]*ne[3],ee[0]*ne[4]+ee[2]*ne[5]+ee[4],ee[1]*ne[4]+ee[3]*ne[5]+ee[5]]}static applyTransform(ee,ne){const ge=ee[0]*ne[0]+ee[1]*ne[2]+ne[4],De=ee[0]*ne[1]+ee[1]*ne[3]+ne[5];return[ge,De]}static applyInverseTransform(ee,ne){const ge=ne[0]*ne[3]-ne[1]*ne[2],De=(ee[0]*ne[3]-ee[1]*ne[2]+ne[2]*ne[5]-ne[4]*ne[3])/ge,je=(-ee[0]*ne[1]+ee[1]*ne[0]+ne[4]*ne[1]-ne[5]*ne[0])/ge;return[De,je]}static getAxialAlignedBoundingBox(ee,ne){const ge=_e.applyTransform(ee,ne),De=_e.applyTransform(ee.slice(2,4),ne),je=_e.applyTransform([ee[0],ee[3]],ne),he=_e.applyTransform([ee[2],ee[1]],ne);return[Math.min(ge[0],De[0],je[0],he[0]),Math.min(ge[1],De[1],je[1],he[1]),Math.max(ge[0],De[0],je[0],he[0]),Math.max(ge[1],De[1],je[1],he[1])]}static inverseTransform(ee){const ne=ee[0]*ee[3]-ee[1]*ee[2];return[ee[3]/ne,-ee[1]/ne,-ee[2]/ne,ee[0]/ne,(ee[2]*ee[5]-ee[4]*ee[3])/ne,(ee[4]*ee[1]-ee[5]*ee[0])/ne]}static apply3dTransform(ee,ne){return[ee[0]*ne[0]+ee[1]*ne[1]+ee[2]*ne[2],ee[3]*ne[0]+ee[4]*ne[1]+ee[5]*ne[2],ee[6]*ne[0]+ee[7]*ne[1]+ee[8]*ne[2]]}static singularValueDecompose2dScale(ee){const ne=[ee[0],ee[2],ee[1],ee[3]],ge=ee[0]*ne[0]+ee[1]*ne[2],De=ee[0]*ne[1]+ee[1]*ne[3],je=ee[2]*ne[0]+ee[3]*ne[2],he=ee[2]*ne[1]+ee[3]*ne[3],oe=(ge+he)/2,Se=Math.sqrt((ge+he)**2-4*(ge*he-je*De))/2,Ie=oe+Se||1,Be=oe-Se||1;return[Math.sqrt(Ie),Math.sqrt(Be)]}static normalizeRect(ee){const ne=ee.slice(0);return ee[0]>ee[2]&&(ne[0]=ee[2],ne[2]=ee[0]),ee[1]>ee[3]&&(ne[1]=ee[3],ne[3]=ee[1]),ne}static intersect(ee,ne){const ge=Math.max(Math.min(ee[0],ee[2]),Math.min(ne[0],ne[2])),De=Math.min(Math.max(ee[0],ee[2]),Math.max(ne[0],ne[2]));if(ge>De)return null;const je=Math.max(Math.min(ee[1],ee[3]),Math.min(ne[1],ne[3])),he=Math.min(Math.max(ee[1],ee[3]),Math.max(ne[1],ne[3]));return je>he?null:[ge,je,De,he]}static bezierBoundingBox(ee,ne,ge,De,je,he,oe,Se){const Ie=[],Be=[[],[]];let Ge,$e,qe,Me,Ye,it,Xe,Ze;for(let rt=0;rt<2;++rt){if(rt===0?($e=6*ee-12*ge+6*je,Ge=-3*ee+9*ge-9*je+3*oe,qe=3*ge-3*ee):($e=6*ne-12*De+6*he,Ge=-3*ne+9*De-9*he+3*Se,qe=3*De-3*ne),Math.abs(Ge)<1e-12){if(Math.abs($e)<1e-12)continue;Me=-qe/$e,0<Me&&Me<1&&Ie.push(Me);continue}Xe=$e*$e-4*qe*Ge,Ze=Math.sqrt(Xe),!(Xe<0)&&(Ye=(-$e+Ze)/(2*Ge),0<Ye&&Ye<1&&Ie.push(Ye),it=(-$e-Ze)/(2*Ge),0<it&&it<1&&Ie.push(it))}let ot=Ie.length,et;const ct=ot;for(;ot--;)Me=Ie[ot],et=1-Me,Be[0][ot]=et*et*et*ee+3*et*et*Me*ge+3*et*Me*Me*je+Me*Me*Me*oe,Be[1][ot]=et*et*et*ne+3*et*et*Me*De+3*et*Me*Me*he+Me*Me*Me*Se;return Be[0][ct]=ee,Be[1][ct]=ne,Be[0][ct+1]=oe,Be[1][ct+1]=Se,Be[0].length=Be[1].length=ct+2,[Math.min(...Be[0]),Math.min(...Be[1]),Math.max(...Be[0]),Math.max(...Be[1])]}}e.Util=_e;const Ve=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function Qe(de){if(de[0]>="ï"){let ne;if(de[0]==="þ"&&de[1]==="ÿ"?ne="utf-16be":de[0]==="ÿ"&&de[1]==="þ"?ne="utf-16le":de[0]==="ï"&&de[1]==="»"&&de[2]==="¿"&&(ne="utf-8"),ne)try{const ge=new TextDecoder(ne,{fatal:!0}),De=te(de);return ge.decode(De)}catch(ge){ce(`stringToPDFString: "${ge}".`)}}const ee=[];for(let ne=0,ge=de.length;ne<ge;ne++){const De=Ve[de.charCodeAt(ne)];ee.push(De?String.fromCharCode(De):de.charAt(ne))}return ee.join("")}function Oe(de){return de.replace(/([()\\\n\r])/g,ee=>ee===`
`?"\\n":ee==="\r"?"\\r":`\\${ee}`)}function Ee(de){return/^[\x00-\x7F]*$/.test(de)}function ae(de){const ee=["þÿ"];for(let ne=0,ge=de.length;ne<ge;ne++){const De=de.charCodeAt(ne);ee.push(String.fromCharCode(De>>8&255),String.fromCharCode(De&255))}return ee.join("")}function ve(de){return decodeURIComponent(escape(de))}function Le(de){return unescape(encodeURIComponent(de))}function Ke(de){return typeof de=="object"&&de!==null&&de.byteLength!==void 0}function ye(de,ee){if(de.length!==ee.length)return!1;for(let ne=0,ge=de.length;ne<ge;ne++)if(de[ne]!==ee[ne])return!1;return!0}function Pe(){let de=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Date;return[de.getUTCFullYear().toString(),(de.getUTCMonth()+1).toString().padStart(2,"0"),de.getUTCDate().toString().padStart(2,"0"),de.getUTCHours().toString().padStart(2,"0"),de.getUTCMinutes().toString().padStart(2,"0"),de.getUTCSeconds().toString().padStart(2,"0")].join("")}function Ne(){const de=Object.create(null);let ee=!1;return Object.defineProperty(de,"settled",{get(){return ee}}),de.promise=new Promise(function(ne,ge){de.resolve=function(De){ee=!0,ne(De)},de.reject=function(De){ee=!0,ge(De)}}),de}},(n,e,t)=>{var r=t(3);globalThis._pdfjsCompatibilityChecked||(globalThis._pdfjsCompatibilityChecked=!0,function(){globalThis.btoa||!r.isNodeJS||(globalThis.btoa=function(i){return Buffer.from(i,"binary").toString("base64")})}(),function(){globalThis.atob||!r.isNodeJS||(globalThis.atob=function(i){return Buffer.from(i,"base64").toString("binary")})}(),function(){globalThis.DOMMatrix||!r.isNodeJS||(globalThis.DOMMatrix=requireDommatrix())}(),function(){globalThis.ReadableStream||!r.isNodeJS||(globalThis.ReadableStream=requirePonyfill().ReadableStream)}(),function(){Array.prototype.at||t(4)}(),function(){Uint8Array.prototype.at||t(76)}(),function(){globalThis.structuredClone||t(86)}())},(n,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.isNodeJS=void 0;const t=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");e.isNodeJS=t},(n,e,t)=>{t(5);var r=t(75);n.exports=r("Array","at")},(n,e,t)=>{var r=t(6),a=t(41),i=t(65),c=t(63),l=t(70);r({target:"Array",proto:!0},{at:function(o){var s=a(this),f=i(s),u=c(o),p=u>=0?u:f+u;return p<0||p>=f?void 0:s[p]}}),l("at")},(n,e,t)=>{var r=t(7),a=t(8).f,i=t(45),c=t(49),l=t(39),h=t(57),o=t(69);n.exports=function(s,f){var u=s.target,p=s.global,v=s.stat,g,A,T,b,_,w;if(p?A=r:v?A=r[u]||l(u,{}):A=(r[u]||{}).prototype,A)for(T in f){if(_=f[T],s.dontCallGetSet?(w=a(A,T),b=w&&w.value):b=A[T],g=o(p?T:u+(v?".":"#")+T,s.forced),!g&&b!==void 0){if(typeof _==typeof b)continue;h(_,b)}(s.sham||b&&b.sham)&&i(_,"sham",!0),c(A,T,_,s)}}},n=>{var e=function(t){return t&&t.Math==Math&&t};n.exports=e(typeof globalThis=="object"&&globalThis)||e(typeof window=="object"&&window)||e(typeof self=="object"&&self)||e(typeof commonjsGlobal=="object"&&commonjsGlobal)||function(){return this}()||Function("return this")()},(n,e,t)=>{var r=t(9),a=t(11),i=t(13),c=t(14),l=t(15),h=t(20),o=t(40),s=t(43),f=Object.getOwnPropertyDescriptor;e.f=r?f:function(p,v){if(p=l(p),v=h(v),s)try{return f(p,v)}catch{}if(o(p,v))return c(!a(i.f,p,v),p[v])}},(n,e,t)=>{var r=t(10);n.exports=!r(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7})},n=>{n.exports=function(e){try{return!!e()}catch{return!0}}},(n,e,t)=>{var r=t(12),a=Function.prototype.call;n.exports=r?a.bind(a):function(){return a.apply(a,arguments)}},(n,e,t)=>{var r=t(10);n.exports=!r(function(){var a=(function(){}).bind();return typeof a!="function"||a.hasOwnProperty("prototype")})},(n,e)=>{var t={}.propertyIsEnumerable,r=Object.getOwnPropertyDescriptor,a=r&&!t.call({1:2},1);e.f=a?function(c){var l=r(this,c);return!!l&&l.enumerable}:t},n=>{n.exports=function(e,t){return{enumerable:!(e&1),configurable:!(e&2),writable:!(e&4),value:t}}},(n,e,t)=>{var r=t(16),a=t(19);n.exports=function(i){return r(a(i))}},(n,e,t)=>{var r=t(17),a=t(10),i=t(18),c=Object,l=r("".split);n.exports=a(function(){return!c("z").propertyIsEnumerable(0)})?function(h){return i(h)=="String"?l(h,""):c(h)}:c},(n,e,t)=>{var r=t(12),a=Function.prototype,i=a.bind,c=a.call,l=r&&i.bind(c,c);n.exports=r?function(h){return h&&l(h)}:function(h){return h&&function(){return c.apply(h,arguments)}}},(n,e,t)=>{var r=t(17),a=r({}.toString),i=r("".slice);n.exports=function(c){return i(a(c),8,-1)}},n=>{var e=TypeError;n.exports=function(t){if(t==null)throw e("Can't call method on "+t);return t}},(n,e,t)=>{var r=t(21),a=t(24);n.exports=function(i){var c=r(i,"string");return a(c)?c:c+""}},(n,e,t)=>{var r=t(11),a=t(22),i=t(24),c=t(31),l=t(34),h=t(35),o=TypeError,s=h("toPrimitive");n.exports=function(f,u){if(!a(f)||i(f))return f;var p=c(f,s),v;if(p){if(u===void 0&&(u="default"),v=r(p,f,u),!a(v)||i(v))return v;throw o("Can't convert object to primitive value")}return u===void 0&&(u="number"),l(f,u)}},(n,e,t)=>{var r=t(23);n.exports=function(a){return typeof a=="object"?a!==null:r(a)}},n=>{n.exports=function(e){return typeof e=="function"}},(n,e,t)=>{var r=t(25),a=t(23),i=t(26),c=t(27),l=Object;n.exports=c?function(h){return typeof h=="symbol"}:function(h){var o=r("Symbol");return a(o)&&i(o.prototype,l(h))}},(n,e,t)=>{var r=t(7),a=t(23),i=function(c){return a(c)?c:void 0};n.exports=function(c,l){return arguments.length<2?i(r[c]):r[c]&&r[c][l]}},(n,e,t)=>{var r=t(17);n.exports=r({}.isPrototypeOf)},(n,e,t)=>{var r=t(28);n.exports=r&&!Symbol.sham&&typeof Symbol.iterator=="symbol"},(n,e,t)=>{var r=t(29),a=t(10);n.exports=!!Object.getOwnPropertySymbols&&!a(function(){var i=Symbol();return!String(i)||!(Object(i)instanceof Symbol)||!Symbol.sham&&r&&r<41})},(n,e,t)=>{var r=t(7),a=t(30),i=r.process,c=r.Deno,l=i&&i.versions||c&&c.version,h=l&&l.v8,o,s;h&&(o=h.split("."),s=o[0]>0&&o[0]<4?1:+(o[0]+o[1])),!s&&a&&(o=a.match(/Edge\/(\d+)/),(!o||o[1]>=74)&&(o=a.match(/Chrome\/(\d+)/),o&&(s=+o[1]))),n.exports=s},(n,e,t)=>{var r=t(25);n.exports=r("navigator","userAgent")||""},(n,e,t)=>{var r=t(32);n.exports=function(a,i){var c=a[i];return c==null?void 0:r(c)}},(n,e,t)=>{var r=t(23),a=t(33),i=TypeError;n.exports=function(c){if(r(c))return c;throw i(a(c)+" is not a function")}},n=>{var e=String;n.exports=function(t){try{return e(t)}catch{return"Object"}}},(n,e,t)=>{var r=t(11),a=t(23),i=t(22),c=TypeError;n.exports=function(l,h){var o,s;if(h==="string"&&a(o=l.toString)&&!i(s=r(o,l))||a(o=l.valueOf)&&!i(s=r(o,l))||h!=="string"&&a(o=l.toString)&&!i(s=r(o,l)))return s;throw c("Can't convert object to primitive value")}},(n,e,t)=>{var r=t(7),a=t(36),i=t(40),c=t(42),l=t(28),h=t(27),o=a("wks"),s=r.Symbol,f=s&&s.for,u=h?s:s&&s.withoutSetter||c;n.exports=function(p){if(!i(o,p)||!(l||typeof o[p]=="string")){var v="Symbol."+p;l&&i(s,p)?o[p]=s[p]:h&&f?o[p]=f(v):o[p]=u(v)}return o[p]}},(n,e,t)=>{var r=t(37),a=t(38);(n.exports=function(i,c){return a[i]||(a[i]=c!==void 0?c:{})})("versions",[]).push({version:"3.24.1",mode:r?"pure":"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.24.1/LICENSE",source:"https://github.com/zloirock/core-js"})},n=>{n.exports=!1},(n,e,t)=>{var r=t(7),a=t(39),i="__core-js_shared__",c=r[i]||a(i,{});n.exports=c},(n,e,t)=>{var r=t(7),a=Object.defineProperty;n.exports=function(i,c){try{a(r,i,{value:c,configurable:!0,writable:!0})}catch{r[i]=c}return c}},(n,e,t)=>{var r=t(17),a=t(41),i=r({}.hasOwnProperty);n.exports=Object.hasOwn||function(l,h){return i(a(l),h)}},(n,e,t)=>{var r=t(19),a=Object;n.exports=function(i){return a(r(i))}},(n,e,t)=>{var r=t(17),a=0,i=Math.random(),c=r(1 .toString);n.exports=function(l){return"Symbol("+(l===void 0?"":l)+")_"+c(++a+i,36)}},(n,e,t)=>{var r=t(9),a=t(10),i=t(44);n.exports=!r&&!a(function(){return Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a!=7})},(n,e,t)=>{var r=t(7),a=t(22),i=r.document,c=a(i)&&a(i.createElement);n.exports=function(l){return c?i.createElement(l):{}}},(n,e,t)=>{var r=t(9),a=t(46),i=t(14);n.exports=r?function(c,l,h){return a.f(c,l,i(1,h))}:function(c,l,h){return c[l]=h,c}},(n,e,t)=>{var r=t(9),a=t(43),i=t(47),c=t(48),l=t(20),h=TypeError,o=Object.defineProperty,s=Object.getOwnPropertyDescriptor,f="enumerable",u="configurable",p="writable";e.f=r?i?function(g,A,T){if(c(g),A=l(A),c(T),typeof g=="function"&&A==="prototype"&&"value"in T&&p in T&&!T[p]){var b=s(g,A);b&&b[p]&&(g[A]=T.value,T={configurable:u in T?T[u]:b[u],enumerable:f in T?T[f]:b[f],writable:!1})}return o(g,A,T)}:o:function(g,A,T){if(c(g),A=l(A),c(T),a)try{return o(g,A,T)}catch{}if("get"in T||"set"in T)throw h("Accessors not supported");return"value"in T&&(g[A]=T.value),g}},(n,e,t)=>{var r=t(9),a=t(10);n.exports=r&&a(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42})},(n,e,t)=>{var r=t(22),a=String,i=TypeError;n.exports=function(c){if(r(c))return c;throw i(a(c)+" is not an object")}},(n,e,t)=>{var r=t(23),a=t(46),i=t(50),c=t(39);n.exports=function(l,h,o,s){s||(s={});var f=s.enumerable,u=s.name!==void 0?s.name:h;if(r(o)&&i(o,u,s),s.global)f?l[h]=o:c(h,o);else{try{s.unsafe?l[h]&&(f=!0):delete l[h]}catch{}f?l[h]=o:a.f(l,h,{value:o,enumerable:!1,configurable:!s.nonConfigurable,writable:!s.nonWritable})}return l}},(n,e,t)=>{var r=t(10),a=t(23),i=t(40),c=t(9),l=t(51).CONFIGURABLE,h=t(52),o=t(53),s=o.enforce,f=o.get,u=Object.defineProperty,p=c&&!r(function(){return u(function(){},"length",{value:8}).length!==8}),v=String(String).split("String"),g=n.exports=function(A,T,b){String(T).slice(0,7)==="Symbol("&&(T="["+String(T).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),b&&b.getter&&(T="get "+T),b&&b.setter&&(T="set "+T),(!i(A,"name")||l&&A.name!==T)&&(c?u(A,"name",{value:T,configurable:!0}):A.name=T),p&&b&&i(b,"arity")&&A.length!==b.arity&&u(A,"length",{value:b.arity});try{b&&i(b,"constructor")&&b.constructor?c&&u(A,"prototype",{writable:!1}):A.prototype&&(A.prototype=void 0)}catch{}var _=s(A);return i(_,"source")||(_.source=v.join(typeof T=="string"?T:"")),A};Function.prototype.toString=g(function(){return a(this)&&f(this).source||h(this)},"toString")},(n,e,t)=>{var r=t(9),a=t(40),i=Function.prototype,c=r&&Object.getOwnPropertyDescriptor,l=a(i,"name"),h=l&&(function(){}).name==="something",o=l&&(!r||r&&c(i,"name").configurable);n.exports={EXISTS:l,PROPER:h,CONFIGURABLE:o}},(n,e,t)=>{var r=t(17),a=t(23),i=t(38),c=r(Function.toString);a(i.inspectSource)||(i.inspectSource=function(l){return c(l)}),n.exports=i.inspectSource},(n,e,t)=>{var r=t(54),a=t(7),i=t(17),c=t(22),l=t(45),h=t(40),o=t(38),s=t(55),f=t(56),u="Object already initialized",p=a.TypeError,v=a.WeakMap,g,A,T,b=function(R){return T(R)?A(R):g(R,{})},_=function(R){return function(M){var F;if(!c(M)||(F=A(M)).type!==R)throw p("Incompatible receiver, "+R+" required");return F}};if(r||o.state){var w=o.state||(o.state=new v),m=i(w.get),S=i(w.has),C=i(w.set);g=function(R,M){if(S(w,R))throw new p(u);return M.facade=R,C(w,R,M),M},A=function(R){return m(w,R)||{}},T=function(R){return S(w,R)}}else{var x=s("state");f[x]=!0,g=function(R,M){if(h(R,x))throw new p(u);return M.facade=R,l(R,x,M),M},A=function(R){return h(R,x)?R[x]:{}},T=function(R){return h(R,x)}}n.exports={set:g,get:A,has:T,enforce:b,getterFor:_}},(n,e,t)=>{var r=t(7),a=t(23),i=t(52),c=r.WeakMap;n.exports=a(c)&&/native code/.test(i(c))},(n,e,t)=>{var r=t(36),a=t(42),i=r("keys");n.exports=function(c){return i[c]||(i[c]=a(c))}},n=>{n.exports={}},(n,e,t)=>{var r=t(40),a=t(58),i=t(8),c=t(46);n.exports=function(l,h,o){for(var s=a(h),f=c.f,u=i.f,p=0;p<s.length;p++){var v=s[p];!r(l,v)&&!(o&&r(o,v))&&f(l,v,u(h,v))}}},(n,e,t)=>{var r=t(25),a=t(17),i=t(59),c=t(68),l=t(48),h=a([].concat);n.exports=r("Reflect","ownKeys")||function(s){var f=i.f(l(s)),u=c.f;return u?h(f,u(s)):f}},(n,e,t)=>{var r=t(60),a=t(67),i=a.concat("length","prototype");e.f=Object.getOwnPropertyNames||function(l){return r(l,i)}},(n,e,t)=>{var r=t(17),a=t(40),i=t(15),c=t(61).indexOf,l=t(56),h=r([].push);n.exports=function(o,s){var f=i(o),u=0,p=[],v;for(v in f)!a(l,v)&&a(f,v)&&h(p,v);for(;s.length>u;)a(f,v=s[u++])&&(~c(p,v)||h(p,v));return p}},(n,e,t)=>{var r=t(15),a=t(62),i=t(65),c=function(l){return function(h,o,s){var f=r(h),u=i(f),p=a(s,u),v;if(l&&o!=o){for(;u>p;)if(v=f[p++],v!=v)return!0}else for(;u>p;p++)if((l||p in f)&&f[p]===o)return l||p||0;return!l&&-1}};n.exports={includes:c(!0),indexOf:c(!1)}},(n,e,t)=>{var r=t(63),a=Math.max,i=Math.min;n.exports=function(c,l){var h=r(c);return h<0?a(h+l,0):i(h,l)}},(n,e,t)=>{var r=t(64);n.exports=function(a){var i=+a;return i!==i||i===0?0:r(i)}},n=>{var e=Math.ceil,t=Math.floor;n.exports=Math.trunc||function(a){var i=+a;return(i>0?t:e)(i)}},(n,e,t)=>{var r=t(66);n.exports=function(a){return r(a.length)}},(n,e,t)=>{var r=t(63),a=Math.min;n.exports=function(i){return i>0?a(r(i),9007199254740991):0}},n=>{n.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},(n,e)=>{e.f=Object.getOwnPropertySymbols},(n,e,t)=>{var r=t(10),a=t(23),i=/#|\.prototype\./,c=function(f,u){var p=h[l(f)];return p==s?!0:p==o?!1:a(u)?r(u):!!u},l=c.normalize=function(f){return String(f).replace(i,".").toLowerCase()},h=c.data={},o=c.NATIVE="N",s=c.POLYFILL="P";n.exports=c},(n,e,t)=>{var r=t(35),a=t(71),i=t(46).f,c=r("unscopables"),l=Array.prototype;l[c]==null&&i(l,c,{configurable:!0,value:a(null)}),n.exports=function(h){l[c][h]=!0}},(n,e,t)=>{var r=t(48),a=t(72),i=t(67),c=t(56),l=t(74),h=t(44),o=t(55),s=">",f="<",u="prototype",p="script",v=o("IE_PROTO"),g=function(){},A=function(m){return f+p+s+m+f+"/"+p+s},T=function(m){m.write(A("")),m.close();var S=m.parentWindow.Object;return m=null,S},b=function(){var m=h("iframe"),S="java"+p+":",C;return m.style.display="none",l.appendChild(m),m.src=String(S),C=m.contentWindow.document,C.open(),C.write(A("document.F=Object")),C.close(),C.F},_,w=function(){try{_=new ActiveXObject("htmlfile")}catch{}w=typeof document<"u"?document.domain&&_?T(_):b():T(_);for(var m=i.length;m--;)delete w[u][i[m]];return w()};c[v]=!0,n.exports=Object.create||function(S,C){var x;return S!==null?(g[u]=r(S),x=new g,g[u]=null,x[v]=S):x=w(),C===void 0?x:a.f(x,C)}},(n,e,t)=>{var r=t(9),a=t(47),i=t(46),c=t(48),l=t(15),h=t(73);e.f=r&&!a?Object.defineProperties:function(s,f){c(s);for(var u=l(f),p=h(f),v=p.length,g=0,A;v>g;)i.f(s,A=p[g++],u[A]);return s}},(n,e,t)=>{var r=t(60),a=t(67);n.exports=Object.keys||function(c){return r(c,a)}},(n,e,t)=>{var r=t(25);n.exports=r("document","documentElement")},(n,e,t)=>{var r=t(7),a=t(17);n.exports=function(i,c){return a(r[i].prototype[c])}},(n,e,t)=>{t(77)},(n,e,t)=>{var r=t(78),a=t(65),i=t(63),c=r.aTypedArray,l=r.exportTypedArrayMethod;l("at",function(o){var s=c(this),f=a(s),u=i(o),p=u>=0?u:f+u;return p<0||p>=f?void 0:s[p]})},(n,e,t)=>{var r=t(79),a=t(9),i=t(7),c=t(23),l=t(22),h=t(40),o=t(80),s=t(33),f=t(45),u=t(49),p=t(46).f,v=t(26),g=t(82),A=t(84),T=t(35),b=t(42),_=t(53),w=_.enforce,m=_.get,S=i.Int8Array,C=S&&S.prototype,x=i.Uint8ClampedArray,R=x&&x.prototype,M=S&&g(S),F=C&&g(C),H=Object.prototype,V=i.TypeError,X=T("toStringTag"),K=b("TYPED_ARRAY_TAG"),q="TypedArrayConstructor",U=r&&!!A&&o(i.opera)!=="Opera",B=!1,N,Q,ce,pe={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Re={BigInt64Array:8,BigUint64Array:8},Y=function(L){if(!l(L))return!1;var j=o(L);return j==="DataView"||h(pe,j)||h(Re,j)},O=function(k){var L=g(k);if(l(L)){var j=m(L);return j&&h(j,q)?j[q]:O(L)}},D=function(k){if(!l(k))return!1;var L=o(k);return h(pe,L)||h(Re,L)},W=function(k){if(D(k))return k;throw V("Target is not a typed array")},G=function(k){if(c(k)&&(!A||v(M,k)))return k;throw V(s(k)+" is not a typed array constructor")},E=function(k,L,j,z){if(a){if(j)for(var Z in pe){var te=i[Z];if(te&&h(te.prototype,k))try{delete te.prototype[k]}catch{try{te.prototype[k]=L}catch{}}}(!F[k]||j)&&u(F,k,j?L:U&&C[k]||L,z)}},P=function(k,L,j){var z,Z;if(a){if(A){if(j){for(z in pe)if(Z=i[z],Z&&h(Z,k))try{delete Z[k]}catch{}}if(!M[k]||j)try{return u(M,k,j?L:U&&M[k]||L)}catch{}else return}for(z in pe)Z=i[z],Z&&(!Z[k]||j)&&u(Z,k,L)}};for(N in pe)Q=i[N],ce=Q&&Q.prototype,ce?w(ce)[q]=Q:U=!1;for(N in Re)Q=i[N],ce=Q&&Q.prototype,ce&&(w(ce)[q]=Q);if((!U||!c(M)||M===Function.prototype)&&(M=function(){throw V("Incorrect invocation")},U))for(N in pe)i[N]&&A(i[N],M);if((!U||!F||F===H)&&(F=M.prototype,U))for(N in pe)i[N]&&A(i[N].prototype,F);if(U&&g(R)!==F&&A(R,F),a&&!h(F,X)){B=!0,p(F,X,{get:function(){return l(this)?this[K]:void 0}});for(N in pe)i[N]&&f(i[N],K,N)}n.exports={NATIVE_ARRAY_BUFFER_VIEWS:U,TYPED_ARRAY_TAG:B&&K,aTypedArray:W,aTypedArrayConstructor:G,exportTypedArrayMethod:E,exportTypedArrayStaticMethod:P,getTypedArrayConstructor:O,isView:Y,isTypedArray:D,TypedArray:M,TypedArrayPrototype:F}},n=>{n.exports=typeof ArrayBuffer<"u"&&typeof DataView<"u"},(n,e,t)=>{var r=t(81),a=t(23),i=t(18),c=t(35),l=c("toStringTag"),h=Object,o=i(function(){return arguments}())=="Arguments",s=function(f,u){try{return f[u]}catch{}};n.exports=r?i:function(f){var u,p,v;return f===void 0?"Undefined":f===null?"Null":typeof(p=s(u=h(f),l))=="string"?p:o?i(u):(v=i(u))=="Object"&&a(u.callee)?"Arguments":v}},(n,e,t)=>{var r=t(35),a=r("toStringTag"),i={};i[a]="z",n.exports=String(i)==="[object z]"},(n,e,t)=>{var r=t(40),a=t(23),i=t(41),c=t(55),l=t(83),h=c("IE_PROTO"),o=Object,s=o.prototype;n.exports=l?o.getPrototypeOf:function(f){var u=i(f);if(r(u,h))return u[h];var p=u.constructor;return a(p)&&u instanceof p?p.prototype:u instanceof o?s:null}},(n,e,t)=>{var r=t(10);n.exports=!r(function(){function a(){}return a.prototype.constructor=null,Object.getPrototypeOf(new a)!==a.prototype})},(n,e,t)=>{var r=t(17),a=t(48),i=t(85);n.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var c=!1,l={},h;try{h=r(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set),h(l,[]),c=l instanceof Array}catch{}return function(s,f){return a(s),i(f),c?h(s,f):s.__proto__=f,s}}():void 0)},(n,e,t)=>{var r=t(23),a=String,i=TypeError;n.exports=function(c){if(typeof c=="object"||r(c))return c;throw i("Can't set "+a(c)+" as a prototype")}},(n,e,t)=>{t(87),t(93),t(95),t(117),t(119);var r=t(128);n.exports=r.structuredClone},(n,e,t)=>{var r=t(15),a=t(70),i=t(88),c=t(53),l=t(46).f,h=t(89),o=t(37),s=t(9),f="Array Iterator",u=c.set,p=c.getterFor(f);n.exports=h(Array,"Array",function(g,A){u(this,{type:f,target:r(g),index:0,kind:A})},function(){var g=p(this),A=g.target,T=g.kind,b=g.index++;return!A||b>=A.length?(g.target=void 0,{value:void 0,done:!0}):T=="keys"?{value:b,done:!1}:T=="values"?{value:A[b],done:!1}:{value:[b,A[b]],done:!1}},"values");var v=i.Arguments=i.Array;if(a("keys"),a("values"),a("entries"),!o&&s&&v.name!=="values")try{l(v,"name",{value:"values"})}catch{}},n=>{n.exports={}},(n,e,t)=>{var r=t(6),a=t(11),i=t(37),c=t(51),l=t(23),h=t(90),o=t(82),s=t(84),f=t(92),u=t(45),p=t(49),v=t(35),g=t(88),A=t(91),T=c.PROPER,b=c.CONFIGURABLE,_=A.IteratorPrototype,w=A.BUGGY_SAFARI_ITERATORS,m=v("iterator"),S="keys",C="values",x="entries",R=function(){return this};n.exports=function(M,F,H,V,X,K,q){h(H,F,V);var U=function(W){if(W===X&&pe)return pe;if(!w&&W in Q)return Q[W];switch(W){case S:return function(){return new H(this,W)};case C:return function(){return new H(this,W)};case x:return function(){return new H(this,W)}}return function(){return new H(this)}},B=F+" Iterator",N=!1,Q=M.prototype,ce=Q[m]||Q["@@iterator"]||X&&Q[X],pe=!w&&ce||U(X),Re=F=="Array"&&Q.entries||ce,Y,O,D;if(Re&&(Y=o(Re.call(new M)),Y!==Object.prototype&&Y.next&&(!i&&o(Y)!==_&&(s?s(Y,_):l(Y[m])||p(Y,m,R)),f(Y,B,!0,!0),i&&(g[B]=R))),T&&X==C&&ce&&ce.name!==C&&(!i&&b?u(Q,"name",C):(N=!0,pe=function(){return a(ce,this)})),X)if(O={values:U(C),keys:K?pe:U(S),entries:U(x)},q)for(D in O)(w||N||!(D in Q))&&p(Q,D,O[D]);else r({target:F,proto:!0,forced:w||N},O);return(!i||q)&&Q[m]!==pe&&p(Q,m,pe,{name:X}),g[F]=pe,O}},(n,e,t)=>{var r=t(91).IteratorPrototype,a=t(71),i=t(14),c=t(92),l=t(88),h=function(){return this};n.exports=function(o,s,f,u){var p=s+" Iterator";return o.prototype=a(r,{next:i(+!u,f)}),c(o,p,!1,!0),l[p]=h,o}},(n,e,t)=>{var r=t(10),a=t(23),i=t(71),c=t(82),l=t(49),h=t(35),o=t(37),s=h("iterator"),f=!1,u,p,v;[].keys&&(v=[].keys(),"next"in v?(p=c(c(v)),p!==Object.prototype&&(u=p)):f=!0);var g=u==null||r(function(){var A={};return u[s].call(A)!==A});g?u={}:o&&(u=i(u)),a(u[s])||l(u,s,function(){return this}),n.exports={IteratorPrototype:u,BUGGY_SAFARI_ITERATORS:f}},(n,e,t)=>{var r=t(46).f,a=t(40),i=t(35),c=i("toStringTag");n.exports=function(l,h,o){l&&!o&&(l=l.prototype),l&&!a(l,c)&&r(l,c,{configurable:!0,value:h})}},(n,e,t)=>{var r=t(81),a=t(49),i=t(94);r||a(Object.prototype,"toString",i,{unsafe:!0})},(n,e,t)=>{var r=t(81),a=t(80);n.exports=r?{}.toString:function(){return"[object "+a(this)+"]"}},(n,e,t)=>{t(96)},(n,e,t)=>{var r=t(97),a=t(114);r("Map",function(i){return function(){return i(this,arguments.length?arguments[0]:void 0)}},a)},(n,e,t)=>{var r=t(6),a=t(7),i=t(17),c=t(69),l=t(49),h=t(98),o=t(105),s=t(111),f=t(23),u=t(22),p=t(10),v=t(112),g=t(92),A=t(113);n.exports=function(T,b,_){var w=T.indexOf("Map")!==-1,m=T.indexOf("Weak")!==-1,S=w?"set":"add",C=a[T],x=C&&C.prototype,R=C,M={},F=function(B){var N=i(x[B]);l(x,B,B=="add"?function(ce){return N(this,ce===0?0:ce),this}:B=="delete"?function(Q){return m&&!u(Q)?!1:N(this,Q===0?0:Q)}:B=="get"?function(ce){return m&&!u(ce)?void 0:N(this,ce===0?0:ce)}:B=="has"?function(ce){return m&&!u(ce)?!1:N(this,ce===0?0:ce)}:function(ce,pe){return N(this,ce===0?0:ce,pe),this})},H=c(T,!f(C)||!(m||x.forEach&&!p(function(){new C().entries().next()})));if(H)R=_.getConstructor(b,T,w,S),h.enable();else if(c(T,!0)){var V=new R,X=V[S](m?{}:-0,1)!=V,K=p(function(){V.has(1)}),q=v(function(B){new C(B)}),U=!m&&p(function(){for(var B=new C,N=5;N--;)B[S](N,N);return!B.has(-0)});q||(R=b(function(B,N){s(B,x);var Q=A(new C,B,R);return N!=null&&o(N,Q[S],{that:Q,AS_ENTRIES:w}),Q}),R.prototype=x,x.constructor=R),(K||U)&&(F("delete"),F("has"),w&&F("get")),(U||X)&&F(S),m&&x.clear&&delete x.clear}return M[T]=R,r({global:!0,constructor:!0,forced:R!=C},M),g(R,T),m||_.setStrong(R,T,w),R}},(n,e,t)=>{var r=t(6),a=t(17),i=t(56),c=t(22),l=t(40),h=t(46).f,o=t(59),s=t(99),f=t(102),u=t(42),p=t(104),v=!1,g=u("meta"),A=0,T=function(C){h(C,g,{value:{objectID:"O"+A++,weakData:{}}})},b=function(C,x){if(!c(C))return typeof C=="symbol"?C:(typeof C=="string"?"S":"P")+C;if(!l(C,g)){if(!f(C))return"F";if(!x)return"E";T(C)}return C[g].objectID},_=function(C,x){if(!l(C,g)){if(!f(C))return!0;if(!x)return!1;T(C)}return C[g].weakData},w=function(C){return p&&v&&f(C)&&!l(C,g)&&T(C),C},m=function(){S.enable=function(){},v=!0;var C=o.f,x=a([].splice),R={};R[g]=1,C(R).length&&(o.f=function(M){for(var F=C(M),H=0,V=F.length;H<V;H++)if(F[H]===g){x(F,H,1);break}return F},r({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:s.f}))},S=n.exports={enable:m,fastKey:b,getWeakData:_,onFreeze:w};i[g]=!0},(n,e,t)=>{var r=t(18),a=t(15),i=t(59).f,c=t(100),l=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],h=function(o){try{return i(o)}catch{return c(l)}};n.exports.f=function(s){return l&&r(s)=="Window"?h(s):i(a(s))}},(n,e,t)=>{var r=t(62),a=t(65),i=t(101),c=Array,l=Math.max;n.exports=function(h,o,s){for(var f=a(h),u=r(o,f),p=r(s===void 0?f:s,f),v=c(l(p-u,0)),g=0;u<p;u++,g++)i(v,g,h[u]);return v.length=g,v}},(n,e,t)=>{var r=t(20),a=t(46),i=t(14);n.exports=function(c,l,h){var o=r(l);o in c?a.f(c,o,i(0,h)):c[o]=h}},(n,e,t)=>{var r=t(10),a=t(22),i=t(18),c=t(103),l=Object.isExtensible,h=r(function(){});n.exports=h||c?function(s){return!a(s)||c&&i(s)=="ArrayBuffer"?!1:l?l(s):!0}:l},(n,e,t)=>{var r=t(10);n.exports=r(function(){if(typeof ArrayBuffer=="function"){var a=new ArrayBuffer(8);Object.isExtensible(a)&&Object.defineProperty(a,"a",{value:8})}})},(n,e,t)=>{var r=t(10);n.exports=!r(function(){return Object.isExtensible(Object.preventExtensions({}))})},(n,e,t)=>{var r=t(106),a=t(11),i=t(48),c=t(33),l=t(107),h=t(65),o=t(26),s=t(108),f=t(109),u=t(110),p=TypeError,v=function(A,T){this.stopped=A,this.result=T},g=v.prototype;n.exports=function(A,T,b){var _=b&&b.that,w=!!(b&&b.AS_ENTRIES),m=!!(b&&b.IS_RECORD),S=!!(b&&b.IS_ITERATOR),C=!!(b&&b.INTERRUPTED),x=r(T,_),R,M,F,H,V,X,K,q=function(B){return R&&u(R,"normal",B),new v(!0,B)},U=function(B){return w?(i(B),C?x(B[0],B[1],q):x(B[0],B[1])):C?x(B,q):x(B)};if(m)R=A.iterator;else if(S)R=A;else{if(M=f(A),!M)throw p(c(A)+" is not iterable");if(l(M)){for(F=0,H=h(A);H>F;F++)if(V=U(A[F]),V&&o(g,V))return V;return new v(!1)}R=s(A,M)}for(X=m?A.next:R.next;!(K=a(X,R)).done;){try{V=U(K.value)}catch(B){u(R,"throw",B)}if(typeof V=="object"&&V&&o(g,V))return V}return new v(!1)}},(n,e,t)=>{var r=t(17),a=t(32),i=t(12),c=r(r.bind);n.exports=function(l,h){return a(l),h===void 0?l:i?c(l,h):function(){return l.apply(h,arguments)}}},(n,e,t)=>{var r=t(35),a=t(88),i=r("iterator"),c=Array.prototype;n.exports=function(l){return l!==void 0&&(a.Array===l||c[i]===l)}},(n,e,t)=>{var r=t(11),a=t(32),i=t(48),c=t(33),l=t(109),h=TypeError;n.exports=function(o,s){var f=arguments.length<2?l(o):s;if(a(f))return i(r(f,o));throw h(c(o)+" is not iterable")}},(n,e,t)=>{var r=t(80),a=t(31),i=t(88),c=t(35),l=c("iterator");n.exports=function(h){if(h!=null)return a(h,l)||a(h,"@@iterator")||i[r(h)]}},(n,e,t)=>{var r=t(11),a=t(48),i=t(31);n.exports=function(c,l,h){var o,s;a(c);try{if(o=i(c,"return"),!o){if(l==="throw")throw h;return h}o=r(o,c)}catch(f){s=!0,o=f}if(l==="throw")throw h;if(s)throw o;return a(o),h}},(n,e,t)=>{var r=t(26),a=TypeError;n.exports=function(i,c){if(r(c,i))return i;throw a("Incorrect invocation")}},(n,e,t)=>{var r=t(35),a=r("iterator"),i=!1;try{var c=0,l={next:function(){return{done:!!c++}},return:function(){i=!0}};l[a]=function(){return this},Array.from(l,function(){throw 2})}catch{}n.exports=function(h,o){if(!o&&!i)return!1;var s=!1;try{var f={};f[a]=function(){return{next:function(){return{done:s=!0}}}},h(f)}catch{}return s}},(n,e,t)=>{var r=t(23),a=t(22),i=t(84);n.exports=function(c,l,h){var o,s;return i&&r(o=l.constructor)&&o!==h&&a(s=o.prototype)&&s!==h.prototype&&i(c,s),c}},(n,e,t)=>{var r=t(46).f,a=t(71),i=t(115),c=t(106),l=t(111),h=t(105),o=t(89),s=t(116),f=t(9),u=t(98).fastKey,p=t(53),v=p.set,g=p.getterFor;n.exports={getConstructor:function(A,T,b,_){var w=A(function(R,M){l(R,m),v(R,{type:T,index:a(null),first:void 0,last:void 0,size:0}),f||(R.size=0),M!=null&&h(M,R[_],{that:R,AS_ENTRIES:b})}),m=w.prototype,S=g(T),C=function(R,M,F){var H=S(R),V=x(R,M),X,K;return V?V.value=F:(H.last=V={index:K=u(M,!0),key:M,value:F,previous:X=H.last,next:void 0,removed:!1},H.first||(H.first=V),X&&(X.next=V),f?H.size++:R.size++,K!=="F"&&(H.index[K]=V)),R},x=function(R,M){var F=S(R),H=u(M),V;if(H!=="F")return F.index[H];for(V=F.first;V;V=V.next)if(V.key==M)return V};return i(m,{clear:function(){for(var M=this,F=S(M),H=F.index,V=F.first;V;)V.removed=!0,V.previous&&(V.previous=V.previous.next=void 0),delete H[V.index],V=V.next;F.first=F.last=void 0,f?F.size=0:M.size=0},delete:function(R){var M=this,F=S(M),H=x(M,R);if(H){var V=H.next,X=H.previous;delete F.index[H.index],H.removed=!0,X&&(X.next=V),V&&(V.previous=X),F.first==H&&(F.first=V),F.last==H&&(F.last=X),f?F.size--:M.size--}return!!H},forEach:function(M){for(var F=S(this),H=c(M,arguments.length>1?arguments[1]:void 0),V;V=V?V.next:F.first;)for(H(V.value,V.key,this);V&&V.removed;)V=V.previous},has:function(M){return!!x(this,M)}}),i(m,b?{get:function(M){var F=x(this,M);return F&&F.value},set:function(M,F){return C(this,M===0?0:M,F)}}:{add:function(M){return C(this,M=M===0?0:M,M)}}),f&&r(m,"size",{get:function(){return S(this).size}}),w},setStrong:function(A,T,b){var _=T+" Iterator",w=g(T),m=g(_);o(A,T,function(S,C){v(this,{type:_,target:S,state:w(S),kind:C,last:void 0})},function(){for(var S=m(this),C=S.kind,x=S.last;x&&x.removed;)x=x.previous;return!S.target||!(S.last=x=x?x.next:S.state.first)?(S.target=void 0,{value:void 0,done:!0}):C=="keys"?{value:x.key,done:!1}:C=="values"?{value:x.value,done:!1}:{value:[x.key,x.value],done:!1}},b?"entries":"values",!b,!0),s(T)}}},(n,e,t)=>{var r=t(49);n.exports=function(a,i,c){for(var l in i)r(a,l,i[l],c);return a}},(n,e,t)=>{var r=t(25),a=t(46),i=t(35),c=t(9),l=i("species");n.exports=function(h){var o=r(h),s=a.f;c&&o&&!o[l]&&s(o,l,{configurable:!0,get:function(){return this}})}},(n,e,t)=>{t(118)},(n,e,t)=>{var r=t(97),a=t(114);r("Set",function(i){return function(){return i(this,arguments.length?arguments[0]:void 0)}},a)},(n,e,t)=>{var r=t(37),a=t(6),i=t(7),c=t(25),l=t(17),h=t(10),o=t(42),s=t(23),f=t(120),u=t(22),p=t(24),v=t(105),g=t(48),A=t(80),T=t(40),b=t(101),_=t(45),w=t(65),m=t(121),S=t(122),C=t(124),x=t(29),R=t(125),M=t(126),F=t(127),H=i.Object,V=i.Date,X=i.Error,K=i.EvalError,q=i.RangeError,U=i.ReferenceError,B=i.SyntaxError,N=i.TypeError,Q=i.URIError,ce=i.PerformanceMark,pe=i.WebAssembly,Re=pe&&pe.CompileError||X,Y=pe&&pe.LinkError||X,O=pe&&pe.RuntimeError||X,D=c("DOMException"),W=c("Set"),G=c("Map"),E=G.prototype,P=l(E.has),k=l(E.get),L=l(E.set),j=l(W.prototype.add),z=c("Object","keys"),Z=l([].push),te=l((!0).valueOf),ie=l(1 .valueOf),le=l("".valueOf),se=l(V.prototype.getTime),ue=o("structuredClone"),me="DataCloneError",be="Transferring",we=function(ye){return!h(function(){var Pe=new i.Set([7]),Ne=ye(Pe),de=ye(H(7));return Ne==Pe||!Ne.has(7)||typeof de!="object"||de!=7})&&ye},Ae=function(ye,Pe){return!h(function(){var Ne=new Pe,de=ye({a:Ne,b:Ne});return!(de&&de.a===de.b&&de.a instanceof Pe&&de.a.stack===Ne.stack)})},Fe=function(ye){return!h(function(){var Pe=ye(new i.AggregateError([1],ue,{cause:3}));return Pe.name!="AggregateError"||Pe.errors[0]!=1||Pe.message!=ue||Pe.cause!=3})},_e=i.structuredClone,Ve=r||!Ae(_e,X)||!Ae(_e,D)||!Fe(_e),Qe=!_e&&we(function(ye){return new ce(ue,{detail:ye}).detail}),Oe=we(_e)||Qe,Ee=function(ye){throw new D("Uncloneable type: "+ye,me)},ae=function(ye,Pe){throw new D((Pe||"Cloning")+" of "+ye+" cannot be properly polyfilled in this engine",me)},ve=function(ye,Pe){if(p(ye)&&Ee("Symbol"),!u(ye))return ye;if(Pe){if(P(Pe,ye))return k(Pe,ye)}else Pe=new G;var Ne=A(ye),de=!1,ee,ne,ge,De,je,he,oe,Se,Ie,Be;switch(Ne){case"Array":ge=[],de=!0;break;case"Object":ge={},de=!0;break;case"Map":ge=new G,de=!0;break;case"Set":ge=new W,de=!0;break;case"RegExp":ge=new RegExp(ye.source,S(ye));break;case"Error":switch(ne=ye.name,ne){case"AggregateError":ge=c("AggregateError")([]);break;case"EvalError":ge=K();break;case"RangeError":ge=q();break;case"ReferenceError":ge=U();break;case"SyntaxError":ge=B();break;case"TypeError":ge=N();break;case"URIError":ge=Q();break;case"CompileError":ge=Re();break;case"LinkError":ge=Y();break;case"RuntimeError":ge=O();break;default:ge=X()}de=!0;break;case"DOMException":ge=new D(ye.message,ye.name),de=!0;break;case"DataView":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":ee=i[Ne],u(ee)||ae(Ne),ge=new ee(ve(ye.buffer,Pe),ye.byteOffset,Ne==="DataView"?ye.byteLength:ye.length);break;case"DOMQuad":try{ge=new DOMQuad(ve(ye.p1,Pe),ve(ye.p2,Pe),ve(ye.p3,Pe),ve(ye.p4,Pe))}catch{Oe?ge=Oe(ye):ae(Ne)}break;case"FileList":if(ee=i.DataTransfer,f(ee)){for(De=new ee,je=0,he=w(ye);je<he;je++)De.items.add(ve(ye[je],Pe));ge=De.files}else Oe?ge=Oe(ye):ae(Ne);break;case"ImageData":try{ge=new ImageData(ve(ye.data,Pe),ye.width,ye.height,{colorSpace:ye.colorSpace})}catch{Oe?ge=Oe(ye):ae(Ne)}break;default:if(Oe)ge=Oe(ye);else switch(Ne){case"BigInt":ge=H(ye.valueOf());break;case"Boolean":ge=H(te(ye));break;case"Number":ge=H(ie(ye));break;case"String":ge=H(le(ye));break;case"Date":ge=new V(se(ye));break;case"ArrayBuffer":ee=i.DataView,!ee&&typeof ye.slice!="function"&&ae(Ne);try{if(typeof ye.slice=="function")ge=ye.slice(0);else for(he=ye.byteLength,ge=new ArrayBuffer(he),Ie=new ee(ye),Be=new ee(ge),je=0;je<he;je++)Be.setUint8(je,Ie.getUint8(je))}catch{throw new D("ArrayBuffer is detached",me)}break;case"SharedArrayBuffer":ge=ye;break;case"Blob":try{ge=ye.slice(0,ye.size,ye.type)}catch{ae(Ne)}break;case"DOMPoint":case"DOMPointReadOnly":ee=i[Ne];try{ge=ee.fromPoint?ee.fromPoint(ye):new ee(ye.x,ye.y,ye.z,ye.w)}catch{ae(Ne)}break;case"DOMRect":case"DOMRectReadOnly":ee=i[Ne];try{ge=ee.fromRect?ee.fromRect(ye):new ee(ye.x,ye.y,ye.width,ye.height)}catch{ae(Ne)}break;case"DOMMatrix":case"DOMMatrixReadOnly":ee=i[Ne];try{ge=ee.fromMatrix?ee.fromMatrix(ye):new ee(ye)}catch{ae(Ne)}break;case"AudioData":case"VideoFrame":s(ye.clone)||ae(Ne);try{ge=ye.clone()}catch{Ee(Ne)}break;case"File":try{ge=new File([ye],ye.name,ye)}catch{ae(Ne)}break;case"CryptoKey":case"GPUCompilationMessage":case"GPUCompilationInfo":case"ImageBitmap":case"RTCCertificate":case"WebAssembly.Module":ae(Ne);default:Ee(Ne)}}if(L(Pe,ye,ge),de)switch(Ne){case"Array":case"Object":for(oe=z(ye),je=0,he=w(oe);je<he;je++)Se=oe[je],b(ge,Se,ve(ye[Se],Pe));break;case"Map":ye.forEach(function(Ge,$e){L(ge,ve($e,Pe),ve(Ge,Pe))});break;case"Set":ye.forEach(function(Ge){j(ge,ve(Ge,Pe))});break;case"Error":_(ge,"message",ve(ye.message,Pe)),T(ye,"cause")&&_(ge,"cause",ve(ye.cause,Pe)),ne=="AggregateError"&&(ge.errors=ve(ye.errors,Pe));case"DOMException":C&&_(ge,"stack",ve(ye.stack,Pe))}return ge},Le=_e&&!h(function(){if(M&&x>92||F&&x>94||R&&x>97)return!1;var ye=new ArrayBuffer(8),Pe=_e(ye,{transfer:[ye]});return ye.byteLength!=0||Pe.byteLength!=8}),Ke=function(ye,Pe){if(!u(ye))throw N("Transfer option cannot be converted to a sequence");var Ne=[];v(ye,function(Ie){Z(Ne,g(Ie))});var de=0,ee=w(Ne),ne,ge,De,je,he,oe,Se;if(Le)for(je=_e(Ne,{transfer:Ne});de<ee;)L(Pe,Ne[de],je[de++]);else for(;de<ee;){if(ne=Ne[de++],P(Pe,ne))throw new D("Duplicate transferable",me);switch(ge=A(ne),ge){case"ImageBitmap":De=i.OffscreenCanvas,f(De)||ae(ge,be);try{oe=new De(ne.width,ne.height),Se=oe.getContext("bitmaprenderer"),Se.transferFromImageBitmap(ne),he=oe.transferToImageBitmap()}catch{}break;case"AudioData":case"VideoFrame":(!s(ne.clone)||!s(ne.close))&&ae(ge,be);try{he=ne.clone(),ne.close()}catch{}break;case"ArrayBuffer":case"MessagePort":case"OffscreenCanvas":case"ReadableStream":case"TransformStream":case"WritableStream":ae(ge,be)}if(he===void 0)throw new D("This object cannot be transferred: "+ge,me);L(Pe,ne,he)}};a({global:!0,enumerable:!0,sham:!Le,forced:Ve},{structuredClone:function(Pe){var Ne=m(arguments.length,1)>1&&arguments[1]!=null?g(arguments[1]):void 0,de=Ne?Ne.transfer:void 0,ee;return de!==void 0&&(ee=new G,Ke(de,ee)),ve(Pe,ee)}})},(n,e,t)=>{var r=t(17),a=t(10),i=t(23),c=t(80),l=t(25),h=t(52),o=function(){},s=[],f=l("Reflect","construct"),u=/^\s*(?:class|function)\b/,p=r(u.exec),v=!u.exec(o),g=function(b){if(!i(b))return!1;try{return f(o,s,b),!0}catch{return!1}},A=function(b){if(!i(b))return!1;switch(c(b)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return v||!!p(u,h(b))}catch{return!0}};A.sham=!0,n.exports=!f||a(function(){var T;return g(g.call)||!g(Object)||!g(function(){T=!0})||T})?A:g},n=>{var e=TypeError;n.exports=function(t,r){if(t<r)throw e("Not enough arguments");return t}},(n,e,t)=>{var r=t(11),a=t(40),i=t(26),c=t(123),l=RegExp.prototype;n.exports=function(h){var o=h.flags;return o===void 0&&!("flags"in l)&&!a(h,"flags")&&i(l,h)?r(c,h):o}},(n,e,t)=>{var r=t(48);n.exports=function(){var a=r(this),i="";return a.hasIndices&&(i+="d"),a.global&&(i+="g"),a.ignoreCase&&(i+="i"),a.multiline&&(i+="m"),a.dotAll&&(i+="s"),a.unicode&&(i+="u"),a.unicodeSets&&(i+="v"),a.sticky&&(i+="y"),i}},(n,e,t)=>{var r=t(10),a=t(14);n.exports=!r(function(){var i=Error("a");return"stack"in i?(Object.defineProperty(i,"stack",a(1,7)),i.stack!==7):!0})},(n,e,t)=>{var r=t(126),a=t(127);n.exports=!r&&!a&&typeof window=="object"&&typeof document=="object"},n=>{n.exports=typeof Deno=="object"&&Deno&&typeof Deno.version=="object"},(n,e,t)=>{var r=t(18),a=t(7);n.exports=r(a.process)=="process"},(n,e,t)=>{var r=t(7);n.exports=r},(__unused_webpack_module,exports,__w_pdfjs_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.build=exports.RenderTask=exports.PDFWorkerUtil=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDocumentLoadingTask=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultStandardFontDataFactory=exports.DefaultCanvasFactory=exports.DefaultCMapReaderFactory=void 0,exports.getDocument=getDocument,exports.setPDFNetworkStreamFactory=setPDFNetworkStreamFactory,exports.version=void 0;var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(130),_display_utils=__w_pdfjs_require__(133),_font_loader=__w_pdfjs_require__(136),_canvas=__w_pdfjs_require__(137),_worker_options=__w_pdfjs_require__(140),_is_node=__w_pdfjs_require__(3),_message_handler=__w_pdfjs_require__(141),_metadata=__w_pdfjs_require__(142),_optional_content_config=__w_pdfjs_require__(143),_transport_stream=__w_pdfjs_require__(144),_xfa_text=__w_pdfjs_require__(145);function _classPrivateMethodInitSpec(n,e){_checkPrivateRedeclaration(n,e),e.add(n)}function _classPrivateMethodGet(n,e,t){if(!e.has(n))throw new TypeError("attempted to get private field on non-instance");return t}function _classPrivateFieldInitSpec(n,e,t){_checkPrivateRedeclaration(n,e),e.set(n,t)}function _checkPrivateRedeclaration(n,e){if(e.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")}function _classPrivateFieldSet(n,e,t){var r=_classExtractFieldDescriptor(n,e,"set");return _classApplyDescriptorSet(n,r,t),t}function _classPrivateFieldGet(n,e){var t=_classExtractFieldDescriptor(n,e,"get");return _classApplyDescriptorGet(n,t)}function _classExtractFieldDescriptor(n,e,t){if(!e.has(n))throw new TypeError("attempted to "+t+" private field on non-instance");return e.get(n)}function _classStaticPrivateFieldSpecSet(n,e,t,r){return _classCheckPrivateStaticAccess(n,e),_classCheckPrivateStaticFieldDescriptor(t,"set"),_classApplyDescriptorSet(n,t,r),r}function _classApplyDescriptorSet(n,e,t){if(e.set)e.set.call(n,t);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=t}}function _classStaticPrivateFieldSpecGet(n,e,t){return _classCheckPrivateStaticAccess(n,e),_classCheckPrivateStaticFieldDescriptor(t,"get"),_classApplyDescriptorGet(n,t)}function _classCheckPrivateStaticFieldDescriptor(n,e){if(n===void 0)throw new TypeError("attempted to "+e+" private static field before its declaration")}function _classCheckPrivateStaticAccess(n,e){if(n!==e)throw new TypeError("Private static access of wrong provenance")}function _classApplyDescriptorGet(n,e){return e.get?e.get.call(n):e.value}const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100;let DefaultCanvasFactory=_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;let DefaultCMapReaderFactory=_display_utils.DOMCMapReaderFactory;exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;let DefaultStandardFontDataFactory=_display_utils.DOMStandardFontDataFactory;if(exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory,_is_node.isNodeJS){const{NodeCanvasFactory:n,NodeCMapReaderFactory:e,NodeStandardFontDataFactory:t}=__w_pdfjs_require__(146);exports.DefaultCanvasFactory=DefaultCanvasFactory=n,exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory=e,exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory=t}let createPDFNetworkStream;function setPDFNetworkStreamFactory(n){createPDFNetworkStream=n}function getDocument(n){const e=new PDFDocumentLoadingTask;let t;if(typeof n=="string"||n instanceof URL)t={url:n};else if((0,_util.isArrayBuffer)(n))t={data:n};else if(n instanceof PDFDataRangeTransport)t={range:n};else{if(typeof n!="object")throw new Error("Invalid parameter in getDocument, need either string, URL, TypedArray, or parameter object.");if(!n.url&&!n.data&&!n.range)throw new Error("Invalid parameter object: need either .data, .range or .url");t=n}const r=Object.create(null);let a=null,i=null;for(const l in t){const h=t[l];switch(l){case"url":if(typeof window<"u")try{r[l]=new URL(h,window.location).href;continue}catch(o){(0,_util.warn)(`Cannot create valid URL: "${o}".`)}else if(typeof h=="string"||h instanceof URL){r[l]=h.toString();continue}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.");case"range":a=h;continue;case"worker":i=h;continue;case"data":if(_is_node.isNodeJS&&typeof Buffer<"u"&&h instanceof Buffer)r[l]=new Uint8Array(h);else{if(h instanceof Uint8Array)break;if(typeof h=="string")r[l]=(0,_util.stringToBytes)(h);else if(typeof h=="object"&&h!==null&&!isNaN(h.length))r[l]=new Uint8Array(h);else if((0,_util.isArrayBuffer)(h))r[l]=new Uint8Array(h);else throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}continue}r[l]=h}if(r.CMapReaderFactory=r.CMapReaderFactory||DefaultCMapReaderFactory,r.StandardFontDataFactory=r.StandardFontDataFactory||DefaultStandardFontDataFactory,r.ignoreErrors=r.stopAtErrors!==!0,r.fontExtraProperties=r.fontExtraProperties===!0,r.pdfBug=r.pdfBug===!0,r.enableXfa=r.enableXfa===!0,(!Number.isInteger(r.rangeChunkSize)||r.rangeChunkSize<1)&&(r.rangeChunkSize=DEFAULT_RANGE_CHUNK_SIZE),(typeof r.docBaseUrl!="string"||(0,_display_utils.isDataScheme)(r.docBaseUrl))&&(r.docBaseUrl=null),(!Number.isInteger(r.maxImageSize)||r.maxImageSize<-1)&&(r.maxImageSize=-1),typeof r.cMapUrl!="string"&&(r.cMapUrl=null),typeof r.standardFontDataUrl!="string"&&(r.standardFontDataUrl=null),typeof r.useWorkerFetch!="boolean"&&(r.useWorkerFetch=r.CMapReaderFactory===_display_utils.DOMCMapReaderFactory&&r.StandardFontDataFactory===_display_utils.DOMStandardFontDataFactory),typeof r.isEvalSupported!="boolean"&&(r.isEvalSupported=!0),typeof r.disableFontFace!="boolean"&&(r.disableFontFace=_is_node.isNodeJS),typeof r.useSystemFonts!="boolean"&&(r.useSystemFonts=!_is_node.isNodeJS&&!r.disableFontFace),(typeof r.ownerDocument!="object"||r.ownerDocument===null)&&(r.ownerDocument=globalThis.document),typeof r.disableRange!="boolean"&&(r.disableRange=!1),typeof r.disableStream!="boolean"&&(r.disableStream=!1),typeof r.disableAutoFetch!="boolean"&&(r.disableAutoFetch=!1),(0,_util.setVerbosityLevel)(r.verbosity),!i){const l={verbosity:r.verbosity,port:_worker_options.GlobalWorkerOptions.workerPort};i=l.port?PDFWorker.fromPort(l):new PDFWorker(l),e._worker=i}const c=e.docId;return i.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");const l=_fetchDocument(i,r,a,c),h=new Promise(function(o){let s;a?s=new _transport_stream.PDFDataTransportStream({length:r.length,initialData:r.initialData,progressiveDone:r.progressiveDone,contentDispositionFilename:r.contentDispositionFilename,disableRange:r.disableRange,disableStream:r.disableStream},a):r.data||(s=createPDFNetworkStream({url:r.url,length:r.length,httpHeaders:r.httpHeaders,withCredentials:r.withCredentials,rangeChunkSize:r.rangeChunkSize,disableRange:r.disableRange,disableStream:r.disableStream})),o(s)});return Promise.all([l,h]).then(function(o){let[s,f]=o;if(e.destroyed)throw new Error("Loading aborted");const u=new _message_handler.MessageHandler(c,s,i.port),p=new WorkerTransport(u,e,f,r);e._transport=p,u.send("Ready",null)})}).catch(e._capability.reject),e}async function _fetchDocument(n,e,t,r){if(n.destroyed)throw new Error("Worker was destroyed");t&&(e.length=t.length,e.initialData=t.initialData,e.progressiveDone=t.progressiveDone,e.contentDispositionFilename=t.contentDispositionFilename);const a=await n.messageHandler.sendWithPromise("GetDocRequest",{docId:r,apiVersion:"2.16.105",source:{data:e.data,url:e.url,password:e.password,disableAutoFetch:e.disableAutoFetch,rangeChunkSize:e.rangeChunkSize,length:e.length},maxImageSize:e.maxImageSize,disableFontFace:e.disableFontFace,docBaseUrl:e.docBaseUrl,ignoreErrors:e.ignoreErrors,isEvalSupported:e.isEvalSupported,fontExtraProperties:e.fontExtraProperties,enableXfa:e.enableXfa,useSystemFonts:e.useSystemFonts,cMapUrl:e.useWorkerFetch?e.cMapUrl:null,standardFontDataUrl:e.useWorkerFetch?e.standardFontDataUrl:null});if(e.data&&(e.data=null),n.destroyed)throw new Error("Worker was destroyed");return a}class PDFDocumentLoadingTask{constructor(){var e,t;this._capability=(0,_util.createPromiseCapability)(),this._transport=null,this._worker=null,this.docId=`d${_classStaticPrivateFieldSpecSet(PDFDocumentLoadingTask,PDFDocumentLoadingTask,_docId,(e=_classStaticPrivateFieldSpecGet(PDFDocumentLoadingTask,PDFDocumentLoadingTask,_docId),t=e++,e)),t}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null,this.onUnsupportedFeature=null}get promise(){return this._capability.promise}async destroy(){var e;this.destroyed=!0,await((e=this._transport)===null||e===void 0?void 0:e.destroy()),this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}}exports.PDFDocumentLoadingTask=PDFDocumentLoadingTask;var _docId={writable:!0,value:0};class PDFDataRangeTransport{constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;this.length=e,this.initialData=t,this.progressiveDone=r,this.contentDispositionFilename=a,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=(0,_util.createPromiseCapability)()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(const r of this._rangeListeners)r(e,t)}onDataProgress(e,t){this._readyCapability.promise.then(()=>{for(const r of this._progressListeners)r(e,t)})}onDataProgressiveRead(e){this._readyCapability.promise.then(()=>{for(const t of this._progressiveReadListeners)t(e)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const e of this._progressiveDoneListeners)e()})}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(e,t){this._pdfInfo=e,this._transport=t,Object.defineProperty(this,"fingerprint",{get(){return(0,_display_utils.deprecated)("`PDFDocumentProxy.fingerprint`, please use `PDFDocumentProxy.fingerprints` instead."),this.fingerprints[0]}}),Object.defineProperty(this,"getStats",{value:async()=>((0,_display_utils.deprecated)("`PDFDocumentProxy.getStats`, please use the `PDFDocumentProxy.stats`-getter instead."),this.stats||{streamTypes:{},fontTypes:{}})})}get annotationStorage(){return this._transport.annotationStorage}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get stats(){return this._transport.stats}get isPureXfa(){return!!this._transport._htmlForXfa}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJavaScript(){return this._transport.getJavaScript()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}saveDocument(){return this._transport.annotationStorage.size<=0&&(0,_display_utils.deprecated)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead."),this._transport.saveDocument()}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(e,t,r,a){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;this._pageIndex=e,this._pageInfo=t,this._ownerDocument=a,this._transport=r,this._stats=i?new _display_utils.StatTimer:null,this._pdfBug=i,this.commonObjs=r.commonObjs,this.objs=new PDFObjects,this._bitmaps=new Set,this.cleanupAfterRender=!1,this.pendingCleanup=!1,this._intentStates=new Map,this._annotationPromises=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport(){let{scale:e,rotation:t=this.rotate,offsetX:r=0,offsetY:a=0,dontFlip:i=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return new _display_utils.PageViewport({viewBox:this.view,scale:e,rotation:t,offsetX:r,offsetY:a,dontFlip:i})}getAnnotations(){let{intent:e="display"}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this._transport.getRenderingIntent(e);let r=this._annotationPromises.get(t.cacheKey);return r||(r=this._transport.getAnnotations(this._pageIndex,t.renderingIntent),this._annotationPromises.set(t.cacheKey,r),r=r.then(a=>{for(const i of a)i.titleObj!==void 0&&Object.defineProperty(i,"title",{get(){return(0,_display_utils.deprecated)("`title`-property on annotation, please use `titleObj` instead."),i.titleObj.str}}),i.contentsObj!==void 0&&Object.defineProperty(i,"contents",{get(){return(0,_display_utils.deprecated)("`contents`-property on annotation, please use `contentsObj` instead."),i.contentsObj.str}});return a})),r}getJSActions(){return this._jsActionsPromise||(this._jsActionsPromise=this._transport.getPageJSActions(this._pageIndex))}async getXfa(){var e;return((e=this._transport._htmlForXfa)===null||e===void 0?void 0:e.children[this._pageIndex])||null}render(e){var t,r,a;let{canvasContext:i,viewport:c,intent:l="display",annotationMode:h=_util.AnnotationMode.ENABLE,transform:o=null,imageLayer:s=null,canvasFactory:f=null,background:u=null,optionalContentConfigPromise:p=null,annotationCanvasMap:v=null,pageColors:g=null,printAnnotationStorage:A=null}=e;((t=arguments[0])===null||t===void 0?void 0:t.renderInteractiveForms)!==void 0&&((0,_display_utils.deprecated)("render no longer accepts the `renderInteractiveForms`-option, please use the `annotationMode`-option instead."),arguments[0].renderInteractiveForms===!0&&h===_util.AnnotationMode.ENABLE&&(h=_util.AnnotationMode.ENABLE_FORMS)),((r=arguments[0])===null||r===void 0?void 0:r.includeAnnotationStorage)!==void 0&&((0,_display_utils.deprecated)("render no longer accepts the `includeAnnotationStorage`-option, please use the `annotationMode`-option instead."),arguments[0].includeAnnotationStorage===!0&&h===_util.AnnotationMode.ENABLE&&(h=_util.AnnotationMode.ENABLE_STORAGE)),this._stats&&this._stats.time("Overall");const T=this._transport.getRenderingIntent(l,h,A);this.pendingCleanup=!1,p||(p=this._transport.getOptionalContentConfig());let b=this._intentStates.get(T.cacheKey);b||(b=Object.create(null),this._intentStates.set(T.cacheKey,b)),b.streamReaderCancelTimeout&&(clearTimeout(b.streamReaderCancelTimeout),b.streamReaderCancelTimeout=null);const _=f||new DefaultCanvasFactory({ownerDocument:this._ownerDocument}),w=!!(T.renderingIntent&_util.RenderingIntentFlag.PRINT);b.displayReadyCapability||(b.displayReadyCapability=(0,_util.createPromiseCapability)(),b.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats&&this._stats.time("Page Request"),this._pumpOperatorList(T));const m=x=>{b.renderTasks.delete(S),(this.cleanupAfterRender||w)&&(this.pendingCleanup=!0),this._tryCleanup(),x?(S.capability.reject(x),this._abortOperatorList({intentState:b,reason:x instanceof Error?x:new Error(x)})):S.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"))},S=new InternalRenderTask({callback:m,params:{canvasContext:i,viewport:c,transform:o,imageLayer:s,background:u},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:v,operatorList:b.operatorList,pageIndex:this._pageIndex,canvasFactory:_,useRequestAnimationFrame:!w,pdfBug:this._pdfBug,pageColors:g});((a=b).renderTasks||(a.renderTasks=new Set)).add(S);const C=S.task;return Promise.all([b.displayReadyCapability.promise,p]).then(x=>{let[R,M]=x;if(this.pendingCleanup){m();return}this._stats&&this._stats.time("Rendering"),S.initializeGraphics({transparency:R,optionalContentConfig:M}),S.operatorListChanged()}).catch(m),C}getOperatorList(){let{intent:e="display",annotationMode:t=_util.AnnotationMode.ENABLE,printAnnotationStorage:r=null}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};function a(){c.operatorList.lastChunk&&(c.opListReadCapability.resolve(c.operatorList),c.renderTasks.delete(l))}const i=this._transport.getRenderingIntent(e,t,r,!0);let c=this._intentStates.get(i.cacheKey);c||(c=Object.create(null),this._intentStates.set(i.cacheKey,c));let l;if(!c.opListReadCapability){var h;l=Object.create(null),l.operatorListChanged=a,c.opListReadCapability=(0,_util.createPromiseCapability)(),((h=c).renderTasks||(h.renderTasks=new Set)).add(l),c.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats&&this._stats.time("Page Request"),this._pumpOperatorList(i)}return c.opListReadCapability.promise}streamTextContent(){let{disableCombineTextItems:e=!1,includeMarkedContent:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,combineTextItems:e!==!0,includeMarkedContent:t===!0},{highWaterMark:100,size(a){return a.items.length}})}getTextContent(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._transport._htmlForXfa)return this.getXfa().then(r=>_xfa_text.XfaText.textContent(r));const t=this.streamTextContent(e);return new Promise(function(r,a){function i(){c.read().then(function(h){let{value:o,done:s}=h;if(s){r(l);return}Object.assign(l.styles,o.styles),l.items.push(...o.items),i()},a)}const c=t.getReader(),l={items:[],styles:Object.create(null)};i()})}getStructTree(){return this._structTreePromise||(this._structTreePromise=this._transport.getStructTree(this._pageIndex))}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const r of t.renderTasks)e.push(r.completed),r.cancel();this.objs.clear();for(const t of this._bitmaps)t.close();return this._bitmaps.clear(),this._annotationPromises.clear(),this._jsActionsPromise=null,this._structTreePromise=null,this.pendingCleanup=!1,Promise.all(e)}cleanup(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return this.pendingCleanup=!0,this._tryCleanup(e)}_tryCleanup(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!this.pendingCleanup)return!1;for(const{renderTasks:t,operatorList:r}of this._intentStates.values())if(t.size>0||!r.lastChunk)return!1;this._intentStates.clear(),this.objs.clear(),this._annotationPromises.clear(),this._jsActionsPromise=null,this._structTreePromise=null,e&&this._stats&&(this._stats=new _display_utils.StatTimer);for(const t of this._bitmaps)t.close();return this._bitmaps.clear(),this.pendingCleanup=!1,!0}_startRenderPage(e,t){const r=this._intentStates.get(t);r&&(this._stats&&this._stats.timeEnd("Page Request"),r.displayReadyCapability&&r.displayReadyCapability.resolve(e))}_renderPageChunk(e,t){for(let r=0,a=e.length;r<a;r++)t.operatorList.fnArray.push(e.fnArray[r]),t.operatorList.argsArray.push(e.argsArray[r]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const r of t.renderTasks)r.operatorListChanged();e.lastChunk&&this._tryCleanup()}_pumpOperatorList(e){let{renderingIntent:t,cacheKey:r,annotationStorageMap:a}=e;const c=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:r,annotationStorage:a}).getReader(),l=this._intentStates.get(r);l.streamReader=c;const h=()=>{c.read().then(o=>{let{value:s,done:f}=o;if(f){l.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(s,l),h())},o=>{if(l.streamReader=null,!this._transport.destroyed){if(l.operatorList){l.operatorList.lastChunk=!0;for(const s of l.renderTasks)s.operatorListChanged();this._tryCleanup()}if(l.displayReadyCapability)l.displayReadyCapability.reject(o);else if(l.opListReadCapability)l.opListReadCapability.reject(o);else throw o}})};h()}_abortOperatorList(e){let{intentState:t,reason:r,force:a=!1}=e;if(t.streamReader){if(!a){if(t.renderTasks.size>0)return;if(r instanceof _display_utils.RenderingCancelledException){t.streamReaderCancelTimeout=setTimeout(()=>{this._abortOperatorList({intentState:t,reason:r,force:!0}),t.streamReaderCancelTimeout=null},RENDERING_CANCELLED_TIMEOUT);return}}if(t.streamReader.cancel(new _util.AbortException(r.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(const[i,c]of this._intentStates)if(c===t){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}}exports.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(){this._listeners=[],this._deferred=Promise.resolve()}postMessage(e,t){const r={data:structuredClone(e,t)};this._deferred.then(()=>{for(const a of this._listeners)a.call(this,r)})}addEventListener(e,t){this._listeners.push(t)}removeEventListener(e,t){const r=this._listeners.indexOf(t);this._listeners.splice(r,1)}terminate(){this._listeners.length=0}}exports.LoopbackPort=LoopbackPort;const PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports.PDFWorkerUtil=PDFWorkerUtil;{if(_is_node.isNodeJS&&typeof commonjsRequire=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){var _document,_document$currentScri;const n=(_document=document)===null||_document===void 0||(_document$currentScri=_document.currentScript)===null||_document$currentScri===void 0?void 0:_document$currentScri.src;n&&(PDFWorkerUtil.fallbackWorkerSrc=n.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(n,e){let t;try{if(t=new URL(n),!t.origin||t.origin==="null")return!1}catch{return!1}const r=new URL(e,t);return t.origin===r.origin},PDFWorkerUtil.createCDNWrapper=function(n){const e=`importScripts("${n}");`;return URL.createObjectURL(new Blob([e]))}}class PDFWorker{constructor(){let{name:n=null,port:e=null,verbosity:t=(0,_util.getVerbosityLevel)()}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(e&&_classStaticPrivateFieldSpecGet(PDFWorker,PDFWorker,_workerPorts).has(e))throw new Error("Cannot use more than one PDFWorker per port.");if(this.name=n,this.destroyed=!1,this.verbosity=t,this._readyCapability=(0,_util.createPromiseCapability)(),this._port=null,this._webWorker=null,this._messageHandler=null,e){_classStaticPrivateFieldSpecGet(PDFWorker,PDFWorker,_workerPorts).set(e,this),this._initializeFromPort(e);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(n){this._port=n,this._messageHandler=new _message_handler.MessageHandler("main","worker",n),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve()}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:n}=PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,n)||(n=PDFWorkerUtil.createCDNWrapper(new URL(n,window.location).href));const e=new Worker(n),t=new _message_handler.MessageHandler("main","worker",e),r=()=>{e.removeEventListener("error",a),t.destroy(),e.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},a=()=>{this._webWorker||r()};e.addEventListener("error",a),t.on("test",c=>{if(e.removeEventListener("error",a),this.destroyed){r();return}c?(this._messageHandler=t,this._port=e,this._webWorker=e,this._readyCapability.resolve(),t.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),t.destroy(),e.terminate())}),t.on("ready",c=>{if(e.removeEventListener("error",a),this.destroyed){r();return}try{i()}catch{this._setupFakeWorker()}});const i=()=>{const c=new Uint8Array;t.send("test",c,[c.buffer])};i();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),PDFWorker._setupFakeWorkerGlobal.then(n=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const e=new LoopbackPort;this._port=e;const t=`fake${PDFWorkerUtil.fakeWorkerId++}`,r=new _message_handler.MessageHandler(t+"_worker",t,e);n.setup(r,e);const a=new _message_handler.MessageHandler(t,t+"_worker",e);this._messageHandler=a,this._readyCapability.resolve(),a.send("configure",{verbosity:this.verbosity})}).catch(n=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${n.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),_classStaticPrivateFieldSpecGet(PDFWorker,PDFWorker,_workerPorts).delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(n){if(!(n!=null&&n.port))throw new Error("PDFWorker.fromPort - invalid method signature.");return _classStaticPrivateFieldSpecGet(this,PDFWorker,_workerPorts).has(n.port)?_classStaticPrivateFieldSpecGet(this,PDFWorker,_workerPorts).get(n.port):new PDFWorker(n)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _is_node.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){try{var n;return((n=globalThis.pdfjsWorker)===null||n===void 0?void 0:n.WorkerMessageHandler)||null}catch{return null}}static get _setupFakeWorkerGlobal(){const loader=async()=>{const mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_is_node.isNodeJS&&typeof commonjsRequire=="function"){const worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}}exports.PDFWorker=PDFWorker;var _workerPorts={value:new WeakMap};PDFWorker.getWorkerSrc=function(){return(0,_display_utils.deprecated)("`PDFWorker.getWorkerSrc()`, please use `PDFWorker.workerSrc` instead."),this.workerSrc};var _docStats=new WeakMap,_pageCache=new WeakMap,_pagePromises=new WeakMap,_metadataPromise=new WeakMap;class WorkerTransport{constructor(e,t,r,a){_classPrivateFieldInitSpec(this,_docStats,{writable:!0,value:null}),_classPrivateFieldInitSpec(this,_pageCache,{writable:!0,value:new Map}),_classPrivateFieldInitSpec(this,_pagePromises,{writable:!0,value:new Map}),_classPrivateFieldInitSpec(this,_metadataPromise,{writable:!0,value:null}),this.messageHandler=e,this.loadingTask=t,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({docId:t.docId,onUnsupportedFeature:this._onUnsupportedFeature.bind(this),ownerDocument:a.ownerDocument,styleElement:a.styleElement}),this._params=a,a.useWorkerFetch||(this.CMapReaderFactory=new a.CMapReaderFactory({baseUrl:a.cMapUrl,isCompressed:a.cMapPacked}),this.StandardFontDataFactory=new a.StandardFontDataFactory({baseUrl:a.standardFontDataUrl})),this.destroyed=!1,this.destroyCapability=null,this._passwordCapability=null,this._networkStream=r,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=(0,_util.createPromiseCapability)(),this.setupMessageHandler()}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}get stats(){return _classPrivateFieldGet(this,_docStats)}getRenderingIntent(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_util.AnnotationMode.ENABLE,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=_util.RenderingIntentFlag.DISPLAY,c=null;switch(e){case"any":i=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":i=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${e}`)}switch(t){case _util.AnnotationMode.DISABLE:i+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:i+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:i+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,c=(i&_util.RenderingIntentFlag.PRINT&&r instanceof _annotation_storage.PrintAnnotationStorage?r:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${t}`)}return a&&(i+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:i,cacheKey:`${i}_${_annotation_storage.AnnotationStorage.getHash(c)}`,annotationStorageMap:c}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=(0,_util.createPromiseCapability)(),this._passwordCapability&&this._passwordCapability.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const r of _classPrivateFieldGet(this,_pageCache).values())e.push(r._destroy());_classPrivateFieldGet(this,_pageCache).clear(),_classPrivateFieldGet(this,_pagePromises).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),_classPrivateFieldSet(this,_metadataPromise,null),this._getFieldObjectsPromise=null,this._hasJSActionsPromise=null,this._networkStream&&this._networkStream.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(r,a)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=i=>{this._lastProgress={loaded:i.loaded,total:i.total}},a.onPull=()=>{this._fullReader.read().then(function(i){let{value:c,done:l}=i;if(l){a.close();return}(0,_util.assert)((0,_util.isArrayBuffer)(c),"GetReader - expected an ArrayBuffer."),a.enqueue(new Uint8Array(c),1,[c])}).catch(i=>{a.error(i)})},a.onCancel=i=>{this._fullReader.cancel(i),a.ready.catch(c=>{if(!this.destroyed)throw c})}}),e.on("ReaderHeadersReady",r=>{const a=(0,_util.createPromiseCapability)(),i=this._fullReader;return i.headersReady.then(()=>{if(!i.isStreamingSupported||!i.isRangeSupported){if(this._lastProgress){var c;(c=t.onProgress)===null||c===void 0||c.call(t,this._lastProgress)}i.onProgress=l=>{var h;(h=t.onProgress)===null||h===void 0||h.call(t,{loaded:l.loaded,total:l.total})}}a.resolve({isStreamingSupported:i.isStreamingSupported,isRangeSupported:i.isRangeSupported,contentLength:i.contentLength})},a.reject),a.promise}),e.on("GetRangeReader",(r,a)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const i=this._networkStream.getRangeReader(r.begin,r.end);if(!i){a.close();return}a.onPull=()=>{i.read().then(function(c){let{value:l,done:h}=c;if(h){a.close();return}(0,_util.assert)((0,_util.isArrayBuffer)(l),"GetRangeReader - expected an ArrayBuffer."),a.enqueue(new Uint8Array(l),1,[l])}).catch(c=>{a.error(c)})},a.onCancel=c=>{i.cancel(c),a.ready.catch(l=>{if(!this.destroyed)throw l})}}),e.on("GetDoc",r=>{let{pdfInfo:a}=r;this._numPages=a.numPages,this._htmlForXfa=a.htmlForXfa,delete a.htmlForXfa,t._capability.resolve(new PDFDocumentProxy(a,this))}),e.on("DocException",function(r){let a;switch(r.name){case"PasswordException":a=new _util.PasswordException(r.message,r.code);break;case"InvalidPDFException":a=new _util.InvalidPDFException(r.message);break;case"MissingPDFException":a=new _util.MissingPDFException(r.message);break;case"UnexpectedResponseException":a=new _util.UnexpectedResponseException(r.message,r.status);break;case"UnknownErrorException":a=new _util.UnknownErrorException(r.message,r.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}t._capability.reject(a)}),e.on("PasswordRequest",r=>{if(this._passwordCapability=(0,_util.createPromiseCapability)(),t.onPassword){const a=i=>{i instanceof Error?this._passwordCapability.reject(i):this._passwordCapability.resolve({password:i})};try{t.onPassword(a,r.code)}catch(i){this._passwordCapability.reject(i)}}else this._passwordCapability.reject(new _util.PasswordException(r.message,r.code));return this._passwordCapability.promise}),e.on("DataLoaded",r=>{var a;(a=t.onProgress)===null||a===void 0||a.call(t,{loaded:r.length,total:r.length}),this.downloadInfoCapability.resolve(r)}),e.on("StartRenderPage",r=>{if(this.destroyed)return;_classPrivateFieldGet(this,_pageCache).get(r.pageIndex)._startRenderPage(r.transparency,r.cacheKey)}),e.on("commonobj",r=>{var a;let[i,c,l]=r;if(!this.destroyed&&!this.commonObjs.has(i))switch(c){case"Font":const h=this._params;if("error"in l){const f=l.error;(0,_util.warn)(`Error during font loading: ${f}`),this.commonObjs.resolve(i,f);break}let o=null;h.pdfBug&&(a=globalThis.FontInspector)!==null&&a!==void 0&&a.enabled&&(o={registerFont(f,u){globalThis.FontInspector.fontAdded(f,u)}});const s=new _font_loader.FontFaceObject(l,{isEvalSupported:h.isEvalSupported,disableFontFace:h.disableFontFace,ignoreErrors:h.ignoreErrors,onUnsupportedFeature:this._onUnsupportedFeature.bind(this),fontRegistry:o});this.fontLoader.bind(s).catch(f=>e.sendWithPromise("FontFallback",{id:i})).finally(()=>{!h.fontExtraProperties&&s.data&&(s.data=null),this.commonObjs.resolve(i,s)});break;case"FontPath":case"Image":this.commonObjs.resolve(i,l);break;default:throw new Error(`Got unknown common object type ${c}`)}}),e.on("obj",r=>{let[a,i,c,l]=r;if(this.destroyed)return;const h=_classPrivateFieldGet(this,_pageCache).get(i);if(!h.objs.has(a))switch(c){case"Image":h.objs.resolve(a,l);const s=8e6;if(l){let f;if(l.bitmap){const{bitmap:u,width:p,height:v}=l;f=p*v*4,h._bitmaps.add(u)}else{var o;f=((o=l.data)===null||o===void 0?void 0:o.length)||0}f>s&&(h.cleanupAfterRender=!0)}break;case"Pattern":h.objs.resolve(a,l);break;default:throw new Error(`Got unknown object type ${c}`)}}),e.on("DocProgress",r=>{var a;this.destroyed||(a=t.onProgress)===null||a===void 0||a.call(t,{loaded:r.loaded,total:r.total})}),e.on("DocStats",r=>{this.destroyed||_classPrivateFieldSet(this,_docStats,Object.freeze({streamTypes:Object.freeze(r.streamTypes),fontTypes:Object.freeze(r.fontTypes)}))}),e.on("UnsupportedFeature",this._onUnsupportedFeature.bind(this)),e.on("FetchBuiltInCMap",r=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.CMapReaderFactory?this.CMapReaderFactory.fetch(r):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),e.on("FetchStandardFontData",r=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.StandardFontDataFactory?this.StandardFontDataFactory.fetch(r):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}_onUnsupportedFeature(e){var t,r;let{featureId:a}=e;this.destroyed||(t=(r=this.loadingTask).onUnsupportedFeature)===null||t===void 0||t.call(r,a)}getData(){return this.messageHandler.sendWithPromise("GetData",null)}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,r=_classPrivateFieldGet(this,_pagePromises).get(t);if(r)return r;const a=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(i=>{if(this.destroyed)throw new Error("Transport destroyed");const c=new PDFPageProxy(t,i,this,this._params.ownerDocument,this._params.pdfBug);return _classPrivateFieldGet(this,_pageCache).set(t,c),c});return _classPrivateFieldGet(this,_pagePromises).set(t,a),a}getPageIndex(e){return typeof e!="object"||e===null||!Number.isInteger(e.num)||e.num<0||!Number.isInteger(e.gen)||e.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen})}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}saveDocument(){var e,t;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:this.annotationStorage.serializable,filename:(e=(t=this._fullReader)===null||t===void 0?void 0:t.filename)!==null&&e!==void 0?e:null}).finally(()=>{this.annotationStorage.resetModified()})}getFieldObjects(){return this._getFieldObjectsPromise||(this._getFieldObjectsPromise=this.messageHandler.sendWithPromise("GetFieldObjects",null))}hasJSActions(){return this._hasJSActionsPromise||(this._hasJSActionsPromise=this.messageHandler.sendWithPromise("HasJSActions",null))}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getJavaScript(){return this.messageHandler.sendWithPromise("GetJavaScript",null)}getDocJSActions(){return this.messageHandler.sendWithPromise("GetDocJSActions",null)}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(e=>new _optional_content_config.OptionalContentConfig(e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){return _classPrivateFieldGet(this,_metadataPromise)||_classPrivateFieldSet(this,_metadataPromise,this.messageHandler.sendWithPromise("GetMetadata",null).then(e=>{var t,r,a,i;return{info:e[0],metadata:e[1]?new _metadata.Metadata(e[1]):null,contentDispositionFilename:(t=(r=this._fullReader)===null||r===void 0?void 0:r.filename)!==null&&t!==void 0?t:null,contentLength:(a=(i=this._fullReader)===null||i===void 0?void 0:i.contentLength)!==null&&a!==void 0?a:null}}))}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(await this.messageHandler.sendWithPromise("Cleanup",null),!this.destroyed){for(const t of _classPrivateFieldGet(this,_pageCache).values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),_classPrivateFieldSet(this,_metadataPromise,null),this._getFieldObjectsPromise=null,this._hasJSActionsPromise=null}}get loadingParams(){const e=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:e.disableAutoFetch,enableXfa:e.enableXfa})}}var _objs=new WeakMap,_ensureObj=new WeakSet;class PDFObjects{constructor(){_classPrivateMethodInitSpec(this,_ensureObj),_classPrivateFieldInitSpec(this,_objs,{writable:!0,value:Object.create(null)})}get(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(t){const a=_classPrivateMethodGet(this,_ensureObj,_ensureObj2).call(this,e);return a.capability.promise.then(()=>t(a.data)),null}const r=_classPrivateFieldGet(this,_objs)[e];if(!(r!=null&&r.capability.settled))throw new Error(`Requesting object that isn't resolved yet ${e}.`);return r.data}has(e){const t=_classPrivateFieldGet(this,_objs)[e];return(t==null?void 0:t.capability.settled)||!1}resolve(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const r=_classPrivateMethodGet(this,_ensureObj,_ensureObj2).call(this,e);r.data=t,r.capability.resolve()}clear(){_classPrivateFieldSet(this,_objs,Object.create(null))}}function _ensureObj2(n){const e=_classPrivateFieldGet(this,_objs)[n];return e||(_classPrivateFieldGet(this,_objs)[n]={capability:(0,_util.createPromiseCapability)(),data:null})}var _internalRenderTask=new WeakMap;class RenderTask{constructor(e){_classPrivateFieldInitSpec(this,_internalRenderTask,{writable:!0,value:null}),_classPrivateFieldSet(this,_internalRenderTask,e),this.onContinue=null}get promise(){return _classPrivateFieldGet(this,_internalRenderTask).capability.promise}cancel(){_classPrivateFieldGet(this,_internalRenderTask).cancel()}get separateAnnots(){const{separateAnnots:e}=_classPrivateFieldGet(this,_internalRenderTask).operatorList;if(!e)return!1;const{annotationCanvasMap:t}=_classPrivateFieldGet(this,_internalRenderTask);return e.form||e.canvas&&(t==null?void 0:t.size)>0}}exports.RenderTask=RenderTask;class InternalRenderTask{constructor(e){let{callback:t,params:r,objs:a,commonObjs:i,annotationCanvasMap:c,operatorList:l,pageIndex:h,canvasFactory:o,useRequestAnimationFrame:s=!1,pdfBug:f=!1,pageColors:u=null}=e;this.callback=t,this.params=r,this.objs=a,this.commonObjs=i,this.annotationCanvasMap=c,this.operatorListIdx=null,this.operatorList=l,this._pageIndex=h,this.canvasFactory=o,this._pdfBug=f,this.pageColors=u,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=s===!0&&typeof window<"u",this.cancelled=!1,this.capability=(0,_util.createPromiseCapability)(),this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=r.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics(e){var t;let{transparency:r=!1,optionalContentConfig:a}=e;if(this.cancelled)return;if(this._canvas){if(_classStaticPrivateFieldSpecGet(InternalRenderTask,InternalRenderTask,_canvasInUse).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");_classStaticPrivateFieldSpecGet(InternalRenderTask,InternalRenderTask,_canvasInUse).add(this._canvas)}this._pdfBug&&(t=globalThis.StepperManager)!==null&&t!==void 0&&t.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:i,viewport:c,transform:l,imageLayer:h,background:o}=this.params;this.gfx=new _canvas.CanvasGraphics(i,this.commonObjs,this.objs,this.canvasFactory,h,a,this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:l,viewport:c,transparency:r,background:o}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback&&this.graphicsReadyCallback()}cancel(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;this.running=!1,this.cancelled=!0,this.gfx&&this.gfx.endDrawing(),this._canvas&&_classStaticPrivateFieldSpecGet(InternalRenderTask,InternalRenderTask,_canvasInUse).delete(this._canvas),this.callback(e||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,"canvas"))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}this.stepper&&this.stepper.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),this._canvas&&_classStaticPrivateFieldSpecGet(InternalRenderTask,InternalRenderTask,_canvasInUse).delete(this._canvas),this.callback())))}}var _canvasInUse={value:new WeakSet};const version="2.16.105";exports.version=version;const build="172ccdbe5";exports.build=build},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PrintAnnotationStorage=e.AnnotationStorage=void 0;var r=t(1),a=t(131),i=t(135);function c(w,m,S){p(w,m),m.set(w,S)}function l(w,m){var S=s(w,m,"get");return h(w,S)}function h(w,m){return m.get?m.get.call(w):m.value}function o(w,m,S){var C=s(w,m,"set");return f(w,C,S),S}function s(w,m,S){if(!m.has(w))throw new TypeError("attempted to "+S+" private field on non-instance");return m.get(w)}function f(w,m,S){if(m.set)m.set.call(w,S);else{if(!m.writable)throw new TypeError("attempted to set read only private field");m.value=S}}function u(w,m){p(w,m),m.add(w)}function p(w,m){if(m.has(w))throw new TypeError("Cannot initialize the same private elements twice on an object")}function v(w,m,S){if(!m.has(w))throw new TypeError("attempted to get private field on non-instance");return S}var g=new WeakSet;class A{constructor(){u(this,g),this._storage=new Map,this._modified=!1,this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(m,S){const C=this._storage.get(m);return C===void 0?S:Object.assign(S,C)}getRawValue(m){return this._storage.get(m)}remove(m){if(this._storage.delete(m),this._storage.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const S of this._storage.values())if(S instanceof a.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(m,S){const C=this._storage.get(m);let x=!1;if(C!==void 0)for(const[R,M]of Object.entries(S))C[R]!==M&&(x=!0,C[R]=M);else x=!0,this._storage.set(m,S);x&&v(this,g,T).call(this),S instanceof a.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(S.constructor._type)}has(m){return this._storage.has(m)}getAll(){return this._storage.size>0?(0,r.objectFromMap)(this._storage):null}get size(){return this._storage.size}resetModified(){this._modified&&(this._modified=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new _(this)}get serializable(){if(this._storage.size===0)return null;const m=new Map;for(const[S,C]of this._storage){const x=C instanceof a.AnnotationEditor?C.serialize():C;x&&m.set(S,x)}return m}static getHash(m){if(!m)return"";const S=new i.MurmurHash3_64;for(const[C,x]of m)S.update(`${C}:${JSON.stringify(x)}`);return S.hexdigest()}}e.AnnotationStorage=A;function T(){this._modified||(this._modified=!0,typeof this.onSetModified=="function"&&this.onSetModified())}var b=new WeakMap;class _ extends A{constructor(m){super(),c(this,b,{writable:!0,value:null}),o(this,b,structuredClone(m.serializable))}get print(){(0,r.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return l(this,b)}}e.PrintAnnotationStorage=_},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AnnotationEditor=void 0;var r=t(132),a=t(1);function i(w,m,S){return m in w?Object.defineProperty(w,m,{value:S,enumerable:!0,configurable:!0,writable:!0}):w[m]=S,w}function c(w,m,S){l(w,m),m.set(w,S)}function l(w,m){if(m.has(w))throw new TypeError("Cannot initialize the same private elements twice on an object")}function h(w,m,S){var C=f(w,m,"set");return o(w,C,S),S}function o(w,m,S){if(m.set)m.set.call(w,S);else{if(!m.writable)throw new TypeError("attempted to set read only private field");m.value=S}}function s(w,m){var S=f(w,m,"get");return u(w,S)}function f(w,m,S){if(!m.has(w))throw new TypeError("attempted to "+S+" private field on non-instance");return m.get(w)}function u(w,m){return m.get?m.get.call(w):m.value}var p=new WeakMap,v=new WeakMap,g=new WeakMap,A=new WeakMap,T=new WeakMap,b=new WeakMap;class _{constructor(m){c(this,p,{writable:!0,value:this.focusin.bind(this)}),c(this,v,{writable:!0,value:this.focusout.bind(this)}),c(this,g,{writable:!0,value:!1}),c(this,A,{writable:!0,value:!1}),c(this,T,{writable:!0,value:!1}),c(this,b,{writable:!0,value:_._zIndex++}),this.constructor===_&&(0,a.unreachable)("Cannot initialize AnnotationEditor."),this.parent=m.parent,this.id=m.id,this.width=this.height=null,this.pageIndex=m.parent.pageIndex,this.name=m.name,this.div=null;const[S,C]=this.parent.viewportBaseDimensions;this.x=m.x/S,this.y=m.y/C,this.rotation=this.parent.viewport.rotation,this.isAttachedToDOM=!1}static get _defaultLineColor(){return(0,a.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=s(this,b)}focusin(m){s(this,g)?h(this,g,!1):this.parent.setSelected(this)}focusout(m){if(!this.isAttachedToDOM)return;const S=m.relatedTarget;S!=null&&S.closest(`#${this.id}`)||(m.preventDefault(),this.parent.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.parent.addToAnnotationStorage(this)}dragstart(m){const S=this.parent.div.getBoundingClientRect();this.startX=m.clientX-S.x,this.startY=m.clientY-S.y,m.dataTransfer.setData("text/plain",this.id),m.dataTransfer.effectAllowed="move"}setAt(m,S,C,x){const[R,M]=this.parent.viewportBaseDimensions;[C,x]=this.screenToPageTranslation(C,x),this.x=(m+C)/R,this.y=(S+x)/M,this.div.style.left=`${100*this.x}%`,this.div.style.top=`${100*this.y}%`}translate(m,S){const[C,x]=this.parent.viewportBaseDimensions;[m,S]=this.screenToPageTranslation(m,S),this.x+=m/C,this.y+=S/x,this.div.style.left=`${100*this.x}%`,this.div.style.top=`${100*this.y}%`}screenToPageTranslation(m,S){const{rotation:C}=this.parent.viewport;switch(C){case 90:return[S,-m];case 180:return[-m,-S];case 270:return[-S,m];default:return[m,S]}}setDims(m,S){const[C,x]=this.parent.viewportBaseDimensions;this.div.style.width=`${100*m/C}%`,this.div.style.height=`${100*S/x}%`}getInitialTranslation(){return[0,0]}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",s(this,p)),this.div.addEventListener("focusout",s(this,v));const[m,S]=this.getInitialTranslation();return this.translate(m,S),(0,r.bindEvents)(this,this.div,["dragstart","pointerdown"]),this.div}pointerdown(m){const S=r.KeyboardManager.platform.isMac;if(m.button!==0||m.ctrlKey&&S){m.preventDefault();return}m.ctrlKey&&!S||m.shiftKey||m.metaKey&&S?this.parent.toggleSelected(this):this.parent.setSelected(this),h(this,g,!0)}getRect(m,S){const[C,x]=this.parent.viewportBaseDimensions,[R,M]=this.parent.pageDimensions,F=R*m/C,H=M*S/x,V=this.x*R,X=this.y*M,K=this.width*R,q=this.height*M;switch(this.rotation){case 0:return[V+F,M-X-H-q,V+F+K,M-X-H];case 90:return[V+H,M-X+F,V+H+q,M-X+F+K];case 180:return[V-F-K,M-X+H,V-F,M-X+H+q];case 270:return[V-H-q,M-X-F-K,V-H,M-X-F];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(m,S){const[C,x,R,M]=m,F=R-C,H=M-x;switch(this.rotation){case 0:return[C,S-M,F,H];case 90:return[C,S-x,H,F];case 180:return[R,S-x,F,H];case 270:return[R,S-M,H,F];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){h(this,T,!0)}disableEditMode(){h(this,T,!1)}isInEditMode(){return s(this,T)}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){var m;(m=this.div)===null||m===void 0||m.addEventListener("focusin",s(this,p))}serialize(){(0,a.unreachable)("An editor must be serializable")}static deserialize(m,S){const C=new this.prototype.constructor({parent:S,id:S.getNextId()});C.rotation=m.rotation;const[x,R]=S.pageDimensions,[M,F,H,V]=C.getRectInCurrentCoords(m.rect,R);return C.x=M/x,C.y=F/R,C.width=H/x,C.height=V/R,C}remove(){this.div.removeEventListener("focusin",s(this,p)),this.div.removeEventListener("focusout",s(this,v)),this.isEmpty()||this.commit(),this.parent.remove(this)}select(){var m;(m=this.div)===null||m===void 0||m.classList.add("selectedEditor")}unselect(){var m;(m=this.div)===null||m===void 0||m.classList.remove("selectedEditor")}updateParams(m,S){}disableEditing(){}enableEditing(){}get propertiesToUpdate(){return{}}get contentDiv(){return this.div}get isEditing(){return s(this,A)}set isEditing(m){h(this,A,m),m?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null)}}e.AnnotationEditor=_,i(_,"_colorManager",new r.ColorManager),i(_,"_zIndex",1)},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.KeyboardManager=e.CommandManager=e.ColorManager=e.AnnotationEditorUIManager=void 0,e.bindEvents=g,e.opacityToHex=A;var r=t(1),a=t(133);function i(Ee,ae,ve){return ae in Ee?Object.defineProperty(Ee,ae,{value:ve,enumerable:!0,configurable:!0,writable:!0}):Ee[ae]=ve,Ee}function c(Ee,ae){o(Ee,ae),ae.add(Ee)}function l(Ee,ae,ve){if(!ae.has(Ee))throw new TypeError("attempted to get private field on non-instance");return ve}function h(Ee,ae,ve){o(Ee,ae),ae.set(Ee,ve)}function o(Ee,ae){if(ae.has(Ee))throw new TypeError("Cannot initialize the same private elements twice on an object")}function s(Ee,ae,ve){var Le=p(Ee,ae,"set");return f(Ee,Le,ve),ve}function f(Ee,ae,ve){if(ae.set)ae.set.call(Ee,ve);else{if(!ae.writable)throw new TypeError("attempted to set read only private field");ae.value=ve}}function u(Ee,ae){var ve=p(Ee,ae,"get");return v(Ee,ve)}function p(Ee,ae,ve){if(!ae.has(Ee))throw new TypeError("attempted to "+ve+" private field on non-instance");return ae.get(Ee)}function v(Ee,ae){return ae.get?ae.get.call(Ee):ae.value}function g(Ee,ae,ve){for(const Le of ve)ae.addEventListener(Le,Ee[Le].bind(Ee))}function A(Ee){return Math.round(Math.min(255,Math.max(1,255*Ee))).toString(16).padStart(2,"0")}var T=new WeakMap;class b{constructor(){h(this,T,{writable:!0,value:0})}getId(){var ae,ve;return`${r.AnnotationEditorPrefix}${s(this,T,(ae=u(this,T),ve=ae++,ae)),ve}`}}var _=new WeakMap,w=new WeakMap,m=new WeakMap,S=new WeakMap;class C{constructor(){let ae=arguments.length>0&&arguments[0]!==void 0?arguments[0]:128;h(this,_,{writable:!0,value:[]}),h(this,w,{writable:!0,value:!1}),h(this,m,{writable:!0,value:void 0}),h(this,S,{writable:!0,value:-1}),s(this,m,ae)}add(ae){let{cmd:ve,undo:Le,mustExec:Ke,type:ye=NaN,overwriteIfSameType:Pe=!1,keepUndo:Ne=!1}=ae;if(Ke&&ve(),u(this,w))return;const de={cmd:ve,undo:Le,type:ye};if(u(this,S)===-1){u(this,_).length>0&&(u(this,_).length=0),s(this,S,0),u(this,_).push(de);return}if(Pe&&u(this,_)[u(this,S)].type===ye){Ne&&(de.undo=u(this,_)[u(this,S)].undo),u(this,_)[u(this,S)]=de;return}const ee=u(this,S)+1;ee===u(this,m)?u(this,_).splice(0,1):(s(this,S,ee),ee<u(this,_).length&&u(this,_).splice(ee)),u(this,_).push(de)}undo(){u(this,S)!==-1&&(s(this,w,!0),u(this,_)[u(this,S)].undo(),s(this,w,!1),s(this,S,u(this,S)-1))}redo(){u(this,S)<u(this,_).length-1&&(s(this,S,u(this,S)+1),s(this,w,!0),u(this,_)[u(this,S)].cmd(),s(this,w,!1))}hasSomethingToUndo(){return u(this,S)!==-1}hasSomethingToRedo(){return u(this,S)<u(this,_).length-1}destroy(){s(this,_,null)}}e.CommandManager=C;var x=new WeakSet;class R{constructor(ae){c(this,x),this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const ve=R.platform.isMac;for(const[Le,Ke]of ae)for(const ye of Le){const Pe=ye.startsWith("mac+");ve&&Pe?(this.callbacks.set(ye.slice(4),Ke),this.allKeys.add(ye.split("+").at(-1))):!ve&&!Pe&&(this.callbacks.set(ye,Ke),this.allKeys.add(ye.split("+").at(-1)))}}static get platform(){const ae=typeof navigator<"u"?navigator.platform:"";return(0,r.shadow)(this,"platform",{isWin:ae.includes("Win"),isMac:ae.includes("Mac")})}exec(ae,ve){if(!this.allKeys.has(ve.key))return;const Le=this.callbacks.get(l(this,x,M).call(this,ve));Le&&(Le.bind(ae)(),ve.stopPropagation(),ve.preventDefault())}}e.KeyboardManager=R;function M(Ee){Ee.altKey&&this.buffer.push("alt"),Ee.ctrlKey&&this.buffer.push("ctrl"),Ee.metaKey&&this.buffer.push("meta"),Ee.shiftKey&&this.buffer.push("shift"),this.buffer.push(Ee.key);const ae=this.buffer.join("+");return this.buffer.length=0,ae}var F=new WeakMap;class H{constructor(){h(this,F,{writable:!0,value:null})}copy(ae){ae&&(Array.isArray(ae)?s(this,F,ae.map(ve=>ve.serialize())):s(this,F,[ae.serialize()]),s(this,F,u(this,F).filter(ve=>!!ve)),u(this,F).length===0&&s(this,F,null))}paste(){return u(this,F)}isEmpty(){return u(this,F)===null}destroy(){s(this,F,null)}}class V{get _colors(){const ae=new Map([["CanvasText",null],["Canvas",null]]);return(0,a.getColorValues)(ae),(0,r.shadow)(this,"_colors",ae)}convert(ae){const ve=(0,a.getRGB)(ae);if(!window.matchMedia("(forced-colors: active)").matches)return ve;for(const[Le,Ke]of this._colors)if(Ke.every((ye,Pe)=>ye===ve[Pe]))return V._colorsMapping.get(Le);return ve}getHexCode(ae){const ve=this._colors.get(ae);return ve?r.Util.makeHexColor(...ve):ae}}e.ColorManager=V,i(V,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));var X=new WeakMap,K=new WeakMap,q=new WeakMap,U=new WeakMap,B=new WeakMap,N=new WeakMap,Q=new WeakMap,ce=new WeakMap,pe=new WeakMap,Re=new WeakMap,Y=new WeakMap,O=new WeakMap,D=new WeakMap,W=new WeakMap,G=new WeakMap,E=new WeakMap,P=new WeakMap,k=new WeakSet,L=new WeakSet,j=new WeakSet,z=new WeakSet,Z=new WeakSet,te=new WeakSet,ie=new WeakSet,le=new WeakSet,se=new WeakSet;class ue{constructor(ae,ve){c(this,se),c(this,le),c(this,ie),c(this,te),c(this,Z),c(this,z),c(this,j),c(this,L),c(this,k),h(this,X,{writable:!0,value:null}),h(this,K,{writable:!0,value:new Map}),h(this,q,{writable:!0,value:new Map}),h(this,U,{writable:!0,value:new H}),h(this,B,{writable:!0,value:new C}),h(this,N,{writable:!0,value:0}),h(this,Q,{writable:!0,value:null}),h(this,ce,{writable:!0,value:null}),h(this,pe,{writable:!0,value:new b}),h(this,Re,{writable:!0,value:!1}),h(this,Y,{writable:!0,value:r.AnnotationEditorType.NONE}),h(this,O,{writable:!0,value:new Set}),h(this,D,{writable:!0,value:this.keydown.bind(this)}),h(this,W,{writable:!0,value:this.onEditingAction.bind(this)}),h(this,G,{writable:!0,value:this.onPageChanging.bind(this)}),h(this,E,{writable:!0,value:{isEditing:!1,isEmpty:!0,hasEmptyClipboard:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1}}),h(this,P,{writable:!0,value:null}),s(this,P,ae),s(this,ce,ve),u(this,ce)._on("editingaction",u(this,W)),u(this,ce)._on("pagechanging",u(this,G))}destroy(){l(this,L,be).call(this),u(this,ce)._off("editingaction",u(this,W)),u(this,ce)._off("pagechanging",u(this,G));for(const ae of u(this,q).values())ae.destroy();u(this,q).clear(),u(this,K).clear(),s(this,X,null),u(this,O).clear(),u(this,U).destroy(),u(this,B).destroy()}onPageChanging(ae){let{pageNumber:ve}=ae;s(this,N,ve-1)}focusMainContainer(){u(this,P).focus()}keydown(ae){var ve;(ve=this.getActive())!==null&&ve!==void 0&&ve.shouldGetKeyboardEvents()||ue._keyboardManager.exec(this,ae)}onEditingAction(ae){["undo","redo","cut","copy","paste","delete","selectAll"].includes(ae.name)&&this[ae.name]()}setEditingState(ae){ae?(l(this,k,me).call(this),l(this,j,we).call(this,{isEditing:u(this,Y)!==r.AnnotationEditorType.NONE,isEmpty:l(this,le,Qe).call(this),hasSomethingToUndo:u(this,B).hasSomethingToUndo(),hasSomethingToRedo:u(this,B).hasSomethingToRedo(),hasSelectedEditor:!1,hasEmptyClipboard:u(this,U).isEmpty()})):(l(this,L,be).call(this),l(this,j,we).call(this,{isEditing:!1}))}registerEditorTypes(ae){s(this,Q,ae);for(const ve of u(this,Q))l(this,z,Ae).call(this,ve.defaultPropertiesToUpdate)}getId(){return u(this,pe).getId()}addLayer(ae){u(this,q).set(ae.pageIndex,ae),u(this,Re)?ae.enable():ae.disable()}removeLayer(ae){u(this,q).delete(ae.pageIndex)}updateMode(ae){if(s(this,Y,ae),ae===r.AnnotationEditorType.NONE)this.setEditingState(!1),l(this,te,_e).call(this);else{this.setEditingState(!0),l(this,Z,Fe).call(this);for(const ve of u(this,q).values())ve.updateMode(ae)}}updateToolbar(ae){ae!==u(this,Y)&&u(this,ce).dispatch("switchannotationeditormode",{source:this,mode:ae})}updateParams(ae,ve){for(const Le of u(this,O))Le.updateParams(ae,ve);for(const Le of u(this,Q))Le.updateDefaultParams(ae,ve)}getEditors(ae){const ve=[];for(const Le of u(this,K).values())Le.pageIndex===ae&&ve.push(Le);return ve}getEditor(ae){return u(this,K).get(ae)}addEditor(ae){u(this,K).set(ae.id,ae)}removeEditor(ae){u(this,K).delete(ae.id),this.unselect(ae)}setActiveEditor(ae){u(this,X)!==ae&&(s(this,X,ae),ae&&l(this,z,Ae).call(this,ae.propertiesToUpdate))}toggleSelected(ae){if(u(this,O).has(ae)){u(this,O).delete(ae),ae.unselect(),l(this,j,we).call(this,{hasSelectedEditor:this.hasSelection});return}u(this,O).add(ae),ae.select(),l(this,z,Ae).call(this,ae.propertiesToUpdate),l(this,j,we).call(this,{hasSelectedEditor:!0})}setSelected(ae){for(const ve of u(this,O))ve!==ae&&ve.unselect();u(this,O).clear(),u(this,O).add(ae),ae.select(),l(this,z,Ae).call(this,ae.propertiesToUpdate),l(this,j,we).call(this,{hasSelectedEditor:!0})}isSelected(ae){return u(this,O).has(ae)}unselect(ae){ae.unselect(),u(this,O).delete(ae),l(this,j,we).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return u(this,O).size!==0}undo(){u(this,B).undo(),l(this,j,we).call(this,{hasSomethingToUndo:u(this,B).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:l(this,le,Qe).call(this)})}redo(){u(this,B).redo(),l(this,j,we).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:u(this,B).hasSomethingToRedo(),isEmpty:l(this,le,Qe).call(this)})}addCommands(ae){u(this,B).add(ae),l(this,j,we).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:l(this,le,Qe).call(this)})}delete(){if(u(this,X)&&u(this,X).commitOrRemove(),!this.hasSelection)return;const ae=[...u(this,O)],ve=()=>{for(const Ke of ae)Ke.remove()},Le=()=>{for(const Ke of ae)l(this,ie,Ve).call(this,Ke)};this.addCommands({cmd:ve,undo:Le,mustExec:!0})}copy(){if(u(this,X)&&u(this,X).commitOrRemove(),this.hasSelection){const ae=[];for(const ve of u(this,O))ve.isEmpty()||ae.push(ve);if(ae.length===0)return;u(this,U).copy(ae),l(this,j,we).call(this,{hasEmptyClipboard:!1})}}cut(){this.copy(),this.delete()}paste(){if(u(this,U).isEmpty())return;this.unselectAll();const ae=u(this,q).get(u(this,N)),ve=u(this,U).paste().map(ye=>ae.deserialize(ye)),Le=()=>{for(const ye of ve)l(this,ie,Ve).call(this,ye);l(this,se,Oe).call(this,ve)},Ke=()=>{for(const ye of ve)ye.remove()};this.addCommands({cmd:Le,undo:Ke,mustExec:!0})}selectAll(){for(const ae of u(this,O))ae.commit();l(this,se,Oe).call(this,u(this,K).values())}unselectAll(){if(u(this,X)){u(this,X).commitOrRemove();return}if(l(this,se,Oe).size!==0){for(const ae of u(this,O))ae.unselect();u(this,O).clear(),l(this,j,we).call(this,{hasSelectedEditor:!1})}}isActive(ae){return u(this,X)===ae}getActive(){return u(this,X)}getMode(){return u(this,Y)}}e.AnnotationEditorUIManager=ue;function me(){u(this,P).addEventListener("keydown",u(this,D))}function be(){u(this,P).removeEventListener("keydown",u(this,D))}function we(Ee){Object.entries(Ee).some(ve=>{let[Le,Ke]=ve;return u(this,E)[Le]!==Ke})&&u(this,ce).dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(u(this,E),Ee)})}function Ae(Ee){u(this,ce).dispatch("annotationeditorparamschanged",{source:this,details:Ee})}function Fe(){if(!u(this,Re)){s(this,Re,!0);for(const Ee of u(this,q).values())Ee.enable()}}function _e(){if(this.unselectAll(),u(this,Re)){s(this,Re,!1);for(const Ee of u(this,q).values())Ee.disable()}}function Ve(Ee){const ae=u(this,q).get(Ee.pageIndex);ae?ae.addOrRebuild(Ee):this.addEditor(Ee)}function Qe(){if(u(this,K).size===0)return!0;if(u(this,K).size===1)for(const Ee of u(this,K).values())return Ee.isEmpty();return!1}function Oe(Ee){u(this,O).clear();for(const ae of Ee)ae.isEmpty()||(u(this,O).add(ae),ae.select());l(this,j,we).call(this,{hasSelectedEditor:!0})}i(ue,"_keyboardManager",new R([[["ctrl+a","mac+meta+a"],ue.prototype.selectAll],[["ctrl+c","mac+meta+c"],ue.prototype.copy],[["ctrl+v","mac+meta+v"],ue.prototype.paste],[["ctrl+x","mac+meta+x"],ue.prototype.cut],[["ctrl+z","mac+meta+z"],ue.prototype.undo],[["ctrl+y","ctrl+shift+Z","mac+meta+shift+Z"],ue.prototype.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete"],ue.prototype.delete],[["Escape","mac+Escape"],ue.prototype.unselectAll]]))},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.StatTimer=e.RenderingCancelledException=e.PixelsPerInch=e.PageViewport=e.PDFDateString=e.DOMStandardFontDataFactory=e.DOMSVGFactory=e.DOMCanvasFactory=e.DOMCMapReaderFactory=e.AnnotationPrefix=void 0,e.deprecated=C,e.getColorValues=H,e.getCurrentTransform=V,e.getCurrentTransformInverse=X,e.getFilenameFromUrl=b,e.getPdfFilenameFromUrl=_,e.getRGB=F,e.getXfaPageViewport=M,e.isDataScheme=A,e.isPdfFile=T,e.isValidFetchUrl=m,e.loadScript=S;var r=t(134),a=t(1);function i(K,q,U){return q in K?Object.defineProperty(K,q,{value:U,enumerable:!0,configurable:!0,writable:!0}):K[q]=U,K}const c="http://www.w3.org/2000/svg",l="pdfjs_internal_id_";e.AnnotationPrefix=l;class h{}e.PixelsPerInch=h,i(h,"CSS",96),i(h,"PDF",72),i(h,"PDF_TO_CSS_UNITS",h.CSS/h.PDF);class o extends r.BaseCanvasFactory{constructor(){let{ownerDocument:q=globalThis.document}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this._document=q}_createCanvas(q,U){const B=this._document.createElement("canvas");return B.width=q,B.height=U,B}}e.DOMCanvasFactory=o;async function s(K){let q=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(m(K,document.baseURI)){const U=await fetch(K);if(!U.ok)throw new Error(U.statusText);return q?new Uint8Array(await U.arrayBuffer()):(0,a.stringToBytes)(await U.text())}return new Promise((U,B)=>{const N=new XMLHttpRequest;N.open("GET",K,!0),q&&(N.responseType="arraybuffer"),N.onreadystatechange=()=>{if(N.readyState===XMLHttpRequest.DONE){if(N.status===200||N.status===0){let Q;if(q&&N.response?Q=new Uint8Array(N.response):!q&&N.responseText&&(Q=(0,a.stringToBytes)(N.responseText)),Q){U(Q);return}}B(new Error(N.statusText))}},N.send(null)})}class f extends r.BaseCMapReaderFactory{_fetchData(q,U){return s(q,this.isCompressed).then(B=>({cMapData:B,compressionType:U}))}}e.DOMCMapReaderFactory=f;class u extends r.BaseStandardFontDataFactory{_fetchData(q){return s(q,!0)}}e.DOMStandardFontDataFactory=u;class p extends r.BaseSVGFactory{_createSVG(q){return document.createElementNS(c,q)}}e.DOMSVGFactory=p;class v{constructor(q){let{viewBox:U,scale:B,rotation:N,offsetX:Q=0,offsetY:ce=0,dontFlip:pe=!1}=q;this.viewBox=U,this.scale=B,this.rotation=N,this.offsetX=Q,this.offsetY=ce;const Re=(U[2]+U[0])/2,Y=(U[3]+U[1])/2;let O,D,W,G;switch(N%=360,N<0&&(N+=360),N){case 180:O=-1,D=0,W=0,G=1;break;case 90:O=0,D=1,W=1,G=0;break;case 270:O=0,D=-1,W=-1,G=0;break;case 0:O=1,D=0,W=0,G=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}pe&&(W=-W,G=-G);let E,P,k,L;O===0?(E=Math.abs(Y-U[1])*B+Q,P=Math.abs(Re-U[0])*B+ce,k=Math.abs(U[3]-U[1])*B,L=Math.abs(U[2]-U[0])*B):(E=Math.abs(Re-U[0])*B+Q,P=Math.abs(Y-U[1])*B+ce,k=Math.abs(U[2]-U[0])*B,L=Math.abs(U[3]-U[1])*B),this.transform=[O*B,D*B,W*B,G*B,E-O*B*Re-W*B*Y,P-D*B*Re-G*B*Y],this.width=k,this.height=L}clone(){let{scale:q=this.scale,rotation:U=this.rotation,offsetX:B=this.offsetX,offsetY:N=this.offsetY,dontFlip:Q=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return new v({viewBox:this.viewBox.slice(),scale:q,rotation:U,offsetX:B,offsetY:N,dontFlip:Q})}convertToViewportPoint(q,U){return a.Util.applyTransform([q,U],this.transform)}convertToViewportRectangle(q){const U=a.Util.applyTransform([q[0],q[1]],this.transform),B=a.Util.applyTransform([q[2],q[3]],this.transform);return[U[0],U[1],B[0],B[1]]}convertToPdfPoint(q,U){return a.Util.applyInverseTransform([q,U],this.transform)}}e.PageViewport=v;class g extends a.BaseException{constructor(q,U){super(q,"RenderingCancelledException"),this.type=U}}e.RenderingCancelledException=g;function A(K){const q=K.length;let U=0;for(;U<q&&K[U].trim()==="";)U++;return K.substring(U,U+5).toLowerCase()==="data:"}function T(K){return typeof K=="string"&&/\.pdf$/i.test(K)}function b(K){const q=K.indexOf("#"),U=K.indexOf("?"),B=Math.min(q>0?q:K.length,U>0?U:K.length);return K.substring(K.lastIndexOf("/",B)+1,B)}function _(K){let q=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"document.pdf";if(typeof K!="string")return q;if(A(K))return(0,a.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),q;const U=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,B=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,N=U.exec(K);let Q=B.exec(N[1])||B.exec(N[2])||B.exec(N[3]);if(Q&&(Q=Q[0],Q.includes("%")))try{Q=B.exec(decodeURIComponent(Q))[0]}catch{}return Q||q}class w{constructor(){this.started=Object.create(null),this.times=[]}time(q){q in this.started&&(0,a.warn)(`Timer is already running for ${q}`),this.started[q]=Date.now()}timeEnd(q){q in this.started||(0,a.warn)(`Timer has not been started for ${q}`),this.times.push({name:q,start:this.started[q],end:Date.now()}),delete this.started[q]}toString(){const q=[];let U=0;for(const B of this.times){const N=B.name;N.length>U&&(U=N.length)}for(const B of this.times){const N=B.end-B.start;q.push(`${B.name.padEnd(U)} ${N}ms
`)}return q.join("")}}e.StatTimer=w;function m(K,q){try{const{protocol:U}=q?new URL(K,q):new URL(K);return U==="http:"||U==="https:"}catch{return!1}}function S(K){let q=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return new Promise((U,B)=>{const N=document.createElement("script");N.src=K,N.onload=function(Q){q&&N.remove(),U(Q)},N.onerror=function(){B(new Error(`Cannot load script at: ${N.src}`))},(document.head||document.documentElement).append(N)})}function C(K){console.log("Deprecated API usage: "+K)}let x;class R{static toDateObject(q){if(!q||typeof q!="string")return null;x||(x=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const U=x.exec(q);if(!U)return null;const B=parseInt(U[1],10);let N=parseInt(U[2],10);N=N>=1&&N<=12?N-1:0;let Q=parseInt(U[3],10);Q=Q>=1&&Q<=31?Q:1;let ce=parseInt(U[4],10);ce=ce>=0&&ce<=23?ce:0;let pe=parseInt(U[5],10);pe=pe>=0&&pe<=59?pe:0;let Re=parseInt(U[6],10);Re=Re>=0&&Re<=59?Re:0;const Y=U[7]||"Z";let O=parseInt(U[8],10);O=O>=0&&O<=23?O:0;let D=parseInt(U[9],10)||0;return D=D>=0&&D<=59?D:0,Y==="-"?(ce+=O,pe+=D):Y==="+"&&(ce-=O,pe-=D),new Date(Date.UTC(B,N,Q,ce,pe,Re))}}e.PDFDateString=R;function M(K,q){let{scale:U=1,rotation:B=0}=q;const{width:N,height:Q}=K.attributes.style,ce=[0,0,parseInt(N),parseInt(Q)];return new v({viewBox:ce,scale:U,rotation:B})}function F(K){if(K.startsWith("#")){const q=parseInt(K.slice(1),16);return[(q&16711680)>>16,(q&65280)>>8,q&255]}return K.startsWith("rgb(")?K.slice(4,-1).split(",").map(q=>parseInt(q)):K.startsWith("rgba(")?K.slice(5,-1).split(",").map(q=>parseInt(q)).slice(0,3):((0,a.warn)(`Not a valid color format: "${K}"`),[0,0,0])}function H(K){const q=document.createElement("span");q.style.visibility="hidden",document.body.append(q);for(const U of K.keys()){q.style.color=U;const B=window.getComputedStyle(q).color;K.set(U,F(B))}q.remove()}function V(K){const{a:q,b:U,c:B,d:N,e:Q,f:ce}=K.getTransform();return[q,U,B,N,Q,ce]}function X(K){const{a:q,b:U,c:B,d:N,e:Q,f:ce}=K.getTransform().invertSelf();return[q,U,B,N,Q,ce]}},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BaseStandardFontDataFactory=e.BaseSVGFactory=e.BaseCanvasFactory=e.BaseCMapReaderFactory=void 0;var r=t(1);class a{constructor(){this.constructor===a&&(0,r.unreachable)("Cannot initialize BaseCanvasFactory.")}create(o,s){if(o<=0||s<=0)throw new Error("Invalid canvas size");const f=this._createCanvas(o,s);return{canvas:f,context:f.getContext("2d")}}reset(o,s,f){if(!o.canvas)throw new Error("Canvas is not specified");if(s<=0||f<=0)throw new Error("Invalid canvas size");o.canvas.width=s,o.canvas.height=f}destroy(o){if(!o.canvas)throw new Error("Canvas is not specified");o.canvas.width=0,o.canvas.height=0,o.canvas=null,o.context=null}_createCanvas(o,s){(0,r.unreachable)("Abstract method `_createCanvas` called.")}}e.BaseCanvasFactory=a;class i{constructor(o){let{baseUrl:s=null,isCompressed:f=!1}=o;this.constructor===i&&(0,r.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=s,this.isCompressed=f}async fetch(o){let{name:s}=o;if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!s)throw new Error("CMap name must be specified.");const f=this.baseUrl+s+(this.isCompressed?".bcmap":""),u=this.isCompressed?r.CMapCompressionType.BINARY:r.CMapCompressionType.NONE;return this._fetchData(f,u).catch(p=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${f}`)})}_fetchData(o,s){(0,r.unreachable)("Abstract method `_fetchData` called.")}}e.BaseCMapReaderFactory=i;class c{constructor(o){let{baseUrl:s=null}=o;this.constructor===c&&(0,r.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=s}async fetch(o){let{filename:s}=o;if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!s)throw new Error("Font filename must be specified.");const f=`${this.baseUrl}${s}`;return this._fetchData(f).catch(u=>{throw new Error(`Unable to load font data at: ${f}`)})}_fetchData(o){(0,r.unreachable)("Abstract method `_fetchData` called.")}}e.BaseStandardFontDataFactory=c;class l{constructor(){this.constructor===l&&(0,r.unreachable)("Cannot initialize BaseSVGFactory.")}create(o,s){let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(o<=0||s<=0)throw new Error("Invalid SVG dimensions");const u=this._createSVG("svg:svg");return u.setAttribute("version","1.1"),f||(u.setAttribute("width",`${o}px`),u.setAttribute("height",`${s}px`)),u.setAttribute("preserveAspectRatio","none"),u.setAttribute("viewBox",`0 0 ${o} ${s}`),u}createElement(o){if(typeof o!="string")throw new Error("Invalid SVG element type");return this._createSVG(o)}_createSVG(o){(0,r.unreachable)("Abstract method `_createSVG` called.")}}e.BaseSVGFactory=l},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MurmurHash3_64=void 0;var r=t(1);const a=3285377520,i=4294901760,c=65535;class l{constructor(o){this.h1=o?o&4294967295:a,this.h2=o?o&4294967295:a}update(o){let s,f;if(typeof o=="string"){s=new Uint8Array(o.length*2),f=0;for(let C=0,x=o.length;C<x;C++){const R=o.charCodeAt(C);R<=255?s[f++]=R:(s[f++]=R>>>8,s[f++]=R&255)}}else if((0,r.isArrayBuffer)(o))s=o.slice(),f=s.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const u=f>>2,p=f-u*4,v=new Uint32Array(s.buffer,0,u);let g=0,A=0,T=this.h1,b=this.h2;const _=3432918353,w=461845907,m=_&c,S=w&c;for(let C=0;C<u;C++)C&1?(g=v[C],g=g*_&i|g*m&c,g=g<<15|g>>>17,g=g*w&i|g*S&c,T^=g,T=T<<13|T>>>19,T=T*5+3864292196):(A=v[C],A=A*_&i|A*m&c,A=A<<15|A>>>17,A=A*w&i|A*S&c,b^=A,b=b<<13|b>>>19,b=b*5+3864292196);switch(g=0,p){case 3:g^=s[u*4+2]<<16;case 2:g^=s[u*4+1]<<8;case 1:g^=s[u*4],g=g*_&i|g*m&c,g=g<<15|g>>>17,g=g*w&i|g*S&c,u&1?T^=g:b^=g}this.h1=T,this.h2=b}hexdigest(){let o=this.h1,s=this.h2;o^=s>>>1,o=o*3981806797&i|o*36045&c,s=s*4283543511&i|((s<<16|o>>>16)*2950163797&i)>>>16,o^=s>>>1,o=o*444984403&i|o*60499&c,s=s*3301882366&i|((s<<16|o>>>16)*3120437893&i)>>>16,o^=s>>>1;const f=(o>>>0).toString(16),u=(s>>>0).toString(16);return f.padStart(8,"0")+u.padStart(8,"0")}}e.MurmurHash3_64=l},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.FontLoader=e.FontFaceObject=void 0;var r=t(1);class a{constructor(h){let{docId:o,onUnsupportedFeature:s,ownerDocument:f=globalThis.document,styleElement:u=null}=h;this.constructor===a&&(0,r.unreachable)("Cannot initialize BaseFontLoader."),this.docId=o,this._onUnsupportedFeature=s,this._document=f,this.nativeFontFaces=[],this.styleElement=null}addNativeFontFace(h){this.nativeFontFaces.push(h),this._document.fonts.add(h)}insertRule(h){let o=this.styleElement;o||(o=this.styleElement=this._document.createElement("style"),o.id=`PDFJS_FONT_STYLE_TAG_${this.docId}`,this._document.documentElement.getElementsByTagName("head")[0].append(o));const s=o.sheet;s.insertRule(h,s.cssRules.length)}clear(){for(const h of this.nativeFontFaces)this._document.fonts.delete(h);this.nativeFontFaces.length=0,this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async bind(h){if(h.attached||h.missingFile)return;if(h.attached=!0,this.isFontLoadingAPISupported){const s=h.createNativeFontFace();if(s){this.addNativeFontFace(s);try{await s.loaded}catch(f){throw this._onUnsupportedFeature({featureId:r.UNSUPPORTED_FEATURES.errorFontLoadNative}),(0,r.warn)(`Failed to load font '${s.family}': '${f}'.`),h.disableFontFace=!0,f}}return}const o=h.createFontFaceRule();if(o){if(this.insertRule(o),this.isSyncFontLoadingSupported)return;await new Promise(s=>{const f=this._queueLoadingCallback(s);this._prepareFontLoadEvent([o],[h],f)})}}_queueLoadingCallback(h){(0,r.unreachable)("Abstract method `_queueLoadingCallback`.")}get isFontLoadingAPISupported(){var h;const o=!!((h=this._document)!==null&&h!==void 0&&h.fonts);return(0,r.shadow)(this,"isFontLoadingAPISupported",o)}get isSyncFontLoadingSupported(){(0,r.unreachable)("Abstract method `isSyncFontLoadingSupported`.")}get _loadTestFont(){(0,r.unreachable)("Abstract method `_loadTestFont`.")}_prepareFontLoadEvent(h,o,s){(0,r.unreachable)("Abstract method `_prepareFontLoadEvent`.")}}let i;e.FontLoader=i,e.FontLoader=i=class extends a{constructor(h){super(h),this.loadingContext={requests:[],nextRequestId:0},this.loadTestFontId=0}get isSyncFontLoadingSupported(){let h=!1;if(typeof navigator>"u")h=!0;else{const o=/Mozilla\/5.0.*?rv:(\d+).*? Gecko/.exec(navigator.userAgent);(o==null?void 0:o[1])>=14&&(h=!0)}return(0,r.shadow)(this,"isSyncFontLoadingSupported",h)}_queueLoadingCallback(h){function o(){for((0,r.assert)(!f.done,"completeRequest() cannot be called twice."),f.done=!0;s.requests.length>0&&s.requests[0].done;){const u=s.requests.shift();setTimeout(u.callback,0)}}const s=this.loadingContext,f={id:`pdfjs-font-loading-${s.nextRequestId++}`,done:!1,complete:o,callback:h};return s.requests.push(f),f}get _loadTestFont(){const h=function(){return atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==")};return(0,r.shadow)(this,"_loadTestFont",h())}_prepareFontLoadEvent(h,o,s){function f(V,X){return V.charCodeAt(X)<<24|V.charCodeAt(X+1)<<16|V.charCodeAt(X+2)<<8|V.charCodeAt(X+3)&255}function u(V,X,K,q){const U=V.substring(0,X),B=V.substring(X+K);return U+q+B}let p,v;const g=this._document.createElement("canvas");g.width=1,g.height=1;const A=g.getContext("2d");let T=0;function b(V,X){if(T++,T>30){(0,r.warn)("Load test font never loaded."),X();return}if(A.font="30px "+V,A.fillText(".",0,20),A.getImageData(0,0,1,1).data[3]>0){X();return}setTimeout(b.bind(null,V,X))}const _=`lt${Date.now()}${this.loadTestFontId++}`;let w=this._loadTestFont;w=u(w,976,_.length,_);const S=16,C=1482184792;let x=f(w,S);for(p=0,v=_.length-3;p<v;p+=4)x=x-C+f(_,p)|0;p<_.length&&(x=x-C+f(_+"XXX",p)|0),w=u(w,S,4,(0,r.string32)(x));const R=`url(data:font/opentype;base64,${btoa(w)});`,M=`@font-face {font-family:"${_}";src:${R}}`;this.insertRule(M);const F=[];for(const V of o)F.push(V.loadedName);F.push(_);const H=this._document.createElement("div");H.style.visibility="hidden",H.style.width=H.style.height="10px",H.style.position="absolute",H.style.top=H.style.left="0px";for(const V of F){const X=this._document.createElement("span");X.textContent="Hi",X.style.fontFamily=V,H.append(X)}this._document.body.append(H),b(_,()=>{H.remove(),s.complete()})}};class c{constructor(h,o){let{isEvalSupported:s=!0,disableFontFace:f=!1,ignoreErrors:u=!1,onUnsupportedFeature:p,fontRegistry:v=null}=o;this.compiledGlyphs=Object.create(null);for(const g in h)this[g]=h[g];this.isEvalSupported=s!==!1,this.disableFontFace=f===!0,this.ignoreErrors=u===!0,this._onUnsupportedFeature=p,this.fontRegistry=v}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let h;if(!this.cssFontInfo)h=new FontFace(this.loadedName,this.data,{});else{const o={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(o.style=`oblique ${this.cssFontInfo.italicAngle}deg`),h=new FontFace(this.cssFontInfo.fontFamily,this.data,o)}return this.fontRegistry&&this.fontRegistry.registerFont(this),h}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const h=(0,r.bytesToString)(this.data),o=`url(data:${this.mimetype};base64,${btoa(h)});`;let s;if(!this.cssFontInfo)s=`@font-face {font-family:"${this.loadedName}";src:${o}}`;else{let f=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(f+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),s=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${f}src:${o}}`}return this.fontRegistry&&this.fontRegistry.registerFont(this,o),s}getPathGenerator(h,o){if(this.compiledGlyphs[o]!==void 0)return this.compiledGlyphs[o];let s;try{s=h.get(this.loadedName+"_path_"+o)}catch(f){if(!this.ignoreErrors)throw f;return this._onUnsupportedFeature({featureId:r.UNSUPPORTED_FEATURES.errorFontGetPath}),(0,r.warn)(`getPathGenerator - ignoring character: "${f}".`),this.compiledGlyphs[o]=function(u,p){}}if(this.isEvalSupported&&r.FeatureTest.isEvalSupported){const f=[];for(const u of s){const p=u.args!==void 0?u.args.join(","):"";f.push("c.",u.cmd,"(",p,`);
`)}return this.compiledGlyphs[o]=new Function("c","size",f.join(""))}return this.compiledGlyphs[o]=function(f,u){for(const p of s)p.cmd==="scale"&&(p.args=[u,-u]),f[p.cmd].apply(f,p.args)}}}e.FontFaceObject=c},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CanvasGraphics=void 0;var r=t(133),a=t(1),i=t(138),c=t(139),l=t(3);function h(Y,O){o(Y,O),O.add(Y)}function o(Y,O){if(O.has(Y))throw new TypeError("Cannot initialize the same private elements twice on an object")}function s(Y,O,D){if(!O.has(Y))throw new TypeError("attempted to get private field on non-instance");return D}const f=16,u=100,p=4096,v=15,g=10,A=l.isNodeJS&&typeof Path2D>"u"?-1:1e3,T=16;function b(Y,O){if(Y._removeMirroring)throw new Error("Context is already forwarding operations.");Y.__originalSave=Y.save,Y.__originalRestore=Y.restore,Y.__originalRotate=Y.rotate,Y.__originalScale=Y.scale,Y.__originalTranslate=Y.translate,Y.__originalTransform=Y.transform,Y.__originalSetTransform=Y.setTransform,Y.__originalResetTransform=Y.resetTransform,Y.__originalClip=Y.clip,Y.__originalMoveTo=Y.moveTo,Y.__originalLineTo=Y.lineTo,Y.__originalBezierCurveTo=Y.bezierCurveTo,Y.__originalRect=Y.rect,Y.__originalClosePath=Y.closePath,Y.__originalBeginPath=Y.beginPath,Y._removeMirroring=()=>{Y.save=Y.__originalSave,Y.restore=Y.__originalRestore,Y.rotate=Y.__originalRotate,Y.scale=Y.__originalScale,Y.translate=Y.__originalTranslate,Y.transform=Y.__originalTransform,Y.setTransform=Y.__originalSetTransform,Y.resetTransform=Y.__originalResetTransform,Y.clip=Y.__originalClip,Y.moveTo=Y.__originalMoveTo,Y.lineTo=Y.__originalLineTo,Y.bezierCurveTo=Y.__originalBezierCurveTo,Y.rect=Y.__originalRect,Y.closePath=Y.__originalClosePath,Y.beginPath=Y.__originalBeginPath,delete Y._removeMirroring},Y.save=function(){O.save(),this.__originalSave()},Y.restore=function(){O.restore(),this.__originalRestore()},Y.translate=function(W,G){O.translate(W,G),this.__originalTranslate(W,G)},Y.scale=function(W,G){O.scale(W,G),this.__originalScale(W,G)},Y.transform=function(W,G,E,P,k,L){O.transform(W,G,E,P,k,L),this.__originalTransform(W,G,E,P,k,L)},Y.setTransform=function(W,G,E,P,k,L){O.setTransform(W,G,E,P,k,L),this.__originalSetTransform(W,G,E,P,k,L)},Y.resetTransform=function(){O.resetTransform(),this.__originalResetTransform()},Y.rotate=function(W){O.rotate(W),this.__originalRotate(W)},Y.clip=function(W){O.clip(W),this.__originalClip(W)},Y.moveTo=function(D,W){O.moveTo(D,W),this.__originalMoveTo(D,W)},Y.lineTo=function(D,W){O.lineTo(D,W),this.__originalLineTo(D,W)},Y.bezierCurveTo=function(D,W,G,E,P,k){O.bezierCurveTo(D,W,G,E,P,k),this.__originalBezierCurveTo(D,W,G,E,P,k)},Y.rect=function(D,W,G,E){O.rect(D,W,G,E),this.__originalRect(D,W,G,E)},Y.closePath=function(){O.closePath(),this.__originalClosePath()},Y.beginPath=function(){O.beginPath(),this.__originalBeginPath()}}class _{constructor(O){this.canvasFactory=O,this.cache=Object.create(null)}getCanvas(O,D,W){let G;return this.cache[O]!==void 0?(G=this.cache[O],this.canvasFactory.reset(G,D,W)):(G=this.canvasFactory.create(D,W),this.cache[O]=G),G}delete(O){delete this.cache[O]}clear(){for(const O in this.cache){const D=this.cache[O];this.canvasFactory.destroy(D),delete this.cache[O]}}}function w(Y,O,D,W,G,E,P,k,L,j){const[z,Z,te,ie,le,se]=(0,r.getCurrentTransform)(Y);if(Z===0&&te===0){const be=P*z+le,we=Math.round(be),Ae=k*ie+se,Fe=Math.round(Ae),_e=(P+L)*z+le,Ve=Math.abs(Math.round(_e)-we)||1,Qe=(k+j)*ie+se,Oe=Math.abs(Math.round(Qe)-Fe)||1;return Y.setTransform(Math.sign(z),0,0,Math.sign(ie),we,Fe),Y.drawImage(O,D,W,G,E,0,0,Ve,Oe),Y.setTransform(z,Z,te,ie,le,se),[Ve,Oe]}if(z===0&&ie===0){const be=k*te+le,we=Math.round(be),Ae=P*Z+se,Fe=Math.round(Ae),_e=(k+j)*te+le,Ve=Math.abs(Math.round(_e)-we)||1,Qe=(P+L)*Z+se,Oe=Math.abs(Math.round(Qe)-Fe)||1;return Y.setTransform(0,Math.sign(Z),Math.sign(te),0,we,Fe),Y.drawImage(O,D,W,G,E,0,0,Oe,Ve),Y.setTransform(z,Z,te,ie,le,se),[Oe,Ve]}Y.drawImage(O,D,W,G,E,P,k,L,j);const ue=Math.hypot(z,Z),me=Math.hypot(te,ie);return[ue*L,me*j]}function m(Y){const{width:O,height:D}=Y;if(O>A||D>A)return null;const W=1e3,G=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),E=O+1;let P=new Uint8Array(E*(D+1)),k,L,j;const z=O+7&-8;let Z=new Uint8Array(z*D),te=0;for(const me of Y.data){let be=128;for(;be>0;)Z[te++]=me&be?0:255,be>>=1}let ie=0;for(te=0,Z[te]!==0&&(P[0]=1,++ie),L=1;L<O;L++)Z[te]!==Z[te+1]&&(P[L]=Z[te]?2:1,++ie),te++;for(Z[te]!==0&&(P[L]=2,++ie),k=1;k<D;k++){te=k*z,j=k*E,Z[te-z]!==Z[te]&&(P[j]=Z[te]?1:8,++ie);let me=(Z[te]?4:0)+(Z[te-z]?8:0);for(L=1;L<O;L++)me=(me>>2)+(Z[te+1]?4:0)+(Z[te-z+1]?8:0),G[me]&&(P[j+L]=G[me],++ie),te++;if(Z[te-z]!==Z[te]&&(P[j+L]=Z[te]?2:4,++ie),ie>W)return null}for(te=z*(D-1),j=k*E,Z[te]!==0&&(P[j]=8,++ie),L=1;L<O;L++)Z[te]!==Z[te+1]&&(P[j+L]=Z[te]?4:8,++ie),te++;if(Z[te]!==0&&(P[j+L]=4,++ie),ie>W)return null;const le=new Int32Array([0,E,-1,0,-E,0,0,0,1]),se=new Path2D;for(k=0;ie&&k<=D;k++){let me=k*E;const be=me+O;for(;me<be&&!P[me];)me++;if(me===be)continue;se.moveTo(me%E,k);const we=me;let Ae=P[me];do{const Fe=le[Ae];do me+=Fe;while(!P[me]);const _e=P[me];_e!==5&&_e!==10?(Ae=_e,P[me]=0):(Ae=_e&51*Ae>>4,P[me]&=Ae>>2|Ae<<2),se.lineTo(me%E,me/E|0),P[me]||--ie}while(we!==me);--k}return Z=null,P=null,function(me){me.save(),me.scale(1/O,-1/D),me.translate(0,-D),me.fill(se),me.beginPath(),me.restore()}}class S{constructor(O,D){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=a.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=a.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=a.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps=null,this.startNewPathAndClipBox([0,0,O,D])}clone(){const O=Object.create(this);return O.clipBox=this.clipBox.slice(),O}setCurrentPoint(O,D){this.x=O,this.y=D}updatePathMinMax(O,D,W){[D,W]=a.Util.applyTransform([D,W],O),this.minX=Math.min(this.minX,D),this.minY=Math.min(this.minY,W),this.maxX=Math.max(this.maxX,D),this.maxY=Math.max(this.maxY,W)}updateRectMinMax(O,D){const W=a.Util.applyTransform(D,O),G=a.Util.applyTransform(D.slice(2),O);this.minX=Math.min(this.minX,W[0],G[0]),this.minY=Math.min(this.minY,W[1],G[1]),this.maxX=Math.max(this.maxX,W[0],G[0]),this.maxY=Math.max(this.maxY,W[1],G[1])}updateScalingPathMinMax(O,D){a.Util.scaleMinMax(O,D),this.minX=Math.min(this.minX,D[0]),this.maxX=Math.max(this.maxX,D[1]),this.minY=Math.min(this.minY,D[2]),this.maxY=Math.max(this.maxY,D[3])}updateCurvePathMinMax(O,D,W,G,E,P,k,L,j,z){const Z=a.Util.bezierBoundingBox(D,W,G,E,P,k,L,j);if(z){z[0]=Math.min(z[0],Z[0],Z[2]),z[1]=Math.max(z[1],Z[0],Z[2]),z[2]=Math.min(z[2],Z[1],Z[3]),z[3]=Math.max(z[3],Z[1],Z[3]);return}this.updateRectMinMax(O,Z)}getPathBoundingBox(){let O=arguments.length>0&&arguments[0]!==void 0?arguments[0]:i.PathType.FILL,D=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const W=[this.minX,this.minY,this.maxX,this.maxY];if(O===i.PathType.STROKE){D||(0,a.unreachable)("Stroke bounding box must include transform.");const G=a.Util.singularValueDecompose2dScale(D),E=G[0]*this.lineWidth/2,P=G[1]*this.lineWidth/2;W[0]-=E,W[1]-=P,W[2]+=E,W[3]+=P}return W}updateClipFromPath(){const O=a.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(O||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(O){this.clipBox=O,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(){let O=arguments.length>0&&arguments[0]!==void 0?arguments[0]:i.PathType.FILL,D=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return a.Util.intersect(this.clipBox,this.getPathBoundingBox(O,D))}}function C(Y,O){let D=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(typeof ImageData<"u"&&O instanceof ImageData){Y.putImageData(O,0,0);return}const W=O.height,G=O.width,E=W%T,P=(W-E)/T,k=E===0?P:P+1,L=Y.createImageData(G,T);let j=0,z;const Z=O.data,te=L.data;let ie,le,se,ue,me,be,we,Ae;if(D)switch(D.length){case 1:me=D[0],be=D[0],we=D[0],Ae=D[0];break;case 4:me=D[0],be=D[1],we=D[2],Ae=D[3];break}if(O.kind===a.ImageKind.GRAYSCALE_1BPP){const Fe=Z.byteLength,_e=new Uint32Array(te.buffer,0,te.byteLength>>2),Ve=_e.length,Qe=G+7>>3;let Oe=4294967295,Ee=a.FeatureTest.isLittleEndian?4278190080:255;for(Ae&&Ae[0]===255&&Ae[255]===0&&([Oe,Ee]=[Ee,Oe]),ie=0;ie<k;ie++){for(se=ie<P?T:E,z=0,le=0;le<se;le++){const ae=Fe-j;let ve=0;const Le=ae>Qe?G:ae*8-7,Ke=Le&-8;let ye=0,Pe=0;for(;ve<Ke;ve+=8)Pe=Z[j++],_e[z++]=Pe&128?Oe:Ee,_e[z++]=Pe&64?Oe:Ee,_e[z++]=Pe&32?Oe:Ee,_e[z++]=Pe&16?Oe:Ee,_e[z++]=Pe&8?Oe:Ee,_e[z++]=Pe&4?Oe:Ee,_e[z++]=Pe&2?Oe:Ee,_e[z++]=Pe&1?Oe:Ee;for(;ve<Le;ve++)ye===0&&(Pe=Z[j++],ye=128),_e[z++]=Pe&ye?Oe:Ee,ye>>=1}for(;z<Ve;)_e[z++]=0;Y.putImageData(L,0,ie*T)}}else if(O.kind===a.ImageKind.RGBA_32BPP){const Fe=!!(me||be||we);for(le=0,ue=G*T*4,ie=0;ie<P;ie++){if(te.set(Z.subarray(j,j+ue)),j+=ue,Fe)for(let _e=0;_e<ue;_e+=4)me&&(te[_e+0]=me[te[_e+0]]),be&&(te[_e+1]=be[te[_e+1]]),we&&(te[_e+2]=we[te[_e+2]]);Y.putImageData(L,0,le),le+=T}if(ie<k){if(ue=G*E*4,te.set(Z.subarray(j,j+ue)),Fe)for(let _e=0;_e<ue;_e+=4)me&&(te[_e+0]=me[te[_e+0]]),be&&(te[_e+1]=be[te[_e+1]]),we&&(te[_e+2]=we[te[_e+2]]);Y.putImageData(L,0,le)}}else if(O.kind===a.ImageKind.RGB_24BPP){const Fe=!!(me||be||we);for(se=T,ue=G*se,ie=0;ie<k;ie++){for(ie>=P&&(se=E,ue=G*se),z=0,le=ue;le--;)te[z++]=Z[j++],te[z++]=Z[j++],te[z++]=Z[j++],te[z++]=255;if(Fe)for(let _e=0;_e<z;_e+=4)me&&(te[_e+0]=me[te[_e+0]]),be&&(te[_e+1]=be[te[_e+1]]),we&&(te[_e+2]=we[te[_e+2]]);Y.putImageData(L,0,ie*T)}}else throw new Error(`bad image kind: ${O.kind}`)}function x(Y,O){if(O.bitmap){Y.drawImage(O.bitmap,0,0);return}const D=O.height,W=O.width,G=D%T,E=(D-G)/T,P=G===0?E:E+1,k=Y.createImageData(W,T);let L=0;const j=O.data,z=k.data;for(let Z=0;Z<P;Z++){const te=Z<E?T:G;({srcPos:L}=(0,c.applyMaskImageData)({src:j,srcPos:L,dest:z,width:W,height:te})),Y.putImageData(k,0,Z*T)}}function R(Y,O){const D=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font"];for(let W=0,G=D.length;W<G;W++){const E=D[W];Y[E]!==void 0&&(O[E]=Y[E])}Y.setLineDash!==void 0&&(O.setLineDash(Y.getLineDash()),O.lineDashOffset=Y.lineDashOffset)}function M(Y,O){Y.strokeStyle=Y.fillStyle=O||"#000000",Y.fillRule="nonzero",Y.globalAlpha=1,Y.lineWidth=1,Y.lineCap="butt",Y.lineJoin="miter",Y.miterLimit=10,Y.globalCompositeOperation="source-over",Y.font="10px sans-serif",Y.setLineDash!==void 0&&(Y.setLineDash([]),Y.lineDashOffset=0)}function F(Y,O,D,W){const G=Y.length;for(let E=3;E<G;E+=4){const P=Y[E];if(P===0)Y[E-3]=O,Y[E-2]=D,Y[E-1]=W;else if(P<255){const k=255-P;Y[E-3]=Y[E-3]*P+O*k>>8,Y[E-2]=Y[E-2]*P+D*k>>8,Y[E-1]=Y[E-1]*P+W*k>>8}}}function H(Y,O,D){const W=Y.length,G=1/255;for(let E=3;E<W;E+=4){const P=D?D[Y[E]]:Y[E];O[E]=O[E]*P*G|0}}function V(Y,O,D){const W=Y.length;for(let G=3;G<W;G+=4){const E=Y[G-3]*77+Y[G-2]*152+Y[G-1]*28;O[G]=D?O[G]*D[E>>8]>>8:O[G]*E>>16}}function X(Y,O,D,W,G,E,P,k,L,j,z){const Z=!!E,te=Z?E[0]:0,ie=Z?E[1]:0,le=Z?E[2]:0;let se;G==="Luminosity"?se=V:se=H;const me=Math.min(W,Math.ceil(1048576/D));for(let be=0;be<W;be+=me){const we=Math.min(me,W-be),Ae=Y.getImageData(k-j,be+(L-z),D,we),Fe=O.getImageData(k,be+L,D,we);Z&&F(Ae.data,te,ie,le),se(Ae.data,Fe.data,P),O.putImageData(Fe,k,be+L)}}function K(Y,O,D,W){const G=W[0],E=W[1],P=W[2]-G,k=W[3]-E;P===0||k===0||(X(O.context,D,P,k,O.subtype,O.backdrop,O.transferMap,G,E,O.offsetX,O.offsetY),Y.save(),Y.globalAlpha=1,Y.globalCompositeOperation="source-over",Y.setTransform(1,0,0,1,0,0),Y.drawImage(D.canvas,0,0),Y.restore())}function q(Y,O){const D=a.Util.singularValueDecompose2dScale(Y);D[0]=Math.fround(D[0]),D[1]=Math.fround(D[1]);const W=Math.fround((globalThis.devicePixelRatio||1)*r.PixelsPerInch.PDF_TO_CSS_UNITS);return O!==void 0?O:D[0]<=W||D[1]<=W}const U=["butt","round","square"],B=["miter","round","bevel"],N={},Q={};var ce=new WeakSet;class pe{constructor(O,D,W,G,E,P,k,L){h(this,ce),this.ctx=O,this.current=new S(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=D,this.objs=W,this.canvasFactory=G,this.imageLayer=E,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=[],this.optionalContentConfig=P,this.cachedCanvases=new _(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=k,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.backgroundColor=(L==null?void 0:L.background)||null,this.foregroundColor=(L==null?void 0:L.foreground)||null,this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(O){let D=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return typeof O=="string"?O.startsWith("g_")?this.commonObjs.get(O):this.objs.get(O):D}beginDrawing(O){let{transform:D,viewport:W,transparency:G=!1,background:E=null}=O;const P=this.ctx.canvas.width,k=this.ctx.canvas.height,L=E||"#ffffff";if(this.ctx.save(),this.foregroundColor&&this.backgroundColor){this.ctx.fillStyle=this.foregroundColor;const j=this.foregroundColor=this.ctx.fillStyle;this.ctx.fillStyle=this.backgroundColor;const z=this.backgroundColor=this.ctx.fillStyle;let Z=!0,te=L;if(this.ctx.fillStyle=L,te=this.ctx.fillStyle,Z=typeof te=="string"&&/^#[0-9A-Fa-f]{6}$/.test(te),j==="#000000"&&z==="#ffffff"||j===z||!Z)this.foregroundColor=this.backgroundColor=null;else{const[ie,le,se]=(0,r.getRGB)(te),ue=be=>(be/=255,be<=.03928?be/12.92:((be+.055)/1.055)**2.4),me=Math.round(.2126*ue(ie)+.7152*ue(le)+.0722*ue(se));this.selectColor=(be,we,Ae)=>{const Fe=.2126*ue(be)+.7152*ue(we)+.0722*ue(Ae);return Math.round(Fe)===me?z:j}}}if(this.ctx.fillStyle=this.backgroundColor||L,this.ctx.fillRect(0,0,P,k),this.ctx.restore(),G){const j=this.cachedCanvases.getCanvas("transparent",P,k);this.compositeCtx=this.ctx,this.transparentCanvas=j.canvas,this.ctx=j.context,this.ctx.save(),this.ctx.transform(...(0,r.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),M(this.ctx,this.foregroundColor),D&&(this.ctx.transform(...D),this.outputScaleX=D[0],this.outputScaleY=D[0]),this.ctx.transform(...W.transform),this.viewportScale=W.scale,this.baseTransform=(0,r.getCurrentTransform)(this.ctx),this.imageLayer&&((0,r.deprecated)("The `imageLayer` functionality will be removed in the future."),this.imageLayer.beginLayout())}executeOperatorList(O,D,W,G){const E=O.argsArray,P=O.fnArray;let k=D||0;const L=E.length;if(L===k)return k;const j=L-k>g&&typeof W=="function",z=j?Date.now()+v:0;let Z=0;const te=this.commonObjs,ie=this.objs;let le;for(;;){if(G!==void 0&&k===G.nextBreakPoint)return G.breakIt(k,W),k;if(le=P[k],le!==a.OPS.dependency)this[le].apply(this,E[k]);else for(const se of E[k]){const ue=se.startsWith("g_")?te:ie;if(!ue.has(se))return ue.get(se,W),k}if(k++,k===L)return k;if(j&&++Z>g){if(Date.now()>z)return W(),k;Z=0}}}endDrawing(){s(this,ce,Re).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const O of this._cachedBitmapsMap.values()){for(const D of O.values())typeof HTMLCanvasElement<"u"&&D instanceof HTMLCanvasElement&&(D.width=D.height=0);O.clear()}this._cachedBitmapsMap.clear(),this.imageLayer&&this.imageLayer.endLayout()}_scaleImage(O,D){const W=O.width,G=O.height;let E=Math.max(Math.hypot(D[0],D[1]),1),P=Math.max(Math.hypot(D[2],D[3]),1),k=W,L=G,j="prescale1",z,Z;for(;E>2&&k>1||P>2&&L>1;){let te=k,ie=L;E>2&&k>1&&(te=Math.ceil(k/2),E/=k/te),P>2&&L>1&&(ie=Math.ceil(L/2),P/=L/ie),z=this.cachedCanvases.getCanvas(j,te,ie),Z=z.context,Z.clearRect(0,0,te,ie),Z.drawImage(O,0,0,k,L,0,0,te,ie),O=z.canvas,k=te,L=ie,j=j==="prescale1"?"prescale2":"prescale1"}return{img:O,paintWidth:k,paintHeight:L}}_createMaskCanvas(O){const D=this.ctx,{width:W,height:G}=O,E=this.current.fillColor,P=this.current.patternFill,k=(0,r.getCurrentTransform)(D);let L,j,z,Z;if((O.bitmap||O.data)&&O.count>1){const Ve=O.bitmap||O.data.buffer,Qe=k.slice(0,4);j=JSON.stringify(P?Qe:[Qe,E]),L=this._cachedBitmapsMap.get(Ve),L||(L=new Map,this._cachedBitmapsMap.set(Ve,L));const Oe=L.get(j);if(Oe&&!P){const Ee=Math.round(Math.min(k[0],k[2])+k[4]),ae=Math.round(Math.min(k[1],k[3])+k[5]);return{canvas:Oe,offsetX:Ee,offsetY:ae}}z=Oe}z||(Z=this.cachedCanvases.getCanvas("maskCanvas",W,G),x(Z.context,O));let te=a.Util.transform(k,[1/W,0,0,-1/G,0,0]);te=a.Util.transform(te,[1,0,0,1,0,-G]);const ie=a.Util.applyTransform([0,0],te),le=a.Util.applyTransform([W,G],te),se=a.Util.normalizeRect([ie[0],ie[1],le[0],le[1]]),ue=Math.round(se[2]-se[0])||1,me=Math.round(se[3]-se[1])||1,be=this.cachedCanvases.getCanvas("fillCanvas",ue,me),we=be.context,Ae=Math.min(ie[0],le[0]),Fe=Math.min(ie[1],le[1]);we.translate(-Ae,-Fe),we.transform(...te),z||(z=this._scaleImage(Z.canvas,(0,r.getCurrentTransformInverse)(we)),z=z.img,L&&P&&L.set(j,z)),we.imageSmoothingEnabled=q((0,r.getCurrentTransform)(we),O.interpolate),w(we,z,0,0,z.width,z.height,0,0,W,G),we.globalCompositeOperation="source-in";const _e=a.Util.transform((0,r.getCurrentTransformInverse)(we),[1,0,0,1,-Ae,-Fe]);return we.fillStyle=P?E.getPattern(D,this,_e,i.PathType.FILL):E,we.fillRect(0,0,W,G),L&&!P&&(this.cachedCanvases.delete("fillCanvas"),L.set(j,be.canvas)),{canvas:be.canvas,offsetX:Math.round(Ae),offsetY:Math.round(Fe)}}setLineWidth(O){O!==this.current.lineWidth&&(this._cachedScaleForStroking=null),this.current.lineWidth=O,this.ctx.lineWidth=O}setLineCap(O){this.ctx.lineCap=U[O]}setLineJoin(O){this.ctx.lineJoin=B[O]}setMiterLimit(O){this.ctx.miterLimit=O}setDash(O,D){const W=this.ctx;W.setLineDash!==void 0&&(W.setLineDash(O),W.lineDashOffset=D)}setRenderingIntent(O){}setFlatness(O){}setGState(O){for(let D=0,W=O.length;D<W;D++){const G=O[D],E=G[0],P=G[1];switch(E){case"LW":this.setLineWidth(P);break;case"LC":this.setLineCap(P);break;case"LJ":this.setLineJoin(P);break;case"ML":this.setMiterLimit(P);break;case"D":this.setDash(P[0],P[1]);break;case"RI":this.setRenderingIntent(P);break;case"FL":this.setFlatness(P);break;case"Font":this.setFont(P[0],P[1]);break;case"CA":this.current.strokeAlpha=G[1];break;case"ca":this.current.fillAlpha=G[1],this.ctx.globalAlpha=G[1];break;case"BM":this.ctx.globalCompositeOperation=P;break;case"SMask":this.current.activeSMask=P?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.current.transferMaps=P}}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const O=this.inSMaskMode;this.current.activeSMask&&!O?this.beginSMaskMode():!this.current.activeSMask&&O&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const O=this.ctx.canvas.width,D=this.ctx.canvas.height,W="smaskGroupAt"+this.groupLevel,G=this.cachedCanvases.getCanvas(W,O,D);this.suspendedCtx=this.ctx,this.ctx=G.context;const E=this.ctx;E.setTransform(...(0,r.getCurrentTransform)(this.suspendedCtx)),R(this.suspendedCtx,E),b(E,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),R(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(O){if(!this.current.activeSMask)return;O?(O[0]=Math.floor(O[0]),O[1]=Math.floor(O[1]),O[2]=Math.ceil(O[2]),O[3]=Math.ceil(O[3])):O=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const D=this.current.activeSMask,W=this.suspendedCtx;K(W,D,this.ctx,O),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(R(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const O=this.current;this.stateStack.push(O),this.current=O.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),R(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null)}transform(O,D,W,G,E,P){this.ctx.transform(O,D,W,G,E,P),this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null}constructPath(O,D,W){const G=this.ctx,E=this.current;let P=E.x,k=E.y,L,j;const z=(0,r.getCurrentTransform)(G),Z=z[0]===0&&z[3]===0||z[1]===0&&z[2]===0,te=Z?W.slice(0):null;for(let ie=0,le=0,se=O.length;ie<se;ie++)switch(O[ie]|0){case a.OPS.rectangle:P=D[le++],k=D[le++];const ue=D[le++],me=D[le++],be=P+ue,we=k+me;G.moveTo(P,k),ue===0||me===0?G.lineTo(be,we):(G.lineTo(be,k),G.lineTo(be,we),G.lineTo(P,we)),Z||E.updateRectMinMax(z,[P,k,be,we]),G.closePath();break;case a.OPS.moveTo:P=D[le++],k=D[le++],G.moveTo(P,k),Z||E.updatePathMinMax(z,P,k);break;case a.OPS.lineTo:P=D[le++],k=D[le++],G.lineTo(P,k),Z||E.updatePathMinMax(z,P,k);break;case a.OPS.curveTo:L=P,j=k,P=D[le+4],k=D[le+5],G.bezierCurveTo(D[le],D[le+1],D[le+2],D[le+3],P,k),E.updateCurvePathMinMax(z,L,j,D[le],D[le+1],D[le+2],D[le+3],P,k,te),le+=6;break;case a.OPS.curveTo2:L=P,j=k,G.bezierCurveTo(P,k,D[le],D[le+1],D[le+2],D[le+3]),E.updateCurvePathMinMax(z,L,j,P,k,D[le],D[le+1],D[le+2],D[le+3],te),P=D[le+2],k=D[le+3],le+=4;break;case a.OPS.curveTo3:L=P,j=k,P=D[le+2],k=D[le+3],G.bezierCurveTo(D[le],D[le+1],P,k,P,k),E.updateCurvePathMinMax(z,L,j,D[le],D[le+1],P,k,P,k,te),le+=4;break;case a.OPS.closePath:G.closePath();break}Z&&E.updateScalingPathMinMax(z,te),E.setCurrentPoint(P,k)}closePath(){this.ctx.closePath()}stroke(O){O=typeof O<"u"?O:!0;const D=this.ctx,W=this.current.strokeColor;D.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof W=="object"&&W!==null&&W!==void 0&&W.getPattern?(D.save(),D.strokeStyle=W.getPattern(D,this,(0,r.getCurrentTransformInverse)(D),i.PathType.STROKE),this.rescaleAndStroke(!1),D.restore()):this.rescaleAndStroke(!0)),O&&this.consumePath(this.current.getClippedPathBoundingBox()),D.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(O){O=typeof O<"u"?O:!0;const D=this.ctx,W=this.current.fillColor,G=this.current.patternFill;let E=!1;G&&(D.save(),D.fillStyle=W.getPattern(D,this,(0,r.getCurrentTransformInverse)(D),i.PathType.FILL),E=!0);const P=this.current.getClippedPathBoundingBox();this.contentVisible&&P!==null&&(this.pendingEOFill?(D.fill("evenodd"),this.pendingEOFill=!1):D.fill()),E&&D.restore(),O&&this.consumePath(P)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=N}eoClip(){this.pendingClip=Q}beginText(){this.current.textMatrix=a.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const O=this.pendingTextPaths,D=this.ctx;if(O===void 0){D.beginPath();return}D.save(),D.beginPath();for(const W of O)D.setTransform(...W.transform),D.translate(W.x,W.y),W.addToPath(D,W.fontSize);D.restore(),D.clip(),D.beginPath(),delete this.pendingTextPaths}setCharSpacing(O){this.current.charSpacing=O}setWordSpacing(O){this.current.wordSpacing=O}setHScale(O){this.current.textHScale=O/100}setLeading(O){this.current.leading=-O}setFont(O,D){const W=this.commonObjs.get(O),G=this.current;if(!W)throw new Error(`Can't find font for ${O}`);if(G.fontMatrix=W.fontMatrix||a.FONT_IDENTITY_MATRIX,(G.fontMatrix[0]===0||G.fontMatrix[3]===0)&&(0,a.warn)("Invalid font matrix for font "+O),D<0?(D=-D,G.fontDirection=-1):G.fontDirection=1,this.current.font=W,this.current.fontSize=D,W.isType3Font)return;const E=W.loadedName||"sans-serif";let P="normal";W.black?P="900":W.bold&&(P="bold");const k=W.italic?"italic":"normal",L=`"${E}", ${W.fallbackName}`;let j=D;D<f?j=f:D>u&&(j=u),this.current.fontSizeScale=D/j,this.ctx.font=`${k} ${P} ${j}px ${L}`}setTextRenderingMode(O){this.current.textRenderingMode=O}setTextRise(O){this.current.textRise=O}moveText(O,D){this.current.x=this.current.lineX+=O,this.current.y=this.current.lineY+=D}setLeadingMoveText(O,D){this.setLeading(-D),this.moveText(O,D)}setTextMatrix(O,D,W,G,E,P){this.current.textMatrix=[O,D,W,G,E,P],this.current.textMatrixScale=Math.hypot(O,D),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(O,D,W,G){const E=this.ctx,P=this.current,k=P.font,L=P.textRenderingMode,j=P.fontSize/P.fontSizeScale,z=L&a.TextRenderingMode.FILL_STROKE_MASK,Z=!!(L&a.TextRenderingMode.ADD_TO_PATH_FLAG),te=P.patternFill&&!k.missingFile;let ie;(k.disableFontFace||Z||te)&&(ie=k.getPathGenerator(this.commonObjs,O)),k.disableFontFace||te?(E.save(),E.translate(D,W),E.beginPath(),ie(E,j),G&&E.setTransform(...G),(z===a.TextRenderingMode.FILL||z===a.TextRenderingMode.FILL_STROKE)&&E.fill(),(z===a.TextRenderingMode.STROKE||z===a.TextRenderingMode.FILL_STROKE)&&E.stroke(),E.restore()):((z===a.TextRenderingMode.FILL||z===a.TextRenderingMode.FILL_STROKE)&&E.fillText(O,D,W),(z===a.TextRenderingMode.STROKE||z===a.TextRenderingMode.FILL_STROKE)&&E.strokeText(O,D,W)),Z&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:(0,r.getCurrentTransform)(E),x:D,y:W,fontSize:j,addToPath:ie})}get isFontSubpixelAAEnabled(){const{context:O}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);O.scale(1.5,1),O.fillText("I",0,10);const D=O.getImageData(0,0,10,10).data;let W=!1;for(let G=3;G<D.length;G+=4)if(D[G]>0&&D[G]<255){W=!0;break}return(0,a.shadow)(this,"isFontSubpixelAAEnabled",W)}showText(O){const D=this.current,W=D.font;if(W.isType3Font)return this.showType3Text(O);const G=D.fontSize;if(G===0)return;const E=this.ctx,P=D.fontSizeScale,k=D.charSpacing,L=D.wordSpacing,j=D.fontDirection,z=D.textHScale*j,Z=O.length,te=W.vertical,ie=te?1:-1,le=W.defaultVMetrics,se=G*D.fontMatrix[0],ue=D.textRenderingMode===a.TextRenderingMode.FILL&&!W.disableFontFace&&!D.patternFill;E.save(),E.transform(...D.textMatrix),E.translate(D.x,D.y+D.textRise),j>0?E.scale(z,-1):E.scale(z,1);let me;if(D.patternFill){E.save();const _e=D.fillColor.getPattern(E,this,(0,r.getCurrentTransformInverse)(E),i.PathType.FILL);me=(0,r.getCurrentTransform)(E),E.restore(),E.fillStyle=_e}let be=D.lineWidth;const we=D.textMatrixScale;if(we===0||be===0){const _e=D.textRenderingMode&a.TextRenderingMode.FILL_STROKE_MASK;(_e===a.TextRenderingMode.STROKE||_e===a.TextRenderingMode.FILL_STROKE)&&(be=this.getSinglePixelWidth())}else be/=we;P!==1&&(E.scale(P,P),be/=P),E.lineWidth=be;let Ae=0,Fe;for(Fe=0;Fe<Z;++Fe){const _e=O[Fe];if(typeof _e=="number"){Ae+=ie*_e*G/1e3;continue}let Ve=!1;const Qe=(_e.isSpace?L:0)+k,Oe=_e.fontChar,Ee=_e.accent;let ae,ve,Le=_e.width;if(te){const ye=_e.vmetric||le,Pe=-(_e.vmetric?ye[1]:Le*.5)*se,Ne=ye[2]*se;Le=ye?-ye[0]:Le,ae=Pe/P,ve=(Ae+Ne)/P}else ae=Ae/P,ve=0;if(W.remeasure&&Le>0){const ye=E.measureText(Oe).width*1e3/G*P;if(Le<ye&&this.isFontSubpixelAAEnabled){const Pe=Le/ye;Ve=!0,E.save(),E.scale(Pe,1),ae/=Pe}else Le!==ye&&(ae+=(Le-ye)/2e3*G/P)}if(this.contentVisible&&(_e.isInFont||W.missingFile)){if(ue&&!Ee)E.fillText(Oe,ae,ve);else if(this.paintChar(Oe,ae,ve,me),Ee){const ye=ae+G*Ee.offset.x/P,Pe=ve-G*Ee.offset.y/P;this.paintChar(Ee.fontChar,ye,Pe,me)}}let Ke;te?Ke=Le*se-Qe*j:Ke=Le*se+Qe*j,Ae+=Ke,Ve&&E.restore()}te?D.y-=Ae:D.x+=Ae*z,E.restore(),this.compose()}showType3Text(O){const D=this.ctx,W=this.current,G=W.font,E=W.fontSize,P=W.fontDirection,k=G.vertical?1:-1,L=W.charSpacing,j=W.wordSpacing,z=W.textHScale*P,Z=W.fontMatrix||a.FONT_IDENTITY_MATRIX,te=O.length,ie=W.textRenderingMode===a.TextRenderingMode.INVISIBLE;let le,se,ue,me;if(!(ie||E===0)){for(this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null,D.save(),D.transform(...W.textMatrix),D.translate(W.x,W.y),D.scale(z,P),le=0;le<te;++le){if(se=O[le],typeof se=="number"){me=k*se*E/1e3,this.ctx.translate(me,0),W.x+=me*z;continue}const be=(se.isSpace?j:0)+L,we=G.charProcOperatorList[se.operatorListId];if(!we){(0,a.warn)(`Type3 character "${se.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=se,this.save(),D.scale(E,E),D.transform(...Z),this.executeOperatorList(we),this.restore()),ue=a.Util.applyTransform([se.width,0],Z)[0]*E+be,D.translate(ue,0),W.x+=ue*z}D.restore(),this.processingType3=null}}setCharWidth(O,D){}setCharWidthAndBounds(O,D,W,G,E,P){this.ctx.rect(W,G,E-W,P-G),this.ctx.clip(),this.endPath()}getColorN_Pattern(O){let D;if(O[0]==="TilingPattern"){const W=O[1],G=this.baseTransform||(0,r.getCurrentTransform)(this.ctx),E={createCanvasGraphics:P=>new pe(P,this.commonObjs,this.objs,this.canvasFactory)};D=new i.TilingPattern(O,W,this.ctx,E,G)}else D=this._getPattern(O[1],O[2]);return D}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(O,D,W){var G;const E=((G=this.selectColor)===null||G===void 0?void 0:G.call(this,O,D,W))||a.Util.makeHexColor(O,D,W);this.ctx.strokeStyle=E,this.current.strokeColor=E}setFillRGBColor(O,D,W){var G;const E=((G=this.selectColor)===null||G===void 0?void 0:G.call(this,O,D,W))||a.Util.makeHexColor(O,D,W);this.ctx.fillStyle=E,this.current.fillColor=E,this.current.patternFill=!1}_getPattern(O){let D=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,W;return this.cachedPatterns.has(O)?W=this.cachedPatterns.get(O):(W=(0,i.getShadingPattern)(this.objs.get(O)),this.cachedPatterns.set(O,W)),D&&(W.matrix=D),W}shadingFill(O){if(!this.contentVisible)return;const D=this.ctx;this.save();const W=this._getPattern(O);D.fillStyle=W.getPattern(D,this,(0,r.getCurrentTransformInverse)(D),i.PathType.SHADING);const G=(0,r.getCurrentTransformInverse)(D);if(G){const E=D.canvas,P=E.width,k=E.height,L=a.Util.applyTransform([0,0],G),j=a.Util.applyTransform([0,k],G),z=a.Util.applyTransform([P,0],G),Z=a.Util.applyTransform([P,k],G),te=Math.min(L[0],j[0],z[0],Z[0]),ie=Math.min(L[1],j[1],z[1],Z[1]),le=Math.max(L[0],j[0],z[0],Z[0]),se=Math.max(L[1],j[1],z[1],Z[1]);this.ctx.fillRect(te,ie,le-te,se-ie)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,a.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,a.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(O,D){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(O)&&O.length===6&&this.transform(...O),this.baseTransform=(0,r.getCurrentTransform)(this.ctx),D)){const W=D[2]-D[0],G=D[3]-D[1];this.ctx.rect(D[0],D[1],W,G),this.current.updateRectMinMax((0,r.getCurrentTransform)(this.ctx),D),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(O){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const D=this.ctx;O.isolated||(0,a.info)("TODO: Support non-isolated groups."),O.knockout&&(0,a.warn)("Knockout groups not supported.");const W=(0,r.getCurrentTransform)(D);if(O.matrix&&D.transform(...O.matrix),!O.bbox)throw new Error("Bounding box is required.");let G=a.Util.getAxialAlignedBoundingBox(O.bbox,(0,r.getCurrentTransform)(D));const E=[0,0,D.canvas.width,D.canvas.height];G=a.Util.intersect(G,E)||[0,0,0,0];const P=Math.floor(G[0]),k=Math.floor(G[1]);let L=Math.max(Math.ceil(G[2])-P,1),j=Math.max(Math.ceil(G[3])-k,1),z=1,Z=1;L>p&&(z=L/p,L=p),j>p&&(Z=j/p,j=p),this.current.startNewPathAndClipBox([0,0,L,j]);let te="groupAt"+this.groupLevel;O.smask&&(te+="_smask_"+this.smaskCounter++%2);const ie=this.cachedCanvases.getCanvas(te,L,j),le=ie.context;le.scale(1/z,1/Z),le.translate(-P,-k),le.transform(...W),O.smask?this.smaskStack.push({canvas:ie.canvas,context:le,offsetX:P,offsetY:k,scaleX:z,scaleY:Z,subtype:O.smask.subtype,backdrop:O.smask.backdrop,transferMap:O.smask.transferMap||null,startTransformInverse:null}):(D.setTransform(1,0,0,1,0,0),D.translate(P,k),D.scale(z,Z),D.save()),R(D,le),this.ctx=le,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(D),this.groupLevel++}endGroup(O){if(!this.contentVisible)return;this.groupLevel--;const D=this.ctx,W=this.groupStack.pop();if(this.ctx=W,this.ctx.imageSmoothingEnabled=!1,O.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const G=(0,r.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...G);const E=a.Util.getAxialAlignedBoundingBox([0,0,D.canvas.width,D.canvas.height],G);this.ctx.drawImage(D.canvas,0,0),this.ctx.restore(),this.compose(E)}}beginAnnotation(O,D,W,G,E){if(s(this,ce,Re).call(this),M(this.ctx,this.foregroundColor),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(D)&&D.length===4){const P=D[2]-D[0],k=D[3]-D[1];if(E&&this.annotationCanvasMap){W=W.slice(),W[4]-=D[0],W[5]-=D[1],D=D.slice(),D[0]=D[1]=0,D[2]=P,D[3]=k;const[L,j]=a.Util.singularValueDecompose2dScale((0,r.getCurrentTransform)(this.ctx)),{viewportScale:z}=this,Z=Math.ceil(P*this.outputScaleX*z),te=Math.ceil(k*this.outputScaleY*z);this.annotationCanvas=this.canvasFactory.create(Z,te);const{canvas:ie,context:le}=this.annotationCanvas;this.annotationCanvasMap.set(O,ie),this.annotationCanvas.savedCtx=this.ctx,this.ctx=le,this.ctx.setTransform(L,0,0,-j,0,k*j),M(this.ctx,this.foregroundColor)}else M(this.ctx,this.foregroundColor),this.ctx.rect(D[0],D[1],P,k),this.ctx.clip(),this.endPath()}this.current=new S(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...W),this.transform(...G)}endAnnotation(){this.annotationCanvas&&(this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(O){if(!this.contentVisible)return;const D=O.count;O=this.getObject(O.data,O),O.count=D;const W=this.ctx,G=this.processingType3;if(G&&(G.compiled===void 0&&(G.compiled=m(O)),G.compiled)){G.compiled(W);return}const E=this._createMaskCanvas(O),P=E.canvas;W.save(),W.setTransform(1,0,0,1,0,0),W.drawImage(P,E.offsetX,E.offsetY),W.restore(),this.compose()}paintImageMaskXObjectRepeat(O,D){let W=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,G=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,E=arguments.length>4?arguments[4]:void 0,P=arguments.length>5?arguments[5]:void 0;if(!this.contentVisible)return;O=this.getObject(O.data,O);const k=this.ctx;k.save();const L=(0,r.getCurrentTransform)(k);k.transform(D,W,G,E,0,0);const j=this._createMaskCanvas(O);k.setTransform(1,0,0,1,0,0);for(let z=0,Z=P.length;z<Z;z+=2){const te=a.Util.transform(L,[D,W,G,E,P[z],P[z+1]]),[ie,le]=a.Util.applyTransform([0,0],te);k.drawImage(j.canvas,ie,le)}k.restore(),this.compose()}paintImageMaskXObjectGroup(O){if(!this.contentVisible)return;const D=this.ctx,W=this.current.fillColor,G=this.current.patternFill;for(const E of O){const{data:P,width:k,height:L,transform:j}=E,z=this.cachedCanvases.getCanvas("maskCanvas",k,L),Z=z.context;Z.save();const te=this.getObject(P,E);x(Z,te),Z.globalCompositeOperation="source-in",Z.fillStyle=G?W.getPattern(Z,this,(0,r.getCurrentTransformInverse)(D),i.PathType.FILL):W,Z.fillRect(0,0,k,L),Z.restore(),D.save(),D.transform(...j),D.scale(1,-1),w(D,z.canvas,0,0,k,L,0,-1,1,1),D.restore()}this.compose()}paintImageXObject(O){if(!this.contentVisible)return;const D=this.getObject(O);if(!D){(0,a.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(D)}paintImageXObjectRepeat(O,D,W,G){if(!this.contentVisible)return;const E=this.getObject(O);if(!E){(0,a.warn)("Dependent image isn't ready yet");return}const P=E.width,k=E.height,L=[];for(let j=0,z=G.length;j<z;j+=2)L.push({transform:[D,0,0,W,G[j],G[j+1]],x:0,y:0,w:P,h:k});this.paintInlineImageXObjectGroup(E,L)}paintInlineImageXObject(O){if(!this.contentVisible)return;const D=O.width,W=O.height,G=this.ctx;this.save(),G.scale(1/D,-1/W);let E;if(typeof HTMLElement=="function"&&O instanceof HTMLElement||!O.data)E=O;else{const j=this.cachedCanvases.getCanvas("inlineImage",D,W),z=j.context;C(z,O,this.current.transferMaps),E=j.canvas}const P=this._scaleImage(E,(0,r.getCurrentTransformInverse)(G));G.imageSmoothingEnabled=q((0,r.getCurrentTransform)(G),O.interpolate);const[k,L]=w(G,P.img,0,0,P.paintWidth,P.paintHeight,0,-W,D,W);if(this.imageLayer){const[j,z]=a.Util.applyTransform([0,-W],(0,r.getCurrentTransform)(this.ctx));this.imageLayer.appendImage({imgData:O,left:j,top:z,width:k,height:L})}this.compose(),this.restore()}paintInlineImageXObjectGroup(O,D){if(!this.contentVisible)return;const W=this.ctx,G=O.width,E=O.height,P=this.cachedCanvases.getCanvas("inlineImage",G,E),k=P.context;C(k,O,this.current.transferMaps);for(const L of D){if(W.save(),W.transform(...L.transform),W.scale(1,-1),w(W,P.canvas,L.x,L.y,L.w,L.h,0,-1,1,1),this.imageLayer){const[j,z]=a.Util.applyTransform([L.x,L.y],(0,r.getCurrentTransform)(this.ctx));this.imageLayer.appendImage({imgData:O,left:j,top:z,width:G,height:E})}W.restore()}this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(O){}markPointProps(O,D){}beginMarkedContent(O){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(O,D){O==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(D)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(O){const D=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(O);const W=this.ctx;this.pendingClip&&(D||(this.pendingClip===Q?W.clip("evenodd"):W.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),W.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const O=(0,r.getCurrentTransform)(this.ctx);if(O[1]===0&&O[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(O[0]),Math.abs(O[3]));else{const D=Math.abs(O[0]*O[3]-O[2]*O[1]),W=Math.hypot(O[0],O[2]),G=Math.hypot(O[1],O[3]);this._cachedGetSinglePixelWidth=Math.max(W,G)/D}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(!this._cachedScaleForStroking){const{lineWidth:O}=this.current,D=(0,r.getCurrentTransform)(this.ctx);let W,G;if(D[1]===0&&D[2]===0){const E=Math.abs(D[0]),P=Math.abs(D[3]);if(O===0)W=1/E,G=1/P;else{const k=E*O,L=P*O;W=k<1?1/k:1,G=L<1?1/L:1}}else{const E=Math.abs(D[0]*D[3]-D[2]*D[1]),P=Math.hypot(D[0],D[1]),k=Math.hypot(D[2],D[3]);if(O===0)W=k/E,G=P/E;else{const L=O*E;W=k>L?k/L:1,G=P>L?P/L:1}}this._cachedScaleForStroking=[W,G]}return this._cachedScaleForStroking}rescaleAndStroke(O){const{ctx:D}=this,{lineWidth:W}=this.current,[G,E]=this.getScaleForStroking();if(D.lineWidth=W||1,G===1&&E===1){D.stroke();return}let P,k,L;O&&(P=(0,r.getCurrentTransform)(D),k=D.getLineDash().slice(),L=D.lineDashOffset),D.scale(G,E);const j=Math.max(G,E);D.setLineDash(D.getLineDash().map(z=>z/j)),D.lineDashOffset/=j,D.stroke(),O&&(D.setTransform(...P),D.setLineDash(k),D.lineDashOffset=L)}isContentVisible(){for(let O=this.markedContentStack.length-1;O>=0;O--)if(!this.markedContentStack[O].visible)return!1;return!0}}e.CanvasGraphics=pe;function Re(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}for(const Y in a.OPS)pe.prototype[Y]!==void 0&&(pe.prototype[a.OPS[Y]]=pe.prototype[Y])},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TilingPattern=e.PathType=void 0,e.getShadingPattern=v;var r=t(1),a=t(133),i=t(3);const c={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};e.PathType=c;function l(T,b){if(!b||i.isNodeJS)return;const _=b[2]-b[0],w=b[3]-b[1],m=new Path2D;m.rect(b[0],b[1],_,w),T.clip(m)}class h{constructor(){this.constructor===h&&(0,r.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,r.unreachable)("Abstract method `getPattern` called.")}}class o extends h{constructor(b){super(),this._type=b[1],this._bbox=b[2],this._colorStops=b[3],this._p0=b[4],this._p1=b[5],this._r0=b[6],this._r1=b[7],this.matrix=null}_createGradient(b){let _;this._type==="axial"?_=b.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(_=b.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const w of this._colorStops)_.addColorStop(w[0],w[1]);return _}getPattern(b,_,w,m){let S;if(m===c.STROKE||m===c.FILL){const C=_.current.getClippedPathBoundingBox(m,(0,a.getCurrentTransform)(b))||[0,0,0,0],x=Math.ceil(C[2]-C[0])||1,R=Math.ceil(C[3]-C[1])||1,M=_.cachedCanvases.getCanvas("pattern",x,R,!0),F=M.context;F.clearRect(0,0,F.canvas.width,F.canvas.height),F.beginPath(),F.rect(0,0,F.canvas.width,F.canvas.height),F.translate(-C[0],-C[1]),w=r.Util.transform(w,[1,0,0,1,C[0],C[1]]),F.transform(..._.baseTransform),this.matrix&&F.transform(...this.matrix),l(F,this._bbox),F.fillStyle=this._createGradient(F),F.fill(),S=b.createPattern(M.canvas,"no-repeat");const H=new DOMMatrix(w);try{S.setTransform(H)}catch(V){(0,r.warn)(`RadialAxialShadingPattern.getPattern: "${V==null?void 0:V.message}".`)}}else l(b,this._bbox),S=this._createGradient(b);return S}}function s(T,b,_,w,m,S,C,x){const R=b.coords,M=b.colors,F=T.data,H=T.width*4;let V;R[_+1]>R[w+1]&&(V=_,_=w,w=V,V=S,S=C,C=V),R[w+1]>R[m+1]&&(V=w,w=m,m=V,V=C,C=x,x=V),R[_+1]>R[w+1]&&(V=_,_=w,w=V,V=S,S=C,C=V);const X=(R[_]+b.offsetX)*b.scaleX,K=(R[_+1]+b.offsetY)*b.scaleY,q=(R[w]+b.offsetX)*b.scaleX,U=(R[w+1]+b.offsetY)*b.scaleY,B=(R[m]+b.offsetX)*b.scaleX,N=(R[m+1]+b.offsetY)*b.scaleY;if(K>=N)return;const Q=M[S],ce=M[S+1],pe=M[S+2],Re=M[C],Y=M[C+1],O=M[C+2],D=M[x],W=M[x+1],G=M[x+2],E=Math.round(K),P=Math.round(N);let k,L,j,z,Z,te,ie,le;for(let se=E;se<=P;se++){if(se<U){let Ae;se<K?Ae=0:Ae=(K-se)/(K-U),k=X-(X-q)*Ae,L=Q-(Q-Re)*Ae,j=ce-(ce-Y)*Ae,z=pe-(pe-O)*Ae}else{let Ae;se>N?Ae=1:U===N?Ae=0:Ae=(U-se)/(U-N),k=q-(q-B)*Ae,L=Re-(Re-D)*Ae,j=Y-(Y-W)*Ae,z=O-(O-G)*Ae}let ue;se<K?ue=0:se>N?ue=1:ue=(K-se)/(K-N),Z=X-(X-B)*ue,te=Q-(Q-D)*ue,ie=ce-(ce-W)*ue,le=pe-(pe-G)*ue;const me=Math.round(Math.min(k,Z)),be=Math.round(Math.max(k,Z));let we=H*se+me*4;for(let Ae=me;Ae<=be;Ae++)ue=(k-Ae)/(k-Z),ue<0?ue=0:ue>1&&(ue=1),F[we++]=L-(L-te)*ue|0,F[we++]=j-(j-ie)*ue|0,F[we++]=z-(z-le)*ue|0,F[we++]=255}}function f(T,b,_){const w=b.coords,m=b.colors;let S,C;switch(b.type){case"lattice":const x=b.verticesPerRow,R=Math.floor(w.length/x)-1,M=x-1;for(S=0;S<R;S++){let F=S*x;for(let H=0;H<M;H++,F++)s(T,_,w[F],w[F+1],w[F+x],m[F],m[F+1],m[F+x]),s(T,_,w[F+x+1],w[F+1],w[F+x],m[F+x+1],m[F+1],m[F+x])}break;case"triangles":for(S=0,C=w.length;S<C;S+=3)s(T,_,w[S],w[S+1],w[S+2],m[S],m[S+1],m[S+2]);break;default:throw new Error("illegal figure")}}class u extends h{constructor(b){super(),this._coords=b[2],this._colors=b[3],this._figures=b[4],this._bounds=b[5],this._bbox=b[7],this._background=b[8],this.matrix=null}_createMeshCanvas(b,_,w){const x=Math.floor(this._bounds[0]),R=Math.floor(this._bounds[1]),M=Math.ceil(this._bounds[2])-x,F=Math.ceil(this._bounds[3])-R,H=Math.min(Math.ceil(Math.abs(M*b[0]*1.1)),3e3),V=Math.min(Math.ceil(Math.abs(F*b[1]*1.1)),3e3),X=M/H,K=F/V,q={coords:this._coords,colors:this._colors,offsetX:-x,offsetY:-R,scaleX:1/X,scaleY:1/K},U=H+2*2,B=V+2*2,N=w.getCanvas("mesh",U,B,!1),Q=N.context,ce=Q.createImageData(H,V);if(_){const Re=ce.data;for(let Y=0,O=Re.length;Y<O;Y+=4)Re[Y]=_[0],Re[Y+1]=_[1],Re[Y+2]=_[2],Re[Y+3]=255}for(const Re of this._figures)f(ce,Re,q);return Q.putImageData(ce,2,2),{canvas:N.canvas,offsetX:x-2*X,offsetY:R-2*K,scaleX:X,scaleY:K}}getPattern(b,_,w,m){l(b,this._bbox);let S;if(m===c.SHADING)S=r.Util.singularValueDecompose2dScale((0,a.getCurrentTransform)(b));else if(S=r.Util.singularValueDecompose2dScale(_.baseTransform),this.matrix){const x=r.Util.singularValueDecompose2dScale(this.matrix);S=[S[0]*x[0],S[1]*x[1]]}const C=this._createMeshCanvas(S,m===c.SHADING?null:this._background,_.cachedCanvases);return m!==c.SHADING&&(b.setTransform(..._.baseTransform),this.matrix&&b.transform(...this.matrix)),b.translate(C.offsetX,C.offsetY),b.scale(C.scaleX,C.scaleY),b.createPattern(C.canvas,"no-repeat")}}class p extends h{getPattern(){return"hotpink"}}function v(T){switch(T[0]){case"RadialAxial":return new o(T);case"Mesh":return new u(T);case"Dummy":return new p}throw new Error(`Unknown IR type: ${T[0]}`)}const g={COLORED:1,UNCOLORED:2};class A{static get MAX_PATTERN_SIZE(){return(0,r.shadow)(this,"MAX_PATTERN_SIZE",3e3)}constructor(b,_,w,m,S){this.operatorList=b[2],this.matrix=b[3]||[1,0,0,1,0,0],this.bbox=b[4],this.xstep=b[5],this.ystep=b[6],this.paintType=b[7],this.tilingType=b[8],this.color=_,this.ctx=w,this.canvasGraphicsFactory=m,this.baseTransform=S}createPatternCanvas(b){const _=this.operatorList,w=this.bbox,m=this.xstep,S=this.ystep,C=this.paintType,x=this.tilingType,R=this.color,M=this.canvasGraphicsFactory;(0,r.info)("TilingType: "+x);const F=w[0],H=w[1],V=w[2],X=w[3],K=r.Util.singularValueDecompose2dScale(this.matrix),q=r.Util.singularValueDecompose2dScale(this.baseTransform),U=[K[0]*q[0],K[1]*q[1]],B=this.getSizeAndScale(m,this.ctx.canvas.width,U[0]),N=this.getSizeAndScale(S,this.ctx.canvas.height,U[1]),Q=b.cachedCanvases.getCanvas("pattern",B.size,N.size,!0),ce=Q.context,pe=M.createCanvasGraphics(ce);pe.groupLevel=b.groupLevel,this.setFillAndStrokeStyleToContext(pe,C,R);let Re=F,Y=H,O=V,D=X;return F<0&&(Re=0,O+=Math.abs(F)),H<0&&(Y=0,D+=Math.abs(H)),ce.translate(-(B.scale*Re),-(N.scale*Y)),pe.transform(B.scale,0,0,N.scale,0,0),ce.save(),this.clipBbox(pe,Re,Y,O,D),pe.baseTransform=(0,a.getCurrentTransform)(pe.ctx),pe.executeOperatorList(_),pe.endDrawing(),{canvas:Q.canvas,scaleX:B.scale,scaleY:N.scale,offsetX:Re,offsetY:Y}}getSizeAndScale(b,_,w){b=Math.abs(b);const m=Math.max(A.MAX_PATTERN_SIZE,_);let S=Math.ceil(b*w);return S>=m?S=m:w=S/b,{scale:w,size:S}}clipBbox(b,_,w,m,S){const C=m-_,x=S-w;b.ctx.rect(_,w,C,x),b.current.updateRectMinMax((0,a.getCurrentTransform)(b.ctx),[_,w,m,S]),b.clip(),b.endPath()}setFillAndStrokeStyleToContext(b,_,w){const m=b.ctx,S=b.current;switch(_){case g.COLORED:const C=this.ctx;m.fillStyle=C.fillStyle,m.strokeStyle=C.strokeStyle,S.fillColor=C.fillStyle,S.strokeColor=C.strokeStyle;break;case g.UNCOLORED:const x=r.Util.makeHexColor(w[0],w[1],w[2]);m.fillStyle=x,m.strokeStyle=x,S.fillColor=x,S.strokeColor=x;break;default:throw new r.FormatError(`Unsupported paint type: ${_}`)}}getPattern(b,_,w,m){let S=w;m!==c.SHADING&&(S=r.Util.transform(S,_.baseTransform),this.matrix&&(S=r.Util.transform(S,this.matrix)));const C=this.createPatternCanvas(_);let x=new DOMMatrix(S);x=x.translate(C.offsetX,C.offsetY),x=x.scale(1/C.scaleX,1/C.scaleY);const R=b.createPattern(C.canvas,"repeat");try{R.setTransform(x)}catch(M){(0,r.warn)(`TilingPattern.getPattern: "${M==null?void 0:M.message}".`)}return R}}e.TilingPattern=A},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.applyMaskImageData=a;var r=t(1);function a(i){let{src:c,srcPos:l=0,dest:h,destPos:o=0,width:s,height:f,inverseDecode:u=!1}=i;const p=r.FeatureTest.isLittleEndian?4278190080:255,[v,g]=u?[0,p]:[p,0],A=s>>3,T=s&7,b=c.length;h=new Uint32Array(h.buffer);for(let _=0;_<f;_++){for(const m=l+A;l<m;l++){const S=l<b?c[l]:255;h[o++]=S&128?g:v,h[o++]=S&64?g:v,h[o++]=S&32?g:v,h[o++]=S&16?g:v,h[o++]=S&8?g:v,h[o++]=S&4?g:v,h[o++]=S&2?g:v,h[o++]=S&1?g:v}if(T===0)continue;const w=l<b?c[l++]:255;for(let m=0;m<T;m++)h[o++]=w&1<<7-m?g:v}return{srcPos:l,destPos:o}}},(n,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GlobalWorkerOptions=void 0;const t=Object.create(null);e.GlobalWorkerOptions=t,t.workerPort=t.workerPort===void 0?null:t.workerPort,t.workerSrc=t.workerSrc===void 0?"":t.workerSrc},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MessageHandler=void 0;var r=t(1);const a={DATA:1,ERROR:2},i={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function c(h){switch(h instanceof Error||typeof h=="object"&&h!==null||(0,r.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),h.name){case"AbortException":return new r.AbortException(h.message);case"MissingPDFException":return new r.MissingPDFException(h.message);case"PasswordException":return new r.PasswordException(h.message,h.code);case"UnexpectedResponseException":return new r.UnexpectedResponseException(h.message,h.status);case"UnknownErrorException":return new r.UnknownErrorException(h.message,h.details);default:return new r.UnknownErrorException(h.message,h.toString())}}class l{constructor(o,s,f){this.sourceName=o,this.targetName=s,this.comObj=f,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=u=>{const p=u.data;if(p.targetName!==this.sourceName)return;if(p.stream){this._processStreamMessage(p);return}if(p.callback){const g=p.callbackId,A=this.callbackCapabilities[g];if(!A)throw new Error(`Cannot resolve callback ${g}`);if(delete this.callbackCapabilities[g],p.callback===a.DATA)A.resolve(p.data);else if(p.callback===a.ERROR)A.reject(c(p.reason));else throw new Error("Unexpected callback case");return}const v=this.actionHandler[p.action];if(!v)throw new Error(`Unknown action from worker: ${p.action}`);if(p.callbackId){const g=this.sourceName,A=p.sourceName;new Promise(function(T){T(v(p.data))}).then(function(T){f.postMessage({sourceName:g,targetName:A,callback:a.DATA,callbackId:p.callbackId,data:T})},function(T){f.postMessage({sourceName:g,targetName:A,callback:a.ERROR,callbackId:p.callbackId,reason:c(T)})});return}if(p.streamId){this._createStreamSink(p);return}v(p.data)},f.addEventListener("message",this._onComObjOnMessage)}on(o,s){const f=this.actionHandler;if(f[o])throw new Error(`There is already an actionName called "${o}"`);f[o]=s}send(o,s,f){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:o,data:s},f)}sendWithPromise(o,s,f){const u=this.callbackId++,p=(0,r.createPromiseCapability)();this.callbackCapabilities[u]=p;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:o,callbackId:u,data:s},f)}catch(v){p.reject(v)}return p.promise}sendWithStream(o,s,f,u){const p=this.streamId++,v=this.sourceName,g=this.targetName,A=this.comObj;return new ReadableStream({start:T=>{const b=(0,r.createPromiseCapability)();return this.streamControllers[p]={controller:T,startCall:b,pullCall:null,cancelCall:null,isClosed:!1},A.postMessage({sourceName:v,targetName:g,action:o,streamId:p,data:s,desiredSize:T.desiredSize},u),b.promise},pull:T=>{const b=(0,r.createPromiseCapability)();return this.streamControllers[p].pullCall=b,A.postMessage({sourceName:v,targetName:g,stream:i.PULL,streamId:p,desiredSize:T.desiredSize}),b.promise},cancel:T=>{(0,r.assert)(T instanceof Error,"cancel must have a valid reason");const b=(0,r.createPromiseCapability)();return this.streamControllers[p].cancelCall=b,this.streamControllers[p].isClosed=!0,A.postMessage({sourceName:v,targetName:g,stream:i.CANCEL,streamId:p,reason:c(T)}),b.promise}},f)}_createStreamSink(o){const s=o.streamId,f=this.sourceName,u=o.sourceName,p=this.comObj,v=this,g=this.actionHandler[o.action],A={enqueue(T){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,_=arguments.length>2?arguments[2]:void 0;if(this.isCancelled)return;const w=this.desiredSize;this.desiredSize-=b,w>0&&this.desiredSize<=0&&(this.sinkCapability=(0,r.createPromiseCapability)(),this.ready=this.sinkCapability.promise),p.postMessage({sourceName:f,targetName:u,stream:i.ENQUEUE,streamId:s,chunk:T},_)},close(){this.isCancelled||(this.isCancelled=!0,p.postMessage({sourceName:f,targetName:u,stream:i.CLOSE,streamId:s}),delete v.streamSinks[s])},error(T){(0,r.assert)(T instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,p.postMessage({sourceName:f,targetName:u,stream:i.ERROR,streamId:s,reason:c(T)}))},sinkCapability:(0,r.createPromiseCapability)(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:o.desiredSize,ready:null};A.sinkCapability.resolve(),A.ready=A.sinkCapability.promise,this.streamSinks[s]=A,new Promise(function(T){T(g(o.data,A))}).then(function(){p.postMessage({sourceName:f,targetName:u,stream:i.START_COMPLETE,streamId:s,success:!0})},function(T){p.postMessage({sourceName:f,targetName:u,stream:i.START_COMPLETE,streamId:s,reason:c(T)})})}_processStreamMessage(o){const s=o.streamId,f=this.sourceName,u=o.sourceName,p=this.comObj,v=this.streamControllers[s],g=this.streamSinks[s];switch(o.stream){case i.START_COMPLETE:o.success?v.startCall.resolve():v.startCall.reject(c(o.reason));break;case i.PULL_COMPLETE:o.success?v.pullCall.resolve():v.pullCall.reject(c(o.reason));break;case i.PULL:if(!g){p.postMessage({sourceName:f,targetName:u,stream:i.PULL_COMPLETE,streamId:s,success:!0});break}g.desiredSize<=0&&o.desiredSize>0&&g.sinkCapability.resolve(),g.desiredSize=o.desiredSize,new Promise(function(A){A(g.onPull&&g.onPull())}).then(function(){p.postMessage({sourceName:f,targetName:u,stream:i.PULL_COMPLETE,streamId:s,success:!0})},function(A){p.postMessage({sourceName:f,targetName:u,stream:i.PULL_COMPLETE,streamId:s,reason:c(A)})});break;case i.ENQUEUE:if((0,r.assert)(v,"enqueue should have stream controller"),v.isClosed)break;v.controller.enqueue(o.chunk);break;case i.CLOSE:if((0,r.assert)(v,"close should have stream controller"),v.isClosed)break;v.isClosed=!0,v.controller.close(),this._deleteStreamController(v,s);break;case i.ERROR:(0,r.assert)(v,"error should have stream controller"),v.controller.error(c(o.reason)),this._deleteStreamController(v,s);break;case i.CANCEL_COMPLETE:o.success?v.cancelCall.resolve():v.cancelCall.reject(c(o.reason)),this._deleteStreamController(v,s);break;case i.CANCEL:if(!g)break;new Promise(function(A){A(g.onCancel&&g.onCancel(c(o.reason)))}).then(function(){p.postMessage({sourceName:f,targetName:u,stream:i.CANCEL_COMPLETE,streamId:s,success:!0})},function(A){p.postMessage({sourceName:f,targetName:u,stream:i.CANCEL_COMPLETE,streamId:s,reason:c(A)})}),g.sinkCapability.reject(c(o.reason)),g.isCancelled=!0,delete this.streamSinks[s];break;default:throw new Error("Unexpected stream case")}}async _deleteStreamController(o,s){await Promise.allSettled([o.startCall&&o.startCall.promise,o.pullCall&&o.pullCall.promise,o.cancelCall&&o.cancelCall.promise]),delete this.streamControllers[s]}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}e.MessageHandler=l},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Metadata=void 0;var r=t(1);function a(v,g,A){i(v,g),g.set(v,A)}function i(v,g){if(g.has(v))throw new TypeError("Cannot initialize the same private elements twice on an object")}function c(v,g){var A=o(v,g,"get");return l(v,A)}function l(v,g){return g.get?g.get.call(v):g.value}function h(v,g,A){var T=o(v,g,"set");return s(v,T,A),A}function o(v,g,A){if(!g.has(v))throw new TypeError("attempted to "+A+" private field on non-instance");return g.get(v)}function s(v,g,A){if(g.set)g.set.call(v,A);else{if(!g.writable)throw new TypeError("attempted to set read only private field");g.value=A}}var f=new WeakMap,u=new WeakMap;class p{constructor(g){let{parsedData:A,rawData:T}=g;a(this,f,{writable:!0,value:void 0}),a(this,u,{writable:!0,value:void 0}),h(this,f,A),h(this,u,T)}getRaw(){return c(this,u)}get(g){var A;return(A=c(this,f).get(g))!==null&&A!==void 0?A:null}getAll(){return(0,r.objectFromMap)(c(this,f))}has(g){return c(this,f).has(g)}}e.Metadata=p},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.OptionalContentConfig=void 0;var r=t(1);function a(C,x){l(C,x),x.add(C)}function i(C,x,R){if(!x.has(C))throw new TypeError("attempted to get private field on non-instance");return R}function c(C,x,R){l(C,x),x.set(C,R)}function l(C,x){if(x.has(C))throw new TypeError("Cannot initialize the same private elements twice on an object")}function h(C,x,R){var M=f(C,x,"set");return o(C,M,R),R}function o(C,x,R){if(x.set)x.set.call(C,R);else{if(!x.writable)throw new TypeError("attempted to set read only private field");x.value=R}}function s(C,x){var R=f(C,x,"get");return u(C,R)}function f(C,x,R){if(!x.has(C))throw new TypeError("attempted to "+R+" private field on non-instance");return x.get(C)}function u(C,x){return x.get?x.get.call(C):x.value}const p=Symbol("INTERNAL");var v=new WeakMap;class g{constructor(x,R){c(this,v,{writable:!0,value:!0}),this.name=x,this.intent=R}get visible(){return s(this,v)}_setVisible(x,R){x!==p&&(0,r.unreachable)("Internal method `_setVisible` called."),h(this,v,R)}}var A=new WeakMap,T=new WeakMap,b=new WeakMap,_=new WeakMap,w=new WeakSet;class m{constructor(x){if(a(this,w),c(this,A,{writable:!0,value:!0}),c(this,T,{writable:!0,value:new Map}),c(this,b,{writable:!0,value:null}),c(this,_,{writable:!0,value:null}),this.name=null,this.creator=null,x!==null){this.name=x.name,this.creator=x.creator,h(this,_,x.order);for(const R of x.groups)s(this,T).set(R.id,new g(R.name,R.intent));if(x.baseState==="OFF")for(const R of s(this,T).values())R._setVisible(p,!1);for(const R of x.on)s(this,T).get(R)._setVisible(p,!0);for(const R of x.off)s(this,T).get(R)._setVisible(p,!1);h(this,b,new Map);for(const[R,M]of s(this,T))s(this,b).set(R,M.visible)}}isVisible(x){if(s(this,T).size===0)return!0;if(!x)return(0,r.warn)("Optional content group not defined."),!0;if(x.type==="OCG")return s(this,T).has(x.id)?s(this,T).get(x.id).visible:((0,r.warn)(`Optional content group not found: ${x.id}`),!0);if(x.type==="OCMD"){if(x.expression)return i(this,w,S).call(this,x.expression);if(!x.policy||x.policy==="AnyOn"){for(const R of x.ids){if(!s(this,T).has(R))return(0,r.warn)(`Optional content group not found: ${R}`),!0;if(s(this,T).get(R).visible)return!0}return!1}else if(x.policy==="AllOn"){for(const R of x.ids){if(!s(this,T).has(R))return(0,r.warn)(`Optional content group not found: ${R}`),!0;if(!s(this,T).get(R).visible)return!1}return!0}else if(x.policy==="AnyOff"){for(const R of x.ids){if(!s(this,T).has(R))return(0,r.warn)(`Optional content group not found: ${R}`),!0;if(!s(this,T).get(R).visible)return!0}return!1}else if(x.policy==="AllOff"){for(const R of x.ids){if(!s(this,T).has(R))return(0,r.warn)(`Optional content group not found: ${R}`),!0;if(s(this,T).get(R).visible)return!1}return!0}return(0,r.warn)(`Unknown optional content policy ${x.policy}.`),!0}return(0,r.warn)(`Unknown group type ${x.type}.`),!0}setVisibility(x){let R=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!s(this,T).has(x)){(0,r.warn)(`Optional content group not found: ${x}`);return}s(this,T).get(x)._setVisible(p,!!R),h(this,A,null)}get hasInitialVisibility(){if(s(this,A)!==null)return s(this,A);for(const[x,R]of s(this,T)){const M=s(this,b).get(x);if(R.visible!==M)return h(this,A,!1)}return h(this,A,!0)}getOrder(){return s(this,T).size?s(this,_)?s(this,_).slice():[...s(this,T).keys()]:null}getGroups(){return s(this,T).size>0?(0,r.objectFromMap)(s(this,T)):null}getGroup(x){return s(this,T).get(x)||null}}e.OptionalContentConfig=m;function S(C){const x=C.length;if(x<2)return!0;const R=C[0];for(let M=1;M<x;M++){const F=C[M];let H;if(Array.isArray(F))H=i(this,w,S).call(this,F);else if(s(this,T).has(F))H=s(this,T).get(F).visible;else return(0,r.warn)(`Optional content group not found: ${F}`),!0;switch(R){case"And":if(!H)return!1;break;case"Or":if(H)return!0;break;case"Not":return!H;default:return!0}}return R==="And"}},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFDataTransportStream=void 0;var r=t(1),a=t(133);class i{constructor(o,s){(0,r.assert)(s,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=o.progressiveDone||!1,this._contentDispositionFilename=o.contentDispositionFilename||null;const f=o.initialData;if((f==null?void 0:f.length)>0){const u=new Uint8Array(f).buffer;this._queuedChunks.push(u)}this._pdfDataRangeTransport=s,this._isStreamingSupported=!o.disableStream,this._isRangeSupported=!o.disableRange,this._contentLength=o.length,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((u,p)=>{this._onReceiveData({begin:u,chunk:p})}),this._pdfDataRangeTransport.addProgressListener((u,p)=>{this._onProgress({loaded:u,total:p})}),this._pdfDataRangeTransport.addProgressiveReadListener(u=>{this._onReceiveData({chunk:u})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData(o){const s=new Uint8Array(o.chunk).buffer;if(o.begin===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(s):this._queuedChunks.push(s);else{const f=this._rangeReaders.some(function(u){return u._begin!==o.begin?!1:(u._enqueue(s),!0)});(0,r.assert)(f,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var o,s;return(o=(s=this._fullRequestReader)===null||s===void 0?void 0:s._loaded)!==null&&o!==void 0?o:0}_onProgress(o){if(o.total===void 0){const s=this._rangeReaders[0];s!=null&&s.onProgress&&s.onProgress({loaded:o.loaded})}else{const s=this._fullRequestReader;s!=null&&s.onProgress&&s.onProgress({loaded:o.loaded,total:o.total})}}_onProgressiveDone(){this._fullRequestReader&&this._fullRequestReader.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(o){const s=this._rangeReaders.indexOf(o);s>=0&&this._rangeReaders.splice(s,1)}getFullReader(){(0,r.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const o=this._queuedChunks;return this._queuedChunks=null,new c(this,o,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(o,s){if(s<=this._progressiveDataLength)return null;const f=new l(this,o,s);return this._pdfDataRangeTransport.requestDataRange(o,s),this._rangeReaders.push(f),f}cancelAllRequests(o){this._fullRequestReader&&this._fullRequestReader.cancel(o);for(const s of this._rangeReaders.slice(0))s.cancel(o);this._pdfDataRangeTransport.abort()}}e.PDFDataTransportStream=i;class c{constructor(o,s){let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;this._stream=o,this._done=f||!1,this._filename=(0,a.isPdfFile)(u)?u:null,this._queuedChunks=s||[],this._loaded=0;for(const p of this._queuedChunks)this._loaded+=p.byteLength;this._requests=[],this._headersReady=Promise.resolve(),o._fullRequestReader=this,this.onProgress=null}_enqueue(o){this._done||(this._requests.length>0?this._requests.shift().resolve({value:o,done:!1}):this._queuedChunks.push(o),this._loaded+=o.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const o=(0,r.createPromiseCapability)();return this._requests.push(o),o.promise}cancel(o){this._done=!0;for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class l{constructor(o,s,f){this._stream=o,this._begin=s,this._end=f,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(o){if(!this._done){if(this._requests.length===0)this._queuedChunk=o;else{this._requests.shift().resolve({value:o,done:!1});for(const f of this._requests)f.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const s=this._queuedChunk;return this._queuedChunk=null,{value:s,done:!1}}if(this._done)return{value:void 0,done:!0};const o=(0,r.createPromiseCapability)();return this._requests.push(o),o.promise}cancel(o){this._done=!0;for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(n,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.XfaText=void 0;class t{static textContent(a){const i=[],c={items:i,styles:Object.create(null)};function l(h){var o;if(!h)return;let s=null;const f=h.name;if(f==="#text")s=h.value;else if(t.shouldBuildText(f))h!=null&&(o=h.attributes)!==null&&o!==void 0&&o.textContent?s=h.attributes.textContent:h.value&&(s=h.value);else return;if(s!==null&&i.push({str:s}),!!h.children)for(const u of h.children)l(u)}return l(a),c}static shouldBuildText(a){return!(a==="textarea"||a==="input"||a==="option"||a==="select")}}e.XfaText=t},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.NodeStandardFontDataFactory=e.NodeCanvasFactory=e.NodeCMapReaderFactory=void 0;var r=t(134);const a=function(h){return new Promise((o,s)=>{require$$7.readFile(h,(u,p)=>{if(u||!p){s(new Error(u));return}o(new Uint8Array(p))})})};class i extends r.BaseCanvasFactory{_createCanvas(o,s){return require$$7.createCanvas(o,s)}}e.NodeCanvasFactory=i;class c extends r.BaseCMapReaderFactory{_fetchData(o,s){return a(o).then(f=>({cMapData:f,compressionType:s}))}}e.NodeCMapReaderFactory=c;class l extends r.BaseStandardFontDataFactory{_fetchData(o){return a(o)}}e.NodeStandardFontDataFactory=l},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AnnotationEditorLayer=void 0;var r=t(132),a=t(1),i=t(148),c=t(149);function l(B,N){s(B,N),N.add(B)}function h(B,N,Q){return N in B?Object.defineProperty(B,N,{value:Q,enumerable:!0,configurable:!0,writable:!0}):B[N]=Q,B}function o(B,N,Q){s(B,N),N.set(B,Q)}function s(B,N){if(N.has(B))throw new TypeError("Cannot initialize the same private elements twice on an object")}function f(B,N,Q){if(!N.has(B))throw new TypeError("attempted to get private field on non-instance");return Q}function u(B,N){var Q=g(B,N,"get");return p(B,Q)}function p(B,N){return N.get?N.get.call(B):N.value}function v(B,N,Q){var ce=g(B,N,"set");return A(B,ce,Q),Q}function g(B,N,Q){if(!N.has(B))throw new TypeError("attempted to "+Q+" private field on non-instance");return N.get(B)}function A(B,N,Q){if(N.set)N.set.call(B,Q);else{if(!N.writable)throw new TypeError("attempted to set read only private field");N.value=Q}}var T=new WeakMap,b=new WeakMap,_=new WeakMap,w=new WeakMap,m=new WeakMap,S=new WeakMap,C=new WeakMap,x=new WeakMap,R=new WeakSet,M=new WeakSet,F=new WeakSet,H=new WeakSet;class V{constructor(N){l(this,H),l(this,F),l(this,M),l(this,R),o(this,T,{writable:!0,value:void 0}),o(this,b,{writable:!0,value:!1}),o(this,_,{writable:!0,value:this.pointerup.bind(this)}),o(this,w,{writable:!0,value:this.pointerdown.bind(this)}),o(this,m,{writable:!0,value:new Map}),o(this,S,{writable:!0,value:!1}),o(this,C,{writable:!0,value:!1}),o(this,x,{writable:!0,value:void 0}),V._initialized||(V._initialized=!0,i.FreeTextEditor.initialize(N.l10n),c.InkEditor.initialize(N.l10n),N.uiManager.registerEditorTypes([i.FreeTextEditor,c.InkEditor])),v(this,x,N.uiManager),this.annotationStorage=N.annotationStorage,this.pageIndex=N.pageIndex,this.div=N.div,v(this,T,N.accessibilityManager),u(this,x).addLayer(this)}updateToolbar(N){u(this,x).updateToolbar(N)}updateMode(){let N=arguments.length>0&&arguments[0]!==void 0?arguments[0]:u(this,x).getMode();f(this,H,U).call(this),N===a.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),u(this,x).unselectAll()}addInkEditorIfNeeded(N){if(!N&&u(this,x).getMode()!==a.AnnotationEditorType.INK)return;if(!N){for(const ce of u(this,m).values())if(ce.isEmpty()){ce.setInBackground();return}}f(this,F,q).call(this,{offsetX:0,offsetY:0}).setInBackground()}setEditingState(N){u(this,x).setEditingState(N)}addCommands(N){u(this,x).addCommands(N)}enable(){this.div.style.pointerEvents="auto";for(const N of u(this,m).values())N.enableEditing()}disable(){this.div.style.pointerEvents="none";for(const N of u(this,m).values())N.disableEditing()}setActiveEditor(N){u(this,x).getActive()!==N&&u(this,x).setActiveEditor(N)}enableClick(){this.div.addEventListener("pointerdown",u(this,w)),this.div.addEventListener("pointerup",u(this,_))}disableClick(){this.div.removeEventListener("pointerdown",u(this,w)),this.div.removeEventListener("pointerup",u(this,_))}attach(N){u(this,m).set(N.id,N)}detach(N){var Q;u(this,m).delete(N.id),(Q=u(this,T))===null||Q===void 0||Q.removePointerInTextLayer(N.contentDiv)}remove(N){u(this,x).removeEditor(N),this.detach(N),this.annotationStorage.remove(N.id),N.div.style.display="none",setTimeout(()=>{N.div.style.display="",N.div.remove(),N.isAttachedToDOM=!1,document.activeElement===document.body&&u(this,x).focusMainContainer()},0),u(this,C)||this.addInkEditorIfNeeded(!1)}add(N){if(f(this,R,X).call(this,N),u(this,x).addEditor(N),this.attach(N),!N.isAttachedToDOM){const Q=N.render();this.div.append(Q),N.isAttachedToDOM=!0}this.moveEditorInDOM(N),N.onceAdded(),this.addToAnnotationStorage(N)}moveEditorInDOM(N){var Q;(Q=u(this,T))===null||Q===void 0||Q.moveElementInDOM(this.div,N.div,N.contentDiv,!0)}addToAnnotationStorage(N){!N.isEmpty()&&!this.annotationStorage.has(N.id)&&this.annotationStorage.setValue(N.id,N)}addOrRebuild(N){N.needsToBeRebuilt()?N.rebuild():this.add(N)}addANewEditor(N){const Q=()=>{this.addOrRebuild(N)},ce=()=>{N.remove()};this.addCommands({cmd:Q,undo:ce,mustExec:!0})}addUndoableEditor(N){const Q=()=>{this.addOrRebuild(N)},ce=()=>{N.remove()};this.addCommands({cmd:Q,undo:ce,mustExec:!1})}getNextId(){return u(this,x).getId()}deserialize(N){switch(N.annotationType){case a.AnnotationEditorType.FREETEXT:return i.FreeTextEditor.deserialize(N,this);case a.AnnotationEditorType.INK:return c.InkEditor.deserialize(N,this)}return null}setSelected(N){u(this,x).setSelected(N)}toggleSelected(N){u(this,x).toggleSelected(N)}isSelected(N){return u(this,x).isSelected(N)}unselect(N){u(this,x).unselect(N)}pointerup(N){const Q=r.KeyboardManager.platform.isMac;if(!(N.button!==0||N.ctrlKey&&Q)&&N.target===this.div&&u(this,S)){if(v(this,S,!1),!u(this,b)){v(this,b,!0);return}f(this,F,q).call(this,N)}}pointerdown(N){const Q=r.KeyboardManager.platform.isMac;if(N.button!==0||N.ctrlKey&&Q||N.target!==this.div)return;v(this,S,!0);const ce=u(this,x).getActive();v(this,b,!ce||ce.isEmpty())}drop(N){const Q=N.dataTransfer.getData("text/plain"),ce=u(this,x).getEditor(Q);if(!ce)return;N.preventDefault(),N.dataTransfer.dropEffect="move",f(this,R,X).call(this,ce);const pe=this.div.getBoundingClientRect(),Re=N.clientX-pe.x,Y=N.clientY-pe.y;ce.translate(Re-ce.startX,Y-ce.startY),this.moveEditorInDOM(ce),ce.div.focus()}dragover(N){N.preventDefault()}destroy(){var N;((N=u(this,x).getActive())===null||N===void 0?void 0:N.parent)===this&&u(this,x).setActiveEditor(null);for(const ce of u(this,m).values()){var Q;(Q=u(this,T))===null||Q===void 0||Q.removePointerInTextLayer(ce.contentDiv),ce.isAttachedToDOM=!1,ce.div.remove(),ce.parent=null}this.div=null,u(this,m).clear(),u(this,x).removeLayer(this)}render(N){this.viewport=N.viewport,(0,r.bindEvents)(this,this.div,["dragover","drop"]),this.setDimensions();for(const Q of u(this,x).getEditors(this.pageIndex))this.add(Q);this.updateMode()}update(N){this.viewport=N.viewport,this.setDimensions(),this.updateMode()}get scaleFactor(){return this.viewport.scale}get pageDimensions(){const[N,Q,ce,pe]=this.viewport.viewBox,Re=ce-N,Y=pe-Q;return[Re,Y]}get viewportBaseDimensions(){const{width:N,height:Q,rotation:ce}=this.viewport;return ce%180===0?[N,Q]:[Q,N]}setDimensions(){const{width:N,height:Q,rotation:ce}=this.viewport,pe=ce%180!==0,Re=Math.floor(N)+"px",Y=Math.floor(Q)+"px";this.div.style.width=pe?Y:Re,this.div.style.height=pe?Re:Y,this.div.setAttribute("data-main-rotation",ce)}}e.AnnotationEditorLayer=V;function X(B){var N;B.parent!==this&&(this.attach(B),B.pageIndex=this.pageIndex,(N=B.parent)===null||N===void 0||N.detach(B),B.parent=this,B.div&&B.isAttachedToDOM&&(B.div.remove(),this.div.append(B.div)))}function K(B){switch(u(this,x).getMode()){case a.AnnotationEditorType.FREETEXT:return new i.FreeTextEditor(B);case a.AnnotationEditorType.INK:return new c.InkEditor(B)}return null}function q(B){const N=this.getNextId(),Q=f(this,M,K).call(this,{parent:this,id:N,x:B.offsetX,y:B.offsetY});return Q&&this.add(Q),Q}function U(){v(this,C,!0);for(const B of u(this,m).values())B.isEmpty()&&B.remove();v(this,C,!1)}h(V,"_initialized",!1)},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.FreeTextEditor=void 0;var r=t(1),a=t(132),i=t(131);function c(q,U){o(q,U),U.add(q)}function l(q,U,B){return U in q?Object.defineProperty(q,U,{value:B,enumerable:!0,configurable:!0,writable:!0}):q[U]=B,q}function h(q,U,B){o(q,U),U.set(q,B)}function o(q,U){if(U.has(q))throw new TypeError("Cannot initialize the same private elements twice on an object")}function s(q,U){var B=v(q,U,"get");return f(q,B)}function f(q,U){return U.get?U.get.call(q):U.value}function u(q,U,B){if(!U.has(q))throw new TypeError("attempted to get private field on non-instance");return B}function p(q,U,B){var N=v(q,U,"set");return g(q,N,B),B}function v(q,U,B){if(!U.has(q))throw new TypeError("attempted to "+B+" private field on non-instance");return U.get(q)}function g(q,U,B){if(U.set)U.set.call(q,B);else{if(!U.writable)throw new TypeError("attempted to set read only private field");U.value=B}}var A=new WeakMap,T=new WeakMap,b=new WeakMap,_=new WeakMap,w=new WeakMap,m=new WeakMap,S=new WeakMap,C=new WeakSet,x=new WeakSet,R=new WeakSet,M=new WeakSet;class F extends i.AnnotationEditor{constructor(U){super({...U,name:"freeTextEditor"}),c(this,M),c(this,R),c(this,x),c(this,C),h(this,A,{writable:!0,value:this.editorDivBlur.bind(this)}),h(this,T,{writable:!0,value:this.editorDivFocus.bind(this)}),h(this,b,{writable:!0,value:this.editorDivKeydown.bind(this)}),h(this,_,{writable:!0,value:void 0}),h(this,w,{writable:!0,value:""}),h(this,m,{writable:!0,value:!1}),h(this,S,{writable:!0,value:void 0}),p(this,_,U.color||F._defaultColor||i.AnnotationEditor._defaultLineColor),p(this,S,U.fontSize||F._defaultFontSize)}static initialize(U){this._l10nPromise=new Map(["free_text_default_content","editor_free_text_aria_label"].map(N=>[N,U.get(N)]));const B=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(B.getPropertyValue("--freetext-padding"))}static updateDefaultParams(U,B){switch(U){case r.AnnotationEditorParamsType.FREETEXT_SIZE:F._defaultFontSize=B;break;case r.AnnotationEditorParamsType.FREETEXT_COLOR:F._defaultColor=B;break}}updateParams(U,B){switch(U){case r.AnnotationEditorParamsType.FREETEXT_SIZE:u(this,C,H).call(this,B);break;case r.AnnotationEditorParamsType.FREETEXT_COLOR:u(this,x,V).call(this,B);break}}static get defaultPropertiesToUpdate(){return[[r.AnnotationEditorParamsType.FREETEXT_SIZE,F._defaultFontSize],[r.AnnotationEditorParamsType.FREETEXT_COLOR,F._defaultColor||i.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[r.AnnotationEditorParamsType.FREETEXT_SIZE,s(this,S)],[r.AnnotationEditorParamsType.FREETEXT_COLOR,s(this,_)]]}getInitialTranslation(){return[-F._internalPadding*this.parent.scaleFactor,-(F._internalPadding+s(this,S))*this.parent.scaleFactor]}rebuild(){super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(r.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.enableEditing(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this.div.draggable=!1,this.editorDiv.addEventListener("keydown",s(this,b)),this.editorDiv.addEventListener("focus",s(this,T)),this.editorDiv.addEventListener("blur",s(this,A)))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.disableEditing(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.draggable=!0,this.editorDiv.removeEventListener("keydown",s(this,b)),this.editorDiv.removeEventListener("focus",s(this,T)),this.editorDiv.removeEventListener("blur",s(this,A)),this.div.focus(),this.isEditing=!1)}focusin(U){super.focusin(U),U.target!==this.editorDiv&&this.editorDiv.focus()}onceAdded(){this.width||(this.enableEditMode(),this.editorDiv.focus())}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent.setEditingState(!0),super.remove()}commit(){super.commit(),s(this,m)||(p(this,m,!0),this.parent.addUndoableEditor(this)),this.disableEditMode(),p(this,w,u(this,R,X).call(this).trimEnd()),u(this,M,K).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}dblclick(U){this.enableEditMode(),this.editorDiv.focus()}keydown(U){U.target===this.div&&U.key==="Enter"&&(this.enableEditMode(),this.editorDiv.focus())}editorDivKeydown(U){F._keyboardManager.exec(this,U)}editorDivFocus(U){this.isEditing=!0}editorDivBlur(U){this.isEditing=!1}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let U,B;this.width&&(U=this.x,B=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",`${this.id}-editor`),this.enableEditing(),F._l10nPromise.get("editor_free_text_aria_label").then(Q=>{var ce;return(ce=this.editorDiv)===null||ce===void 0?void 0:ce.setAttribute("aria-label",Q)}),F._l10nPromise.get("free_text_default_content").then(Q=>{var ce;return(ce=this.editorDiv)===null||ce===void 0?void 0:ce.setAttribute("default-content",Q)}),this.editorDiv.contentEditable=!0;const{style:N}=this.editorDiv;if(N.fontSize=`calc(${s(this,S)}px * var(--scale-factor))`,N.color=s(this,_),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,a.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[Q,ce]=this.parent.viewportBaseDimensions;this.setAt(U*Q,B*ce,this.width*Q,this.height*ce);for(const pe of s(this,w).split(`
`)){const Re=document.createElement("div");Re.append(pe?document.createTextNode(pe):document.createElement("br")),this.editorDiv.append(Re)}this.div.draggable=!0,this.editorDiv.contentEditable=!1}else this.div.draggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(U,B){const N=super.deserialize(U,B);return p(N,S,U.fontSize),p(N,_,r.Util.makeHexColor(...U.color)),p(N,w,U.value),N}serialize(){if(this.isEmpty())return null;const U=F._internalPadding*this.parent.scaleFactor,B=this.getRect(U,U),N=i.AnnotationEditor._colorManager.convert(getComputedStyle(this.editorDiv).color);return{annotationType:r.AnnotationEditorType.FREETEXT,color:N,fontSize:s(this,S),value:s(this,w),pageIndex:this.parent.pageIndex,rect:B,rotation:this.rotation}}}e.FreeTextEditor=F;function H(q){const U=N=>{this.editorDiv.style.fontSize=`calc(${N}px * var(--scale-factor))`,this.translate(0,-(N-s(this,S))*this.parent.scaleFactor),p(this,S,N),u(this,M,K).call(this)},B=s(this,S);this.parent.addCommands({cmd:()=>{U(q)},undo:()=>{U(B)},mustExec:!0,type:r.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}function V(q){const U=s(this,_);this.parent.addCommands({cmd:()=>{p(this,_,q),this.editorDiv.style.color=q},undo:()=>{p(this,_,U),this.editorDiv.style.color=U},mustExec:!0,type:r.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}function X(){const q=this.editorDiv.getElementsByTagName("div");if(q.length===0)return this.editorDiv.innerText;const U=[];for(let B=0,N=q.length;B<N;B++){const ce=q[B].firstChild;(ce==null?void 0:ce.nodeName)==="#text"?U.push(ce.data):U.push("")}return U.join(`
`)}function K(){const[q,U]=this.parent.viewportBaseDimensions,B=this.div.getBoundingClientRect();this.width=B.width/q,this.height=B.height/U}l(F,"_freeTextDefaultContent",""),l(F,"_l10nPromise",void 0),l(F,"_internalPadding",0),l(F,"_defaultColor",null),l(F,"_defaultFontSize",10),l(F,"_keyboardManager",new a.KeyboardManager([[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],F.prototype.commitOrRemove]])),l(F,"_type","freetext")},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.InkEditor=void 0,Object.defineProperty(e,"fitCurve",{enumerable:!0,get:function(){return i.fitCurve}});var r=t(1),a=t(131),i=t(150),c=t(132);function l(he,oe){s(he,oe),oe.add(he)}function h(he,oe,Se){return oe in he?Object.defineProperty(he,oe,{value:Se,enumerable:!0,configurable:!0,writable:!0}):he[oe]=Se,he}function o(he,oe,Se){s(he,oe),oe.set(he,Se)}function s(he,oe){if(oe.has(he))throw new TypeError("Cannot initialize the same private elements twice on an object")}function f(he,oe,Se){return u(he,oe),Se}function u(he,oe){if(he!==oe)throw new TypeError("Private static access of wrong provenance")}function p(he,oe,Se){var Ie=A(he,oe,"set");return v(he,Ie,Se),Se}function v(he,oe,Se){if(oe.set)oe.set.call(he,Se);else{if(!oe.writable)throw new TypeError("attempted to set read only private field");oe.value=Se}}function g(he,oe){var Se=A(he,oe,"get");return T(he,Se)}function A(he,oe,Se){if(!oe.has(he))throw new TypeError("attempted to "+Se+" private field on non-instance");return oe.get(he)}function T(he,oe){return oe.get?oe.get.call(he):oe.value}function b(he,oe,Se){if(!oe.has(he))throw new TypeError("attempted to get private field on non-instance");return Se}const _=16;var w=new WeakMap,m=new WeakMap,S=new WeakMap,C=new WeakMap,x=new WeakMap,R=new WeakMap,M=new WeakMap,F=new WeakMap,H=new WeakMap,V=new WeakMap,X=new WeakMap,K=new WeakMap,q=new WeakMap,U=new WeakMap,B=new WeakSet,N=new WeakSet,Q=new WeakSet,ce=new WeakSet,pe=new WeakSet,Re=new WeakSet,Y=new WeakSet,O=new WeakSet,D=new WeakSet,W=new WeakSet,G=new WeakSet,E=new WeakSet,P=new WeakSet,k=new WeakSet,L=new WeakSet,j=new WeakSet,z=new WeakSet,Z=new WeakSet,te=new WeakSet,ie=new WeakSet,le=new WeakSet,se=new WeakSet;class ue extends a.AnnotationEditor{constructor(oe){super({...oe,name:"inkEditor"}),l(this,se),l(this,le),l(this,ie),l(this,te),l(this,Z),l(this,z),l(this,j),l(this,L),l(this,k),l(this,P),l(this,E),l(this,G),l(this,W),l(this,D),l(this,O),l(this,Y),l(this,Re),l(this,pe),l(this,ce),l(this,Q),l(this,N),l(this,B),o(this,w,{writable:!0,value:0}),o(this,m,{writable:!0,value:0}),o(this,S,{writable:!0,value:0}),o(this,C,{writable:!0,value:this.canvasPointermove.bind(this)}),o(this,x,{writable:!0,value:this.canvasPointerleave.bind(this)}),o(this,R,{writable:!0,value:this.canvasPointerup.bind(this)}),o(this,M,{writable:!0,value:this.canvasPointerdown.bind(this)}),o(this,F,{writable:!0,value:!1}),o(this,H,{writable:!0,value:!1}),o(this,V,{writable:!0,value:null}),o(this,X,{writable:!0,value:null}),o(this,K,{writable:!0,value:0}),o(this,q,{writable:!0,value:0}),o(this,U,{writable:!0,value:null}),this.color=oe.color||null,this.thickness=oe.thickness||null,this.opacity=oe.opacity||null,this.paths=[],this.bezierPath2D=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0}static initialize(oe){this._l10nPromise=new Map(["editor_ink_canvas_aria_label","editor_ink_aria_label"].map(Se=>[Se,oe.get(Se)]))}static updateDefaultParams(oe,Se){switch(oe){case r.AnnotationEditorParamsType.INK_THICKNESS:ue._defaultThickness=Se;break;case r.AnnotationEditorParamsType.INK_COLOR:ue._defaultColor=Se;break;case r.AnnotationEditorParamsType.INK_OPACITY:ue._defaultOpacity=Se/100;break}}updateParams(oe,Se){switch(oe){case r.AnnotationEditorParamsType.INK_THICKNESS:b(this,B,me).call(this,Se);break;case r.AnnotationEditorParamsType.INK_COLOR:b(this,N,be).call(this,Se);break;case r.AnnotationEditorParamsType.INK_OPACITY:b(this,Q,we).call(this,Se);break}}static get defaultPropertiesToUpdate(){return[[r.AnnotationEditorParamsType.INK_THICKNESS,ue._defaultThickness],[r.AnnotationEditorParamsType.INK_COLOR,ue._defaultColor||a.AnnotationEditor._defaultLineColor],[r.AnnotationEditorParamsType.INK_OPACITY,Math.round(ue._defaultOpacity*100)]]}get propertiesToUpdate(){var oe;return[[r.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||ue._defaultThickness],[r.AnnotationEditorParamsType.INK_COLOR,this.color||ue._defaultColor||a.AnnotationEditor._defaultLineColor],[r.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*((oe=this.opacity)!==null&&oe!==void 0?oe:ue._defaultOpacity))]]}rebuild(){super.rebuild(),this.div!==null&&(this.canvas||(b(this,G,ae).call(this),b(this,E,ve).call(this)),this.isAttachedToDOM||(this.parent.add(this),b(this,P,Le).call(this)),b(this,le,De).call(this))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,g(this,X).disconnect(),p(this,X,null),super.remove())}enableEditMode(){g(this,F)||this.canvas===null||(super.enableEditMode(),this.div.draggable=!1,this.canvas.addEventListener("pointerdown",g(this,M)),this.canvas.addEventListener("pointerup",g(this,R)))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this.div.draggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",g(this,M)),this.canvas.removeEventListener("pointerup",g(this,R)))}onceAdded(){this.div.draggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}commit(){g(this,F)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),p(this,F,!0),this.div.classList.add("disabled"),b(this,le,De).call(this,!0),this.parent.addInkEditorIfNeeded(!0),this.parent.moveEditorInDOM(this),this.div.focus())}focusin(oe){super.focusin(oe),this.enableEditMode()}canvasPointerdown(oe){oe.button!==0||!this.isInEditMode()||g(this,F)||(this.setInForeground(),oe.type!=="mouse"&&this.div.focus(),oe.stopPropagation(),this.canvas.addEventListener("pointerleave",g(this,x)),this.canvas.addEventListener("pointermove",g(this,C)),b(this,Re,_e).call(this,oe.offsetX,oe.offsetY))}canvasPointermove(oe){oe.stopPropagation(),b(this,Y,Ve).call(this,oe.offsetX,oe.offsetY)}canvasPointerup(oe){oe.button===0&&this.isInEditMode()&&this.currentPath.length!==0&&(oe.stopPropagation(),b(this,W,Ee).call(this,oe),this.setInBackground())}canvasPointerleave(oe){b(this,W,Ee).call(this,oe),this.setInBackground()}render(){if(this.div)return this.div;let oe,Se;this.width&&(oe=this.x,Se=this.y),super.render(),ue._l10nPromise.get("editor_ink_aria_label").then(qe=>{var Me;return(Me=this.div)===null||Me===void 0?void 0:Me.setAttribute("aria-label",qe)});const[Ie,Be,Ge,$e]=b(this,ce,Ae).call(this);if(this.setAt(Ie,Be,0,0),this.setDims(Ge,$e),b(this,G,ae).call(this),this.width){const[qe,Me]=this.parent.viewportBaseDimensions;this.setAt(oe*qe,Se*Me,this.width*qe,this.height*Me),p(this,H,!0),b(this,P,Le).call(this),this.setDims(this.width*qe,this.height*Me),b(this,D,Oe).call(this),b(this,se,je).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return b(this,E,ve).call(this),this.div}setDimensions(oe,Se){const Ie=Math.round(oe),Be=Math.round(Se);if(g(this,K)===Ie&&g(this,q)===Be)return;p(this,K,Ie),p(this,q,Be),this.canvas.style.visibility="hidden",g(this,w)&&Math.abs(g(this,w)-oe/Se)>.01&&(Se=Math.ceil(oe/g(this,w)),this.setDims(oe,Se));const[Ge,$e]=this.parent.viewportBaseDimensions;this.width=oe/Ge,this.height=Se/$e,g(this,F)&&b(this,k,Ke).call(this,oe,Se),b(this,P,Le).call(this),b(this,D,Oe).call(this),this.canvas.style.visibility="visible"}static deserialize(oe,Se){const Ie=super.deserialize(oe,Se);Ie.thickness=oe.thickness,Ie.color=r.Util.makeHexColor(...oe.color),Ie.opacity=oe.opacity;const[Be,Ge]=Se.pageDimensions,$e=Ie.width*Be,qe=Ie.height*Ge,Me=Se.scaleFactor,Ye=oe.thickness/2;p(Ie,w,$e/qe),p(Ie,F,!0),p(Ie,K,Math.round($e)),p(Ie,q,Math.round(qe));for(const{bezier:Xe}of oe.paths){const Ze=[];Ie.paths.push(Ze);let ot=Me*(Xe[0]-Ye),et=Me*(qe-Xe[1]-Ye);for(let rt=2,yt=Xe.length;rt<yt;rt+=6){const Tt=Me*(Xe[rt]-Ye),dt=Me*(qe-Xe[rt+1]-Ye),Mt=Me*(Xe[rt+2]-Ye),qt=Me*(qe-Xe[rt+3]-Ye),Lt=Me*(Xe[rt+4]-Ye),ht=Me*(qe-Xe[rt+5]-Ye);Ze.push([[ot,et],[Tt,dt],[Mt,qt],[Lt,ht]]),ot=Lt,et=ht}const ct=f(this,ue,Pe).call(this,Ze);Ie.bezierPath2D.push(ct)}const it=b(Ie,te,ne).call(Ie);return p(Ie,S,Math.max(_,it[2]-it[0])),p(Ie,m,Math.max(_,it[3]-it[1])),b(Ie,k,Ke).call(Ie,$e,qe),Ie}serialize(){if(this.isEmpty())return null;const oe=this.getRect(0,0),Se=this.rotation%180===0?oe[3]-oe[1]:oe[2]-oe[0],Ie=a.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:r.AnnotationEditorType.INK,color:Ie,thickness:this.thickness,opacity:this.opacity,paths:b(this,j,Ne).call(this,this.scaleFactor/this.parent.scaleFactor,this.translationX,this.translationY,Se),pageIndex:this.parent.pageIndex,rect:oe,rotation:this.rotation}}}e.InkEditor=ue;function me(he){const oe=this.thickness;this.parent.addCommands({cmd:()=>{this.thickness=he,b(this,le,De).call(this)},undo:()=>{this.thickness=oe,b(this,le,De).call(this)},mustExec:!0,type:r.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})}function be(he){const oe=this.color;this.parent.addCommands({cmd:()=>{this.color=he,b(this,D,Oe).call(this)},undo:()=>{this.color=oe,b(this,D,Oe).call(this)},mustExec:!0,type:r.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})}function we(he){he/=100;const oe=this.opacity;this.parent.addCommands({cmd:()=>{this.opacity=he,b(this,D,Oe).call(this)},undo:()=>{this.opacity=oe,b(this,D,Oe).call(this)},mustExec:!0,type:r.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})}function Ae(){const{width:he,height:oe,rotation:Se}=this.parent.viewport;switch(Se){case 90:return[0,he,he,oe];case 180:return[he,oe,he,oe];case 270:return[oe,0,he,oe];default:return[0,0,he,oe]}}function Fe(){this.ctx.lineWidth=this.thickness*this.parent.scaleFactor/this.scaleFactor,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.miterLimit=10,this.ctx.strokeStyle=`${this.color}${(0,c.opacityToHex)(this.opacity)}`}function _e(he,oe){if(this.isEditing=!0,!g(this,H)){var Se;p(this,H,!0),b(this,P,Le).call(this),this.thickness||(this.thickness=ue._defaultThickness),this.color||(this.color=ue._defaultColor||a.AnnotationEditor._defaultLineColor),(Se=this.opacity)!==null&&Se!==void 0||(this.opacity=ue._defaultOpacity)}this.currentPath.push([he,oe]),p(this,V,null),b(this,pe,Fe).call(this),this.ctx.beginPath(),this.ctx.moveTo(he,oe),p(this,U,()=>{g(this,U)&&(g(this,V)&&(this.isEmpty()?(this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)):b(this,D,Oe).call(this),this.ctx.lineTo(...g(this,V)),p(this,V,null),this.ctx.stroke()),window.requestAnimationFrame(g(this,U)))}),window.requestAnimationFrame(g(this,U))}function Ve(he,oe){const[Se,Ie]=this.currentPath.at(-1);he===Se&&oe===Ie||(this.currentPath.push([he,oe]),p(this,V,[he,oe]))}function Qe(he,oe){this.ctx.closePath(),p(this,U,null),he=Math.min(Math.max(he,0),this.canvas.width),oe=Math.min(Math.max(oe,0),this.canvas.height);const[Se,Ie]=this.currentPath.at(-1);(he!==Se||oe!==Ie)&&this.currentPath.push([he,oe]);let Be;if(this.currentPath.length!==1)Be=(0,i.fitCurve)(this.currentPath,30,null);else{const Me=[he,oe];Be=[[Me,Me.slice(),Me.slice(),Me]]}const Ge=f(ue,ue,Pe).call(ue,Be);this.currentPath.length=0;const $e=()=>{this.paths.push(Be),this.bezierPath2D.push(Ge),this.rebuild()},qe=()=>{this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(b(this,G,ae).call(this),b(this,E,ve).call(this)),b(this,le,De).call(this))};this.parent.addCommands({cmd:$e,undo:qe,mustExec:!0})}function Oe(){if(this.isEmpty()){b(this,L,ye).call(this);return}b(this,pe,Fe).call(this);const{canvas:he,ctx:oe}=this;oe.setTransform(1,0,0,1,0,0),oe.clearRect(0,0,he.width,he.height),b(this,L,ye).call(this);for(const Se of this.bezierPath2D)oe.stroke(Se)}function Ee(he){b(this,O,Qe).call(this,he.offsetX,he.offsetY),this.canvas.removeEventListener("pointerleave",g(this,x)),this.canvas.removeEventListener("pointermove",g(this,C)),this.parent.addToAnnotationStorage(this)}function ae(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",ue._l10nPromise.get("editor_ink_canvas_aria_label").then(he=>{var oe;return(oe=this.canvas)===null||oe===void 0?void 0:oe.setAttribute("aria-label",he)}),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")}function ve(){p(this,X,new ResizeObserver(he=>{const oe=he[0].contentRect;oe.width&&oe.height&&this.setDimensions(oe.width,oe.height)})),g(this,X).observe(this.div)}function Le(){if(!g(this,H))return;const[he,oe]=this.parent.viewportBaseDimensions;this.canvas.width=Math.ceil(this.width*he),this.canvas.height=Math.ceil(this.height*oe),b(this,L,ye).call(this)}function Ke(he,oe){const Se=b(this,ie,ge).call(this),Ie=(he-Se)/g(this,S),Be=(oe-Se)/g(this,m);this.scaleFactor=Math.min(Ie,Be)}function ye(){const he=b(this,ie,ge).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+he,this.translationY*this.scaleFactor+he)}function Pe(he){const oe=new Path2D;for(let Se=0,Ie=he.length;Se<Ie;Se++){const[Be,Ge,$e,qe]=he[Se];Se===0&&oe.moveTo(...Be),oe.bezierCurveTo(Ge[0],Ge[1],$e[0],$e[1],qe[0],qe[1])}return oe}function Ne(he,oe,Se,Ie){const Ge=[],$e=this.thickness/2;let qe,Me;for(const Ye of this.paths){qe=[],Me=[];for(let it=0,Xe=Ye.length;it<Xe;it++){const[Ze,ot,et,ct]=Ye[it],rt=he*(Ze[0]+oe)+$e,yt=Ie-he*(Ze[1]+Se)-$e,Tt=he*(ot[0]+oe)+$e,dt=Ie-he*(ot[1]+Se)-$e,Mt=he*(et[0]+oe)+$e,qt=Ie-he*(et[1]+Se)-$e,Lt=he*(ct[0]+oe)+$e,ht=Ie-he*(ct[1]+Se)-$e;it===0&&(qe.push(rt,yt),Me.push(rt,yt)),qe.push(Tt,dt,Mt,qt,Lt,ht),b(this,z,de).call(this,rt,yt,Tt,dt,Mt,qt,Lt,ht,4,Me)}Ge.push({bezier:qe,points:Me})}return Ge}function de(he,oe,Se,Ie,Be,Ge,$e,qe,Me,Ye){if(b(this,Z,ee).call(this,he,oe,Se,Ie,Be,Ge,$e,qe)){Ye.push($e,qe);return}for(let it=1;it<Me-1;it++){const Xe=it/Me,Ze=1-Xe;let ot=Xe*he+Ze*Se,et=Xe*oe+Ze*Ie,ct=Xe*Se+Ze*Be,rt=Xe*Ie+Ze*Ge;const yt=Xe*Be+Ze*$e,Tt=Xe*Ge+Ze*qe;ot=Xe*ot+Ze*ct,et=Xe*et+Ze*rt,ct=Xe*ct+Ze*yt,rt=Xe*rt+Ze*Tt,ot=Xe*ot+Ze*ct,et=Xe*et+Ze*rt,Ye.push(ot,et)}Ye.push($e,qe)}function ee(he,oe,Se,Ie,Be,Ge,$e,qe){const Ye=(3*Se-2*he-$e)**2,it=(3*Ie-2*oe-qe)**2,Xe=(3*Be-he-2*$e)**2,Ze=(3*Ge-oe-2*qe)**2;return Math.max(Ye,Xe)+Math.max(it,Ze)<=10}function ne(){let he=1/0,oe=-1/0,Se=1/0,Ie=-1/0;for(const Be of this.paths)for(const[Ge,$e,qe,Me]of Be){const Ye=r.Util.bezierBoundingBox(...Ge,...$e,...qe,...Me);he=Math.min(he,Ye[0]),Se=Math.min(Se,Ye[1]),oe=Math.max(oe,Ye[2]),Ie=Math.max(Ie,Ye[3])}return[he,Se,oe,Ie]}function ge(){return g(this,F)?Math.ceil(this.thickness*this.parent.scaleFactor):0}function De(){let he=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(this.isEmpty())return;if(!g(this,F)){b(this,D,Oe).call(this);return}const oe=b(this,te,ne).call(this),Se=b(this,ie,ge).call(this);p(this,S,Math.max(_,oe[2]-oe[0])),p(this,m,Math.max(_,oe[3]-oe[1]));const Ie=Math.ceil(Se+g(this,S)*this.scaleFactor),Be=Math.ceil(Se+g(this,m)*this.scaleFactor),[Ge,$e]=this.parent.viewportBaseDimensions;this.width=Ie/Ge,this.height=Be/$e,p(this,w,Ie/Be),b(this,se,je).call(this);const qe=this.translationX,Me=this.translationY;this.translationX=-oe[0],this.translationY=-oe[1],b(this,P,Le).call(this),b(this,D,Oe).call(this),p(this,K,Ie),p(this,q,Be),this.setDims(Ie,Be);const Ye=he?Se/this.scaleFactor/2:0;this.translate(qe-this.translationX-Ye,Me-this.translationY-Ye)}function je(){const{style:he}=this.div;g(this,w)>=1?(he.minHeight=`${_}px`,he.minWidth=`${Math.round(g(this,w)*_)}px`):(he.minWidth=`${_}px`,he.minHeight=`${Math.round(_/g(this,w))}px`)}h(ue,"_defaultColor",null),h(ue,"_defaultOpacity",1),h(ue,"_defaultThickness",1),h(ue,"_l10nPromise",void 0),h(ue,"_type","ink")},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.fitCurve=void 0;const r=t(151);e.fitCurve=r},n=>{function e(v,g,A){if(!Array.isArray(v))throw new TypeError("First argument should be an array");if(v.forEach(w=>{if(!Array.isArray(w)||w.some(m=>typeof m!="number")||w.length!==v[0].length)throw Error("Each point should be an array of numbers. Each point should have the same amount of numbers.")}),v=v.filter((w,m)=>m===0||!w.every((S,C)=>S===v[m-1][C])),v.length<2)return[];const T=v.length,b=f(v[1],v[0]),_=f(v[T-2],v[T-1]);return t(v,b,_,g,A)}function t(v,g,A,T,b){var w,m,S,C,x,R,M,F,H,V,X,K,q;if(v.length===2)return K=u.vectorLen(u.subtract(v[0],v[1]))/3,w=[v[0],u.addArrays(v[0],u.mulItems(g,K)),u.addArrays(v[1],u.mulItems(A,K)),v[1]],[w];if(m=l(v),[w,C,R]=r(v,m,m,g,A,b),C===0||C<T)return[w];if(C<T*T)for(S=m,x=C,M=R,q=0;q<20;q++){if(S=i(w,v,S),[w,C,R]=r(v,m,S,g,A,b),C<T)return[w];if(R===M){let U=C/x;if(U>.9999&&U<1.0001)break}x=C,M=R}return X=[],F=u.subtract(v[R-1],v[R+1]),F.every(U=>U===0)&&(F=u.subtract(v[R-1],v[R]),[F[0],F[1]]=[-F[1],F[0]]),H=u.normalize(F),V=u.mulItems(H,-1),X=X.concat(t(v.slice(0,R+1),g,H,T,b)),X=X.concat(t(v.slice(R),V,A,T,b)),X}function r(v,g,A,T,b,_){var w,m,S;return w=a(v,A,T,b),[m,S]=h(v,w,g),_&&_({bez:w,points:v,params:g,maxErr:m,maxPoint:S}),[w,m,S]}function a(v,g,A,T){var b,_,w,m,S,C,x,R,M,F,H,V,X,K,q,U,B,N=v[0],Q=v[v.length-1];for(b=[N,null,null,Q],_=u.zeros_Xx2x2(g.length),X=0,K=g.length;X<K;X++)U=g[X],B=1-U,w=_[X],w[0]=u.mulItems(A,3*U*(B*B)),w[1]=u.mulItems(T,3*B*(U*U));for(m=[[0,0],[0,0]],S=[0,0],X=0,K=v.length;X<K;X++)U=g[X],w=_[X],m[0][0]+=u.dot(w[0],w[0]),m[0][1]+=u.dot(w[0],w[1]),m[1][0]+=u.dot(w[0],w[1]),m[1][1]+=u.dot(w[1],w[1]),q=u.subtract(v[X],p.q([N,N,Q,Q],U)),S[0]+=u.dot(w[0],q),S[1]+=u.dot(w[1],q);return C=m[0][0]*m[1][1]-m[1][0]*m[0][1],x=m[0][0]*S[1]-m[1][0]*S[0],R=S[0]*m[1][1]-S[1]*m[0][1],M=C===0?0:R/C,F=C===0?0:x/C,V=u.vectorLen(u.subtract(N,Q)),H=1e-6*V,M<H||F<H?(b[1]=u.addArrays(N,u.mulItems(A,V/3)),b[2]=u.addArrays(Q,u.mulItems(T,V/3))):(b[1]=u.addArrays(N,u.mulItems(A,M)),b[2]=u.addArrays(Q,u.mulItems(T,F))),b}function i(v,g,A){return A.map((T,b)=>c(v,g[b],T))}function c(v,g,A){var T=u.subtract(p.q(v,A),g),b=p.qprime(v,A),_=u.mulMatrix(T,b),w=u.sum(u.squareItems(b))+2*u.mulMatrix(T,p.qprimeprime(v,A));return w===0?A:A-_/w}function l(v){var g=[],A,T,b;return v.forEach((_,w)=>{A=w?T+u.vectorLen(u.subtract(_,b)):0,g.push(A),T=A,b=_}),g=g.map(_=>_/T),g}function h(v,g,A){var T,b,_,w,m,S,C,x;b=0,_=Math.floor(v.length/2);const R=o(g,10);for(m=0,S=v.length;m<S;m++)C=v[m],x=s(g,A[m],R,10),w=u.subtract(p.q(g,x),C),T=w[0]*w[0]+w[1]*w[1],T>b&&(b=T,_=m);return[b,_]}var o=function(v,g){for(var A,T=[0],b=v[0],_=0,w=1;w<=g;w++)A=p.q(v,w/g),_+=u.vectorLen(u.subtract(A,b)),T.push(_),b=A;return T=T.map(m=>m/_),T};function s(v,g,A,T){if(g<0)return 0;if(g>1)return 1;for(var b,_,w,m,S,C=1;C<=T;C++)if(g<=A[C]){m=(C-1)/T,w=C/T,_=A[C-1],b=A[C],S=(g-_)/(b-_)*(w-m)+m;break}return S}function f(v,g){return u.normalize(u.subtract(v,g))}class u{static zeros_Xx2x2(g){for(var A=[];g--;)A.push([0,0]);return A}static mulItems(g,A){return g.map(T=>T*A)}static mulMatrix(g,A){return g.reduce((T,b,_)=>T+b*A[_],0)}static subtract(g,A){return g.map((T,b)=>T-A[b])}static addArrays(g,A){return g.map((T,b)=>T+A[b])}static addItems(g,A){return g.map(T=>T+A)}static sum(g){return g.reduce((A,T)=>A+T)}static dot(g,A){return u.mulMatrix(g,A)}static vectorLen(g){return Math.hypot(...g)}static divItems(g,A){return g.map(T=>T/A)}static squareItems(g){return g.map(A=>A*A)}static normalize(g){return this.divItems(g,this.vectorLen(g))}}class p{static q(g,A){var T=1-A,b=u.mulItems(g[0],T*T*T),_=u.mulItems(g[1],3*T*T*A),w=u.mulItems(g[2],3*T*A*A),m=u.mulItems(g[3],A*A*A);return u.addArrays(u.addArrays(b,_),u.addArrays(w,m))}static qprime(g,A){var T=1-A,b=u.mulItems(u.subtract(g[1],g[0]),3*T*T),_=u.mulItems(u.subtract(g[2],g[1]),6*T*A),w=u.mulItems(u.subtract(g[3],g[2]),3*A*A);return u.addArrays(u.addArrays(b,_),w)}static qprimeprime(g,A){return u.addArrays(u.mulItems(u.addArrays(u.subtract(g[2],u.mulItems(g[1],2)),g[0]),6*(1-A)),u.mulItems(u.addArrays(u.subtract(g[3],u.mulItems(g[2],2)),g[1]),6*A))}}n.exports=e,n.exports.fitCubic=t,n.exports.createTangent=f},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AnnotationLayer=void 0;var r=t(1),a=t(133),i=t(130),c=t(153),l=t(154);function h(G,E,P){return o(G,E),P}function o(G,E){if(G!==E)throw new TypeError("Private static access of wrong provenance")}const s=1e3,f=9,u=new WeakSet;function p(G){return{width:G[2]-G[0],height:G[3]-G[1]}}class v{static create(E){switch(E.data.annotationType){case r.AnnotationType.LINK:return new A(E);case r.AnnotationType.TEXT:return new T(E);case r.AnnotationType.WIDGET:switch(E.data.fieldType){case"Tx":return new _(E);case"Btn":return E.data.radioButton?new m(E):E.data.checkBox?new w(E):new S(E);case"Ch":return new C(E)}return new b(E);case r.AnnotationType.POPUP:return new x(E);case r.AnnotationType.FREETEXT:return new M(E);case r.AnnotationType.LINE:return new F(E);case r.AnnotationType.SQUARE:return new H(E);case r.AnnotationType.CIRCLE:return new V(E);case r.AnnotationType.POLYLINE:return new X(E);case r.AnnotationType.CARET:return new q(E);case r.AnnotationType.INK:return new U(E);case r.AnnotationType.POLYGON:return new K(E);case r.AnnotationType.HIGHLIGHT:return new B(E);case r.AnnotationType.UNDERLINE:return new N(E);case r.AnnotationType.SQUIGGLY:return new Q(E);case r.AnnotationType.STRIKEOUT:return new ce(E);case r.AnnotationType.STAMP:return new pe(E);case r.AnnotationType.FILEATTACHMENT:return new Re(E);default:return new g(E)}}}class g{constructor(E){let{isRenderable:P=!1,ignoreBorder:k=!1,createQuadrilaterals:L=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.isRenderable=P,this.data=E.data,this.layer=E.layer,this.page=E.page,this.viewport=E.viewport,this.linkService=E.linkService,this.downloadManager=E.downloadManager,this.imageResourcesPath=E.imageResourcesPath,this.renderForms=E.renderForms,this.svgFactory=E.svgFactory,this.annotationStorage=E.annotationStorage,this.enableScripting=E.enableScripting,this.hasJSActions=E.hasJSActions,this._fieldObjects=E.fieldObjects,this._mouseState=E.mouseState,P&&(this.container=this._createContainer(k)),L&&(this.quadrilaterals=this._createQuadrilaterals(k))}_createContainer(){let E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;const P=this.data,k=this.page,L=this.viewport,j=document.createElement("section"),{width:z,height:Z}=p(P.rect),[te,ie,le,se]=L.viewBox,ue=le-te,me=se-ie;j.setAttribute("data-annotation-id",P.id);const be=r.Util.normalizeRect([P.rect[0],k.view[3]-P.rect[1]+k.view[1],P.rect[2],k.view[3]-P.rect[3]+k.view[1]]);if(!E&&P.borderStyle.width>0){j.style.borderWidth=`${P.borderStyle.width}px`;const Ae=P.borderStyle.horizontalCornerRadius,Fe=P.borderStyle.verticalCornerRadius;if(Ae>0||Fe>0){const Ve=`calc(${Ae}px * var(--scale-factor)) / calc(${Fe}px * var(--scale-factor))`;j.style.borderRadius=Ve}else if(this instanceof m){const Ve=`calc(${z}px * var(--scale-factor)) / calc(${Z}px * var(--scale-factor))`;j.style.borderRadius=Ve}switch(P.borderStyle.style){case r.AnnotationBorderStyleType.SOLID:j.style.borderStyle="solid";break;case r.AnnotationBorderStyleType.DASHED:j.style.borderStyle="dashed";break;case r.AnnotationBorderStyleType.BEVELED:(0,r.warn)("Unimplemented border style: beveled");break;case r.AnnotationBorderStyleType.INSET:(0,r.warn)("Unimplemented border style: inset");break;case r.AnnotationBorderStyleType.UNDERLINE:j.style.borderBottomStyle="solid";break}const _e=P.borderColor||null;_e?j.style.borderColor=r.Util.makeHexColor(_e[0]|0,_e[1]|0,_e[2]|0):j.style.borderWidth=0}j.style.left=`${100*(be[0]-te)/ue}%`,j.style.top=`${100*(be[1]-ie)/me}%`;const{rotation:we}=P;return P.hasOwnCanvas||we===0?(j.style.width=`${100*z/ue}%`,j.style.height=`${100*Z/me}%`):this.setRotation(we,j),j}setRotation(E){let P=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.container;const[k,L,j,z]=this.viewport.viewBox,Z=j-k,te=z-L,{width:ie,height:le}=p(this.data.rect);let se,ue;E%180===0?(se=100*ie/Z,ue=100*le/te):(se=100*le/Z,ue=100*ie/te),P.style.width=`${se}%`,P.style.height=`${ue}%`,P.setAttribute("data-main-rotation",(360-E)%360)}get _commonActions(){const E=(P,k,L)=>{const j=L.detail[P];L.target.style[k]=c.ColorConverters[`${j[0]}_HTML`](j.slice(1))};return(0,r.shadow)(this,"_commonActions",{display:P=>{const k=P.detail.display%2===1;this.container.style.visibility=k?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:k,print:P.detail.display===0||P.detail.display===3})},print:P=>{this.annotationStorage.setValue(this.data.id,{print:P.detail.print})},hidden:P=>{this.container.style.visibility=P.detail.hidden?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:P.detail.hidden})},focus:P=>{setTimeout(()=>P.target.focus({preventScroll:!1}),0)},userName:P=>{P.target.title=P.detail.userName},readonly:P=>{P.detail.readonly?P.target.setAttribute("readonly",""):P.target.removeAttribute("readonly")},required:P=>{this._setRequired(P.target,P.detail.required)},bgColor:P=>{E("bgColor","backgroundColor",P)},fillColor:P=>{E("fillColor","backgroundColor",P)},fgColor:P=>{E("fgColor","color",P)},textColor:P=>{E("textColor","color",P)},borderColor:P=>{E("borderColor","borderColor",P)},strokeColor:P=>{E("strokeColor","borderColor",P)},rotation:P=>{const k=P.detail.rotation;this.setRotation(k),this.annotationStorage.setValue(this.data.id,{rotation:k})}})}_dispatchEventFromSandbox(E,P){const k=this._commonActions;for(const L of Object.keys(P.detail)){const j=E[L]||k[L];j&&j(P)}}_setDefaultPropertiesFromJS(E){if(!this.enableScripting)return;const P=this.annotationStorage.getRawValue(this.data.id);if(!P)return;const k=this._commonActions;for(const[L,j]of Object.entries(P)){const z=k[L];if(z){const Z={detail:{[L]:j},target:E};z(Z),delete P[L]}}}_createQuadrilaterals(){let E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!this.data.quadPoints)return null;const P=[],k=this.data.rect;for(const L of this.data.quadPoints)this.data.rect=[L[2].x,L[2].y,L[1].x,L[1].y],P.push(this._createContainer(E));return this.data.rect=k,P}_createPopup(E,P){let k=this.container;this.quadrilaterals&&(E=E||this.quadrilaterals,k=this.quadrilaterals[0]),E||(E=document.createElement("div"),E.className="popupTriggerArea",k.append(E));const j=new R({container:k,trigger:E,color:P.color,titleObj:P.titleObj,modificationDate:P.modificationDate,contentsObj:P.contentsObj,richText:P.richText,hideWrapper:!0}).render();j.style.left="100%",k.append(j)}_renderQuadrilaterals(E){for(const P of this.quadrilaterals)P.className=E;return this.quadrilaterals}render(){(0,r.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(E){let P=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const k=[];if(this._fieldObjects){const L=this._fieldObjects[E];if(L)for(const{page:j,id:z,exportValues:Z}of L){if(j===-1||z===P)continue;const te=typeof Z=="string"?Z:null,ie=document.querySelector(`[data-element-id="${z}"]`);if(ie&&!u.has(ie)){(0,r.warn)(`_getElementsByName - element not allowed: ${z}`);continue}k.push({id:z,exportValue:te,domElement:ie})}return k}for(const L of document.getElementsByName(E)){const{id:j,exportValue:z}=L;j!==P&&u.has(L)&&k.push({id:j,exportValue:z,domElement:L})}return k}static get platform(){const E=typeof navigator<"u"?navigator.platform:"";return(0,r.shadow)(this,"platform",{isWin:E.includes("Win"),isMac:E.includes("Mac")})}}class A extends g{constructor(E){let P=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;super(E,{isRenderable:!0,ignoreBorder:!!(P!=null&&P.ignoreBorder),createQuadrilaterals:!0}),this.isTooltipOnly=E.data.isTooltipOnly}render(){const{data:E,linkService:P}=this,k=document.createElement("a");k.setAttribute("data-element-id",E.id);let L=!1;return E.url?(P.addLinkAttributes(k,E.url,E.newWindow),L=!0):E.action?(this._bindNamedAction(k,E.action),L=!0):E.dest?(this._bindLink(k,E.dest),L=!0):(E.actions&&(E.actions.Action||E.actions["Mouse Up"]||E.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(k,E),L=!0),E.resetForm?(this._bindResetFormAction(k,E.resetForm),L=!0):this.isTooltipOnly&&!L&&(this._bindLink(k,""),L=!0)),this.quadrilaterals?this._renderQuadrilaterals("linkAnnotation").map((j,z)=>{const Z=z===0?k:k.cloneNode();return j.append(Z),j}):(this.container.className="linkAnnotation",L&&this.container.append(k),this.container)}_bindLink(E,P){E.href=this.linkService.getDestinationHash(P),E.onclick=()=>(P&&this.linkService.goToDestination(P),!1),(P||P==="")&&(E.className="internalLink")}_bindNamedAction(E,P){E.href=this.linkService.getAnchorUrl(""),E.onclick=()=>(this.linkService.executeNamedAction(P),!1),E.className="internalLink"}_bindJSAction(E,P){E.href=this.linkService.getAnchorUrl("");const k=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const L of Object.keys(P.actions)){const j=k.get(L);j&&(E[j]=()=>{var z;return(z=this.linkService.eventBus)===null||z===void 0||z.dispatch("dispatcheventinsandbox",{source:this,detail:{id:P.id,name:L}}),!1})}E.onclick||(E.onclick=()=>!1),E.className="internalLink"}_bindResetFormAction(E,P){const k=E.onclick;if(k||(E.href=this.linkService.getAnchorUrl("")),E.className="internalLink",!this._fieldObjects){(0,r.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),k||(E.onclick=()=>!1);return}E.onclick=()=>{k&&k();const{fields:L,refs:j,include:z}=P,Z=[];if(L.length!==0||j.length!==0){const se=new Set(j);for(const ue of L){const me=this._fieldObjects[ue]||[];for(const{id:be}of me)se.add(be)}for(const ue of Object.values(this._fieldObjects))for(const me of ue)se.has(me.id)===z&&Z.push(me)}else for(const se of Object.values(this._fieldObjects))Z.push(...se);const te=this.annotationStorage,ie=[];for(const se of Z){const{id:ue}=se;switch(ie.push(ue),se.type){case"text":{const be=se.defaultValue||"";te.setValue(ue,{value:be});break}case"checkbox":case"radiobutton":{const be=se.defaultValue===se.exportValues;te.setValue(ue,{value:be});break}case"combobox":case"listbox":{const be=se.defaultValue||"";te.setValue(ue,{value:be});break}default:continue}const me=document.querySelector(`[data-element-id="${ue}"]`);if(me){if(!u.has(me)){(0,r.warn)(`_bindResetFormAction - element not allowed: ${ue}`);continue}}else continue;me.dispatchEvent(new Event("resetform"))}if(this.enableScripting){var le;(le=this.linkService.eventBus)===null||le===void 0||le.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:ie,name:"ResetForm"}})}return!1}}}class T extends g{constructor(E){var P,k,L;const j=!!(E.data.hasPopup||(P=E.data.titleObj)!==null&&P!==void 0&&P.str||(k=E.data.contentsObj)!==null&&k!==void 0&&k.str||(L=E.data.richText)!==null&&L!==void 0&&L.str);super(E,{isRenderable:j})}render(){this.container.className="textAnnotation";const E=document.createElement("img");return E.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",E.alt="[{{type}} Annotation]",E.dataset.l10nId="text_annotation_type",E.dataset.l10nArgs=JSON.stringify({type:this.data.name}),this.data.hasPopup||this._createPopup(E,this.data),this.container.append(E),this.container}}class b extends g{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}_getKeyModifier(E){const{isWin:P,isMac:k}=g.platform;return P&&E.ctrlKey||k&&E.metaKey}_setEventListener(E,P,k,L){P.includes("mouse")?E.addEventListener(P,j=>{var z;(z=this.linkService.eventBus)===null||z===void 0||z.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:k,value:L(j),shift:j.shiftKey,modifier:this._getKeyModifier(j)}})}):E.addEventListener(P,j=>{var z;(z=this.linkService.eventBus)===null||z===void 0||z.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:k,value:L(j)}})})}_setEventListeners(E,P,k){for(const[j,z]of P){var L;(z==="Action"||(L=this.data.actions)!==null&&L!==void 0&&L[z])&&this._setEventListener(E,j,z,k)}}_setBackgroundColor(E){const P=this.data.backgroundColor||null;E.style.backgroundColor=P===null?"transparent":r.Util.makeHexColor(P[0],P[1],P[2])}_setTextStyle(E){const P=["left","center","right"],{fontColor:k}=this.data.defaultAppearanceData,L=this.data.defaultAppearanceData.fontSize||f,j=E.style;let z;if(this.data.multiLine){const Z=Math.abs(this.data.rect[3]-this.data.rect[1]),te=Math.round(Z/(r.LINE_FACTOR*L))||1,ie=Z/te;z=Math.min(L,Math.round(ie/r.LINE_FACTOR))}else{const Z=Math.abs(this.data.rect[3]-this.data.rect[1]);z=Math.min(L,Math.round(Z/r.LINE_FACTOR))}j.fontSize=`calc(${z}px * var(--scale-factor))`,j.color=r.Util.makeHexColor(k[0],k[1],k[2]),this.data.textAlignment!==null&&(j.textAlign=P[this.data.textAlignment])}_setRequired(E,P){P?E.setAttribute("required",!0):E.removeAttribute("required"),E.setAttribute("aria-required",P)}}class _ extends b{constructor(E){const P=E.renderForms||!E.data.hasAppearance&&!!E.data.fieldValue;super(E,{isRenderable:P})}setPropertyOnSiblings(E,P,k,L){const j=this.annotationStorage;for(const z of this._getElementsByName(E.name,E.id))z.domElement&&(z.domElement[P]=k),j.setValue(z.id,{[L]:k})}render(){const E=this.annotationStorage,P=this.data.id;this.container.className="textWidgetAnnotation";let k=null;if(this.renderForms){const j=E.getValue(P,{value:this.data.fieldValue});let z=j.formattedValue||j.value||"";const Z=E.getValue(P,{charLimit:this.data.maxLen}).charLimit;Z&&z.length>Z&&(z=z.slice(0,Z));const te={userValue:z,formattedValue:null,valueOnFocus:""};this.data.multiLine?(k=document.createElement("textarea"),k.textContent=z,this.data.doNotScroll&&(k.style.overflowY="hidden")):(k=document.createElement("input"),k.type="text",k.setAttribute("value",z),this.data.doNotScroll&&(k.style.overflowX="hidden")),u.add(k),k.setAttribute("data-element-id",P),k.disabled=this.data.readOnly,k.name=this.data.fieldName,k.tabIndex=s,this._setRequired(k,this.data.required),Z&&(k.maxLength=Z),k.addEventListener("input",le=>{E.setValue(P,{value:le.target.value}),this.setPropertyOnSiblings(k,"value",le.target.value,"value")}),k.addEventListener("resetform",le=>{var se;const ue=(se=this.data.defaultFieldValue)!==null&&se!==void 0?se:"";k.value=te.userValue=ue,te.formattedValue=null});let ie=le=>{const{formattedValue:se}=te;se!=null&&(le.target.value=se),le.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){var L;k.addEventListener("focus",se=>{te.userValue&&(se.target.value=te.userValue),te.valueOnFocus=se.target.value}),k.addEventListener("updatefromsandbox",se=>{const ue={value(me){var be;te.userValue=(be=me.detail.value)!==null&&be!==void 0?be:"",E.setValue(P,{value:te.userValue.toString()}),me.target.value=te.userValue},formattedValue(me){const{formattedValue:be}=me.detail;te.formattedValue=be,be!=null&&me.target!==document.activeElement&&(me.target.value=be),E.setValue(P,{formattedValue:be})},selRange(me){me.target.setSelectionRange(...me.detail.selRange)},charLimit:me=>{var be;const{charLimit:we}=me.detail,{target:Ae}=me;if(we===0){Ae.removeAttribute("maxLength");return}Ae.setAttribute("maxLength",we);let Fe=te.userValue;!Fe||Fe.length<=we||(Fe=Fe.slice(0,we),Ae.value=te.userValue=Fe,E.setValue(P,{value:Fe}),(be=this.linkService.eventBus)===null||be===void 0||be.dispatch("dispatcheventinsandbox",{source:this,detail:{id:P,name:"Keystroke",value:Fe,willCommit:!0,commitKey:1,selStart:Ae.selectionStart,selEnd:Ae.selectionEnd}}))}};this._dispatchEventFromSandbox(ue,se)}),k.addEventListener("keydown",se=>{var ue;let me=-1;if(se.key==="Escape"?me=0:se.key==="Enter"?me=2:se.key==="Tab"&&(me=3),me===-1)return;const{value:be}=se.target;te.valueOnFocus!==be&&(te.userValue=be,(ue=this.linkService.eventBus)===null||ue===void 0||ue.dispatch("dispatcheventinsandbox",{source:this,detail:{id:P,name:"Keystroke",value:be,willCommit:!0,commitKey:me,selStart:se.target.selectionStart,selEnd:se.target.selectionEnd}}))});const le=ie;ie=null,k.addEventListener("blur",se=>{const{value:ue}=se.target;if(te.userValue=ue,this._mouseState.isDown&&te.valueOnFocus!==ue){var me;(me=this.linkService.eventBus)===null||me===void 0||me.dispatch("dispatcheventinsandbox",{source:this,detail:{id:P,name:"Keystroke",value:ue,willCommit:!0,commitKey:1,selStart:se.target.selectionStart,selEnd:se.target.selectionEnd}})}le(se)}),(L=this.data.actions)!==null&&L!==void 0&&L.Keystroke&&k.addEventListener("beforeinput",se=>{var ue;const{data:me,target:be}=se,{value:we,selectionStart:Ae,selectionEnd:Fe}=be;let _e=Ae,Ve=Fe;switch(se.inputType){case"deleteWordBackward":{const Qe=we.substring(0,Ae).match(/\w*[^\w]*$/);Qe&&(_e-=Qe[0].length);break}case"deleteWordForward":{const Qe=we.substring(Ae).match(/^[^\w]*\w*/);Qe&&(Ve+=Qe[0].length);break}case"deleteContentBackward":Ae===Fe&&(_e-=1);break;case"deleteContentForward":Ae===Fe&&(Ve+=1);break}se.preventDefault(),(ue=this.linkService.eventBus)===null||ue===void 0||ue.dispatch("dispatcheventinsandbox",{source:this,detail:{id:P,name:"Keystroke",value:we,change:me||"",willCommit:!1,selStart:_e,selEnd:Ve}})}),this._setEventListeners(k,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],se=>se.target.value)}if(ie&&k.addEventListener("blur",ie),this.data.comb){const se=(this.data.rect[2]-this.data.rect[0])/Z;k.classList.add("comb"),k.style.letterSpacing=`calc(${se}px * var(--scale-factor) - 1ch)`}}else k=document.createElement("div"),k.textContent=this.data.fieldValue,k.style.verticalAlign="middle",k.style.display="table-cell";return this._setTextStyle(k),this._setBackgroundColor(k),this._setDefaultPropertiesFromJS(k),this.container.append(k),this.container}}class w extends b{constructor(E){super(E,{isRenderable:E.renderForms})}render(){const E=this.annotationStorage,P=this.data,k=P.id;let L=E.getValue(k,{value:P.exportValue===P.fieldValue}).value;typeof L=="string"&&(L=L!=="Off",E.setValue(k,{value:L})),this.container.className="buttonWidgetAnnotation checkBox";const j=document.createElement("input");return u.add(j),j.setAttribute("data-element-id",k),j.disabled=P.readOnly,this._setRequired(j,this.data.required),j.type="checkbox",j.name=P.fieldName,L&&j.setAttribute("checked",!0),j.setAttribute("exportValue",P.exportValue),j.tabIndex=s,j.addEventListener("change",z=>{const{name:Z,checked:te}=z.target;for(const ie of this._getElementsByName(Z,k)){const le=te&&ie.exportValue===P.exportValue;ie.domElement&&(ie.domElement.checked=le),E.setValue(ie.id,{value:le})}E.setValue(k,{value:te})}),j.addEventListener("resetform",z=>{const Z=P.defaultFieldValue||"Off";z.target.checked=Z===P.exportValue}),this.enableScripting&&this.hasJSActions&&(j.addEventListener("updatefromsandbox",z=>{const Z={value(te){te.target.checked=te.detail.value!=="Off",E.setValue(k,{value:te.target.checked})}};this._dispatchEventFromSandbox(Z,z)}),this._setEventListeners(j,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],z=>z.target.checked)),this._setBackgroundColor(j),this._setDefaultPropertiesFromJS(j),this.container.append(j),this.container}}class m extends b{constructor(E){super(E,{isRenderable:E.renderForms})}render(){this.container.className="buttonWidgetAnnotation radioButton";const E=this.annotationStorage,P=this.data,k=P.id;let L=E.getValue(k,{value:P.fieldValue===P.buttonValue}).value;typeof L=="string"&&(L=L!==P.buttonValue,E.setValue(k,{value:L}));const j=document.createElement("input");if(u.add(j),j.setAttribute("data-element-id",k),j.disabled=P.readOnly,this._setRequired(j,this.data.required),j.type="radio",j.name=P.fieldName,L&&j.setAttribute("checked",!0),j.tabIndex=s,j.addEventListener("change",z=>{const{name:Z,checked:te}=z.target;for(const ie of this._getElementsByName(Z,k))E.setValue(ie.id,{value:!1});E.setValue(k,{value:te})}),j.addEventListener("resetform",z=>{const Z=P.defaultFieldValue;z.target.checked=Z!=null&&Z===P.buttonValue}),this.enableScripting&&this.hasJSActions){const z=P.buttonValue;j.addEventListener("updatefromsandbox",Z=>{const te={value:ie=>{const le=z===ie.detail.value;for(const se of this._getElementsByName(ie.target.name)){const ue=le&&se.id===k;se.domElement&&(se.domElement.checked=ue),E.setValue(se.id,{value:ue})}}};this._dispatchEventFromSandbox(te,Z)}),this._setEventListeners(j,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],Z=>Z.target.checked)}return this._setBackgroundColor(j),this._setDefaultPropertiesFromJS(j),this.container.append(j),this.container}}class S extends A{constructor(E){super(E,{ignoreBorder:E.data.hasAppearance})}render(){const E=super.render();E.className="buttonWidgetAnnotation pushButton",this.data.alternativeText&&(E.title=this.data.alternativeText);const P=E.lastChild;return this.enableScripting&&this.hasJSActions&&P&&(this._setDefaultPropertiesFromJS(P),P.addEventListener("updatefromsandbox",k=>{this._dispatchEventFromSandbox({},k)})),E}}class C extends b{constructor(E){super(E,{isRenderable:E.renderForms})}render(){this.container.className="choiceWidgetAnnotation";const E=this.annotationStorage,P=this.data.id,k=E.getValue(P,{value:this.data.fieldValue}),L=document.createElement("select");u.add(L),L.setAttribute("data-element-id",P),L.disabled=this.data.readOnly,this._setRequired(L,this.data.required),L.name=this.data.fieldName,L.tabIndex=s;let j=this.data.combo&&this.data.options.length>0;this.data.combo||(L.size=this.data.options.length,this.data.multiSelect&&(L.multiple=!0)),L.addEventListener("resetform",ie=>{const le=this.data.defaultFieldValue;for(const se of L.options)se.selected=se.value===le});for(const ie of this.data.options){const le=document.createElement("option");le.textContent=ie.displayValue,le.value=ie.exportValue,k.value.includes(ie.exportValue)&&(le.setAttribute("selected",!0),j=!1),L.append(le)}let z=null;if(j){const ie=document.createElement("option");ie.value=" ",ie.setAttribute("hidden",!0),ie.setAttribute("selected",!0),L.prepend(ie),z=()=>{ie.remove(),L.removeEventListener("input",z),z=null},L.addEventListener("input",z)}const Z=(ie,le)=>{const se=le?"value":"textContent",ue=ie.target.options;return ie.target.multiple?Array.prototype.filter.call(ue,me=>me.selected).map(me=>me[se]):ue.selectedIndex===-1?null:ue[ue.selectedIndex][se]},te=ie=>{const le=ie.target.options;return Array.prototype.map.call(le,se=>({displayValue:se.textContent,exportValue:se.value}))};return this.enableScripting&&this.hasJSActions?(L.addEventListener("updatefromsandbox",ie=>{const le={value(se){var ue;(ue=z)===null||ue===void 0||ue();const me=se.detail.value,be=new Set(Array.isArray(me)?me:[me]);for(const we of L.options)we.selected=be.has(we.value);E.setValue(P,{value:Z(se,!0)})},multipleSelection(se){L.multiple=!0},remove(se){const ue=L.options,me=se.detail.remove;ue[me].selected=!1,L.remove(me),ue.length>0&&Array.prototype.findIndex.call(ue,we=>we.selected)===-1&&(ue[0].selected=!0),E.setValue(P,{value:Z(se,!0),items:te(se)})},clear(se){for(;L.length!==0;)L.remove(0);E.setValue(P,{value:null,items:[]})},insert(se){const{index:ue,displayValue:me,exportValue:be}=se.detail.insert,we=L.children[ue],Ae=document.createElement("option");Ae.textContent=me,Ae.value=be,we?we.before(Ae):L.append(Ae),E.setValue(P,{value:Z(se,!0),items:te(se)})},items(se){const{items:ue}=se.detail;for(;L.length!==0;)L.remove(0);for(const me of ue){const{displayValue:be,exportValue:we}=me,Ae=document.createElement("option");Ae.textContent=be,Ae.value=we,L.append(Ae)}L.options.length>0&&(L.options[0].selected=!0),E.setValue(P,{value:Z(se,!0),items:te(se)})},indices(se){const ue=new Set(se.detail.indices);for(const me of se.target.options)me.selected=ue.has(me.index);E.setValue(P,{value:Z(se,!0)})},editable(se){se.target.disabled=!se.detail.editable}};this._dispatchEventFromSandbox(le,ie)}),L.addEventListener("input",ie=>{var le;const se=Z(ie,!0),ue=Z(ie,!1);E.setValue(P,{value:se}),(le=this.linkService.eventBus)===null||le===void 0||le.dispatch("dispatcheventinsandbox",{source:this,detail:{id:P,name:"Keystroke",value:ue,changeEx:se,willCommit:!0,commitKey:1,keyDown:!1}})}),this._setEventListeners(L,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"]],ie=>ie.target.checked)):L.addEventListener("input",function(ie){E.setValue(P,{value:Z(ie,!0)})}),this.data.combo&&this._setTextStyle(L),this._setBackgroundColor(L),this._setDefaultPropertiesFromJS(L),this.container.append(L),this.container}}class x extends g{constructor(E){var P,k,L;const j=!!((P=E.data.titleObj)!==null&&P!==void 0&&P.str||(k=E.data.contentsObj)!==null&&k!==void 0&&k.str||(L=E.data.richText)!==null&&L!==void 0&&L.str);super(E,{isRenderable:j})}render(){const E=["Line","Square","Circle","PolyLine","Polygon","Ink"];if(this.container.className="popupAnnotation",E.includes(this.data.parentType))return this.container;const P=`[data-annotation-id="${this.data.parentId}"]`,k=this.layer.querySelectorAll(P);if(k.length===0)return this.container;const L=new R({container:this.container,trigger:Array.from(k),color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText}),j=this.page,z=r.Util.normalizeRect([this.data.parentRect[0],j.view[3]-this.data.parentRect[1]+j.view[1],this.data.parentRect[2],j.view[3]-this.data.parentRect[3]+j.view[1]]),Z=z[0]+this.data.parentRect[2]-this.data.parentRect[0],te=z[1],[ie,le,se,ue]=this.viewport.viewBox,me=se-ie,be=ue-le;return this.container.style.left=`${100*(Z-ie)/me}%`,this.container.style.top=`${100*(te-le)/be}%`,this.container.append(L.render()),this.container}}class R{constructor(E){this.container=E.container,this.trigger=E.trigger,this.color=E.color,this.titleObj=E.titleObj,this.modificationDate=E.modificationDate,this.contentsObj=E.contentsObj,this.richText=E.richText,this.hideWrapper=E.hideWrapper||!1,this.pinned=!1}render(){var E,P;const L=document.createElement("div");L.className="popupWrapper",this.hideElement=this.hideWrapper?L:this.container,this.hideElement.hidden=!0;const j=document.createElement("div");j.className="popup";const z=this.color;if(z){const ie=.7*(255-z[0])+z[0],le=.7*(255-z[1])+z[1],se=.7*(255-z[2])+z[2];j.style.backgroundColor=r.Util.makeHexColor(ie|0,le|0,se|0)}const Z=document.createElement("h1");Z.dir=this.titleObj.dir,Z.textContent=this.titleObj.str,j.append(Z);const te=a.PDFDateString.toDateObject(this.modificationDate);if(te){const ie=document.createElement("span");ie.className="popupDate",ie.textContent="{{date}}, {{time}}",ie.dataset.l10nId="annotation_date_string",ie.dataset.l10nArgs=JSON.stringify({date:te.toLocaleDateString(),time:te.toLocaleTimeString()}),j.append(ie)}if((E=this.richText)!==null&&E!==void 0&&E.str&&(!((P=this.contentsObj)!==null&&P!==void 0&&P.str)||this.contentsObj.str===this.richText.str))l.XfaLayer.render({xfaHtml:this.richText.html,intent:"richText",div:j}),j.lastChild.className="richText popupContent";else{const ie=this._formatContents(this.contentsObj);j.append(ie)}Array.isArray(this.trigger)||(this.trigger=[this.trigger]);for(const ie of this.trigger)ie.addEventListener("click",this._toggle.bind(this)),ie.addEventListener("mouseover",this._show.bind(this,!1)),ie.addEventListener("mouseout",this._hide.bind(this,!1));return j.addEventListener("click",this._hide.bind(this,!0)),L.append(j),L}_formatContents(E){let{str:P,dir:k}=E;const L=document.createElement("p");L.className="popupContent",L.dir=k;const j=P.split(/(?:\r\n?|\n)/);for(let z=0,Z=j.length;z<Z;++z){const te=j[z];L.append(document.createTextNode(te)),z<Z-1&&L.append(document.createElement("br"))}return L}_toggle(){this.pinned?this._hide(!0):this._show(!0)}_show(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1)&&(this.pinned=!0),this.hideElement.hidden&&(this.hideElement.hidden=!1,this.container.style.zIndex=parseInt(this.container.style.zIndex)+1e3)}_hide(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0)&&(this.pinned=!1),!this.hideElement.hidden&&!this.pinned&&(this.hideElement.hidden=!0,this.container.style.zIndex=parseInt(this.container.style.zIndex)-1e3)}}class M extends g{constructor(E){var P,k,L;const j=!!(E.data.hasPopup||(P=E.data.titleObj)!==null&&P!==void 0&&P.str||(k=E.data.contentsObj)!==null&&k!==void 0&&k.str||(L=E.data.richText)!==null&&L!==void 0&&L.str);super(E,{isRenderable:j,ignoreBorder:!0}),this.textContent=E.data.textContent}render(){if(this.container.className="freeTextAnnotation",this.textContent){const E=document.createElement("div");E.className="annotationTextContent",E.setAttribute("role","comment");for(const P of this.textContent){const k=document.createElement("span");k.textContent=P,E.append(k)}this.container.append(E)}return this.data.hasPopup||this._createPopup(null,this.data),this.container}}class F extends g{constructor(E){var P,k,L;const j=!!(E.data.hasPopup||(P=E.data.titleObj)!==null&&P!==void 0&&P.str||(k=E.data.contentsObj)!==null&&k!==void 0&&k.str||(L=E.data.richText)!==null&&L!==void 0&&L.str);super(E,{isRenderable:j,ignoreBorder:!0})}render(){this.container.className="lineAnnotation";const E=this.data,{width:P,height:k}=p(E.rect),L=this.svgFactory.create(P,k,!0),j=this.svgFactory.createElement("svg:line");return j.setAttribute("x1",E.rect[2]-E.lineCoordinates[0]),j.setAttribute("y1",E.rect[3]-E.lineCoordinates[1]),j.setAttribute("x2",E.rect[2]-E.lineCoordinates[2]),j.setAttribute("y2",E.rect[3]-E.lineCoordinates[3]),j.setAttribute("stroke-width",E.borderStyle.width||1),j.setAttribute("stroke","transparent"),j.setAttribute("fill","transparent"),L.append(j),this.container.append(L),this._createPopup(j,E),this.container}}class H extends g{constructor(E){var P,k,L;const j=!!(E.data.hasPopup||(P=E.data.titleObj)!==null&&P!==void 0&&P.str||(k=E.data.contentsObj)!==null&&k!==void 0&&k.str||(L=E.data.richText)!==null&&L!==void 0&&L.str);super(E,{isRenderable:j,ignoreBorder:!0})}render(){this.container.className="squareAnnotation";const E=this.data,{width:P,height:k}=p(E.rect),L=this.svgFactory.create(P,k,!0),j=E.borderStyle.width,z=this.svgFactory.createElement("svg:rect");return z.setAttribute("x",j/2),z.setAttribute("y",j/2),z.setAttribute("width",P-j),z.setAttribute("height",k-j),z.setAttribute("stroke-width",j||1),z.setAttribute("stroke","transparent"),z.setAttribute("fill","transparent"),L.append(z),this.container.append(L),this._createPopup(z,E),this.container}}class V extends g{constructor(E){var P,k,L;const j=!!(E.data.hasPopup||(P=E.data.titleObj)!==null&&P!==void 0&&P.str||(k=E.data.contentsObj)!==null&&k!==void 0&&k.str||(L=E.data.richText)!==null&&L!==void 0&&L.str);super(E,{isRenderable:j,ignoreBorder:!0})}render(){this.container.className="circleAnnotation";const E=this.data,{width:P,height:k}=p(E.rect),L=this.svgFactory.create(P,k,!0),j=E.borderStyle.width,z=this.svgFactory.createElement("svg:ellipse");return z.setAttribute("cx",P/2),z.setAttribute("cy",k/2),z.setAttribute("rx",P/2-j/2),z.setAttribute("ry",k/2-j/2),z.setAttribute("stroke-width",j||1),z.setAttribute("stroke","transparent"),z.setAttribute("fill","transparent"),L.append(z),this.container.append(L),this._createPopup(z,E),this.container}}class X extends g{constructor(E){var P,k,L;const j=!!(E.data.hasPopup||(P=E.data.titleObj)!==null&&P!==void 0&&P.str||(k=E.data.contentsObj)!==null&&k!==void 0&&k.str||(L=E.data.richText)!==null&&L!==void 0&&L.str);super(E,{isRenderable:j,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.className=this.containerClassName;const E=this.data,{width:P,height:k}=p(E.rect),L=this.svgFactory.create(P,k,!0);let j=[];for(const Z of E.vertices){const te=Z.x-E.rect[0],ie=E.rect[3]-Z.y;j.push(te+","+ie)}j=j.join(" ");const z=this.svgFactory.createElement(this.svgElementName);return z.setAttribute("points",j),z.setAttribute("stroke-width",E.borderStyle.width||1),z.setAttribute("stroke","transparent"),z.setAttribute("fill","transparent"),L.append(z),this.container.append(L),this._createPopup(z,E),this.container}}class K extends X{constructor(E){super(E),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class q extends g{constructor(E){var P,k,L;const j=!!(E.data.hasPopup||(P=E.data.titleObj)!==null&&P!==void 0&&P.str||(k=E.data.contentsObj)!==null&&k!==void 0&&k.str||(L=E.data.richText)!==null&&L!==void 0&&L.str);super(E,{isRenderable:j,ignoreBorder:!0})}render(){return this.container.className="caretAnnotation",this.data.hasPopup||this._createPopup(null,this.data),this.container}}class U extends g{constructor(E){var P,k,L;const j=!!(E.data.hasPopup||(P=E.data.titleObj)!==null&&P!==void 0&&P.str||(k=E.data.contentsObj)!==null&&k!==void 0&&k.str||(L=E.data.richText)!==null&&L!==void 0&&L.str);super(E,{isRenderable:j,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline"}render(){this.container.className=this.containerClassName;const E=this.data,{width:P,height:k}=p(E.rect),L=this.svgFactory.create(P,k,!0);for(const j of E.inkLists){let z=[];for(const te of j){const ie=te.x-E.rect[0],le=E.rect[3]-te.y;z.push(`${ie},${le}`)}z=z.join(" ");const Z=this.svgFactory.createElement(this.svgElementName);Z.setAttribute("points",z),Z.setAttribute("stroke-width",E.borderStyle.width||1),Z.setAttribute("stroke","transparent"),Z.setAttribute("fill","transparent"),this._createPopup(Z,E),L.append(Z)}return this.container.append(L),this.container}}class B extends g{constructor(E){var P,k,L;const j=!!(E.data.hasPopup||(P=E.data.titleObj)!==null&&P!==void 0&&P.str||(k=E.data.contentsObj)!==null&&k!==void 0&&k.str||(L=E.data.richText)!==null&&L!==void 0&&L.str);super(E,{isRenderable:j,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("highlightAnnotation"):(this.container.className="highlightAnnotation",this.container)}}class N extends g{constructor(E){var P,k,L;const j=!!(E.data.hasPopup||(P=E.data.titleObj)!==null&&P!==void 0&&P.str||(k=E.data.contentsObj)!==null&&k!==void 0&&k.str||(L=E.data.richText)!==null&&L!==void 0&&L.str);super(E,{isRenderable:j,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("underlineAnnotation"):(this.container.className="underlineAnnotation",this.container)}}class Q extends g{constructor(E){var P,k,L;const j=!!(E.data.hasPopup||(P=E.data.titleObj)!==null&&P!==void 0&&P.str||(k=E.data.contentsObj)!==null&&k!==void 0&&k.str||(L=E.data.richText)!==null&&L!==void 0&&L.str);super(E,{isRenderable:j,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("squigglyAnnotation"):(this.container.className="squigglyAnnotation",this.container)}}class ce extends g{constructor(E){var P,k,L;const j=!!(E.data.hasPopup||(P=E.data.titleObj)!==null&&P!==void 0&&P.str||(k=E.data.contentsObj)!==null&&k!==void 0&&k.str||(L=E.data.richText)!==null&&L!==void 0&&L.str);super(E,{isRenderable:j,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("strikeoutAnnotation"):(this.container.className="strikeoutAnnotation",this.container)}}class pe extends g{constructor(E){var P,k,L;const j=!!(E.data.hasPopup||(P=E.data.titleObj)!==null&&P!==void 0&&P.str||(k=E.data.contentsObj)!==null&&k!==void 0&&k.str||(L=E.data.richText)!==null&&L!==void 0&&L.str);super(E,{isRenderable:j,ignoreBorder:!0})}render(){return this.container.className="stampAnnotation",this.data.hasPopup||this._createPopup(null,this.data),this.container}}class Re extends g{constructor(E){var P;super(E,{isRenderable:!0});const{filename:k,content:L}=this.data.file;this.filename=(0,a.getFilenameFromUrl)(k),this.content=L,(P=this.linkService.eventBus)===null||P===void 0||P.dispatch("fileattachmentannotation",{source:this,filename:k,content:L})}render(){var E,P;this.container.className="fileAttachmentAnnotation";const k=document.createElement("div");return k.className="popupTriggerArea",k.addEventListener("dblclick",this._download.bind(this)),!this.data.hasPopup&&((E=this.data.titleObj)!==null&&E!==void 0&&E.str||(P=this.data.contentsObj)!==null&&P!==void 0&&P.str||this.data.richText)&&this._createPopup(k,this.data),this.container.append(k),this.container}_download(){var E;(E=this.downloadManager)===null||E===void 0||E.openOrDownloadData(this.container,this.content,this.filename)}}class Y{static render(E){const{annotations:P,div:k,viewport:L,accessibilityManager:j}=E;h(this,Y,D).call(this,k,L);let z=0;for(const Z of P){if(Z.annotationType!==r.AnnotationType.POPUP){const{width:ie,height:le}=p(Z.rect);if(ie<=0||le<=0)continue}const te=v.create({data:Z,layer:k,page:E.page,viewport:L,linkService:E.linkService,downloadManager:E.downloadManager,imageResourcesPath:E.imageResourcesPath||"",renderForms:E.renderForms!==!1,svgFactory:new a.DOMSVGFactory,annotationStorage:E.annotationStorage||new i.AnnotationStorage,enableScripting:E.enableScripting,hasJSActions:E.hasJSActions,fieldObjects:E.fieldObjects,mouseState:E.mouseState||{isDown:!1}});if(te.isRenderable){const ie=te.render();if(Z.hidden&&(ie.style.visibility="hidden"),Array.isArray(ie))for(const le of ie)le.style.zIndex=z++,h(Y,Y,O).call(Y,le,Z.id,k,j);else ie.style.zIndex=z++,te instanceof x?k.prepend(ie):h(Y,Y,O).call(Y,ie,Z.id,k,j)}}h(this,Y,W).call(this,k,E.annotationCanvasMap)}static update(E){const{annotationCanvasMap:P,div:k,viewport:L}=E;h(this,Y,D).call(this,k,L),h(this,Y,W).call(this,k,P),k.hidden=!1}}e.AnnotationLayer=Y;function O(G,E,P,k){const L=G.firstChild||G;L.id=`${a.AnnotationPrefix}${E}`,P.append(G),k==null||k.moveElementInDOM(P,G,L,!1)}function D(G,E){let{width:P,height:k,rotation:L}=E;const{style:j}=G,z=L%180!==0,Z=Math.floor(P)+"px",te=Math.floor(k)+"px";j.width=z?te:Z,j.height=z?Z:te,G.setAttribute("data-main-rotation",L)}function W(G,E){if(E){for(const[P,k]of E){const L=G.querySelector(`[data-annotation-id="${P}"]`);if(!L)continue;const{firstChild:j}=L;j?j.nodeName==="CANVAS"?j.replaceWith(k):j.before(k):L.append(k)}E.clear()}}},(n,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ColorConverters=void 0;function t(a){return Math.floor(Math.max(0,Math.min(1,a))*255).toString(16).padStart(2,"0")}class r{static CMYK_G(i){let[c,l,h,o]=i;return["G",1-Math.min(1,.3*c+.59*h+.11*l+o)]}static G_CMYK(i){let[c]=i;return["CMYK",0,0,0,1-c]}static G_RGB(i){let[c]=i;return["RGB",c,c,c]}static G_HTML(i){let[c]=i;const l=t(c);return`#${l}${l}${l}`}static RGB_G(i){let[c,l,h]=i;return["G",.3*c+.59*l+.11*h]}static RGB_HTML(i){let[c,l,h]=i;const o=t(c),s=t(l),f=t(h);return`#${o}${s}${f}`}static T_HTML(){return"#00000000"}static CMYK_RGB(i){let[c,l,h,o]=i;return["RGB",1-Math.min(1,c+o),1-Math.min(1,h+o),1-Math.min(1,l+o)]}static CMYK_HTML(i){const c=this.CMYK_RGB(i).slice(1);return this.RGB_HTML(c)}static RGB_CMYK(i){let[c,l,h]=i;const o=1-c,s=1-l,f=1-h,u=Math.min(o,s,f);return["CMYK",o,s,f,u]}}e.ColorConverters=r},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.XfaLayer=void 0;var r=t(145);class a{static setupStorage(c,l,h,o,s){const f=o.getValue(l,{value:null});switch(h.name){case"textarea":if(f.value!==null&&(c.textContent=f.value),s==="print")break;c.addEventListener("input",u=>{o.setValue(l,{value:u.target.value})});break;case"input":if(h.attributes.type==="radio"||h.attributes.type==="checkbox"){if(f.value===h.attributes.xfaOn?c.setAttribute("checked",!0):f.value===h.attributes.xfaOff&&c.removeAttribute("checked"),s==="print")break;c.addEventListener("change",u=>{o.setValue(l,{value:u.target.checked?u.target.getAttribute("xfaOn"):u.target.getAttribute("xfaOff")})})}else{if(f.value!==null&&c.setAttribute("value",f.value),s==="print")break;c.addEventListener("input",u=>{o.setValue(l,{value:u.target.value})})}break;case"select":if(f.value!==null)for(const u of h.children)u.attributes.value===f.value&&(u.attributes.selected=!0);c.addEventListener("input",u=>{const p=u.target.options,v=p.selectedIndex===-1?"":p[p.selectedIndex].value;o.setValue(l,{value:v})});break}}static setAttributes(c){let{html:l,element:h,storage:o=null,intent:s,linkService:f}=c;const{attributes:u}=h,p=l instanceof HTMLAnchorElement;u.type==="radio"&&(u.name=`${u.name}-${s}`);for(const[v,g]of Object.entries(u))if(g!=null)switch(v){case"class":g.length&&l.setAttribute(v,g.join(" "));break;case"dataId":break;case"id":l.setAttribute("data-element-id",g);break;case"style":Object.assign(l.style,g);break;case"textContent":l.textContent=g;break;default:(!p||v!=="href"&&v!=="newWindow")&&l.setAttribute(v,g)}p&&f.addLinkAttributes(l,u.href,u.newWindow),o&&u.dataId&&this.setupStorage(l,u.dataId,h,o)}static render(c){const l=c.annotationStorage,h=c.linkService,o=c.xfaHtml,s=c.intent||"display",f=document.createElement(o.name);o.attributes&&this.setAttributes({html:f,element:o,intent:s,linkService:h});const u=[[o,-1,f]],p=c.div;if(p.append(f),c.viewport){const A=`matrix(${c.viewport.transform.join(",")})`;p.style.transform=A}s!=="richText"&&p.setAttribute("class","xfaLayer xfaFont");const v=[];for(;u.length>0;){var g;const[A,T,b]=u.at(-1);if(T+1===A.children.length){u.pop();continue}const _=A.children[++u.at(-1)[1]];if(_===null)continue;const{name:w}=_;if(w==="#text"){const S=document.createTextNode(_.value);v.push(S),b.append(S);continue}let m;if(_!=null&&(g=_.attributes)!==null&&g!==void 0&&g.xmlns?m=document.createElementNS(_.attributes.xmlns,w):m=document.createElement(w),b.append(m),_.attributes&&this.setAttributes({html:m,element:_,storage:l,intent:s,linkService:h}),_.children&&_.children.length>0)u.push([_,-1,m]);else if(_.value){const S=document.createTextNode(_.value);r.XfaText.shouldBuildText(w)&&v.push(S),m.append(S)}}for(const A of p.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))A.setAttribute("readOnly",!0);return{textDivs:v}}static update(c){const l=`matrix(${c.viewport.transform.join(",")})`;c.div.style.transform=l,c.div.hidden=!1}}e.XfaLayer=a},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TextLayerRenderTask=void 0,e.renderTextLayer=b;var r=t(1),a=t(133);const i=1e5,c=30,l=.8,h=new Map,o=/^\s+$/g;function s(_,w){const m=h.get(_);if(m)return m;w.save(),w.font=`${c}px ${_}`;const S=w.measureText("");let C=S.fontBoundingBoxAscent,x=Math.abs(S.fontBoundingBoxDescent);if(C){w.restore();const M=C/(C+x);return h.set(_,M),M}w.strokeStyle="red",w.clearRect(0,0,c,c),w.strokeText("g",0,0);let R=w.getImageData(0,0,c,c).data;x=0;for(let M=R.length-1-3;M>=0;M-=4)if(R[M]>0){x=Math.ceil(M/4/c);break}w.clearRect(0,0,c,c),w.strokeText("A",0,c),R=w.getImageData(0,0,c,c).data,C=0;for(let M=0,F=R.length;M<F;M+=4)if(R[M]>0){C=c-Math.floor(M/4/c);break}if(w.restore(),C){const M=C/(C+x);return h.set(_,M),M}return h.set(_,l),l}function f(_,w,m,S){const C=document.createElement("span"),x=_._enhanceTextSelection?{angle:0,canvasWidth:0,hasText:w.str!=="",hasEOL:w.hasEOL,originalTransform:null,paddingBottom:0,paddingLeft:0,paddingRight:0,paddingTop:0,scale:1,fontSize:0}:{angle:0,canvasWidth:0,hasText:w.str!=="",hasEOL:w.hasEOL,fontSize:0};_._textDivs.push(C);const R=r.Util.transform(_._viewport.transform,w.transform);let M=Math.atan2(R[1],R[0]);const F=m[w.fontName];F.vertical&&(M+=Math.PI/2);const H=Math.hypot(R[2],R[3]),V=H*s(F.fontFamily,S);let X,K;M===0?(X=R[4],K=R[5]-V):(X=R[4]+V*Math.sin(M),K=R[5]-V*Math.cos(M)),C.style.left=`${X}px`,C.style.top=`${K}px`,C.style.fontSize=`${H}px`,C.style.fontFamily=F.fontFamily,x.fontSize=H,C.setAttribute("role","presentation"),C.textContent=w.str,C.dir=w.dir,_._fontInspectorEnabled&&(C.dataset.fontName=w.fontName),M!==0&&(x.angle=M*(180/Math.PI));let q=!1;if(w.str.length>1||_._enhanceTextSelection&&o.test(w.str))q=!0;else if(w.str!==" "&&w.transform[0]!==w.transform[3]){const U=Math.abs(w.transform[0]),B=Math.abs(w.transform[3]);U!==B&&Math.max(U,B)/Math.min(U,B)>1.5&&(q=!0)}if(q&&(F.vertical?x.canvasWidth=w.height*_._viewport.scale:x.canvasWidth=w.width*_._viewport.scale),_._textDivProperties.set(C,x),_._textContentStream&&_._layoutText(C),_._enhanceTextSelection&&x.hasText){let U=1,B=0;M!==0&&(U=Math.cos(M),B=Math.sin(M));const N=(F.vertical?w.height:w.width)*_._viewport.scale,Q=H;let ce,pe;M!==0?(ce=[U,B,-B,U,X,K],pe=r.Util.getAxialAlignedBoundingBox([0,0,N,Q],ce)):pe=[X,K,X+N,K+Q],_._bounds.push({left:pe[0],top:pe[1],right:pe[2],bottom:pe[3],div:C,size:[N,Q],m:ce})}}function u(_){if(_._canceled)return;const w=_._textDivs,m=_._capability,S=w.length;if(S>i){_._renderingDone=!0,m.resolve();return}if(!_._textContentStream)for(let C=0;C<S;C++)_._layoutText(w[C]);_._renderingDone=!0,m.resolve()}function p(_,w,m){let S=0;for(let C=0;C<m;C++){const x=_[w++];x>0&&(S=S?Math.min(x,S):x)}return S}function v(_){const w=_._bounds,m=_._viewport,S=g(m.width,m.height,w);for(let C=0;C<S.length;C++){const x=w[C].div,R=_._textDivProperties.get(x);if(R.angle===0){R.paddingLeft=w[C].left-S[C].left,R.paddingTop=w[C].top-S[C].top,R.paddingRight=S[C].right-w[C].right,R.paddingBottom=S[C].bottom-w[C].bottom,_._textDivProperties.set(x,R);continue}const M=S[C],F=w[C],H=F.m,V=H[0],X=H[1],K=[[0,0],[0,F.size[1]],[F.size[0],0],F.size],q=new Float64Array(64);for(let B=0,N=K.length;B<N;B++){const Q=r.Util.applyTransform(K[B],H);q[B+0]=V&&(M.left-Q[0])/V,q[B+4]=X&&(M.top-Q[1])/X,q[B+8]=V&&(M.right-Q[0])/V,q[B+12]=X&&(M.bottom-Q[1])/X,q[B+16]=X&&(M.left-Q[0])/-X,q[B+20]=V&&(M.top-Q[1])/V,q[B+24]=X&&(M.right-Q[0])/-X,q[B+28]=V&&(M.bottom-Q[1])/V,q[B+32]=V&&(M.left-Q[0])/-V,q[B+36]=X&&(M.top-Q[1])/-X,q[B+40]=V&&(M.right-Q[0])/-V,q[B+44]=X&&(M.bottom-Q[1])/-X,q[B+48]=X&&(M.left-Q[0])/X,q[B+52]=V&&(M.top-Q[1])/-V,q[B+56]=X&&(M.right-Q[0])/X,q[B+60]=V&&(M.bottom-Q[1])/-V}const U=1+Math.min(Math.abs(V),Math.abs(X));R.paddingLeft=p(q,32,16)/U,R.paddingTop=p(q,48,16)/U,R.paddingRight=p(q,0,16)/U,R.paddingBottom=p(q,16,16)/U,_._textDivProperties.set(x,R)}}function g(_,w,m){const S=m.map(function(x,R){return{x1:x.left,y1:x.top,x2:x.right,y2:x.bottom,index:R,x1New:void 0,x2New:void 0}});A(_,S);const C=new Array(m.length);for(const x of S){const R=x.index;C[R]={left:x.x1New,top:0,right:x.x2New,bottom:0}}m.map(function(x,R){const M=C[R],F=S[R];F.x1=x.top,F.y1=_-M.right,F.x2=x.bottom,F.y2=_-M.left,F.index=R,F.x1New=void 0,F.x2New=void 0}),A(w,S);for(const x of S){const R=x.index;C[R].top=x.x1New,C[R].bottom=x.x2New}return C}function A(_,w){w.sort(function(C,x){return C.x1-x.x1||C.index-x.index});const S=[{start:-1/0,end:1/0,boundary:{x1:-1/0,y1:-1/0,x2:0,y2:1/0,index:-1,x1New:0,x2New:0}}];for(const C of w){let x=0;for(;x<S.length&&S[x].end<=C.y1;)x++;let R=S.length-1;for(;R>=0&&S[R].start>=C.y2;)R--;let M,F,H,V,X=-1/0;for(H=x;H<=R;H++){M=S[H],F=M.boundary;let U;F.x2>C.x1?U=F.index>C.index?F.x1New:C.x1:F.x2New===void 0?U=(F.x2+C.x1)/2:U=F.x2New,U>X&&(X=U)}for(C.x1New=X,H=x;H<=R;H++)M=S[H],F=M.boundary,F.x2New===void 0?F.x2>C.x1?F.index>C.index&&(F.x2New=F.x2):F.x2New=X:F.x2New>X&&(F.x2New=Math.max(X,F.x2));const K=[];let q=null;for(H=x;H<=R;H++){M=S[H],F=M.boundary;const U=F.x2>C.x2?F:C;q===U?K.at(-1).end=M.end:(K.push({start:M.start,end:M.end,boundary:U}),q=U)}for(S[x].start<C.y1&&(K[0].start=C.y1,K.unshift({start:S[x].start,end:C.y1,boundary:S[x].boundary})),C.y2<S[R].end&&(K.at(-1).end=C.y2,K.push({start:C.y2,end:S[R].end,boundary:S[R].boundary})),H=x;H<=R;H++){if(M=S[H],F=M.boundary,F.x2New!==void 0)continue;let U=!1;for(V=x-1;!U&&V>=0&&S[V].start>=F.y1;V--)U=S[V].boundary===F;for(V=R+1;!U&&V<S.length&&S[V].end<=F.y2;V++)U=S[V].boundary===F;for(V=0;!U&&V<K.length;V++)U=K[V].boundary===F;U||(F.x2New=X)}Array.prototype.splice.apply(S,[x,R-x+1,...K])}for(const C of S){const x=C.boundary;x.x2New===void 0&&(x.x2New=Math.max(_,x.x2))}}class T{constructor(w){var m;let{textContent:S,textContentStream:C,container:x,viewport:R,textDivs:M,textContentItemsStr:F,enhanceTextSelection:H}=w;H&&(0,a.deprecated)("The `enhanceTextSelection` functionality will be removed in the future."),this._textContent=S,this._textContentStream=C,this._container=x,this._document=x.ownerDocument,this._viewport=R,this._textDivs=M||[],this._textContentItemsStr=F||[],this._enhanceTextSelection=!!H,this._fontInspectorEnabled=!!((m=globalThis.FontInspector)!==null&&m!==void 0&&m.enabled),this._reader=null,this._layoutTextLastFontSize=null,this._layoutTextLastFontFamily=null,this._layoutTextCtx=null,this._textDivProperties=new WeakMap,this._renderingDone=!1,this._canceled=!1,this._capability=(0,r.createPromiseCapability)(),this._renderTimer=null,this._bounds=[],this._devicePixelRatio=globalThis.devicePixelRatio||1,this._capability.promise.finally(()=>{this._enhanceTextSelection||(this._textDivProperties=null),this._layoutTextCtx&&(this._layoutTextCtx.canvas.width=0,this._layoutTextCtx.canvas.height=0,this._layoutTextCtx=null)}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new r.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._renderTimer!==null&&(clearTimeout(this._renderTimer),this._renderTimer=null),this._capability.reject(new Error("TextLayer task cancelled."))}_processItems(w,m){for(let S=0,C=w.length;S<C;S++){if(w[S].str===void 0){if(w[S].type==="beginMarkedContentProps"||w[S].type==="beginMarkedContent"){const x=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),w[S].id!==null&&this._container.setAttribute("id",`${w[S].id}`),x.append(this._container)}else w[S].type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(w[S].str),f(this,w[S],m,this._layoutTextCtx)}}_layoutText(w){const m=this._textDivProperties.get(w);let S="";if(m.canvasWidth!==0&&m.hasText){const{fontFamily:C}=w.style,{fontSize:x}=m;(x!==this._layoutTextLastFontSize||C!==this._layoutTextLastFontFamily)&&(this._layoutTextCtx.font=`${x*this._devicePixelRatio}px ${C}`,this._layoutTextLastFontSize=x,this._layoutTextLastFontFamily=C);const{width:R}=this._layoutTextCtx.measureText(w.textContent);if(R>0){const M=this._devicePixelRatio*m.canvasWidth/R;this._enhanceTextSelection&&(m.scale=M),S=`scaleX(${M})`}}if(m.angle!==0&&(S=`rotate(${m.angle}deg) ${S}`),S.length>0&&(this._enhanceTextSelection&&(m.originalTransform=S),w.style.transform=S),m.hasText&&this._container.append(w),m.hasEOL){const C=document.createElement("br");C.setAttribute("role","presentation"),this._container.append(C)}}_render(){let w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const m=(0,r.createPromiseCapability)();let S=Object.create(null);const C=this._document.createElement("canvas");if(C.height=C.width=c,this._layoutTextCtx=C.getContext("2d",{alpha:!1}),this._textContent){const x=this._textContent.items,R=this._textContent.styles;this._processItems(x,R),m.resolve()}else if(this._textContentStream){const x=()=>{this._reader.read().then(R=>{let{value:M,done:F}=R;if(F){m.resolve();return}Object.assign(S,M.styles),this._processItems(M.items,S),x()},m.reject)};this._reader=this._textContentStream.getReader(),x()}else throw new Error('Neither "textContent" nor "textContentStream" parameters specified.');m.promise.then(()=>{S=null,w?this._renderTimer=setTimeout(()=>{u(this),this._renderTimer=null},w):u(this)},this._capability.reject)}expandTextDivs(){let w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!this._enhanceTextSelection||!this._renderingDone)return;this._bounds!==null&&(v(this),this._bounds=null);const m=[],S=[];for(let C=0,x=this._textDivs.length;C<x;C++){const R=this._textDivs[C],M=this._textDivProperties.get(R);M.hasText&&(w?(m.length=0,S.length=0,M.originalTransform&&m.push(M.originalTransform),M.paddingTop>0?(S.push(`${M.paddingTop}px`),m.push(`translateY(${-M.paddingTop}px)`)):S.push(0),M.paddingRight>0?S.push(`${M.paddingRight/M.scale}px`):S.push(0),M.paddingBottom>0?S.push(`${M.paddingBottom}px`):S.push(0),M.paddingLeft>0?(S.push(`${M.paddingLeft/M.scale}px`),m.push(`translateX(${-M.paddingLeft/M.scale}px)`)):S.push(0),R.style.padding=S.join(" "),m.length&&(R.style.transform=m.join(" "))):(R.style.padding=null,R.style.transform=M.originalTransform))}}}e.TextLayerRenderTask=T;function b(_){const w=new T({textContent:_.textContent,textContentStream:_.textContentStream,container:_.container,viewport:_.viewport,textDivs:_.textDivs,textContentItemsStr:_.textContentItemsStr,enhanceTextSelection:_.enhanceTextSelection});return w._render(_.timeout),w}},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SVGGraphics=void 0;var r=t(133),a=t(1),i=t(3);let c=class{constructor(){(0,a.unreachable)("Not implemented: SVGGraphics")}};e.SVGGraphics=c;{let g=function(m){let S=[];const C=[];for(const x of m){if(x.fn==="save"){S.push({fnId:92,fn:"group",items:[]}),C.push(S),S=S.at(-1).items;continue}x.fn==="restore"?S=C.pop():S.push(x)}return S},A=function(m){if(Number.isInteger(m))return m.toString();const S=m.toFixed(10);let C=S.length-1;if(S[C]!=="0")return S;do C--;while(S[C]==="0");return S.substring(0,S[C]==="."?C:C+1)},T=function(m){if(m[4]===0&&m[5]===0){if(m[1]===0&&m[2]===0)return m[0]===1&&m[3]===1?"":`scale(${A(m[0])} ${A(m[3])})`;if(m[0]===m[3]&&m[1]===-m[2]){const S=Math.acos(m[0])*180/Math.PI;return`rotate(${A(S)})`}}else if(m[0]===1&&m[1]===0&&m[2]===0&&m[3]===1)return`translate(${A(m[4])} ${A(m[5])})`;return`matrix(${A(m[0])} ${A(m[1])} ${A(m[2])} ${A(m[3])} ${A(m[4])} ${A(m[5])})`};const l={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},h="http://www.w3.org/XML/1998/namespace",o="http://www.w3.org/1999/xlink",s=["butt","round","square"],f=["miter","round","bevel"],u=function(m){let S=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(URL.createObjectURL&&typeof Blob<"u"&&!C)return URL.createObjectURL(new Blob([m],{type:S}));const x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let R=`data:${S};base64,`;for(let M=0,F=m.length;M<F;M+=3){const H=m[M]&255,V=m[M+1]&255,X=m[M+2]&255,K=H>>2,q=(H&3)<<4|V>>4,U=M+1<F?(V&15)<<2|X>>6:64,B=M+2<F?X&63:64;R+=x[K]+x[q]+x[U]+x[B]}return R},p=function(){const m=new Uint8Array([137,80,78,71,13,10,26,10]),S=12,C=new Int32Array(256);for(let X=0;X<256;X++){let K=X;for(let q=0;q<8;q++)K&1?K=3988292384^K>>1&2147483647:K=K>>1&2147483647;C[X]=K}function x(X,K,q){let U=-1;for(let B=K;B<q;B++){const N=(U^X[B])&255,Q=C[N];U=U>>>8^Q}return U^-1}function R(X,K,q,U){let B=U;const N=K.length;q[B]=N>>24&255,q[B+1]=N>>16&255,q[B+2]=N>>8&255,q[B+3]=N&255,B+=4,q[B]=X.charCodeAt(0)&255,q[B+1]=X.charCodeAt(1)&255,q[B+2]=X.charCodeAt(2)&255,q[B+3]=X.charCodeAt(3)&255,B+=4,q.set(K,B),B+=K.length;const Q=x(q,U+4,B);q[B]=Q>>24&255,q[B+1]=Q>>16&255,q[B+2]=Q>>8&255,q[B+3]=Q&255}function M(X,K,q){let U=1,B=0;for(let N=K;N<q;++N)U=(U+(X[N]&255))%65521,B=(B+U)%65521;return B<<16|U}function F(X){if(!i.isNodeJS)return H(X);try{let K;parseInt(process.versions.node)>=8?K=X:K=Buffer.from(X);const q=require$$7.deflateSync(K,{level:9});return q instanceof Uint8Array?q:new Uint8Array(q)}catch(K){(0,a.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+K)}return H(X)}function H(X){let K=X.length;const q=65535,U=Math.ceil(K/q),B=new Uint8Array(2+K+U*5+4);let N=0;B[N++]=120,B[N++]=156;let Q=0;for(;K>q;)B[N++]=0,B[N++]=255,B[N++]=255,B[N++]=0,B[N++]=0,B.set(X.subarray(Q,Q+q),N),N+=q,Q+=q,K-=q;B[N++]=1,B[N++]=K&255,B[N++]=K>>8&255,B[N++]=~K&65535&255,B[N++]=(~K&65535)>>8&255,B.set(X.subarray(Q),N),N+=X.length-Q;const ce=M(X,0,X.length);return B[N++]=ce>>24&255,B[N++]=ce>>16&255,B[N++]=ce>>8&255,B[N++]=ce&255,B}function V(X,K,q,U){const B=X.width,N=X.height;let Q,ce,pe;const Re=X.data;switch(K){case a.ImageKind.GRAYSCALE_1BPP:ce=0,Q=1,pe=B+7>>3;break;case a.ImageKind.RGB_24BPP:ce=2,Q=8,pe=B*3;break;case a.ImageKind.RGBA_32BPP:ce=6,Q=8,pe=B*4;break;default:throw new Error("invalid format")}const Y=new Uint8Array((1+pe)*N);let O=0,D=0;for(let L=0;L<N;++L)Y[O++]=0,Y.set(Re.subarray(D,D+pe),O),D+=pe,O+=pe;if(K===a.ImageKind.GRAYSCALE_1BPP&&U){O=0;for(let L=0;L<N;L++){O++;for(let j=0;j<pe;j++)Y[O++]^=255}}const W=new Uint8Array([B>>24&255,B>>16&255,B>>8&255,B&255,N>>24&255,N>>16&255,N>>8&255,N&255,Q,ce,0,0,0]),G=F(Y),E=m.length+S*3+W.length+G.length,P=new Uint8Array(E);let k=0;return P.set(m,k),k+=m.length,R("IHDR",W,P,k),k+=S+W.length,R("IDATA",G,P,k),k+=S+G.length,R("IEND",new Uint8Array(0),P,k),u(P,"image/png",q)}return function(K,q,U){const B=K.kind===void 0?a.ImageKind.GRAYSCALE_1BPP:K.kind;return V(K,B,q,U)}}();class v{constructor(){this.fontSizeScale=1,this.fontWeight=l.fontWeight,this.fontSize=0,this.textMatrix=a.IDENTITY_MATRIX,this.fontMatrix=a.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=a.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=l.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(S,C){this.x=S,this.y=C}}let b=0,_=0,w=0;e.SVGGraphics=c=class{constructor(m,S){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;(0,r.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new r.DOMSVGFactory,this.current=new v,this.transformMatrix=a.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=m,this.objs=S,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!C,this._operatorIdMapping=[];for(const x in a.OPS)this._operatorIdMapping[a.OPS[x]]=x}save(){this.transformStack.push(this.transformMatrix);const m=this.current;this.extraStack.push(m),this.current=m.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(m){this.save(),this.executeOpTree(m),this.restore()}loadDependencies(m){const S=m.fnArray,C=m.argsArray;for(let x=0,R=S.length;x<R;x++)if(S[x]===a.OPS.dependency)for(const M of C[x]){const F=M.startsWith("g_")?this.commonObjs:this.objs,H=new Promise(V=>{F.get(M,V)});this.current.dependencies.push(H)}return Promise.all(this.current.dependencies)}transform(m,S,C,x,R,M){const F=[m,S,C,x,R,M];this.transformMatrix=a.Util.transform(this.transformMatrix,F),this.tgrp=null}getSVG(m,S){this.viewport=S;const C=this._initialize(S);return this.loadDependencies(m).then(()=>(this.transformMatrix=a.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(m)),C))}convertOpList(m){const S=this._operatorIdMapping,C=m.argsArray,x=m.fnArray,R=[];for(let M=0,F=x.length;M<F;M++){const H=x[M];R.push({fnId:H,fn:S[H],args:C[M]})}return g(R)}executeOpTree(m){for(const S of m){const C=S.fn,x=S.fnId,R=S.args;switch(x|0){case a.OPS.beginText:this.beginText();break;case a.OPS.dependency:break;case a.OPS.setLeading:this.setLeading(R);break;case a.OPS.setLeadingMoveText:this.setLeadingMoveText(R[0],R[1]);break;case a.OPS.setFont:this.setFont(R);break;case a.OPS.showText:this.showText(R[0]);break;case a.OPS.showSpacedText:this.showText(R[0]);break;case a.OPS.endText:this.endText();break;case a.OPS.moveText:this.moveText(R[0],R[1]);break;case a.OPS.setCharSpacing:this.setCharSpacing(R[0]);break;case a.OPS.setWordSpacing:this.setWordSpacing(R[0]);break;case a.OPS.setHScale:this.setHScale(R[0]);break;case a.OPS.setTextMatrix:this.setTextMatrix(R[0],R[1],R[2],R[3],R[4],R[5]);break;case a.OPS.setTextRise:this.setTextRise(R[0]);break;case a.OPS.setTextRenderingMode:this.setTextRenderingMode(R[0]);break;case a.OPS.setLineWidth:this.setLineWidth(R[0]);break;case a.OPS.setLineJoin:this.setLineJoin(R[0]);break;case a.OPS.setLineCap:this.setLineCap(R[0]);break;case a.OPS.setMiterLimit:this.setMiterLimit(R[0]);break;case a.OPS.setFillRGBColor:this.setFillRGBColor(R[0],R[1],R[2]);break;case a.OPS.setStrokeRGBColor:this.setStrokeRGBColor(R[0],R[1],R[2]);break;case a.OPS.setStrokeColorN:this.setStrokeColorN(R);break;case a.OPS.setFillColorN:this.setFillColorN(R);break;case a.OPS.shadingFill:this.shadingFill(R[0]);break;case a.OPS.setDash:this.setDash(R[0],R[1]);break;case a.OPS.setRenderingIntent:this.setRenderingIntent(R[0]);break;case a.OPS.setFlatness:this.setFlatness(R[0]);break;case a.OPS.setGState:this.setGState(R[0]);break;case a.OPS.fill:this.fill();break;case a.OPS.eoFill:this.eoFill();break;case a.OPS.stroke:this.stroke();break;case a.OPS.fillStroke:this.fillStroke();break;case a.OPS.eoFillStroke:this.eoFillStroke();break;case a.OPS.clip:this.clip("nonzero");break;case a.OPS.eoClip:this.clip("evenodd");break;case a.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case a.OPS.paintImageXObject:this.paintImageXObject(R[0]);break;case a.OPS.paintInlineImageXObject:this.paintInlineImageXObject(R[0]);break;case a.OPS.paintImageMaskXObject:this.paintImageMaskXObject(R[0]);break;case a.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(R[0],R[1]);break;case a.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case a.OPS.closePath:this.closePath();break;case a.OPS.closeStroke:this.closeStroke();break;case a.OPS.closeFillStroke:this.closeFillStroke();break;case a.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case a.OPS.nextLine:this.nextLine();break;case a.OPS.transform:this.transform(R[0],R[1],R[2],R[3],R[4],R[5]);break;case a.OPS.constructPath:this.constructPath(R[0],R[1]);break;case a.OPS.endPath:this.endPath();break;case 92:this.group(S.items);break;default:(0,a.warn)(`Unimplemented operator ${C}`);break}}}setWordSpacing(m){this.current.wordSpacing=m}setCharSpacing(m){this.current.charSpacing=m}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(m,S,C,x,R,M){const F=this.current;F.textMatrix=F.lineMatrix=[m,S,C,x,R,M],F.textMatrixScale=Math.hypot(m,S),F.x=F.lineX=0,F.y=F.lineY=0,F.xcoords=[],F.ycoords=[],F.tspan=this.svgFactory.createElement("svg:tspan"),F.tspan.setAttributeNS(null,"font-family",F.fontFamily),F.tspan.setAttributeNS(null,"font-size",`${A(F.fontSize)}px`),F.tspan.setAttributeNS(null,"y",A(-F.y)),F.txtElement=this.svgFactory.createElement("svg:text"),F.txtElement.append(F.tspan)}beginText(){const m=this.current;m.x=m.lineX=0,m.y=m.lineY=0,m.textMatrix=a.IDENTITY_MATRIX,m.lineMatrix=a.IDENTITY_MATRIX,m.textMatrixScale=1,m.tspan=this.svgFactory.createElement("svg:tspan"),m.txtElement=this.svgFactory.createElement("svg:text"),m.txtgrp=this.svgFactory.createElement("svg:g"),m.xcoords=[],m.ycoords=[]}moveText(m,S){const C=this.current;C.x=C.lineX+=m,C.y=C.lineY+=S,C.xcoords=[],C.ycoords=[],C.tspan=this.svgFactory.createElement("svg:tspan"),C.tspan.setAttributeNS(null,"font-family",C.fontFamily),C.tspan.setAttributeNS(null,"font-size",`${A(C.fontSize)}px`),C.tspan.setAttributeNS(null,"y",A(-C.y))}showText(m){const S=this.current,C=S.font,x=S.fontSize;if(x===0)return;const R=S.fontSizeScale,M=S.charSpacing,F=S.wordSpacing,H=S.fontDirection,V=S.textHScale*H,X=C.vertical,K=X?1:-1,q=C.defaultVMetrics,U=x*S.fontMatrix[0];let B=0;for(const ce of m){if(ce===null){B+=H*F;continue}else if(typeof ce=="number"){B+=K*ce*x/1e3;continue}const pe=(ce.isSpace?F:0)+M,Re=ce.fontChar;let Y,O,D=ce.width;if(X){let G;const E=ce.vmetric||q;G=ce.vmetric?E[1]:D*.5,G=-G*U;const P=E[2]*U;D=E?-E[0]:D,Y=G/R,O=(B+P)/R}else Y=B/R,O=0;(ce.isInFont||C.missingFile)&&(S.xcoords.push(S.x+Y),X&&S.ycoords.push(-S.y+O),S.tspan.textContent+=Re);let W;X?W=D*U-pe*H:W=D*U+pe*H,B+=W}S.tspan.setAttributeNS(null,"x",S.xcoords.map(A).join(" ")),X?S.tspan.setAttributeNS(null,"y",S.ycoords.map(A).join(" ")):S.tspan.setAttributeNS(null,"y",A(-S.y)),X?S.y-=B:S.x+=B*V,S.tspan.setAttributeNS(null,"font-family",S.fontFamily),S.tspan.setAttributeNS(null,"font-size",`${A(S.fontSize)}px`),S.fontStyle!==l.fontStyle&&S.tspan.setAttributeNS(null,"font-style",S.fontStyle),S.fontWeight!==l.fontWeight&&S.tspan.setAttributeNS(null,"font-weight",S.fontWeight);const N=S.textRenderingMode&a.TextRenderingMode.FILL_STROKE_MASK;if(N===a.TextRenderingMode.FILL||N===a.TextRenderingMode.FILL_STROKE?(S.fillColor!==l.fillColor&&S.tspan.setAttributeNS(null,"fill",S.fillColor),S.fillAlpha<1&&S.tspan.setAttributeNS(null,"fill-opacity",S.fillAlpha)):S.textRenderingMode===a.TextRenderingMode.ADD_TO_PATH?S.tspan.setAttributeNS(null,"fill","transparent"):S.tspan.setAttributeNS(null,"fill","none"),N===a.TextRenderingMode.STROKE||N===a.TextRenderingMode.FILL_STROKE){const ce=1/(S.textMatrixScale||1);this._setStrokeAttributes(S.tspan,ce)}let Q=S.textMatrix;S.textRise!==0&&(Q=Q.slice(),Q[5]+=S.textRise),S.txtElement.setAttributeNS(null,"transform",`${T(Q)} scale(${A(V)}, -1)`),S.txtElement.setAttributeNS(h,"xml:space","preserve"),S.txtElement.append(S.tspan),S.txtgrp.append(S.txtElement),this._ensureTransformGroup().append(S.txtElement)}setLeadingMoveText(m,S){this.setLeading(-S),this.moveText(m,S)}addFontStyle(m){if(!m.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));const S=u(m.data,m.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${m.loadedName}"; src: url(${S}); }
`}setFont(m){const S=this.current,C=this.commonObjs.get(m[0]);let x=m[1];S.font=C,this.embedFonts&&!C.missingFile&&!this.embeddedFonts[C.loadedName]&&(this.addFontStyle(C),this.embeddedFonts[C.loadedName]=C),S.fontMatrix=C.fontMatrix||a.FONT_IDENTITY_MATRIX;let R="normal";C.black?R="900":C.bold&&(R="bold");const M=C.italic?"italic":"normal";x<0?(x=-x,S.fontDirection=-1):S.fontDirection=1,S.fontSize=x,S.fontFamily=C.loadedName,S.fontWeight=R,S.fontStyle=M,S.tspan=this.svgFactory.createElement("svg:tspan"),S.tspan.setAttributeNS(null,"y",A(-S.y)),S.xcoords=[],S.ycoords=[]}endText(){var m;const S=this.current;S.textRenderingMode&a.TextRenderingMode.ADD_TO_PATH_FLAG&&(m=S.txtElement)!==null&&m!==void 0&&m.hasChildNodes()&&(S.element=S.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(m){m>0&&(this.current.lineWidth=m)}setLineCap(m){this.current.lineCap=s[m]}setLineJoin(m){this.current.lineJoin=f[m]}setMiterLimit(m){this.current.miterLimit=m}setStrokeAlpha(m){this.current.strokeAlpha=m}setStrokeRGBColor(m,S,C){this.current.strokeColor=a.Util.makeHexColor(m,S,C)}setFillAlpha(m){this.current.fillAlpha=m}setFillRGBColor(m,S,C){this.current.fillColor=a.Util.makeHexColor(m,S,C),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(m){this.current.strokeColor=this._makeColorN_Pattern(m)}setFillColorN(m){this.current.fillColor=this._makeColorN_Pattern(m)}shadingFill(m){const S=this.viewport.width,C=this.viewport.height,x=a.Util.inverseTransform(this.transformMatrix),R=a.Util.applyTransform([0,0],x),M=a.Util.applyTransform([0,C],x),F=a.Util.applyTransform([S,0],x),H=a.Util.applyTransform([S,C],x),V=Math.min(R[0],M[0],F[0],H[0]),X=Math.min(R[1],M[1],F[1],H[1]),K=Math.max(R[0],M[0],F[0],H[0]),q=Math.max(R[1],M[1],F[1],H[1]),U=this.svgFactory.createElement("svg:rect");U.setAttributeNS(null,"x",V),U.setAttributeNS(null,"y",X),U.setAttributeNS(null,"width",K-V),U.setAttributeNS(null,"height",q-X),U.setAttributeNS(null,"fill",this._makeShadingPattern(m)),this.current.fillAlpha<1&&U.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(U)}_makeColorN_Pattern(m){return m[0]==="TilingPattern"?this._makeTilingPattern(m):this._makeShadingPattern(m)}_makeTilingPattern(m){const S=m[1],C=m[2],x=m[3]||a.IDENTITY_MATRIX,[R,M,F,H]=m[4],V=m[5],X=m[6],K=m[7],q=`shading${w++}`,[U,B,N,Q]=a.Util.normalizeRect([...a.Util.applyTransform([R,M],x),...a.Util.applyTransform([F,H],x)]),[ce,pe]=a.Util.singularValueDecompose2dScale(x),Re=V*ce,Y=X*pe,O=this.svgFactory.createElement("svg:pattern");O.setAttributeNS(null,"id",q),O.setAttributeNS(null,"patternUnits","userSpaceOnUse"),O.setAttributeNS(null,"width",Re),O.setAttributeNS(null,"height",Y),O.setAttributeNS(null,"x",`${U}`),O.setAttributeNS(null,"y",`${B}`);const D=this.svg,W=this.transformMatrix,G=this.current.fillColor,E=this.current.strokeColor,P=this.svgFactory.create(N-U,Q-B);if(this.svg=P,this.transformMatrix=x,K===2){const k=a.Util.makeHexColor(...S);this.current.fillColor=k,this.current.strokeColor=k}return this.executeOpTree(this.convertOpList(C)),this.svg=D,this.transformMatrix=W,this.current.fillColor=G,this.current.strokeColor=E,O.append(P.childNodes[0]),this.defs.append(O),`url(#${q})`}_makeShadingPattern(m){switch(typeof m=="string"&&(m=this.objs.get(m)),m[0]){case"RadialAxial":const S=`shading${w++}`,C=m[3];let x;switch(m[1]){case"axial":const R=m[4],M=m[5];x=this.svgFactory.createElement("svg:linearGradient"),x.setAttributeNS(null,"id",S),x.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),x.setAttributeNS(null,"x1",R[0]),x.setAttributeNS(null,"y1",R[1]),x.setAttributeNS(null,"x2",M[0]),x.setAttributeNS(null,"y2",M[1]);break;case"radial":const F=m[4],H=m[5],V=m[6],X=m[7];x=this.svgFactory.createElement("svg:radialGradient"),x.setAttributeNS(null,"id",S),x.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),x.setAttributeNS(null,"cx",H[0]),x.setAttributeNS(null,"cy",H[1]),x.setAttributeNS(null,"r",X),x.setAttributeNS(null,"fx",F[0]),x.setAttributeNS(null,"fy",F[1]),x.setAttributeNS(null,"fr",V);break;default:throw new Error(`Unknown RadialAxial type: ${m[1]}`)}for(const R of C){const M=this.svgFactory.createElement("svg:stop");M.setAttributeNS(null,"offset",R[0]),M.setAttributeNS(null,"stop-color",R[1]),x.append(M)}return this.defs.append(x),`url(#${S})`;case"Mesh":return(0,a.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${m[0]}`)}}setDash(m,S){this.current.dashArray=m,this.current.dashPhase=S}constructPath(m,S){const C=this.current;let x=C.x,R=C.y,M=[],F=0;for(const H of m)switch(H|0){case a.OPS.rectangle:x=S[F++],R=S[F++];const V=S[F++],X=S[F++],K=x+V,q=R+X;M.push("M",A(x),A(R),"L",A(K),A(R),"L",A(K),A(q),"L",A(x),A(q),"Z");break;case a.OPS.moveTo:x=S[F++],R=S[F++],M.push("M",A(x),A(R));break;case a.OPS.lineTo:x=S[F++],R=S[F++],M.push("L",A(x),A(R));break;case a.OPS.curveTo:x=S[F+4],R=S[F+5],M.push("C",A(S[F]),A(S[F+1]),A(S[F+2]),A(S[F+3]),A(x),A(R)),F+=6;break;case a.OPS.curveTo2:M.push("C",A(x),A(R),A(S[F]),A(S[F+1]),A(S[F+2]),A(S[F+3])),x=S[F+2],R=S[F+3],F+=4;break;case a.OPS.curveTo3:x=S[F+2],R=S[F+3],M.push("C",A(S[F]),A(S[F+1]),A(x),A(R),A(x),A(R)),F+=4;break;case a.OPS.closePath:M.push("Z");break}M=M.join(" "),C.path&&m.length>0&&m[0]!==a.OPS.rectangle&&m[0]!==a.OPS.moveTo?M=C.path.getAttributeNS(null,"d")+M:(C.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(C.path)),C.path.setAttributeNS(null,"d",M),C.path.setAttributeNS(null,"fill","none"),C.element=C.path,C.setCurrentPoint(x,R)}endPath(){const m=this.current;if(m.path=null,!this.pendingClip)return;if(!m.element){this.pendingClip=null;return}const S=`clippath${b++}`,C=this.svgFactory.createElement("svg:clipPath");C.setAttributeNS(null,"id",S),C.setAttributeNS(null,"transform",T(this.transformMatrix));const x=m.element.cloneNode(!0);if(this.pendingClip==="evenodd"?x.setAttributeNS(null,"clip-rule","evenodd"):x.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,C.append(x),this.defs.append(C),m.activeClipUrl){m.clipGroup=null;for(const R of this.extraStack)R.clipGroup=null;C.setAttributeNS(null,"clip-path",m.activeClipUrl)}m.activeClipUrl=`url(#${S})`,this.tgrp=null}clip(m){this.pendingClip=m}closePath(){const m=this.current;if(m.path){const S=`${m.path.getAttributeNS(null,"d")}Z`;m.path.setAttributeNS(null,"d",S)}}setLeading(m){this.current.leading=-m}setTextRise(m){this.current.textRise=m}setTextRenderingMode(m){this.current.textRenderingMode=m}setHScale(m){this.current.textHScale=m/100}setRenderingIntent(m){}setFlatness(m){}setGState(m){for(const[S,C]of m)switch(S){case"LW":this.setLineWidth(C);break;case"LC":this.setLineCap(C);break;case"LJ":this.setLineJoin(C);break;case"ML":this.setMiterLimit(C);break;case"D":this.setDash(C[0],C[1]);break;case"RI":this.setRenderingIntent(C);break;case"FL":this.setFlatness(C);break;case"Font":this.setFont(C);break;case"CA":this.setStrokeAlpha(C);break;case"ca":this.setFillAlpha(C);break;default:(0,a.warn)(`Unimplemented graphic state operator ${S}`);break}}fill(){const m=this.current;m.element&&(m.element.setAttributeNS(null,"fill",m.fillColor),m.element.setAttributeNS(null,"fill-opacity",m.fillAlpha),this.endPath())}stroke(){const m=this.current;m.element&&(this._setStrokeAttributes(m.element),m.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(m){let S=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const C=this.current;let x=C.dashArray;S!==1&&x.length>0&&(x=x.map(function(R){return S*R})),m.setAttributeNS(null,"stroke",C.strokeColor),m.setAttributeNS(null,"stroke-opacity",C.strokeAlpha),m.setAttributeNS(null,"stroke-miterlimit",A(C.miterLimit)),m.setAttributeNS(null,"stroke-linecap",C.lineCap),m.setAttributeNS(null,"stroke-linejoin",C.lineJoin),m.setAttributeNS(null,"stroke-width",A(S*C.lineWidth)+"px"),m.setAttributeNS(null,"stroke-dasharray",x.map(A).join(" ")),m.setAttributeNS(null,"stroke-dashoffset",A(S*C.dashPhase)+"px")}eoFill(){this.current.element&&this.current.element.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){this.current.element&&this.current.element.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const m=this.svgFactory.createElement("svg:rect");m.setAttributeNS(null,"x","0"),m.setAttributeNS(null,"y","0"),m.setAttributeNS(null,"width","1px"),m.setAttributeNS(null,"height","1px"),m.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(m)}paintImageXObject(m){const S=m.startsWith("g_")?this.commonObjs.get(m):this.objs.get(m);if(!S){(0,a.warn)(`Dependent image with object ID ${m} is not ready yet`);return}this.paintInlineImageXObject(S)}paintInlineImageXObject(m,S){const C=m.width,x=m.height,R=p(m,this.forceDataSchema,!!S),M=this.svgFactory.createElement("svg:rect");M.setAttributeNS(null,"x","0"),M.setAttributeNS(null,"y","0"),M.setAttributeNS(null,"width",A(C)),M.setAttributeNS(null,"height",A(x)),this.current.element=M,this.clip("nonzero");const F=this.svgFactory.createElement("svg:image");F.setAttributeNS(o,"xlink:href",R),F.setAttributeNS(null,"x","0"),F.setAttributeNS(null,"y",A(-x)),F.setAttributeNS(null,"width",A(C)+"px"),F.setAttributeNS(null,"height",A(x)+"px"),F.setAttributeNS(null,"transform",`scale(${A(1/C)} ${A(-1/x)})`),S?S.append(F):this._ensureTransformGroup().append(F)}paintImageMaskXObject(m){const S=this.current,C=m.width,x=m.height,R=S.fillColor;S.maskId=`mask${_++}`;const M=this.svgFactory.createElement("svg:mask");M.setAttributeNS(null,"id",S.maskId);const F=this.svgFactory.createElement("svg:rect");F.setAttributeNS(null,"x","0"),F.setAttributeNS(null,"y","0"),F.setAttributeNS(null,"width",A(C)),F.setAttributeNS(null,"height",A(x)),F.setAttributeNS(null,"fill",R),F.setAttributeNS(null,"mask",`url(#${S.maskId})`),this.defs.append(M),this._ensureTransformGroup().append(F),this.paintInlineImageXObject(m,M)}paintFormXObjectBegin(m,S){if(Array.isArray(m)&&m.length===6&&this.transform(m[0],m[1],m[2],m[3],m[4],m[5]),S){const C=S[2]-S[0],x=S[3]-S[1],R=this.svgFactory.createElement("svg:rect");R.setAttributeNS(null,"x",S[0]),R.setAttributeNS(null,"y",S[1]),R.setAttributeNS(null,"width",A(C)),R.setAttributeNS(null,"height",A(x)),this.current.element=R,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(m){const S=this.svgFactory.create(m.width,m.height),C=this.svgFactory.createElement("svg:defs");S.append(C),this.defs=C;const x=this.svgFactory.createElement("svg:g");return x.setAttributeNS(null,"transform",T(m.transform)),S.append(x),this.svg=x,S}_ensureClipGroup(){if(!this.current.clipGroup){const m=this.svgFactory.createElement("svg:g");m.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(m),this.current.clipGroup=m}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",T(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}}},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFNodeStream=void 0;var r=t(1),a=t(158);const i=require$$7,c=require$$7,l=require$$7,h=require$$7,o=/^file:\/\/\/[a-zA-Z]:\//;function s(_){const w=h.parse(_);return w.protocol==="file:"||w.host?w:/^[a-z]:[/\\]/i.test(_)?h.parse(`file:///${_}`):(w.host||(w.protocol="file:"),w)}class f{constructor(w){this.source=w,this.url=s(w.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&w.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var w,m;return(w=(m=this._fullRequestReader)===null||m===void 0?void 0:m._loaded)!==null&&w!==void 0?w:0}getFullReader(){return(0,r.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new T(this):new g(this),this._fullRequestReader}getRangeReader(w,m){if(m<=this._progressiveDataLength)return null;const S=this.isFsUrl?new b(this,w,m):new A(this,w,m);return this._rangeRequestReaders.push(S),S}cancelAllRequests(w){this._fullRequestReader&&this._fullRequestReader.cancel(w);for(const m of this._rangeRequestReaders.slice(0))m.cancel(w)}}e.PDFNodeStream=f;class u{constructor(w){this._url=w.url,this._done=!1,this._storedError=null,this.onProgress=null;const m=w.source;this._contentLength=m.length,this._loaded=0,this._filename=null,this._disableRange=m.disableRange||!1,this._rangeChunkSize=m.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!m.disableStream,this._isRangeSupported=!m.disableRange,this._readableStream=null,this._readCapability=(0,r.createPromiseCapability)(),this._headersCapability=(0,r.createPromiseCapability)()}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const w=this._readableStream.read();return w===null?(this._readCapability=(0,r.createPromiseCapability)(),this.read()):(this._loaded+=w.length,this.onProgress&&this.onProgress({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(w).buffer,done:!1})}cancel(w){if(!this._readableStream){this._error(w);return}this._readableStream.destroy(w)}_error(w){this._storedError=w,this._readCapability.resolve()}_setReadableStream(w){this._readableStream=w,w.on("readable",()=>{this._readCapability.resolve()}),w.on("end",()=>{w.destroy(),this._done=!0,this._readCapability.resolve()}),w.on("error",m=>{this._error(m)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new r.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class p{constructor(w){this._url=w.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=(0,r.createPromiseCapability)();const m=w.source;this._isStreamingSupported=!m.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const w=this._readableStream.read();return w===null?(this._readCapability=(0,r.createPromiseCapability)(),this.read()):(this._loaded+=w.length,this.onProgress&&this.onProgress({loaded:this._loaded}),{value:new Uint8Array(w).buffer,done:!1})}cancel(w){if(!this._readableStream){this._error(w);return}this._readableStream.destroy(w)}_error(w){this._storedError=w,this._readCapability.resolve()}_setReadableStream(w){this._readableStream=w,w.on("readable",()=>{this._readCapability.resolve()}),w.on("end",()=>{w.destroy(),this._done=!0,this._readCapability.resolve()}),w.on("error",m=>{this._error(m)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function v(_,w){return{protocol:_.protocol,auth:_.auth,host:_.hostname,port:_.port,path:_.path,method:"GET",headers:w}}class g extends u{constructor(w){super(w);const m=S=>{if(S.statusCode===404){const M=new r.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=M,this._headersCapability.reject(M);return}this._headersCapability.resolve(),this._setReadableStream(S);const C=M=>this._readableStream.headers[M.toLowerCase()],{allowRangeRequests:x,suggestedLength:R}=(0,a.validateRangeRequestCapabilities)({getResponseHeader:C,isHttp:w.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=x,this._contentLength=R||this._contentLength,this._filename=(0,a.extractFilenameFromHeader)(C)};this._request=null,this._url.protocol==="http:"?this._request=c.request(v(this._url,w.httpHeaders),m):this._request=l.request(v(this._url,w.httpHeaders),m),this._request.on("error",S=>{this._storedError=S,this._headersCapability.reject(S)}),this._request.end()}}class A extends p{constructor(w,m,S){super(w),this._httpHeaders={};for(const x in w.httpHeaders){const R=w.httpHeaders[x];typeof R>"u"||(this._httpHeaders[x]=R)}this._httpHeaders.Range=`bytes=${m}-${S-1}`;const C=x=>{if(x.statusCode===404){const R=new r.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=R;return}this._setReadableStream(x)};this._request=null,this._url.protocol==="http:"?this._request=c.request(v(this._url,this._httpHeaders),C):this._request=l.request(v(this._url,this._httpHeaders),C),this._request.on("error",x=>{this._storedError=x}),this._request.end()}}class T extends u{constructor(w){super(w);let m=decodeURIComponent(this._url.path);o.test(this._url.href)&&(m=m.replace(/^\//,"")),i.lstat(m,(S,C)=>{if(S){S.code==="ENOENT"&&(S=new r.MissingPDFException(`Missing PDF "${m}".`)),this._storedError=S,this._headersCapability.reject(S);return}this._contentLength=C.size,this._setReadableStream(i.createReadStream(m)),this._headersCapability.resolve()})}}class b extends p{constructor(w,m,S){super(w);let C=decodeURIComponent(this._url.path);o.test(this._url.href)&&(C=C.replace(/^\//,"")),this._setReadableStream(i.createReadStream(C,{start:m,end:S-1}))}}},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createResponseStatusError=h,e.extractFilenameFromHeader=l,e.validateRangeRequestCapabilities=c,e.validateResponseStatus=o;var r=t(1),a=t(159),i=t(133);function c(s){let{getResponseHeader:f,isHttp:u,rangeChunkSize:p,disableRange:v}=s;const g={allowRangeRequests:!1,suggestedLength:void 0},A=parseInt(f("Content-Length"),10);return!Number.isInteger(A)||(g.suggestedLength=A,A<=2*p)||v||!u||f("Accept-Ranges")!=="bytes"||(f("Content-Encoding")||"identity")!=="identity"||(g.allowRangeRequests=!0),g}function l(s){const f=s("Content-Disposition");if(f){let u=(0,a.getFilenameFromContentDispositionHeader)(f);if(u.includes("%"))try{u=decodeURIComponent(u)}catch{}if((0,i.isPdfFile)(u))return u}return null}function h(s,f){return s===404||s===0&&f.startsWith("file:")?new r.MissingPDFException('Missing PDF "'+f+'".'):new r.UnexpectedResponseException(`Unexpected server response (${s}) while retrieving PDF "${f}".`,s)}function o(s){return s===200||s===206}},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getFilenameFromContentDispositionHeader=a;var r=t(1);function a(i){let c=!0,l=h("filename\\*","i").exec(i);if(l){l=l[1];let g=u(l);return g=unescape(g),g=p(g),g=v(g),s(g)}if(l=f(i),l){const g=v(l);return s(g)}if(l=h("filename","i").exec(i),l){l=l[1];let g=u(l);return g=v(g),s(g)}function h(g,A){return new RegExp("(?:^|;)\\s*"+g+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',A)}function o(g,A){if(g){if(!/^[\x00-\xFF]+$/.test(A))return A;try{const T=new TextDecoder(g,{fatal:!0}),b=(0,r.stringToBytes)(A);A=T.decode(b),c=!1}catch{}}return A}function s(g){return c&&/[\x80-\xff]/.test(g)&&(g=o("utf-8",g),c&&(g=o("iso-8859-1",g))),g}function f(g){const A=[];let T;const b=h("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(T=b.exec(g))!==null;){let[,w,m,S]=T;if(w=parseInt(w,10),w in A){if(w===0)break;continue}A[w]=[m,S]}const _=[];for(let w=0;w<A.length&&w in A;++w){let[m,S]=A[w];S=u(S),m&&(S=unescape(S),w===0&&(S=p(S))),_.push(S)}return _.join("")}function u(g){if(g.startsWith('"')){const A=g.slice(1).split('\\"');for(let T=0;T<A.length;++T){const b=A[T].indexOf('"');b!==-1&&(A[T]=A[T].slice(0,b),A.length=T+1),A[T]=A[T].replace(/\\(.)/g,"$1")}g=A.join('"')}return g}function p(g){const A=g.indexOf("'");if(A===-1)return g;const T=g.slice(0,A),_=g.slice(A+1).replace(/^[^']*'/,"");return o(T,_)}function v(g){return!g.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(g)?g:g.replace(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(A,T,b,_){if(b==="q"||b==="Q")return _=_.replace(/_/g," "),_=_.replace(/=([0-9a-fA-F]{2})/g,function(w,m){return String.fromCharCode(parseInt(m,16))}),o(T,_);try{_=atob(_)}catch{}return o(T,_)})}return""}},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFNetworkStream=void 0;var r=t(1),a=t(158);const i=200,c=206;function l(u){const p=u.response;return typeof p!="string"?p:(0,r.stringToBytes)(p).buffer}class h{constructor(p){let v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.url=p,this.isHttp=/^https?:/i.test(p),this.httpHeaders=this.isHttp&&v.httpHeaders||Object.create(null),this.withCredentials=v.withCredentials||!1,this.getXhr=v.getXhr||function(){return new XMLHttpRequest},this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(p,v,g){const A={begin:p,end:v};for(const T in g)A[T]=g[T];return this.request(A)}requestFull(p){return this.request(p)}request(p){const v=this.getXhr(),g=this.currXhrId++,A=this.pendingRequests[g]={xhr:v};v.open("GET",this.url),v.withCredentials=this.withCredentials;for(const T in this.httpHeaders){const b=this.httpHeaders[T];typeof b>"u"||v.setRequestHeader(T,b)}return this.isHttp&&"begin"in p&&"end"in p?(v.setRequestHeader("Range",`bytes=${p.begin}-${p.end-1}`),A.expectedStatus=c):A.expectedStatus=i,v.responseType="arraybuffer",p.onError&&(v.onerror=function(T){p.onError(v.status)}),v.onreadystatechange=this.onStateChange.bind(this,g),v.onprogress=this.onProgress.bind(this,g),A.onHeadersReceived=p.onHeadersReceived,A.onDone=p.onDone,A.onError=p.onError,A.onProgress=p.onProgress,v.send(null),g}onProgress(p,v){var g;const A=this.pendingRequests[p];A&&((g=A.onProgress)===null||g===void 0||g.call(A,v))}onStateChange(p,v){const g=this.pendingRequests[p];if(!g)return;const A=g.xhr;if(A.readyState>=2&&g.onHeadersReceived&&(g.onHeadersReceived(),delete g.onHeadersReceived),A.readyState!==4||!(p in this.pendingRequests))return;if(delete this.pendingRequests[p],A.status===0&&this.isHttp){var T;(T=g.onError)===null||T===void 0||T.call(g,A.status);return}const b=A.status||i;if(!(b===i&&g.expectedStatus===c)&&b!==g.expectedStatus){var w;(w=g.onError)===null||w===void 0||w.call(g,A.status);return}const m=l(A);if(b===c){const C=A.getResponseHeader("Content-Range"),x=/bytes (\d+)-(\d+)\/(\d+)/.exec(C);g.onDone({begin:parseInt(x[1],10),chunk:m})}else if(m)g.onDone({begin:0,chunk:m});else{var S;(S=g.onError)===null||S===void 0||S.call(g,A.status)}}getRequestXhr(p){return this.pendingRequests[p].xhr}isPendingRequest(p){return p in this.pendingRequests}abortRequest(p){const v=this.pendingRequests[p].xhr;delete this.pendingRequests[p],v.abort()}}class o{constructor(p){this._source=p,this._manager=new h(p.url,{httpHeaders:p.httpHeaders,withCredentials:p.withCredentials}),this._rangeChunkSize=p.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(p){const v=this._rangeRequestReaders.indexOf(p);v>=0&&this._rangeRequestReaders.splice(v,1)}getFullReader(){return(0,r.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new s(this._manager,this._source),this._fullRequestReader}getRangeReader(p,v){const g=new f(this._manager,p,v);return g.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(g),g}cancelAllRequests(p){var v;(v=this._fullRequestReader)===null||v===void 0||v.cancel(p);for(const g of this._rangeRequestReaders.slice(0))g.cancel(p)}}e.PDFNetworkStream=o;class s{constructor(p,v){this._manager=p;const g={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=v.url,this._fullRequestId=p.requestFull(g),this._headersReceivedCapability=(0,r.createPromiseCapability)(),this._disableRange=v.disableRange||!1,this._contentLength=v.length,this._rangeChunkSize=v.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const p=this._fullRequestId,v=this._manager.getRequestXhr(p),g=b=>v.getResponseHeader(b),{allowRangeRequests:A,suggestedLength:T}=(0,a.validateRangeRequestCapabilities)({getResponseHeader:g,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});A&&(this._isRangeSupported=!0),this._contentLength=T||this._contentLength,this._filename=(0,a.extractFilenameFromHeader)(g),this._isRangeSupported&&this._manager.abortRequest(p),this._headersReceivedCapability.resolve()}_onDone(p){if(p&&(this._requests.length>0?this._requests.shift().resolve({value:p.chunk,done:!1}):this._cachedChunks.push(p.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const v of this._requests)v.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(p){this._storedError=(0,a.createResponseStatusError)(p,this._url),this._headersReceivedCapability.reject(this._storedError);for(const v of this._requests)v.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(p){var v;(v=this.onProgress)===null||v===void 0||v.call(this,{loaded:p.loaded,total:p.lengthComputable?p.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const p=(0,r.createPromiseCapability)();return this._requests.push(p),p.promise}cancel(p){this._done=!0,this._headersReceivedCapability.reject(p);for(const v of this._requests)v.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class f{constructor(p,v,g){this._manager=p;const A={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=p.url,this._requestId=p.requestRange(v,g,A),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){var p;(p=this.onClosed)===null||p===void 0||p.call(this,this)}_onDone(p){const v=p.chunk;this._requests.length>0?this._requests.shift().resolve({value:v,done:!1}):this._queuedChunk=v,this._done=!0;for(const g of this._requests)g.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(p){this._storedError=(0,a.createResponseStatusError)(p,this._url);for(const v of this._requests)v.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(p){if(!this.isStreamingSupported){var v;(v=this.onProgress)===null||v===void 0||v.call(this,{loaded:p.loaded})}}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const v=this._queuedChunk;return this._queuedChunk=null,{value:v,done:!1}}if(this._done)return{value:void 0,done:!0};const p=(0,r.createPromiseCapability)();return this._requests.push(p),p.promise}cancel(p){this._done=!0;for(const v of this._requests)v.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(n,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFFetchStream=void 0;var r=t(1),a=t(158);function i(s,f,u){return{method:"GET",headers:s,signal:u.signal,mode:"cors",credentials:f?"include":"same-origin",redirect:"follow"}}function c(s){const f=new Headers;for(const u in s){const p=s[u];typeof p>"u"||f.append(u,p)}return f}class l{constructor(f){this.source=f,this.isHttp=/^https?:/i.test(f.url),this.httpHeaders=this.isHttp&&f.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var f,u;return(f=(u=this._fullRequestReader)===null||u===void 0?void 0:u._loaded)!==null&&f!==void 0?f:0}getFullReader(){return(0,r.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new h(this),this._fullRequestReader}getRangeReader(f,u){if(u<=this._progressiveDataLength)return null;const p=new o(this,f,u);return this._rangeRequestReaders.push(p),p}cancelAllRequests(f){this._fullRequestReader&&this._fullRequestReader.cancel(f);for(const u of this._rangeRequestReaders.slice(0))u.cancel(f)}}e.PDFFetchStream=l;class h{constructor(f){this._stream=f,this._reader=null,this._loaded=0,this._filename=null;const u=f.source;this._withCredentials=u.withCredentials||!1,this._contentLength=u.length,this._headersCapability=(0,r.createPromiseCapability)(),this._disableRange=u.disableRange||!1,this._rangeChunkSize=u.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!u.disableStream,this._isRangeSupported=!u.disableRange,this._headers=c(this._stream.httpHeaders);const p=u.url;fetch(p,i(this._headers,this._withCredentials,this._abortController)).then(v=>{if(!(0,a.validateResponseStatus)(v.status))throw(0,a.createResponseStatusError)(v.status,p);this._reader=v.body.getReader(),this._headersCapability.resolve();const g=b=>v.headers.get(b),{allowRangeRequests:A,suggestedLength:T}=(0,a.validateRangeRequestCapabilities)({getResponseHeader:g,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=A,this._contentLength=T||this._contentLength,this._filename=(0,a.extractFilenameFromHeader)(g),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new r.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:f,done:u}=await this._reader.read();return u?{value:f,done:u}:(this._loaded+=f.byteLength,this.onProgress&&this.onProgress({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(f).buffer,done:!1})}cancel(f){this._reader&&this._reader.cancel(f),this._abortController.abort()}}class o{constructor(f,u,p){this._stream=f,this._reader=null,this._loaded=0;const v=f.source;this._withCredentials=v.withCredentials||!1,this._readCapability=(0,r.createPromiseCapability)(),this._isStreamingSupported=!v.disableStream,this._abortController=new AbortController,this._headers=c(this._stream.httpHeaders),this._headers.append("Range",`bytes=${u}-${p-1}`);const g=v.url;fetch(g,i(this._headers,this._withCredentials,this._abortController)).then(A=>{if(!(0,a.validateResponseStatus)(A.status))throw(0,a.createResponseStatusError)(A.status,g);this._readCapability.resolve(),this._reader=A.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:f,done:u}=await this._reader.read();return u?{value:f,done:u}:(this._loaded+=f.byteLength,this.onProgress&&this.onProgress({loaded:this._loaded}),{value:new Uint8Array(f).buffer,done:!1})}cancel(f){this._reader&&this._reader.cancel(f),this._abortController.abort()}}}],__webpack_module_cache__={};function __w_pdfjs_require__(n){var e=__webpack_module_cache__[n];if(e!==void 0)return e.exports;var t=__webpack_module_cache__[n]={exports:{}};return __webpack_modules__[n](t,t.exports,__w_pdfjs_require__),t.exports}var __webpack_exports__={};return(()=>{var n=__webpack_exports__;Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"AnnotationEditorLayer",{enumerable:!0,get:function(){return a.AnnotationEditorLayer}}),Object.defineProperty(n,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return e.AnnotationEditorParamsType}}),Object.defineProperty(n,"AnnotationEditorType",{enumerable:!0,get:function(){return e.AnnotationEditorType}}),Object.defineProperty(n,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return i.AnnotationEditorUIManager}}),Object.defineProperty(n,"AnnotationLayer",{enumerable:!0,get:function(){return c.AnnotationLayer}}),Object.defineProperty(n,"AnnotationMode",{enumerable:!0,get:function(){return e.AnnotationMode}}),Object.defineProperty(n,"CMapCompressionType",{enumerable:!0,get:function(){return e.CMapCompressionType}}),Object.defineProperty(n,"GlobalWorkerOptions",{enumerable:!0,get:function(){return l.GlobalWorkerOptions}}),Object.defineProperty(n,"InvalidPDFException",{enumerable:!0,get:function(){return e.InvalidPDFException}}),Object.defineProperty(n,"LoopbackPort",{enumerable:!0,get:function(){return t.LoopbackPort}}),Object.defineProperty(n,"MissingPDFException",{enumerable:!0,get:function(){return e.MissingPDFException}}),Object.defineProperty(n,"OPS",{enumerable:!0,get:function(){return e.OPS}}),Object.defineProperty(n,"PDFDataRangeTransport",{enumerable:!0,get:function(){return t.PDFDataRangeTransport}}),Object.defineProperty(n,"PDFDateString",{enumerable:!0,get:function(){return r.PDFDateString}}),Object.defineProperty(n,"PDFWorker",{enumerable:!0,get:function(){return t.PDFWorker}}),Object.defineProperty(n,"PasswordResponses",{enumerable:!0,get:function(){return e.PasswordResponses}}),Object.defineProperty(n,"PermissionFlag",{enumerable:!0,get:function(){return e.PermissionFlag}}),Object.defineProperty(n,"PixelsPerInch",{enumerable:!0,get:function(){return r.PixelsPerInch}}),Object.defineProperty(n,"RenderingCancelledException",{enumerable:!0,get:function(){return r.RenderingCancelledException}}),Object.defineProperty(n,"SVGGraphics",{enumerable:!0,get:function(){return s.SVGGraphics}}),Object.defineProperty(n,"UNSUPPORTED_FEATURES",{enumerable:!0,get:function(){return e.UNSUPPORTED_FEATURES}}),Object.defineProperty(n,"UnexpectedResponseException",{enumerable:!0,get:function(){return e.UnexpectedResponseException}}),Object.defineProperty(n,"Util",{enumerable:!0,get:function(){return e.Util}}),Object.defineProperty(n,"VerbosityLevel",{enumerable:!0,get:function(){return e.VerbosityLevel}}),Object.defineProperty(n,"XfaLayer",{enumerable:!0,get:function(){return f.XfaLayer}}),Object.defineProperty(n,"build",{enumerable:!0,get:function(){return t.build}}),Object.defineProperty(n,"createPromiseCapability",{enumerable:!0,get:function(){return e.createPromiseCapability}}),Object.defineProperty(n,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return e.createValidAbsoluteUrl}}),Object.defineProperty(n,"getDocument",{enumerable:!0,get:function(){return t.getDocument}}),Object.defineProperty(n,"getFilenameFromUrl",{enumerable:!0,get:function(){return r.getFilenameFromUrl}}),Object.defineProperty(n,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return r.getPdfFilenameFromUrl}}),Object.defineProperty(n,"getXfaPageViewport",{enumerable:!0,get:function(){return r.getXfaPageViewport}}),Object.defineProperty(n,"isPdfFile",{enumerable:!0,get:function(){return r.isPdfFile}}),Object.defineProperty(n,"loadScript",{enumerable:!0,get:function(){return r.loadScript}}),Object.defineProperty(n,"renderTextLayer",{enumerable:!0,get:function(){return o.renderTextLayer}}),Object.defineProperty(n,"shadow",{enumerable:!0,get:function(){return e.shadow}}),Object.defineProperty(n,"version",{enumerable:!0,get:function(){return t.version}});var e=__w_pdfjs_require__(1),t=__w_pdfjs_require__(129),r=__w_pdfjs_require__(133),a=__w_pdfjs_require__(147),i=__w_pdfjs_require__(132),c=__w_pdfjs_require__(152),l=__w_pdfjs_require__(140),h=__w_pdfjs_require__(3),o=__w_pdfjs_require__(155),s=__w_pdfjs_require__(156),f=__w_pdfjs_require__(154);if(h.isNodeJS){const{PDFNodeStream:u}=__w_pdfjs_require__(157);(0,t.setPDFNetworkStreamFactory)(p=>new u(p))}else{const{PDFNetworkStream:u}=__w_pdfjs_require__(160),{PDFFetchStream:p}=__w_pdfjs_require__(161);(0,t.setPDFNetworkStreamFactory)(v=>(0,r.isValidFetchUrl)(v.url)?new p(v):new u(v))}})(),__webpack_exports__})())}(pdf)),pdf.exports}var pdfExports=requirePdf();const defaultSortConfig={primarySort:"category",secondarySort:"sku",sortOrder:"asc",groupByCategory:!0,prioritizeActiveCategories:!1,sortCategoriesAlphabetically:!0};class BaseTransformer{constructor(e,t,r,a,i,c=!0){Te(this,"filePath");Te(this,"pdfDoc");Te(this,"outputPdf");Te(this,"summaryText",[]);Te(this,"sortConfig");Te(this,"batchInfo");Te(this,"enableBarcodes");this.products=t,this.categories=r,this.filePath=e,this.products=t,this.categories=r,this.batchInfo=i,this.enableBarcodes=c,this.sortConfig={...defaultSortConfig,primarySort:"category",secondarySort:"sku",groupByCategory:!0,...a}}async initialize(){}async transform(){return await this.initialize(),this.outputPdf}get summary(){return this.summaryText}sortTextItems(e){return e.sort((t,r)=>{const a=r.transform[5]-t.transform[5];return Math.abs(a)<5?t.transform[4]-r.transform[4]:a})}combineTextIntoLines(e){var i;let t=(i=e[0])==null?void 0:i.transform[5],r="";const a=[];return e.forEach(c=>{Math.abs(c.transform[5]-t)>5?(r&&a.push(r.trim()),r=c.str,t=c.transform[5]):r+=" "+c.str}),r&&a.push(r.trim()),a}sortProducts(e){if(e.length<=1)return e;const t=e.map(c=>{const l=this.products.find(s=>s.sku===c.SKU),h=(l==null?void 0:l.categoryId)||"",o=this.categories.find(s=>s.id===h);return{...c,categoryId:h,category:(o==null?void 0:o.name)||"Uncategorized"}}),r={};t.forEach(c=>{const l=c.category||"Uncategorized";r[l]||(r[l]=[]),r[l].push(c)});const a=Object.keys(r);a.sort((c,l)=>c==="Uncategorized"?1:l==="Uncategorized"?-1:c.localeCompare(l));const i=[];return a.forEach(c=>{const l=r[c];this.sortByField(l,"sku"),i.push(...l)}),i}sortByField(e,t,r="asc"){e.sort((a,i)=>{let c,l;switch(t){case"name":c=a.name||"",l=i.name||"";break;case"sku":c=a.SKU||"",l=i.SKU||"";break;default:c="",l=""}return typeof c=="string"&&typeof l=="string"?r==="asc"?c.localeCompare(l):l.localeCompare(c):0})}}class InventoryOrderProcessor{constructor(){Te(this,"inventoryService");Te(this,"categoryService");Te(this,"productService");this.inventoryService=new InventoryService,this.categoryService=new CategoryService,this.productService=new ProductService}async processOrderWithCategoryDeduction(e,t){if(!e||e.length===0)return{orderItems:[],inventoryResult:{deductions:[],warnings:[],errors:[]}};try{const r=await this.enhanceOrderItemsWithCategoryInfo(e),a=await this.calculateCategoryDeductions(r,t);let i={deductions:[],warnings:[],errors:[]};return a.length>0&&(i=await this.inventoryService.deductInventoryFromOrder(a)),{orderItems:r,inventoryResult:i}}catch(r){return console.error("Error processing order with category deduction:",r),{orderItems:e,inventoryResult:{deductions:[],warnings:[],errors:[{categoryGroupId:"unknown",error:`Order processing failed: ${r instanceof Error?r.message:"Unknown error"}`,requestedQuantity:0,reason:"Processing error"}]}}}}async previewCategoryDeductions(e){const t={items:[],totalDeductions:new Map,warnings:[],errors:[]};if(!e||e.length===0)return t;try{const r=await this.enhanceOrderItemsWithCategoryInfo(e);for(const c of r){const l=parseInt(c.quantity||"1");await this.addPrimaryDeductionToPreview(c,l,t),c.categoryId&&await this.addCascadeDeductionsToPreview(c,l,t)}const a=r.filter(c=>!c.inventoryDeductionRequired);a.length>0&&t.warnings.push(`${a.length} items will not trigger automatic inventory deduction (not configured)`);const i=t.items.filter(c=>c.isCascade);i.length>0&&t.warnings.push(`${i.length} additional cascade deductions will be processed from linked categories`)}catch(r){t.errors.push(`Preview calculation failed: ${r instanceof Error?r.message:"Unknown error"}`)}return t}async addPrimaryDeductionToPreview(e,t,r){var a;if(e.inventoryDeductionRequired&&e.categoryDeductionQuantity&&((a=e.product)!=null&&a.categoryGroupId)){const i=t*e.categoryDeductionQuantity;if(i>0){const c=await this.getCategoryInventoryUnit(e.categoryId||"")||"pcs";r.items.push({productSku:e.SKU||"Unknown",productName:e.name,categoryName:e.category||"Unknown",categoryGroupId:e.product.categoryGroupId,orderQuantity:t,deductionQuantity:e.categoryDeductionQuantity,totalDeduction:i,inventoryUnit:c,isCascade:!1}),this.aggregateDeductionInPreview(e.product.categoryGroupId,i,c,r)}}}async addCascadeDeductionsToPreview(e,t,r){try{const a=await this.categoryService.getLinkedCategories(e.categoryId,!1);for(const i of a){if(!i.inventoryDeductionQuantity||i.inventoryDeductionQuantity<=0||!i.categoryGroupId)continue;const c=t*i.inventoryDeductionQuantity;if(c>0){const l=i.inventoryUnit||"pcs";r.items.push({productSku:e.SKU||"Unknown",productName:e.name,categoryName:i.name,categoryGroupId:i.categoryGroupId,orderQuantity:t,deductionQuantity:i.inventoryDeductionQuantity,totalDeduction:c,inventoryUnit:l,isCascade:!0,cascadeSource:{sourceCategoryName:e.category||"Unknown",targetCategoryName:i.name}}),this.aggregateDeductionInPreview(i.categoryGroupId,c,l,r)}}}catch(a){console.error(`Error adding cascade deductions to preview for category ${e.categoryId}:`,a),r.warnings.push(`Could not calculate cascade deductions for ${e.category||"Unknown"} category`)}}aggregateDeductionInPreview(e,t,r,a){if(a.totalDeductions.has(e)){const i=a.totalDeductions.get(e);i.totalQuantity+=t}else{const i=`Group ${e}`;a.totalDeductions.set(e,{categoryGroupName:i,totalQuantity:t,unit:r})}}async enhanceOrderItemsWithCategoryInfo(e){const[t,r]=await Promise.all([this.productService.getProducts(),this.categoryService.getCategories()]);return e.map(a=>{const i=t.find(h=>h.sku===a.SKU),c=i?r.find(h=>h.id===i.categoryId):void 0,l=!!(c!=null&&c.inventoryDeductionQuantity&&c.inventoryDeductionQuantity>0&&c.categoryGroupId);return{...a,categoryId:i==null?void 0:i.categoryId,category:c==null?void 0:c.name,product:i,categoryDeductionQuantity:(c==null?void 0:c.inventoryDeductionQuantity)||void 0,categoryGroupId:c==null?void 0:c.categoryGroupId,inventoryDeductionRequired:l}})}async calculateCategoryDeductions(e,t){const r=[];for(const a of e){const i=parseInt(a.quantity||"1");await this.processPrimaryDeduction(a,i,t,r),a.categoryId&&await this.processCascadeDeductions(a,i,t,r)}return r}async processPrimaryDeduction(e,t,r,a){var l;const i=e.categoryGroupId;if(!e.inventoryDeductionRequired||!e.categoryDeductionQuantity||!i)return;const c=t*e.categoryDeductionQuantity;if(c>0){const h=await this.getCategoryInventoryUnit(e.categoryId||"")||"pcs",o={categoryGroupId:i,quantity:c,unit:h,productSku:e.SKU||"",orderReference:e.orderId||r,transactionReference:(l=e.batchInfo)==null?void 0:l.batchId,platform:e.type};a.push(o)}}async processCascadeDeductions(e,t,r,a){var i;try{const c=await this.categoryService.getLinkedCategories(e.categoryId,!1);for(const l of c){if(!l.inventoryDeductionQuantity||l.inventoryDeductionQuantity<=0||!l.categoryGroupId)continue;const h=t*l.inventoryDeductionQuantity;if(h>0){const o=l.inventoryUnit||"pcs",s={categoryGroupId:l.categoryGroupId,quantity:h,unit:o,productSku:e.SKU||"",orderReference:e.orderId||r,transactionReference:(i=e.batchInfo)==null?void 0:i.batchId,platform:e.type};a.push(s)}}}catch(c){console.error(`Error processing cascade deductions for category ${e.categoryId}:`,c)}}async getCategoryInventoryUnit(e){if(e)try{const t=await this.categoryService.getCategory(e);return t==null?void 0:t.inventoryUnit}catch{return}}async getCategoryGroupName(e){try{return`Group ${e}`}catch{return`Unknown Group (${e})`}}async getCategoriesWithDeductionEnabled(){return this.categoryService.getCategoriesWithInventoryDeduction()}async isAutomaticDeductionEnabled(e){try{const r=(await this.productService.getProducts()).find(a=>a.sku===e);return r!=null&&r.categoryId?this.categoryService.isCategoryReadyForDeduction(r.categoryId):!1}catch{return!1}}async getDeductionConfigurationSummary(){try{const e=await this.categoryService.getCategories(),t=[];for(const r of e)if(r.id){const a=await this.categoryService.getDeductionValidationSummary(r.id);t.push({categoryId:r.id,categoryName:r.name,summary:a})}return t}catch(e){return console.error("Error getting deduction configuration summary:",e),[]}}}const tt=class tt{static get PDF_EMBED_SIZE(){return tt._PDF_EMBED_SIZE}static generatePDFEmbedBarcode(e){return tt.generateBarcodeImage(e,tt._PDF_EMBED_SIZE)}static generateBarcodeImage(e,t=tt.DEFAULT_BARCODE_SIZE){const r=document.createElement("canvas"),a=r.getContext("2d");if(!a)throw new Error("Failed to get canvas context for barcode generation");try{r.width=t,r.height=t,a.fillStyle="#ffffff",a.fillRect(0,0,t,t),JsBarcode(r,e,{format:"CODE128",width:2,height:Math.floor(t*.8),displayValue:!1,margin:2,background:"#ffffff",lineColor:"#000000",fontSize:8});const c=r.toDataURL("image/png").split(",")[1],l=atob(c),h=new Uint8Array(l.length);for(let o=0;o<l.length;o++)h[o]=l.charCodeAt(o);return h}catch(i){throw new Error(`Failed to generate barcode image for ${e}: ${i}`)}}static calculateOptimalSize(e,t){const r=Math.min(e,t)*.05,a=Math.max(tt.MIN_SIZE,Math.min(tt.MAX_SIZE,r));return Math.floor(a)}static calculateBarcodePosition(e,t,r){return{x:tt.MARGIN,y:tt.MARGIN,size:r}}static async embedBarcodeInPage(e,t,r,a){try{const{width:i,height:c}=t.getSize(),l=a||tt.calculateOptimalSize(i,c),h=tt.generateBarcodeImage(r,l),o=await e.embedPng(h),s=tt.calculateBarcodePosition(i,c,l);return t.drawImage(o,{x:s.x,y:s.y,width:s.size,height:s.size,opacity:1}),o}catch(i){throw new Error(`Failed to embed barcode ${r} in PDF page: ${i}`)}}static async batchEmbedBarcodes(e,t){const r=[];for(const a of t)try{const i=await tt.embedBarcodeInPage(e,a.page,a.barcodeId,a.customSize);r.push(i)}catch(i){console.error(`Failed to embed barcode ${a.barcodeId}:`,i)}return r}static validateBarcodeSpace(e,t,r){const a=r||tt.calculateOptimalSize(e,t),i=tt.calculateBarcodePosition(e,t,a),c=i.x+a<=e,l=i.y+a<=t,h=c&&l;let o=a;if(!h){const s=e-tt.MARGIN*2,f=t-tt.MARGIN*2;o=Math.max(tt.MIN_SIZE,Math.min(s,f))}return{canEmbed:h,recommendedSize:o,position:i}}static isAreaClear(e,t,r,a,i){const{width:c,height:l}=e.getSize();return!(t<0||r<0||t+a>c||r+i>l)}static createTestBarcode(e=tt.DEFAULT_BARCODE_SIZE){const t=`TEST_${new Date().toISOString().split("T")[0]}_001`;return tt.generateBarcodeImage(t,e)}static getBarcodeConfig(e,t){const r=tt.validateBarcodeSpace(e,t);return{size:r.recommendedSize,position:r.position,canEmbed:r.canEmbed}}};Te(tt,"DEFAULT_BARCODE_SIZE",64),Te(tt,"_PDF_EMBED_SIZE",24),Te(tt,"MARGIN",10),Te(tt,"MIN_SIZE",32),Te(tt,"MAX_SIZE",128);let PDFBarcodeEmbedder=tt;class AmazonPDFTransformer extends BaseTransformer{constructor(t,r,a,i,c,l=!0){super(t,r,a,i,c,l);Te(this,"filePath");Te(this,"pdf");Te(this,"barcodeService");Te(this,"generatedBarcodes",[]);this.filePath=t,this.barcodeService=new BarcodeService}get barcodeResults(){return this.generatedBarcodes}async initialize(){const{PDFDocument:t}=await __vitePreload(async()=>{const{PDFDocument:a}=await import("./pdf-vendor-CApBJrGQ.js").then(i=>i.i);return{PDFDocument:a}},__vite__mapDeps([0,1]));this.pdfDoc=await t.load(this.filePath),this.outputPdf=await t.create();const r=pdfExports.getDocument({data:this.filePath});this.pdf=await r.promise}recurseQuantity(t,r=-1){for(let i=r>-1?r:0;i<t.length;i++){const c=t[i];if(c.includes("₹"))return this.recurseQuantity(t,i+1);if(r>-1&&!c.includes("₹"))return i}return-1}extractProductInfo(t){var f,u;const r=t.findIndex(p=>p.startsWith("1 "));if(r===-1)return{name:"",quantity:"",type:"amazon",batchInfo:this.batchInfo};const a=t.find(p=>p.includes("Order Number"));let i="";if(a){const p=a.split(" "),v=/\b\d{3}-\d{7}-\d{7}\b/;for(const g of p){const A=g.match(v);if(A){i=A[0];break}}}const c=t.slice(r,r+4).join(" ");let[l,...h]=c.split("|");l.indexOf("₹")!==-1&&(l=l.substring(0,l.indexOf("₹")-1));let o;if(/[A-Za-z0-9]{2}-[A-Za-z0-9]{4}-[A-Z|a-z|0-9]{4}/gi.test(c)){const p=new RegExp(/[A-Za-z0-9]{2}-[A-Za-z0-9]{4}-[A-Za-z0-9]{4}/,"ig");o=(f=c.match(p))==null?void 0:f[0]}if(/SS[a-z0-9]{2}.*/gi.test(c)){const p=new RegExp(/SS[a-zA-Z]{2,4}[0-9]{6,7}/,"ig");o=(u=c.match(p))==null?void 0:u[0]}let s="1";if(h.length>0){const p=h.join(" ").split(" ").filter(g=>!!g&&/[()]/.test(g)===!1),v=this.recurseQuantity(p);v>-1&&(s=p[v]||"1")}return{name:l.replace(/1 /,"").trim(),quantity:s,SKU:o||"",type:"amazon",orderId:i||void 0,batchInfo:this.batchInfo}}async addFooterText(t,r){var p,v;const{rgb:a,StandardFonts:i}=await __vitePreload(async()=>{const{rgb:g,StandardFonts:A}=await import("./pdf-vendor-CApBJrGQ.js").then(T=>T.i);return{rgb:g,StandardFonts:A}},__vite__mapDeps([0,1])),c=t.getWidth(),l=12;let h=`${r.quantity} X [${(p=r==null?void 0:r.name)==null?void 0:p.substring(0,80)}]`;const o=this.products.find(g=>g.sku===r.SKU),s=this.categories.find(g=>g.id===(o==null?void 0:o.categoryId)),f={name:(o==null?void 0:o.name)||r.name,quantity:r.quantity,type:"amazon",SKU:r.SKU,categoryId:o==null?void 0:o.categoryId,category:s==null?void 0:s.name,orderId:r.orderId,batchInfo:r.batchInfo};s&&(h=`${r.quantity} X [${s.name}] ${(v=o==null?void 0:o.name)==null?void 0:v.substring(0,80)}`),this.summaryText.push(f);const u=await this.outputPdf.embedFont(i.Helvetica);t.drawText(h,{y:t.getHeight()-20,x:40,size:l,color:a(0,0,0),lineHeight:l+2,font:u,maxWidth:c})}async transform(){var v;await this.initialize();const t=this.pdfDoc.getPages();let r=0;const a=new Set,i=[];for(let g=0;g<t.length;g++)if(g%2===1){const A=g-1;if(a.has(A)||A<0||A>=t.length)continue;const _=(await(await this.pdf.getPage(g+1)).getTextContent()).items,w=this.sortTextItems(_),m=this.combineTextIntoLines(w),S=this.extractProductInfo(m);i.push({page:A,product:S,pageIndex:r,dataPageIndex:g}),a.add(A),r++}try{if((v=this.sortConfig)!=null&&v.groupByCategory&&i.length>0){const g=i.map((T,b)=>{const _=this.products.find(m=>m.sku===T.product.SKU),w=this.categories.find(m=>m.id===(_==null?void 0:_.categoryId));return{...T,originalIndex:b,categoryName:(w==null?void 0:w.name)||"Uncategorized",categoryId:(_==null?void 0:_.categoryId)||"",matchedProduct:_}});g.sort((T,b)=>{if(T.categoryName!==b.categoryName)return T.categoryName==="Uncategorized"?1:b.categoryName==="Uncategorized"?-1:T.categoryName.localeCompare(b.categoryName);const _=T.product.SKU||"",w=b.product.SKU||"";return _.localeCompare(w)});const A=g.map(({...T})=>{const{originalIndex:b,categoryName:_,categoryId:w,matchedProduct:m,...S}=T;return S});A.length===i.length&&(i.length=0,i.push(...A))}else i.sort((g,A)=>{const T=g.product.SKU||"",b=A.product.SKU||"";return T.localeCompare(b)})}catch{}const c=this.pdfDoc.getPageCount(),l=i.filter(g=>g.page>=0&&g.page<c),h=new Set,o=[];l.forEach(g=>{h.has(g.page)?o.push(g.page):h.add(g.page)});const s=o.length>0?l.filter((g,A,T)=>T.findIndex(b=>b.page===g.page)===A):l,f=format(new Date,"yyyy-MM-dd");console.log(`Amazon Transformer: Processing ${s.length} items for date ${f}`);const u=s.map((g,A)=>({dateDocId:f,orderIndex:A,metadata:{productName:g.product.name,sku:g.product.SKU,quantity:parseInt(g.product.quantity,10)||1,platform:g.product.type},orderId:g.product.orderId})),p=await this.barcodeService.batchGenerateBarcodes(u,{date:f});this.generatedBarcodes=p;for(let g=0;g<s.length;g++){const A=s[g];try{const[T]=await this.outputPdf.copyPages(this.pdfDoc,[A.page]);if(await this.addFooterText(T,A.product),this.enableBarcodes){const b=p[g];if(b){const _=PDFBarcodeEmbedder.generatePDFEmbedBarcode(b.barcodeId),w=await this.outputPdf.embedPng(_),m=PDFBarcodeEmbedder.PDF_EMBED_SIZE,S=40,C=T.getHeight()-45;T.drawImage(w,{x:S,y:C,height:m,opacity:1})}}this.outputPdf.addPage(T)}catch{}}return this.outputPdf}async processOrdersWithInventory(){var h;await this.initialize();const t=this.pdfDoc.getPages(),r=new Set,a=[];for(let o=0;o<t.length;o++)if(o%2===1){const s=o-1;if(r.has(s)||s<0||s>=t.length)continue;const p=(await(await this.pdf.getPage(o+1)).getTextContent()).items,v=this.sortTextItems(p),g=this.combineTextIntoLines(v),A=this.extractProductInfo(g);A.SKU&&A.quantity&&parseInt(A.quantity)>0&&a.push(A),r.add(s)}const i=new InventoryOrderProcessor,c=(h=this.batchInfo)==null?void 0:h.batchId,l=await i.processOrderWithCategoryDeduction(a,c);return{orderItems:l.orderItems,inventoryResult:l.inventoryResult}}async previewInventoryDeductions(){await this.initialize();const t=this.pdfDoc.getPages(),r=new Set,a=[];for(let c=0;c<t.length;c++)if(c%2===1){const l=c-1;if(r.has(l)||l<0||l>=t.length)continue;const s=(await(await this.pdf.getPage(c+1)).getTextContent()).items,f=this.sortTextItems(s),u=this.combineTextIntoLines(f),p=this.extractProductInfo(u);p.SKU&&p.quantity&&parseInt(p.quantity)>0&&a.push(p),r.add(l)}return await new InventoryOrderProcessor().previewCategoryDeductions(a)}}pdfExports.GlobalWorkerOptions.workerSrc=`//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfExports.version}/pdf.worker.min.js`;class FlipkartPageTransformer extends BaseTransformer{constructor(t,r,a,i,c,l=!0){super(t,r,a,i,c,l);Te(this,"pdf");Te(this,"barcodeService");Te(this,"generatedBarcodes",[]);this.barcodeService=new BarcodeService}get barcodeResults(){return this.generatedBarcodes}async initialize(){const{PDFDocument:t}=await __vitePreload(async()=>{const{PDFDocument:a}=await import("./pdf-vendor-CApBJrGQ.js").then(i=>i.i);return{PDFDocument:a}},__vite__mapDeps([0,1]));this.pdfDoc=await t.load(this.filePath),this.outputPdf=await t.create();const r=pdfExports.getDocument({data:this.filePath});this.pdf=await r.promise}async transformPages(){var l,h;if(await this.initialize(),!this.pdfDoc||!this.outputPdf)throw new Error("PDF document is not loaded. Call initialize() first.");const t=this.pdfDoc.getPages(),r=[];for(let o=0;o<t.length;o++){const f=t[o].getMediaBox(),u=f.width,p=f.height,v=180,g=p/2+38,A=u,T=p-10,w=(await(await this.pdf.getPage(o+1)).getTextContent()).items,m=this.sortTextItems(w),S=this.combineTextIntoLines(m);let C=1;const x={name:"",quantity:"0",type:"flipkart",batchInfo:this.batchInfo};if(S.length>0){S[1]&&S[1].toLowerCase().includes("od")&&(x.orderId=S[1].split(" ").at(0)||void 0);const F=S.find(H=>H.toLowerCase().includes("total qty"));if(F){const H=F.split(" ");x.quantity=H.at(2)||"0"}}for(let F=0;F<S.length;)if(S[F].startsWith("SKU")&&/^\d {3}/.test(S[F+C])){const H=S[F+C],[V,...X]=H.split("|"),K=X.join(" ").split(" "),q=V.split(" ").filter(N=>!!N),U=q.length?q[q.length-1].trim():"",B=K.filter(N=>!!N).reduce((N,Q)=>N.trim()+" "+Q.trim(),"");x.SKU!==U&&x.SKU?(x.name+=" && "+B,x.SKU+=" && "+U):(x.name=B,x.SKU=U),C++}else F++;const R=this.products.find(F=>F.sku===x.SKU),M=this.categories.find(F=>F.id===(R==null?void 0:R.categoryId));x.categoryId=R==null?void 0:R.categoryId,x.category=M==null?void 0:M.name,r.push({page:o,pageData:{width:u,height:p,lowerLeftX:v,lowerLeftY:g,upperRightX:A,upperRightY:T},summary:{...x}}),this.summaryText.push({...x})}(l=this.sortConfig)!=null&&l.groupByCategory&&r.length>0?r.sort((o,s)=>{var g;const f=this.categories.find(A=>A.id===o.summary.categoryId),u=this.categories.find(A=>A.id===s.summary.categoryId);if(o.summary.categoryId&&!s.summary.categoryId)return-1;if(!o.summary.categoryId&&s.summary.categoryId)return 1;if(f&&u&&(g=this.sortConfig)!=null&&g.sortCategoriesAlphabetically)return f.name.localeCompare(u.name);const p=o.summary.SKU||"",v=s.summary.SKU||"";return p.localeCompare(v)}):r.length>0&&r.sort((o,s)=>{const f=o.summary.SKU||"",u=s.summary.SKU||"";return f.localeCompare(u)});const a=format(new Date,"yyyy-MM-dd"),i=r.map((o,s)=>({dateDocId:a,orderIndex:s,metadata:{productName:o.summary.name,sku:o.summary.SKU,quantity:parseInt(o.summary.quantity,10)||1,platform:o.summary.type},orderId:o.summary.orderId})),c=await this.barcodeService.batchGenerateBarcodes(i,{date:a});this.generatedBarcodes=c;for(let o=0;o<r.length;o++){const s=r[o],f=t[s.page],{width:u,lowerLeftX:p,lowerLeftY:v,upperRightX:g,upperRightY:A}=s.pageData;f.setWidth(u-180),f.setHeight(A),f.setCropBox(p,v,g,A);const[T]=await this.outputPdf.copyPages(this.pdfDoc,[s.page]);this.outputPdf.addPage(T);const{rgb:b,StandardFonts:_}=await __vitePreload(async()=>{const{rgb:H,StandardFonts:V}=await import("./pdf-vendor-CApBJrGQ.js").then(X=>X.i);return{rgb:H,StandardFonts:V}},__vite__mapDeps([0,1])),w=f.getWidth(),m=6,S=this.products.find(H=>H.sku===s.summary.SKU),C=this.categories.find(H=>H.id===(S==null?void 0:S.categoryId));let x=`${s.summary.quantity} X [${(h=s.summary)==null?void 0:h.name}]`;C&&(x=`${s.summary.quantity} X [${C.name}]`);const R=c[o],M=15;if(this.enableBarcodes&&R)try{const H=T.getSize(),X=H.height+10;T.setSize(H.width,X);const K=PDFBarcodeEmbedder.generatePDFEmbedBarcode(R.barcodeId),q=await this.outputPdf.embedPng(K),U=190,B=T.getHeight()-M;T.drawImage(q,{x:U,y:B,height:M,opacity:1})}catch(H){console.error(`Failed to embed barcode ${R.barcodeId} on Flipkart page ${o+1}:`,H)}const F=await this.outputPdf.embedFont(_.Helvetica);T.drawText(x,{y:T.getHeight()-(this.enableBarcodes&&R?M:0)-5,x:190,size:m,color:b(0,0,0),lineHeight:m+2,font:F,maxWidth:w-180})}return this.outputPdf}async processOrdersWithInventory(){var l;if(await this.initialize(),!this.pdfDoc||!this.outputPdf)throw new Error("PDF document is not loaded. Call initialize() first.");const t=this.pdfDoc.getPages(),r=[];for(let h=0;h<t.length;h++){const f=(await(await this.pdf.getPage(h+1)).getTextContent()).items,u=this.sortTextItems(f),p=this.combineTextIntoLines(u);let v=1;const g={name:"",quantity:"0",type:"flipkart",batchInfo:this.batchInfo};if(p.length>0){p[1]&&p[1].toLowerCase().includes("od")&&(g.orderId=p[1].split(" ").at(0)||void 0);const b=p.find(_=>_.toLowerCase().includes("total qty"));if(b){const _=b.split(" ");g.quantity=_.at(2)||"0"}}for(let b=0;b<p.length;)if(p[b].startsWith("SKU")&&/^\d {3}/.test(p[b+v])){const _=p[b+v],[w,...m]=_.split("|"),S=m.join(" ").split(" "),C=w.split(" ").filter(M=>!!M),x=C.length?C[C.length-1].trim():"",R=S.filter(M=>!!M).reduce((M,F)=>M.trim()+" "+F.trim(),"");g.SKU!==x&&g.SKU?(g.name+=" && "+R,g.SKU+=" && "+x):(g.name=R,g.SKU=x),v++}else b++;const A=this.products.find(b=>b.sku===g.SKU),T=this.categories.find(b=>b.id===(A==null?void 0:A.categoryId));g.categoryId=A==null?void 0:A.categoryId,g.category=T==null?void 0:T.name,g.product=A,g.SKU&&g.quantity&&parseInt(g.quantity)>0&&r.push({...g})}const a=new InventoryOrderProcessor,i=r.length>0?r[0].orderId:(l=this.batchInfo)==null?void 0:l.batchId,c=await a.processOrderWithCategoryDeduction(r,i);return{orderItems:c.orderItems,inventoryResult:c.inventoryResult}}async previewInventoryDeductions(){if(await this.initialize(),!this.pdfDoc||!this.outputPdf)throw new Error("PDF document is not loaded. Call initialize() first.");const t=this.pdfDoc.getPages(),r=[];for(let i=0;i<t.length;i++){const h=(await(await this.pdf.getPage(i+1)).getTextContent()).items,o=this.sortTextItems(h),s=this.combineTextIntoLines(o);let f=1;const u={name:"",quantity:"0",type:"flipkart",batchInfo:this.batchInfo};if(s.length>0){s[1]&&s[1].toLowerCase().includes("od")&&(u.orderId=s[1].split(" ").at(0)||void 0);const g=s.find(A=>A.toLowerCase().includes("total qty"));if(g){const A=g.split(" ");u.quantity=A.at(2)||"0"}}for(let g=0;g<s.length;)if(s[g].startsWith("SKU")&&/^\d {3}/.test(s[g+f])){const A=s[g+f],[T,...b]=A.split("|"),_=b.join(" ").split(" "),w=T.split(" ").filter(C=>!!C),m=w.length?w[w.length-1].trim():"",S=_.filter(C=>!!C).reduce((C,x)=>C.trim()+" "+x.trim(),"");u.SKU!==m&&u.SKU?(u.name+=" && "+S,u.SKU+=" && "+m):(u.name=S,u.SKU=m),f++}else g++;const p=this.products.find(g=>g.sku===u.SKU),v=this.categories.find(g=>g.id===(p==null?void 0:p.categoryId));u.categoryId=p==null?void 0:p.categoryId,u.category=v==null?void 0:v.name,u.product=p,u.SKU&&u.quantity&&parseInt(u.quantity)>0&&r.push({...u})}return await new InventoryOrderProcessor().previewCategoryDeductions(r)}}function generateBatchId(){const n=Date.now(),e=Math.random().toString(36).substring(2,8);return`batch_${n}_${e}`}function createBatchInfo(n,e,t,r,a,i,c){const l=new Date().toISOString(),h={batchId:generateBatchId(),uploadedAt:l,fileName:n,platform:t,orderCount:i,metadata:{userId:r,selectedDate:a,processedAt:l}};return h.description=c,h}class PDFMergerService{constructor(e,t){Te(this,"outpdf");Te(this,"summaryText",[]);Te(this,"inventoryResults",[]);Te(this,"barcodeService");Te(this,"barcodeResults",[]);this.products=e,this.categories=t,this.products=e,this.categories=t,this.barcodeService=new BarcodeService}async initialize(){const{PDFDocument:e}=await __vitePreload(async()=>{const{PDFDocument:t}=await import("./pdf-vendor-CApBJrGQ.js").then(r=>r.i);return{PDFDocument:t}},__vite__mapDeps([0,1]));return this.outpdf=await e.create()}async mergePdfs({amzon:e,flp:t,sortConfig:r,selectedDate:a,fileNames:i,enableBarcodes:c=!0}){if(await this.initialize(),!this.outpdf)return;const h=format(a||new Date,"yyyy-MM-dd");let o,s;if(e.length>0||t.length>0){const u=[];e.length>0&&u.push("amazon"),t.length>0&&u.push("flipkart");const p=u.length===1?u[0]:"mixed",v=this.generateBatchFileName(h,i);s=this.createBatchInfoObject(v,p,h,0),o=await this.createBatchFromInfo(s)}for(const u of e)await this.processAmazonFile(u,r,s,h,c);for(const u of t)await this.processFlipkartFile(u,r,s,h,c);o&&this.summaryText.length>0&&await this.updateBatchOrderCount(o,this.summaryText.length);const f={orders:this.summaryText,date:h,id:h};return o&&(f.batchId=o),a?await new TodaysOrder().updateOrdersForDate(f,h):await new TodaysOrder().updateTodaysOrder(f),this.outpdf}async processAmazonFile(e,t,r,a,i){if(!e||!this.outpdf)return;const c=new AmazonPDFTransformer(e,this.products,this.categories,t,r,i),l=await c.processOrdersWithInventory();this.inventoryResults.push(l.inventoryResult);const h=await c.transform(),o=h.getPageIndices().length;for(let s=0;s<o;s++){const[f]=await this.outpdf.copyPages(h,[s]);this.outpdf.addPage(f)}this.barcodeResults.push(...c.barcodeResults),this.summaryText.push(...c.summary)}async processFlipkartFile(e,t,r,a,i){if(!e||!this.outpdf)return;const c=new FlipkartPageTransformer(e,this.products,this.categories,t,r,i),l=await c.processOrdersWithInventory();this.inventoryResults.push(l.inventoryResult);const h=await c.transformPages(),o=h.getPageIndices().length;for(let s=0;s<o;s++){const[f]=await this.outpdf.copyPages(h,[s]);this.outpdf.addPage(f)}this.barcodeResults.push(...c.barcodeResults),this.summaryText.push(...c.summary)}get summary(){return this.summaryText}get inventoryDeductionResults(){return this.inventoryResults}get barcodeGenerationResults(){return this.barcodeResults}createBatchInfoObject(e,t,r,a){try{const c=getAuth().currentUser;if(!c){console.warn("User not authenticated, cannot create batch info");return}return createBatchInfo(e,void 0,t,c.uid,r,a,"PDF batch upload")}catch(i){console.error("Error creating batch info:",i);return}}async createBatchFromInfo(e){if(e)try{const t=await batchService.createBatch(e);return t.success?t.batchId:void 0}catch(t){console.error("Error creating batch:",t);return}}async updateBatchOrderCount(e,t){try{await batchService.updateBatchOrderCount(e,t)}catch(r){console.error("Error updating batch order count:",r)}}generateBatchFileName(e,t){if(t&&t.length>0)return t.join(", ");const r=Date.now();return`Batch_${e}_${r}.pdf`}async previewAmazonDeductions(e,t){return await new AmazonPDFTransformer(e,this.products,this.categories,t).previewInventoryDeductions()}async previewFlipkartDeductions(e,t){return await new FlipkartPageTransformer(e,this.products,this.categories,t).previewInventoryDeductions()}}class PerformanceMonitor{constructor(){Te(this,"metrics");Te(this,"startTime");Te(this,"memoryThreshold",50*1024*1024);this.startTime=Date.now(),this.metrics={memoryUsage:0,processingTime:0,filesProcessed:0,totalFiles:0,chunkSize:5,averageTimePerFile:0,estimatedTimeRemaining:0}}updateMetrics(e,t){this.metrics.filesProcessed=e,this.metrics.totalFiles=t,this.metrics.processingTime=Date.now()-this.startTime,this.metrics.averageTimePerFile=this.metrics.processingTime/e,this.metrics.estimatedTimeRemaining=this.metrics.averageTimePerFile*(t-e),this.updateMemoryUsage()}updateMemoryUsage(){"memory"in performance&&(this.metrics.memoryUsage=performance.memory.usedJSHeapSize)}shouldReduceChunkSize(){return this.metrics.memoryUsage>this.memoryThreshold}getOptimalChunkSize(){const t=this.metrics.memoryUsage/this.memoryThreshold;return t>.8?Math.max(1,Math.floor(5/2)):t>.6?Math.max(2,Math.floor(5*.8)):5}getMetrics(){return{...this.metrics}}}class ConsolidationErrorHandler{constructor(e){Te(this,"retryConfig");Te(this,"errorLog",[]);this.retryConfig={maxRetries:3,baseDelay:1e3,maxDelay:1e4,backoffMultiplier:2,...e}}async handleError(e,t){if(this.logError(e),!e.recoverable)throw e;return this.retryWithBackoff(t,e)}async retryWithBackoff(e,t){let r=t;for(let a=1;a<=this.retryConfig.maxRetries;a++)try{if(a>1){const i=Math.min(this.retryConfig.baseDelay*Math.pow(this.retryConfig.backoffMultiplier,a-1),this.retryConfig.maxDelay);await this.sleep(i)}return await e()}catch(i){if(r=this.classifyError(i,a),!r.recoverable)throw r}throw r}classifyError(e,t){const r=e instanceof Error?e.message:String(e);return r.includes("memory")?{name:"MemoryAllocationError",type:"MEMORY_ALLOCATION_ERROR",message:r,recoverable:t<2,userMessage:"Insufficient memory to process files. Try with fewer files.",retryCount:t}:r.includes("PDF")?{name:"PDFMergeError",type:"PDF_MERGE_ERROR",message:r,recoverable:!0,userMessage:"Error merging PDF files. Retrying...",retryCount:t}:r.includes("cancelled")?{name:"CancellationError",type:"CANCELLATION_ERROR",message:r,recoverable:!1,userMessage:"Operation was cancelled by the user.",retryCount:t}:{name:"UnknownError",type:"UNKNOWN_ERROR",message:r,recoverable:!1,userMessage:"An unexpected error occurred. Please try again.",retryCount:t}}logError(e){this.errorLog.push({...e,timestamp:new Date().toISOString()}),console.error("Consolidation Error:",{type:e.type,message:e.message,userMessage:e.userMessage,retryCount:e.retryCount,timestamp:new Date().toISOString()})}sleep(e){return new Promise(t=>setTimeout(t,e))}getErrorLog(){return[...this.errorLog]}}class PDFConsolidationService{constructor(e={}){Te(this,"performanceMonitor");Te(this,"errorHandler");Te(this,"isCancelled",!1);Te(this,"onProgress");this.performanceMonitor=new PerformanceMonitor,this.errorHandler=new ConsolidationErrorHandler,this.onProgress=e.enableProgressTracking?t=>this.updateProgress(t):void 0}async mergeAmazonFiles(e,t={}){return this.mergeFiles(e,"amazon",t)}async mergeFlipkartFiles(e,t={}){return this.mergeFiles(e,"flipkart",t)}async mergeFiles(e,t,r){if(e.length===0)return null;this.isCancelled=!1;const a=await PDFDocument.create();let i=0;const c=e.length;let l=r.chunkSize||5;for(let h=0;h<e.length;h+=l){if(this.isCancelled)throw new Error("Operation cancelled by user");const o=e.slice(h,h+l);try{for(const s of o){if(r.validateFiles!==!1&&!await this.validatePDFFile(s)){console.warn(`Skipping invalid PDF file at index ${h+i}`),i++;continue}const f=await PDFDocument.load(s);(await a.copyPages(f,f.getPageIndices())).forEach(p=>a.addPage(p)),i++,this.performanceMonitor.updateMetrics(i,c),this.onProgress&&this.onProgress({currentFile:i,totalFiles:c,percentage:i/c*100,memoryUsage:this.performanceMonitor.getMetrics().memoryUsage,estimatedTimeRemaining:this.performanceMonitor.getMetrics().estimatedTimeRemaining,currentChunkSize:l,processingSpeed:i/(this.performanceMonitor.getMetrics().processingTime/1e3)}),this.performanceMonitor.shouldReduceChunkSize()?l=Math.max(1,l-1):l=Math.min(l+1,this.performanceMonitor.getOptimalChunkSize())}"gc"in window&&window.gc()}catch(s){console.error(`Error processing chunk ${h}-${h+l}:`,s),l=Math.max(1,l-1);continue}}return a.getPageCount()===0?null:await a.save()}async validatePDFFile(e){try{return new TextDecoder().decode(e.slice(0,8)).startsWith("%PDF-")?(await PDFDocument.load(e),!0):!1}catch(t){return console.warn("PDF validation failed:",t),!1}}updateProgress(e){}cancel(){this.isCancelled=!0}getPerformanceMetrics(){return this.performanceMonitor.getMetrics()}getErrorLog(){return this.errorHandler.getErrorLog()}}const initialState$7={amazonFiles:[],flipkartFiles:[],finalPdf:null,summary:[],inventoryResults:[],loading:!1,error:null,selectedDate:new Date,consolidationProgress:null,isConsolidating:!1,categoryDeductionPreview:null,hasAutomaticDeductionEnabled:!1,enableBarcodes:!0},readFileFromInput=n=>new Promise((e,t)=>{const r=new FileReader;r.onload=()=>{r.result instanceof ArrayBuffer?e(new Uint8Array(r.result)):t(new Error("Failed to read file"))},r.onerror=t,r.readAsArrayBuffer(n)}),previewCategoryDeductions$1=createAsyncThunk("pdfMerger/previewCategoryDeductions",async(n,{dispatch:e})=>{const{amazonFiles:t,flipkartFiles:r,sortConfig:a}=n;if(t.length===0&&r.length===0)throw new Error("No files provided");let i=store.getState().products.items,c=store.getState().products.categories;i.length===0&&(await e(fetchProducts({})).unwrap(),i=store.getState().products.items),c.length===0&&(await e(fetchCategories$1()).unwrap(),c=store.getState().products.categories);const l=new PDFConsolidationService({enableProgressTracking:!1,enableCancellation:!1,chunkSize:5,validateFiles:!0});let h=null;if(t.length>0){const v=await Promise.all(t.map(g=>readFileFromInput(g)));h=await l.mergeAmazonFiles(v)}let o=null;if(r.length>0){const v=await Promise.all(r.map(g=>readFileFromInput(g)));o=await l.mergeFlipkartFiles(v)}const s=new PDFMergerService(i,c),f=h?await s.previewAmazonDeductions(h,a):null,u=o?await s.previewFlipkartDeductions(o,a):null;return{items:[...(f==null?void 0:f.items)||[],...(u==null?void 0:u.items)||[]],totalDeductions:new Map([...Array.from((f==null?void 0:f.totalDeductions)||new Map),...Array.from((u==null?void 0:u.totalDeductions)||new Map)]),warnings:[...(f==null?void 0:f.warnings)||[],...(u==null?void 0:u.warnings)||[]],errors:[...(f==null?void 0:f.errors)||[],...(u==null?void 0:u.errors)||[]]}}),mergePDFs=createAsyncThunk("pdfMerger/mergePDFs",async(n,{dispatch:e})=>{const{amazonFiles:t,flipkartFiles:r,sortConfig:a,selectedDate:i,enableBarcodes:c=!0}=n;if(t.length===0&&r.length===0)throw new Error("No files provided");if(i){const s=new Date;s.setHours(0,0,0,0);const f=new Date(i);if(f.setHours(0,0,0,0),f<s)throw new Error("Selected date cannot be in the past")}let l=store.getState().products.items,h=store.getState().products.categories;l.length===0&&(await e(fetchProducts({})).unwrap(),l=store.getState().products.items),h.length===0&&(await e(fetchCategories$1()).unwrap(),h=store.getState().products.categories);const o=new PDFConsolidationService({enableProgressTracking:!0,enableCancellation:!0,chunkSize:5,validateFiles:!0});o.onProgress=s=>{e(pdfMergerSlice.actions.updateConsolidationProgress(s))};try{let s=null;if(t.length>0){const b=await Promise.all(t.map(_=>readFileFromInput(_)));s=await o.mergeAmazonFiles(b)}let f=null;if(r.length>0){const b=await Promise.all(r.map(_=>readFileFromInput(_)));f=await o.mergeFlipkartFiles(b)}const u=new PDFMergerService(l,h),p=[...t.map(b=>b.name),...r.map(b=>b.name)],v=await u.mergePdfs({amzon:s?[s]:[],flp:f?[f]:[],sortConfig:a,selectedDate:i,fileNames:p,enableBarcodes:c});if(!v)throw new Error("Failed to merge PDFs");const g=await v.save(),A=new Blob([g],{type:"application/pdf"});return{pdfUrl:URL.createObjectURL(A),summary:u.summary,inventoryResults:u.inventoryDeductionResults}}catch(s){if(s instanceof Error){const f=s;if(f.userMessage)throw new Error(f.userMessage)}throw s}}),pdfMergerSlice=createSlice({name:"pdfMerger",initialState:initialState$7,reducers:{addAmazonFile:(n,e)=>{n.amazonFiles.push(e.payload)},addFlipkartFile:(n,e)=>{n.flipkartFiles.push(e.payload)},removeAmazonFile:(n,e)=>{n.amazonFiles.splice(e.payload,1)},removeFlipkartFile:(n,e)=>{n.flipkartFiles.splice(e.payload,1)},clearAmazonFiles:n=>{n.amazonFiles=[]},clearFlipkartFiles:n=>{n.flipkartFiles=[]},setSelectedDate:(n,e)=>{const t=new Date;t.setHours(0,0,0,0);const r=new Date(e.payload);r.setHours(0,0,0,0),r>=t&&(n.selectedDate=e.payload)},clearFiles:n=>{n.amazonFiles=[],n.flipkartFiles=[],n.finalPdf=null,n.summary=[],n.inventoryResults=[],n.selectedDate=new Date,n.consolidationProgress=null,n.isConsolidating=!1,n.categoryDeductionPreview=null,n.hasAutomaticDeductionEnabled=!1},updateConsolidationProgress:(n,e)=>{n.consolidationProgress=e.payload,n.isConsolidating=!0},clearConsolidationProgress:n=>{n.consolidationProgress=null,n.isConsolidating=!1},setCategoryDeductionPreview:(n,e)=>{n.categoryDeductionPreview=e.payload},clearCategoryDeductionPreview:n=>{n.categoryDeductionPreview=null},setAutomaticDeductionEnabled:(n,e)=>{n.hasAutomaticDeductionEnabled=e.payload},setEnableBarcodes:(n,e)=>{n.enableBarcodes=e.payload}},extraReducers:n=>{n.addCase(mergePDFs.pending,e=>{e.loading=!0,e.error=null,e.isConsolidating=!0}).addCase(mergePDFs.fulfilled,(e,t)=>{e.loading=!1,e.finalPdf=t.payload.pdfUrl,e.summary=t.payload.summary,e.inventoryResults=t.payload.inventoryResults||[],e.consolidationProgress=null,e.isConsolidating=!1}).addCase(mergePDFs.rejected,(e,t)=>{e.loading=!1,e.error=t.error.message||"Failed to merge PDFs",e.consolidationProgress=null,e.isConsolidating=!1}).addCase(previewCategoryDeductions$1.pending,e=>{e.loading=!0,e.error=null,e.categoryDeductionPreview=null}).addCase(previewCategoryDeductions$1.fulfilled,(e,t)=>{e.loading=!1,e.categoryDeductionPreview=t.payload,e.hasAutomaticDeductionEnabled=t.payload.items.length>0}).addCase(previewCategoryDeductions$1.rejected,(e,t)=>{e.loading=!1,e.error=t.error.message||"Failed to preview category deductions",e.categoryDeductionPreview=null})}}),{addAmazonFile,addFlipkartFile,removeAmazonFile,removeFlipkartFile,clearAmazonFiles,clearFlipkartFiles,setSelectedDate,clearFiles,updateConsolidationProgress,clearConsolidationProgress,setCategoryDeductionPreview:setCategoryDeductionPreview$1,clearCategoryDeductionPreview:clearCategoryDeductionPreview$1,setAutomaticDeductionEnabled,setEnableBarcodes}=pdfMergerSlice.actions,pdfMergerReducer=pdfMergerSlice.reducer,CACHE_DURATIONS={orders:5*60*1e3},shouldFetchData=(n,e,t,r=!0)=>r?!n||e.length===0?!0:Date.now()-n>t:!1,initialState$6={dailyOrders:[],loading:!1,error:null,lastFetched:null},orderService=new TodaysOrder,fetchOrderHistory=createAsyncThunk("orderHistory/fetchOrderHistory",async(n,{getState:e})=>{const t=e(),{lastFetched:r,dailyOrders:a}=t.orderHistory,{isAuthenticated:i}=t.auth;return shouldFetchData(r,a,CACHE_DURATIONS.orders,i)?await orderService.getLastThirtyDaysOrders():a}),orderHistorySlice=createSlice({name:"orderHistory",initialState:initialState$6,reducers:{},extraReducers:n=>{n.addCase(fetchOrderHistory.pending,e=>{e.loading=!0,e.error=null}).addCase(fetchOrderHistory.fulfilled,(e,t)=>{e.loading=!1,e.dailyOrders=t.payload,e.lastFetched=Date.now()}).addCase(fetchOrderHistory.rejected,(e,t)=>{e.loading=!1,e.error=t.error.message||"Failed to fetch order history"})}}),orderHistoryReducer=orderHistorySlice.reducer,initialState$5={items:[],loading:!1,error:null,selectedCategory:null,categoryInventoryLevels:{},categoryGroupInventoryLevels:{},categoryInventoryAlerts:[],inventoryLoading:!1,inventoryError:null,categoryGroupsLoading:!1,categoryGroupsError:null,categoriesWithLowStock:[],categoriesWithZeroStock:[],categoryInventoryStatus:{},categoryGroups:[],categoriesWithDeduction:[],deductionConfiguration:{},deductionLoading:!1,deductionError:null},categoryService=new CategoryService,inventoryService$1=new InventoryService,categoryGroupService$1=new CategoryGroupService,fetchCategories=createAsyncThunk("categories/fetchCategories",async()=>await categoryService.getCategories()),createCategory=createAsyncThunk("categories/create",async(n,{rejectWithValue:e})=>{try{return{id:await categoryService.createCategory(n),...n}}catch(t){return e(t.message||"Failed to create category")}}),updateCategory=createAsyncThunk("categories/update",async({id:n,...e},{rejectWithValue:t})=>{try{return await categoryService.updateCategory(n,e),{id:n,...e}}catch(r){return t(r.message||"Failed to update category")}}),deleteCategory=createAsyncThunk("categories/delete",async(n,{rejectWithValue:e})=>{try{return await categoryService.deleteCategory(n),n}catch(t){return e(t.message||"Failed to delete category")}}),fetchCategoryInventoryLevels=createAsyncThunk("categories/fetchCategoryInventoryLevels",async(n,{rejectWithValue:e})=>{try{return await inventoryService$1.getInventoryLevels()}catch(t){return e(t.message||"Failed to fetch category inventory levels")}}),fetchCategoryGroups$1=createAsyncThunk("categories/fetchCategoryGroups",async(n,{rejectWithValue:e})=>{try{return await categoryGroupService$1.getCategoryGroups()}catch(t){return e(t.message||"Failed to fetch category groups")}}),updateCategoryWithInventorySync=createAsyncThunk("categories/updateCategoryWithInventorySync",async({id:n,updates:e,syncInventory:t=!0},{rejectWithValue:r})=>{try{await categoryService.updateCategory(n,e);let a=[];return t&&(a=await inventoryService$1.getInventoryLevels()),{id:n,updates:e,inventoryLevels:a}}catch(a){return r(a.message||"Failed to update category with inventory sync")}}),deleteCategoryWithInventorySync=createAsyncThunk("categories/deleteCategoryWithInventorySync",async({id:n,syncInventory:e=!0},{rejectWithValue:t})=>{try{await categoryService.deleteCategory(n);let r=[];return e&&(r=await inventoryService$1.getInventoryLevels()),{id:n,inventoryLevels:r}}catch(r){return t(r.message||"Failed to delete category with inventory sync")}}),fetchCategoriesWithDeduction$1=createAsyncThunk("categories/fetchCategoriesWithDeduction",async(n,{rejectWithValue:e})=>{try{return await categoryService.getCategoriesWithInventoryDeduction()}catch(t){return e(t.message||"Failed to fetch categories with deduction")}}),updateCategoryDeductionQuantity=createAsyncThunk("categories/updateCategoryDeductionQuantity",async({categoryId:n,quantity:e},{rejectWithValue:t})=>{try{return await categoryService.updateInventoryDeductionQuantity(n,e??null),{categoryId:n,quantity:e}}catch(r){return t(r.message||"Failed to update category deduction quantity")}}),categoriesSlice=createSlice({name:"categories",initialState:initialState$5,reducers:{selectCategory:(n,e)=>{n.selectedCategory=e.payload},clearCategoriesError:n=>{n.error=null},updateCategoryInventoryLevels:(n,e)=>{if(!e.payload||!Array.isArray(e.payload)){n.categoryGroupInventoryLevels={};return}n.categoryGroupInventoryLevels=e.payload.reduce((a,i)=>(a[i.categoryGroupId]=i,a),{});const t=[],r=[];n.items.forEach(a=>{const i=n.categoryGroups.filter(c=>c.id&&a.categoryGroupId===c.id);if(i.length>0){let c=!1,l=!1;i.forEach(h=>{const o=h.id?n.categoryGroupInventoryLevels[h.id]:null;o&&(o.status==="low_stock"?c=!0:(o.status==="zero_stock"||o.status==="negative_stock")&&(l=!0))}),l?a.id&&(n.categoryInventoryStatus[a.id]="zero_stock",r.push(a.id)):c?a.id&&(n.categoryInventoryStatus[a.id]="low_stock",t.push(a.id)):a.id&&(n.categoryInventoryStatus[a.id]="healthy")}else a.id&&(n.categoryInventoryStatus[a.id]="healthy")}),n.categoriesWithLowStock=t,n.categoriesWithZeroStock=r},updateCategoryInventoryAlerts:(n,e)=>{n.categoryInventoryAlerts=e.payload},clearInventoryError:n=>{n.inventoryError=null},clearCategoryGroupsError:n=>{n.categoryGroupsError=null},updateCategoryGroups:(n,e)=>{n.categoryGroups=e.payload},updateCategoriesWithDeduction:(n,e)=>{const t=e.payload.filter(a=>a.inventoryDeductionQuantity&&a.inventoryDeductionQuantity>0).map(a=>a.id).filter(Boolean);n.categoriesWithDeduction=t;const r={};e.payload.forEach(a=>{a.id&&a.inventoryDeductionQuantity&&a.inventoryDeductionQuantity>0&&(r[a.id]=a.inventoryDeductionQuantity)}),n.deductionConfiguration=r},updateCategoryDeductionConfig:(n,e)=>{const{categoryId:t,quantity:r}=e.payload;r&&r>0?(n.deductionConfiguration[t]=r,n.categoriesWithDeduction.includes(t)||n.categoriesWithDeduction.push(t)):(delete n.deductionConfiguration[t],n.categoriesWithDeduction=n.categoriesWithDeduction.filter(a=>a!==t))},clearDeductionError:n=>{n.deductionError=null}},extraReducers:n=>{n.addCase(fetchCategories.pending,e=>{e.loading=!0,e.error=null}),n.addCase(fetchCategories.fulfilled,(e,t)=>{e.loading=!1,e.items=t.payload}),n.addCase(fetchCategories.rejected,(e,t)=>{e.loading=!1,e.error=t.error.message||"Failed to fetch categories"}),n.addCase(createCategory.fulfilled,(e,t)=>{e.items.push(t.payload)}),n.addCase(createCategory.rejected,(e,t)=>{e.error=t.payload}),n.addCase(updateCategory.fulfilled,(e,t)=>{const r=e.items.findIndex(a=>a.id===t.payload.id);r!==-1&&(e.items[r]={...e.items[r],...t.payload})}),n.addCase(updateCategory.rejected,(e,t)=>{e.error=t.payload}),n.addCase(deleteCategory.fulfilled,(e,t)=>{e.items=e.items.filter(r=>r.id!==t.payload),e.selectedCategory===t.payload&&(e.selectedCategory=null)}),n.addCase(deleteCategory.rejected,(e,t)=>{e.error=t.payload}),n.addCase(fetchCategoryInventoryLevels.pending,e=>{e.inventoryLoading=!0,e.inventoryError=null}),n.addCase(fetchCategoryInventoryLevels.fulfilled,(e,t)=>{if(e.inventoryLoading=!1,!t.payload||!Array.isArray(t.payload)){e.categoryGroupInventoryLevels={};return}e.categoryGroupInventoryLevels=t.payload.reduce((i,c)=>(i[c.categoryGroupId]=c,i),{});const r=[],a=[];e.items.forEach(i=>{const c=e.categoryGroups.filter(l=>l.id&&i.categoryGroupId===l.id);if(c.length>0){let l=!1,h=!1;c.forEach(o=>{const s=o.id?e.categoryGroupInventoryLevels[o.id]:null;s&&(s.status==="low_stock"?l=!0:(s.status==="zero_stock"||s.status==="negative_stock")&&(h=!0))}),h?i.id&&(e.categoryInventoryStatus[i.id]="zero_stock",a.push(i.id)):l?i.id&&(e.categoryInventoryStatus[i.id]="low_stock",r.push(i.id)):i.id&&(e.categoryInventoryStatus[i.id]="healthy")}else i.id&&(e.categoryInventoryStatus[i.id]="healthy")}),e.categoriesWithLowStock=r,e.categoriesWithZeroStock=a}),n.addCase(fetchCategoryInventoryLevels.rejected,(e,t)=>{e.inventoryLoading=!1,e.inventoryError=t.payload}),n.addCase(fetchCategoryGroups$1.pending,e=>{e.categoryGroupsLoading=!0,e.categoryGroupsError=null}),n.addCase(fetchCategoryGroups$1.fulfilled,(e,t)=>{e.categoryGroupsLoading=!1,e.categoryGroups=t.payload}),n.addCase(fetchCategoryGroups$1.rejected,(e,t)=>{e.categoryGroupsLoading=!1,e.categoryGroupsError=t.payload}),n.addCase(updateCategoryWithInventorySync.fulfilled,(e,t)=>{const{id:r,updates:a,inventoryLevels:i}=t.payload,c=e.items.findIndex(l=>l.id===r);c!==-1&&(e.items[c]={...e.items[c],...a}),i.length>0&&(e.categoryGroupInventoryLevels=i.reduce((l,h)=>(l[h.categoryGroupId]=h,l),{}))}),n.addCase(updateCategoryWithInventorySync.rejected,(e,t)=>{e.error=t.payload}),n.addCase(deleteCategoryWithInventorySync.fulfilled,(e,t)=>{const{id:r,inventoryLevels:a}=t.payload;e.items=e.items.filter(i=>i.id!==r),e.selectedCategory===r&&(e.selectedCategory=null),a.length>0&&(e.categoryGroupInventoryLevels=a.reduce((i,c)=>(i[c.categoryGroupId]=c,i),{})),delete e.categoryInventoryStatus[r],e.categoriesWithLowStock=e.categoriesWithLowStock.filter(i=>i!==r),e.categoriesWithZeroStock=e.categoriesWithZeroStock.filter(i=>i!==r)}),n.addCase(deleteCategoryWithInventorySync.rejected,(e,t)=>{e.error=t.payload}),n.addCase(fetchCategoriesWithDeduction$1.pending,e=>{e.deductionLoading=!0,e.deductionError=null}),n.addCase(fetchCategoriesWithDeduction$1.fulfilled,(e,t)=>{e.deductionLoading=!1;const r=t.payload.filter(i=>i.inventoryDeductionQuantity&&i.inventoryDeductionQuantity>0).map(i=>i.id).filter(Boolean);e.categoriesWithDeduction=r;const a={};t.payload.forEach(i=>{i.id&&i.inventoryDeductionQuantity&&i.inventoryDeductionQuantity>0&&(a[i.id]=i.inventoryDeductionQuantity)}),e.deductionConfiguration=a}),n.addCase(fetchCategoriesWithDeduction$1.rejected,(e,t)=>{e.deductionLoading=!1,e.deductionError=t.payload}),n.addCase(updateCategoryDeductionQuantity.fulfilled,(e,t)=>{const{categoryId:r,quantity:a}=t.payload,i=e.items.findIndex(c=>c.id===r);i!==-1&&(e.items[i]={...e.items[i],inventoryDeductionQuantity:a}),a&&a>0?(e.deductionConfiguration[r]=a,e.categoriesWithDeduction.includes(r)||e.categoriesWithDeduction.push(r)):(delete e.deductionConfiguration[r],e.categoriesWithDeduction=e.categoriesWithDeduction.filter(c=>c!==r))}),n.addCase(updateCategoryDeductionQuantity.rejected,(e,t)=>{e.deductionError=t.payload})}}),{selectCategory,clearCategoriesError,updateCategoryInventoryLevels,updateCategoryInventoryAlerts,clearInventoryError,clearCategoryGroupsError,updateCategoryGroups,updateCategoriesWithDeduction,updateCategoryDeductionConfig,clearDeductionError:clearDeductionError$1}=categoriesSlice.actions,categoriesReducer=categoriesSlice.reducer,initialState$4={groups:[],loading:!1,error:null,selectedGroupId:null,lastUpdated:null},categoryGroupService=new CategoryGroupService,fetchCategoryGroups=createAsyncThunk("categoryGroups/fetchGroups",async(n,{rejectWithValue:e})=>{try{return await categoryGroupService.getCategoryGroupsWithStats()}catch(t){return e(t instanceof Error?t.message:"Failed to fetch category groups")}}),createCategoryGroup=createAsyncThunk("categoryGroups/create",async(n,{rejectWithValue:e,dispatch:t})=>{try{const r=await categoryGroupService.createCategoryGroup(n);return t(fetchCategoryGroups()),r}catch(r){return e(r instanceof Error?r.message:"Failed to create category group")}}),updateCategoryGroup=createAsyncThunk("categoryGroups/update",async({id:n,groupData:e},{rejectWithValue:t,dispatch:r})=>{try{return await categoryGroupService.updateCategoryGroup(n,e),r(fetchCategoryGroups()),{id:n,groupData:e}}catch(a){return t(a instanceof Error?a.message:"Failed to update category group")}}),deleteCategoryGroup=createAsyncThunk("categoryGroups/delete",async(n,{rejectWithValue:e,dispatch:t})=>{try{return await categoryGroupService.deleteCategoryGroup(n),t(fetchCategoryGroups()),n}catch(r){return e(r instanceof Error?r.message:"Failed to delete category group")}}),assignCategoriesToGroup=createAsyncThunk("categoryGroups/assignCategories",async({categoryIds:n,groupId:e},{rejectWithValue:t,dispatch:r})=>{try{return await categoryGroupService.assignMultipleCategoriesToGroup(n,e),r(fetchCategoryGroups()),{categoryIds:n,groupId:e}}catch(a){return t(a instanceof Error?a.message:"Failed to assign categories to group")}}),removeCategoryFromGroup=createAsyncThunk("categoryGroups/removeCategoryFromGroup",async(n,{rejectWithValue:e,dispatch:t})=>{try{return await categoryGroupService.removeCategoryFromGroup(n),t(fetchCategoryGroups()),n}catch(r){return e(r instanceof Error?r.message:"Failed to remove category from group")}}),categoryGroupsSlice=createSlice({name:"categoryGroups",initialState:initialState$4,reducers:{clearError:n=>{n.error=null},setSelectedGroup:(n,e)=>{n.selectedGroupId=e.payload},resetState:()=>initialState$4},extraReducers:n=>{n.addCase(fetchCategoryGroups.pending,e=>{e.loading=!0,e.error=null}).addCase(fetchCategoryGroups.fulfilled,(e,t)=>{e.loading=!1,e.groups=t.payload,e.lastUpdated=new Date().toISOString(),e.error=null}).addCase(fetchCategoryGroups.rejected,(e,t)=>{e.loading=!1,e.error=t.payload}),n.addCase(createCategoryGroup.pending,e=>{e.loading=!0,e.error=null}).addCase(createCategoryGroup.fulfilled,e=>{e.loading=!1,e.error=null}).addCase(createCategoryGroup.rejected,(e,t)=>{e.loading=!1,e.error=t.payload}),n.addCase(updateCategoryGroup.pending,e=>{e.loading=!0,e.error=null}).addCase(updateCategoryGroup.fulfilled,e=>{e.loading=!1,e.error=null}).addCase(updateCategoryGroup.rejected,(e,t)=>{e.loading=!1,e.error=t.payload}),n.addCase(deleteCategoryGroup.pending,e=>{e.loading=!0,e.error=null}).addCase(deleteCategoryGroup.fulfilled,e=>{e.loading=!1,e.error=null,e.selectedGroupId===e.selectedGroupId&&(e.selectedGroupId=null)}).addCase(deleteCategoryGroup.rejected,(e,t)=>{e.loading=!1,e.error=t.payload}),n.addCase(assignCategoriesToGroup.pending,e=>{e.loading=!0,e.error=null}).addCase(assignCategoriesToGroup.fulfilled,e=>{e.loading=!1,e.error=null}).addCase(assignCategoriesToGroup.rejected,(e,t)=>{e.loading=!1,e.error=t.payload}),n.addCase(removeCategoryFromGroup.pending,e=>{e.loading=!0,e.error=null}).addCase(removeCategoryFromGroup.fulfilled,e=>{e.loading=!1,e.error=null}).addCase(removeCategoryFromGroup.rejected,(e,t)=>{e.loading=!1,e.error=t.payload})}}),{clearError:clearError$1,setSelectedGroup,resetState}=categoryGroupsSlice.actions,selectCategoryGroups=n=>n.categoryGroups.groups,selectCategoryGroupsLoading=n=>n.categoryGroups.loading,selectCategoryGroupsError=n=>n.categoryGroups.error,selectCategoryGroupsLastUpdated=n=>n.categoryGroups.lastUpdated,categoryGroupsReducer=categoryGroupsSlice.reducer,initialState$3={metrics:null,categoryData:[],skuData:[],loading:!1,error:null},orderAnalyticsSlice=createSlice({name:"orderAnalytics",initialState:initialState$3,reducers:{}}),orderAnalyticsReducer=orderAnalyticsSlice.reducer;class AllOrdersForAnalyticsService extends FirebaseService{constructor(){super(...arguments);Te(this,"COLLECTION_NAME","active-orders")}async fetchAllDailyOrderDocuments(){return this.getDocuments(this.COLLECTION_NAME,[orderBy("date","asc")])}}const initialState$2={items:[],loading:!1,error:null},allOrdersService=new AllOrdersForAnalyticsService,fetchAllOrdersForAnalytics=createAsyncThunk("allOrdersForAnalytics/fetchAll",async(n,{rejectWithValue:e})=>{try{return(await allOrdersService.fetchAllDailyOrderDocuments()).reduce((a,i)=>{const c=i.orders.map(l=>({...l,date:i.date}));return[...a,...c]},[])}catch(t){const r=t instanceof Error?t.message:"An unknown error occurred";return e(r)}}),allOrdersForAnalyticsSlice=createSlice({name:"allOrdersForAnalytics",initialState:initialState$2,reducers:{},extraReducers:n=>{n.addCase(fetchAllOrdersForAnalytics.pending,e=>{e.loading=!0,e.error=null}).addCase(fetchAllOrdersForAnalytics.fulfilled,(e,t)=>{e.loading=!1,e.items=t.payload}).addCase(fetchAllOrdersForAnalytics.rejected,(e,t)=>{var r;e.loading=!1,e.error=t.payload||((r=t.error)==null?void 0:r.message)||"Failed to fetch all orders for analytics"})}}),allOrdersForAnalyticsReducer=allOrdersForAnalyticsSlice.reducer;class AlertingService extends FirebaseService{constructor(){super();Te(this,"INVENTORY_ALERTS_COLLECTION","inventoryAlerts");Te(this,"rules",[]);Te(this,"alerts",[]);Te(this,"isEnabled");Te(this,"checkInterval",6e4);Te(this,"intervalId");this.isEnabled=this.shouldEnableAlerting(),this.initializeDefaultRules(),this.isEnabled&&this.startAlertingService()}shouldEnableAlerting(){const t=window.location.hostname;return t.includes("github.io")||t.includes("netlify.app")||t.includes("vercel.app")||!0}initializeDefaultRules(){this.rules=[{id:"critical_error_rate",name:"Critical Error Rate",type:"error_rate",condition:{metric:"error_rate_critical",operator:">",threshold:0,timeWindow:5},severity:"critical",enabled:!0,cooldown:10,actions:[{type:"console",config:{level:"error"}},{type:"localStorage",config:{key:"critical_alerts"}}]},{id:"high_error_rate",name:"High Error Rate",type:"error_rate",condition:{metric:"error_rate_total",operator:">",threshold:10,timeWindow:15},severity:"high",enabled:!0,cooldown:30,actions:[{type:"console",config:{level:"warn"}},{type:"localStorage",config:{key:"error_alerts"}}]},{id:"performance_degradation",name:"Performance Degradation",type:"performance",condition:{metric:"avg_page_load_time",operator:">",threshold:5e3,timeWindow:10},severity:"medium",enabled:!0,cooldown:20,actions:[{type:"console",config:{level:"warn"}},{type:"localStorage",config:{key:"performance_alerts"}}]},{id:"slow_page_load",name:"Slow Page Load",type:"performance",condition:{metric:"page_load_time",operator:">",threshold:1e4,timeWindow:5},severity:"high",enabled:!0,cooldown:15,actions:[{type:"console",config:{level:"error"}},{type:"localStorage",config:{key:"performance_alerts"}}]}]}startAlertingService(){this.intervalId=window.setInterval(()=>{this.checkAlertRules()},this.checkInterval),setTimeout(()=>{this.checkAlertRules()},2e3)}checkAlertRules(){this.isEnabled&&this.rules.forEach(t=>{if(!t.enabled)return;if(t.lastTriggered){const a=new Date(t.lastTriggered.getTime()+t.cooldown*6e4);if(new Date<a)return}this.evaluateRule(t)&&this.triggerAlert(t)})}evaluateRule(t){try{const r=t.condition.timeWindow*6e4,a=Date.now(),i=a-r;switch(t.type){case"error_rate":return this.evaluateErrorRateRule(t,i,a);case"performance":return this.evaluatePerformanceRule(t,i,a);case"availability":return this.evaluateAvailabilityRule(t,i,a);default:return!1}}catch(r){return console.error("Error evaluating alert rule:",t.name,r),!1}}evaluateErrorRateRule(t,r,a){const i=this.getErrorsInTimeWindow(r,a);let c;switch(t.condition.metric){case"error_rate_critical":c=i.filter(l=>l.severity==="critical").length;break;case"error_rate_total":c=i.length;break;default:return!1}return this.compareValues(c,t.condition.operator,t.condition.threshold)}evaluatePerformanceRule(t,r,a){const i=this.getPerformanceInTimeWindow(r,a);if(i.length===0)return!1;let c;switch(t.condition.metric){case"avg_page_load_time":c=i.reduce((l,h)=>l+h.metrics.pageLoadTime,0)/i.length;break;case"page_load_time":c=Math.max(...i.map(l=>l.metrics.pageLoadTime));break;default:return!1}return this.compareValues(c,t.condition.operator,t.condition.threshold)}evaluateAvailabilityRule(t,r,a){return!1}compareValues(t,r,a){switch(r){case">":return t>a;case"<":return t<a;case"=":return t===a;case">=":return t>=a;case"<=":return t<=a;default:return!1}}getErrorsInTimeWindow(t,r){try{return JSON.parse(localStorage.getItem("monitoring_errors")||"[]").filter(i=>{const c=new Date(i.timestamp).getTime();return c>=t&&c<=r})}catch{return[]}}getPerformanceInTimeWindow(t,r){try{return JSON.parse(localStorage.getItem("monitoring_performance")||"[]").filter(i=>{const c=new Date(i.timestamp).getTime();return c>=t&&c<=r})}catch{return[]}}triggerAlert(t){const r={id:`alert_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,ruleId:t.id,ruleName:t.name,timestamp:new Date,severity:t.severity,message:this.generateAlertMessage(t),details:{rule:t,threshold:t.condition.threshold,metric:t.condition.metric},resolved:!1};this.alerts.push(r),t.lastTriggered=new Date,t.actions.forEach(a=>{this.executeAlertAction(r,a)}),this.saveAlertsToStorage()}generateAlertMessage(t){switch(t.type){case"error_rate":return`Error rate alert: ${t.name} - ${t.condition.metric} ${t.condition.operator} ${t.condition.threshold} in ${t.condition.timeWindow} minutes`;case"performance":return`Performance alert: ${t.name} - ${t.condition.metric} ${t.condition.operator} ${t.condition.threshold}ms in ${t.condition.timeWindow} minutes`;case"availability":return`Availability alert: ${t.name} - Service availability issue detected`;default:return`Alert: ${t.name}`}}executeAlertAction(t,r){try{switch(r.type){case"console":{const a=r.config.level||"log";console[a](`🚨 ALERT [${t.severity.toUpperCase()}]: ${t.message}`,t);break}case"localStorage":{const a=r.config.key||"alerts",i=JSON.parse(localStorage.getItem(a)||"[]");i.push(t),localStorage.setItem(a,JSON.stringify(i.slice(-100)));break}case"webhook":console.log("Webhook alert (not implemented):",t);break;case"email":console.log("Email alert (not implemented):",t);break}}catch(a){console.error("Failed to execute alert action:",r.type,a)}}saveAlertsToStorage(){try{localStorage.setItem("monitoring_alerts",JSON.stringify(this.alerts.slice(-1e3)))}catch(t){console.error("Failed to save alerts to storage:",t)}}addRule(t){this.rules.push(t)}updateRule(t,r){const a=this.rules.findIndex(i=>i.id===t);a>=0&&(this.rules[a]={...this.rules[a],...r})}removeRule(t){this.rules=this.rules.filter(r=>r.id!==t)}getRules(){return[...this.rules]}getAlerts(t){return this.alerts.filter(r=>t===void 0||r.resolved===t)}resolveAlert(t){const r=this.alerts.find(a=>a.id===t);r&&(r.resolved=!0,r.resolvedAt=new Date,this.saveAlertsToStorage())}getStoredAlerts(){try{return JSON.parse(localStorage.getItem("monitoring_alerts")||"[]")}catch{return[]}}clearAlerts(){this.alerts=[],localStorage.removeItem("monitoring_alerts")}async createInventoryAlert(t,r,a,i,c,l){if(!t||typeof t!="string")throw new Error("Category group ID is required and must be a valid string");if(!r||!["low_stock","zero_stock","negative_stock"].includes(r))throw new Error("Alert type must be one of: low_stock, zero_stock, negative_stock");if(typeof a!="number"||isNaN(a))throw new Error("Current level must be a valid number");if(typeof i!="number"||isNaN(i)||i<0)throw new Error("Threshold level must be a valid non-negative number");if(!c||!["kg","g","pcs"].includes(c))throw new Error("Unit must be one of: kg, g, pcs");if(!l||!["low","medium","high","critical"].includes(l))throw new Error("Severity must be one of: low, medium, high, critical");if(r==="zero_stock"&&a!==0)throw new Error("Zero stock alert type requires current level to be exactly 0");if(r==="negative_stock"&&a>=0)throw new Error("Negative stock alert type requires current level to be below 0");if(r==="low_stock"&&(a<=0||a>=i))throw new Error("Low stock alert type requires current level to be between 0 and threshold level");try{const h=await this.getDocuments(this.INVENTORY_ALERTS_COLLECTION,[where("categoryGroupId","==",t),where("alertType","==",r),where("isActive","==",!0)]);if(h.length>0){const u=h[0];return console.warn(`Active ${r} alert already exists for category group ${t}:`,u.id),u}const o={categoryGroupId:t,alertType:r,currentLevel:a,thresholdLevel:i,unit:c,severity:l,isActive:!0,createdAt:Timestamp.now()},s=await this.addDocument(this.INVENTORY_ALERTS_COLLECTION,o),f={...o,id:s.id};return console.info("Inventory alert created successfully:",{alertId:s.id,categoryGroupId:t,alertType:r,currentLevel:a,thresholdLevel:i,unit:c,severity:l}),f}catch(h){const o=h instanceof Error?h.message:"Unknown error during inventory alert creation";throw new Error(`Failed to create inventory alert: ${o}`)}}calculateSeverity(t,r,a){if(typeof t!="number"||isNaN(t))throw new Error("Current level must be a valid number");if(typeof r!="number"||isNaN(r))throw new Error("Threshold level must be a valid number");if(r<0)throw new Error("Threshold level must be non-negative");if(!a||!["low_stock","zero_stock","negative_stock"].includes(a))throw new Error("Alert type must be one of: low_stock, zero_stock, negative_stock");switch(a){case"negative_stock":return"critical";case"zero_stock":return r>=100?"critical":r>=10?"high":"medium";case"low_stock":{if(r===0)return"high";const i=t/r*100;return i<=10?"high":i<=25?"medium":"low"}default:throw new Error(`Unsupported alert type: ${a}`)}}async resolveInventoryAlert(t,r){if(!t||typeof t!="string")throw new Error("Alert ID is required and must be a valid string");if(!r||typeof r!="string")throw new Error("Acknowledged by is required and must be a valid string");try{const a=await this.getDocument(this.INVENTORY_ALERTS_COLLECTION,t);if(!a)throw new Error(`Alert with ID ${t} not found`);if(!a.isActive)throw new Error(`Alert with ID ${t} is already resolved`);const i=Timestamp.now(),c={isActive:!1,acknowledgedBy:r,acknowledgedAt:i,resolvedAt:i};await this.updateDocument(this.INVENTORY_ALERTS_COLLECTION,t,c);const l={...a,...c,id:t};return console.info("Inventory alert resolved successfully:",{alertId:t,categoryGroupId:a.categoryGroupId,alertType:a.alertType,acknowledgedBy:r,resolvedAt:i}),l}catch(a){const i=a instanceof Error?a.message:"Unknown error during alert resolution";throw new Error(`Failed to resolve inventory alert: ${i}`)}}async getInventoryAlerts(){try{return await this.getDocuments(this.INVENTORY_ALERTS_COLLECTION)}catch(t){const r=t instanceof Error?t.message:"Unknown error fetching inventory alerts";throw new Error(`Failed to fetch inventory alerts: ${r}`)}}async updateInventoryAlert(t,r){try{await this.updateDocument(this.INVENTORY_ALERTS_COLLECTION,t,r)}catch(a){const i=a instanceof Error?a.message:"Unknown error updating inventory alert";throw new Error(`Failed to update inventory alert: ${i}`)}}async getInventoryAlert(t){try{return await this.getDocument(this.INVENTORY_ALERTS_COLLECTION,t)}catch(r){const a=r instanceof Error?r.message:"Unknown error fetching inventory alert";throw new Error(`Failed to fetch inventory alert: ${a}`)}}destroy(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=void 0)}}new AlertingService;const initialState$1={inventoryLevels:[],filteredInventoryLevels:[],inventoryMovements:[],filteredInventoryMovements:[],inventoryAlerts:[],activeInventoryAlerts:[],loading:{inventoryLevels:!1,inventoryMovements:!1,inventoryAlerts:!1,deduction:!1,adjustment:!1,alertCreation:!1,alertAcknowledgment:!1,alertResolution:!1},error:{inventoryLevels:null,inventoryMovements:null,inventoryAlerts:null,deduction:null,adjustment:null,alertCreation:null,alertAcknowledgment:null,alertResolution:null},filters:{inventory:{},movements:{}},pagination:{inventoryLevels:{currentPage:1,pageSize:20,totalItems:0,hasNextPage:!1},inventoryMovements:{currentPage:1,pageSize:20,totalItems:0,hasNextPage:!1}},lastFetched:{inventoryLevels:null,inventoryMovements:null,inventoryAlerts:null},selectedInventoryLevel:null,selectedMovement:null,selectedAlert:null,lastDeductionResult:null,categoryDeduction:{isProcessing:!1,preview:null,categoriesWithDeduction:[],deductionConfigurationSummary:[],lastProcessedOrderItems:[]}},inventoryService=new InventoryService,inventoryOrderProcessor$1=new InventoryOrderProcessor,alertingService=new AlertingService,fetchInventoryLevels=createAsyncThunk("inventory/fetchInventoryLevels",async()=>await inventoryService.getInventoryLevels()),fetchInventoryMovements=createAsyncThunk("inventory/fetchInventoryMovements",async n=>await inventoryService.getInventoryMovements(n)),processInventoryDeductions=createAsyncThunk("inventory/processInventoryDeductions",async n=>await inventoryService.deductInventoryFromOrder(n)),adjustInventoryManually=createAsyncThunk("inventory/adjustInventoryManually",async n=>(await inventoryService.adjustInventoryManually(n),n)),fetchInventoryAlerts=createAsyncThunk("inventory/fetchInventoryAlerts",async()=>await alertingService.getInventoryAlerts()),createInventoryAlert=createAsyncThunk("inventory/createInventoryAlert",async n=>await alertingService.createInventoryAlert(n.categoryGroupId,n.alertType,n.currentLevel,n.thresholdLevel,n.unit,n.severity)),acknowledgeInventoryAlert=createAsyncThunk("inventory/acknowledgeInventoryAlert",async n=>{const e={acknowledgedBy:n.acknowledgedBy,acknowledgedAt:Timestamp.now()};await alertingService.updateInventoryAlert(n.alertId,e);const t=await alertingService.getInventoryAlert(n.alertId);if(!t)throw new Error("Failed to fetch updated alert");return t}),resolveInventoryAlert=createAsyncThunk("inventory/resolveInventoryAlert",async n=>await alertingService.resolveInventoryAlert(n.alertId,n.acknowledgedBy)),applyInventoryFilters=(n,e)=>!n||!Array.isArray(n)?[]:n.filter(t=>{if(e.categoryGroupIds&&e.categoryGroupIds.length>0&&!e.categoryGroupIds.includes(t.categoryGroupId))return!1;const r=[e.lowStock&&"low_stock",e.zeroStock&&"zero_stock",e.negativeStock&&"negative_stock",e.healthyStock&&"healthy"].filter(Boolean);if(r.length>0&&!r.includes(t.status)||e.inventoryType&&t.inventoryType!==e.inventoryType||e.unit&&t.inventoryUnit!==e.unit||e.minThreshold&&t.minimumThreshold<e.minThreshold||e.maxThreshold&&t.minimumThreshold>e.maxThreshold)return!1;if(e.searchTerm){const a=e.searchTerm.toLowerCase();if(!t.name.toLowerCase().includes(a))return!1}return!0}),applyMovementFilters=(n,e)=>n.filter(t=>!(e.categoryGroupId&&t.categoryGroupId!==e.categoryGroupId||e.movementType&&t.movementType!==e.movementType||e.platform&&t.platform!==e.platform||e.adjustedBy&&t.adjustedBy!==e.adjustedBy||e.transactionReference&&t.transactionReference!==e.transactionReference||e.orderReference&&t.orderReference!==e.orderReference||e.productSku&&t.productSku!==e.productSku||e.reason&&t.reason!==e.reason||e.startDate&&t.createdAt&&t.createdAt.toDate()<e.startDate||e.endDate&&t.createdAt&&t.createdAt.toDate()>e.endDate)),exportInventoryData=createAsyncThunk("inventory/exportInventoryData",async n=>await new InventoryService().exportInventoryData(n.includeMovements||!1,n.dateRange)),importInventoryData=createAsyncThunk("inventory/importInventoryData",async n=>await new InventoryService().importInventoryData(n.csvData,n.options||{})),processOrderWithCategoryDeduction=createAsyncThunk("inventory/processOrderWithCategoryDeduction",async n=>await inventoryOrderProcessor$1.processOrderWithCategoryDeduction(n.orderItems,n.orderReference)),previewCategoryDeductions=createAsyncThunk("inventory/previewCategoryDeductions",async n=>await inventoryOrderProcessor$1.previewCategoryDeductions(n)),fetchCategoriesWithDeduction=createAsyncThunk("inventory/fetchCategoriesWithDeduction",async()=>await inventoryOrderProcessor$1.getCategoriesWithDeductionEnabled()),checkAutomaticDeductionEnabled=createAsyncThunk("inventory/checkAutomaticDeductionEnabled",async n=>await inventoryOrderProcessor$1.isAutomaticDeductionEnabled(n)),fetchDeductionConfigurationSummary=createAsyncThunk("inventory/fetchDeductionConfigurationSummary",async()=>await inventoryOrderProcessor$1.getDeductionConfigurationSummary()),inventorySlice=createSlice({name:"inventory",initialState:initialState$1,reducers:{setInventoryFilters:(n,e)=>{n.filters.inventory={...n.filters.inventory,...e.payload},n.filteredInventoryLevels=applyInventoryFilters(n.inventoryLevels||[],n.filters.inventory)},clearInventoryFilters:n=>{n.filters.inventory={},n.filteredInventoryLevels=n.inventoryLevels||[]},setMovementFilters:(n,e)=>{n.filters.movements={...n.filters.movements,...e.payload},n.filteredInventoryMovements=applyMovementFilters(n.inventoryMovements,n.filters.movements)},clearMovementFilters:n=>{n.filters.movements={},n.filteredInventoryMovements=n.inventoryMovements},selectInventoryLevel:(n,e)=>{n.selectedInventoryLevel=e.payload},selectMovement:(n,e)=>{n.selectedMovement=e.payload},selectAlert:(n,e)=>{n.selectedAlert=e.payload},setInventoryLevelsPagination:(n,e)=>{n.pagination.inventoryLevels={...n.pagination.inventoryLevels,...e.payload}},setInventoryMovementsPagination:(n,e)=>{n.pagination.inventoryMovements={...n.pagination.inventoryMovements,...e.payload}},clearInventoryLevelsError:n=>{n.error.inventoryLevels=null},clearInventoryMovementsError:n=>{n.error.inventoryMovements=null},clearInventoryAlertsError:n=>{n.error.inventoryAlerts=null},clearDeductionError:n=>{n.error.deduction=null},clearAdjustmentError:n=>{n.error.adjustment=null},clearAlertCreationError:n=>{n.error.alertCreation=null},clearAlertAcknowledgmentError:n=>{n.error.alertAcknowledgment=null},clearAlertResolutionError:n=>{n.error.alertResolution=null},clearLastDeductionResult:n=>{n.lastDeductionResult=null},clearCategoryDeductionPreview:n=>{n.categoryDeduction.preview=null},clearCategoryDeductionState:n=>{n.categoryDeduction={isProcessing:!1,preview:null,categoriesWithDeduction:[],deductionConfigurationSummary:[],lastProcessedOrderItems:[]}},setCategoryDeductionPreview:(n,e)=>{n.categoryDeduction.preview=e.payload},updateLastProcessedOrderItems:(n,e)=>{n.categoryDeduction.lastProcessedOrderItems=e.payload}},extraReducers:n=>{n.addCase(fetchInventoryLevels.pending,e=>{e.loading.inventoryLevels=!0,e.error.inventoryLevels=null}).addCase(fetchInventoryLevels.fulfilled,(e,t)=>{e.loading.inventoryLevels=!1,e.inventoryLevels=t.payload,e.filteredInventoryLevels=applyInventoryFilters(t.payload,e.filters.inventory),e.lastFetched.inventoryLevels=Date.now()}).addCase(fetchInventoryLevels.rejected,(e,t)=>{e.loading.inventoryLevels=!1,e.error.inventoryLevels=t.error.message||"Failed to fetch inventory levels"}).addCase(fetchInventoryMovements.pending,e=>{e.loading.inventoryMovements=!0,e.error.inventoryMovements=null}).addCase(fetchInventoryMovements.fulfilled,(e,t)=>{e.loading.inventoryMovements=!1,e.inventoryMovements=t.payload,e.filteredInventoryMovements=applyMovementFilters(t.payload,e.filters.movements),e.lastFetched.inventoryMovements=Date.now()}).addCase(fetchInventoryMovements.rejected,(e,t)=>{e.loading.inventoryMovements=!1,e.error.inventoryMovements=t.error.message||"Failed to fetch inventory movements"}).addCase(processInventoryDeductions.pending,e=>{e.loading.deduction=!0,e.error.deduction=null,e.lastDeductionResult=null}).addCase(processInventoryDeductions.fulfilled,(e,t)=>{e.loading.deduction=!1,e.lastDeductionResult=t.payload,e.lastFetched.inventoryLevels=null}).addCase(processInventoryDeductions.rejected,(e,t)=>{e.loading.deduction=!1,e.error.deduction=t.error.message||"Failed to process inventory deductions"}).addCase(adjustInventoryManually.pending,e=>{e.loading.adjustment=!0,e.error.adjustment=null}).addCase(adjustInventoryManually.fulfilled,e=>{e.loading.adjustment=!1,e.lastFetched.inventoryLevels=null,e.lastFetched.inventoryMovements=null}).addCase(adjustInventoryManually.rejected,(e,t)=>{e.loading.adjustment=!1,e.error.adjustment=t.error.message||"Failed to adjust inventory manually"}).addCase(fetchInventoryAlerts.pending,e=>{e.loading.inventoryAlerts=!0,e.error.inventoryAlerts=null}).addCase(fetchInventoryAlerts.fulfilled,(e,t)=>{e.loading.inventoryAlerts=!1,e.inventoryAlerts=t.payload,e.activeInventoryAlerts=t.payload.filter(r=>r.isActive),e.lastFetched.inventoryAlerts=Date.now()}).addCase(fetchInventoryAlerts.rejected,(e,t)=>{e.loading.inventoryAlerts=!1,e.error.inventoryAlerts=t.error.message||"Failed to fetch inventory alerts"}).addCase(createInventoryAlert.pending,e=>{e.loading.alertCreation=!0,e.error.alertCreation=null}).addCase(createInventoryAlert.fulfilled,(e,t)=>{e.loading.alertCreation=!1,e.inventoryAlerts.push(t.payload),t.payload.isActive&&e.activeInventoryAlerts.push(t.payload)}).addCase(createInventoryAlert.rejected,(e,t)=>{e.loading.alertCreation=!1,e.error.alertCreation=t.error.message||"Failed to create inventory alert"}).addCase(acknowledgeInventoryAlert.pending,e=>{e.loading.alertAcknowledgment=!0,e.error.alertAcknowledgment=null}).addCase(acknowledgeInventoryAlert.fulfilled,(e,t)=>{e.loading.alertAcknowledgment=!1;const r=e.inventoryAlerts.findIndex(i=>i.id===t.payload.id);r!==-1&&(e.inventoryAlerts[r]=t.payload);const a=e.activeInventoryAlerts.findIndex(i=>i.id===t.payload.id);a!==-1&&(e.activeInventoryAlerts[a]=t.payload)}).addCase(acknowledgeInventoryAlert.rejected,(e,t)=>{e.loading.alertAcknowledgment=!1,e.error.alertAcknowledgment=t.error.message||"Failed to acknowledge inventory alert"}).addCase(resolveInventoryAlert.pending,e=>{e.loading.alertResolution=!0,e.error.alertResolution=null}).addCase(resolveInventoryAlert.fulfilled,(e,t)=>{e.loading.alertResolution=!1;const r=e.inventoryAlerts.findIndex(a=>a.id===t.payload.id);r!==-1&&(e.inventoryAlerts[r]=t.payload),t.payload.isActive||(e.activeInventoryAlerts=e.activeInventoryAlerts.filter(a=>a.id!==t.payload.id))}).addCase(resolveInventoryAlert.rejected,(e,t)=>{e.loading.alertResolution=!1,e.error.alertResolution=t.error.message||"Failed to resolve inventory alert"}).addCase(exportInventoryData.pending,e=>{e.loading.inventoryLevels=!0,e.error.inventoryLevels=null}).addCase(exportInventoryData.fulfilled,e=>{e.loading.inventoryLevels=!1}).addCase(exportInventoryData.rejected,(e,t)=>{e.loading.inventoryLevels=!1,e.error.inventoryLevels=t.error.message||"Failed to export inventory data"}).addCase(importInventoryData.pending,e=>{e.loading.adjustment=!0,e.error.adjustment=null}).addCase(importInventoryData.fulfilled,e=>{e.loading.adjustment=!1}).addCase(importInventoryData.rejected,(e,t)=>{e.loading.adjustment=!1,e.error.adjustment=t.error.message||"Failed to import inventory data"}).addCase(processOrderWithCategoryDeduction.pending,e=>{e.categoryDeduction.isProcessing=!0,e.error.deduction=null,e.lastDeductionResult=null}).addCase(processOrderWithCategoryDeduction.fulfilled,(e,t)=>{e.categoryDeduction.isProcessing=!1,e.categoryDeduction.lastProcessedOrderItems=t.payload.orderItems,e.lastDeductionResult=t.payload.inventoryResult,e.lastFetched.inventoryLevels=null,e.lastFetched.inventoryMovements=null}).addCase(processOrderWithCategoryDeduction.rejected,(e,t)=>{e.categoryDeduction.isProcessing=!1,e.error.deduction=t.error.message||"Failed to process order with category deduction"}).addCase(previewCategoryDeductions.pending,e=>{e.categoryDeduction.preview=null,e.error.deduction=null}).addCase(previewCategoryDeductions.fulfilled,(e,t)=>{e.categoryDeduction.preview=t.payload}).addCase(previewCategoryDeductions.rejected,(e,t)=>{e.error.deduction=t.error.message||"Failed to preview category deductions"}).addCase(fetchCategoriesWithDeduction.pending,e=>{e.error.deduction=null}).addCase(fetchCategoriesWithDeduction.fulfilled,(e,t)=>{e.categoryDeduction.categoriesWithDeduction=t.payload}).addCase(fetchCategoriesWithDeduction.rejected,(e,t)=>{e.error.deduction=t.error.message||"Failed to fetch categories with deduction"}).addCase(checkAutomaticDeductionEnabled.pending,e=>{e.error.deduction=null}).addCase(checkAutomaticDeductionEnabled.fulfilled,e=>{}).addCase(checkAutomaticDeductionEnabled.rejected,(e,t)=>{e.error.deduction=t.error.message||"Failed to check automatic deduction status"}).addCase(fetchDeductionConfigurationSummary.pending,e=>{e.error.deduction=null}).addCase(fetchDeductionConfigurationSummary.fulfilled,(e,t)=>{e.categoryDeduction.deductionConfigurationSummary=t.payload}).addCase(fetchDeductionConfigurationSummary.rejected,(e,t)=>{e.error.deduction=t.error.message||"Failed to fetch deduction configuration summary"})}}),{setInventoryFilters,clearInventoryFilters,setMovementFilters,clearMovementFilters,selectInventoryLevel,selectMovement,selectAlert,setInventoryLevelsPagination,setInventoryMovementsPagination,clearInventoryLevelsError,clearInventoryMovementsError,clearInventoryAlertsError,clearDeductionError,clearAdjustmentError,clearAlertCreationError,clearAlertAcknowledgmentError,clearAlertResolutionError,clearLastDeductionResult,clearCategoryDeductionPreview,clearCategoryDeductionState,setCategoryDeductionPreview,updateLastProcessedOrderItems}=inventorySlice.actions,selectInventoryLevels=n=>n.inventory.filteredInventoryLevels,selectInventoryAlerts=n=>n.inventory.inventoryAlerts,selectActiveInventoryAlerts=n=>n.inventory.activeInventoryAlerts,selectInventoryLoading=n=>n.inventory.loading,selectInventoryErrors=n=>n.inventory.error,selectInventoryFilters=n=>n.inventory.filters,inventoryReducer=inventorySlice.reducer,initialState={processing:!1,error:null,lastDeductionResult:null,currentPreview:null,previewLoading:!1,previewError:null,recentActivity:[],activityLoading:!1,activityError:null,alerts:[],alertsLoading:!1,alertsError:null,unreadAlertsCount:0,activeDeductions:{},totalDeductionsToday:0,totalQuantityDeductedToday:0,validationResults:{},validationLoading:!1},inventoryOrderProcessor=new InventoryOrderProcessor,processOrderDeductions=createAsyncThunk("inventoryDeduction/processOrderDeductions",async(n,{rejectWithValue:e})=>{try{return await inventoryOrderProcessor.processOrderWithCategoryDeduction(n)}catch(t){return e(t.message||"Failed to process order deductions")}}),previewOrderDeductions=createAsyncThunk("inventoryDeduction/previewOrderDeductions",async(n,{rejectWithValue:e})=>{try{return await inventoryOrderProcessor.previewCategoryDeductions(n)}catch(t){return e(t.message||"Failed to preview order deductions")}}),fetchRecentDeductionActivity=createAsyncThunk("inventoryDeduction/fetchRecentActivity",async({limit:n=50}={},{rejectWithValue:e})=>{try{return[].slice(0,n)}catch(t){return e(t.message||"Failed to fetch recent deduction activity")}}),fetchDeductionAlerts=createAsyncThunk("inventoryDeduction/fetchAlerts",async(n,{rejectWithValue:e})=>{try{return[]}catch(t){return e(t.message||"Failed to fetch deduction alerts")}}),validateCategoryDeductionConfig=createAsyncThunk("inventoryDeduction/validateConfig",async(n,{rejectWithValue:e})=>{try{const t={};return n.forEach(r=>{t[r]=!0}),t}catch(t){return e(t.message||"Failed to validate category deduction configuration")}}),inventoryDeductionSlice=createSlice({name:"inventoryDeduction",initialState,reducers:{clearError:n=>{n.error=null},clearPreviewError:n=>{n.previewError=null},clearActivityError:n=>{n.activityError=null},clearAlertsError:n=>{n.alertsError=null},clearCurrentPreview:n=>{n.currentPreview=null,n.previewError=null},addDeductionActivity:(n,e)=>{n.recentActivity.unshift(e.payload),n.recentActivity.length>100&&(n.recentActivity=n.recentActivity.slice(0,100));const t=new Date;new Date(e.payload.timestamp).toDateString()===t.toDateString()&&e.payload.status==="success"&&(n.totalDeductionsToday+=1,n.totalQuantityDeductedToday+=e.payload.quantityDeducted)},updateDeductionActivity:(n,e)=>{const t=n.recentActivity.findIndex(r=>r.id===e.payload.id);t!==-1&&(n.recentActivity[t]=e.payload)},startDeduction:(n,e)=>{e.payload.orderId&&(n.activeDeductions[e.payload.orderId]=e.payload)},completeDeduction:(n,e)=>{const{orderId:t,status:r,errorMessage:a}=e.payload,i=n.activeDeductions[t];if(i){i.status=r,a&&(i.errorMessage=a),n.recentActivity.unshift(i),delete n.activeDeductions[t];const c=new Date;new Date(i.timestamp).toDateString()===c.toDateString()&&r==="success"&&(n.totalDeductionsToday+=1,n.totalQuantityDeductedToday+=i.quantityDeducted)}},addAlert:(n,e)=>{n.alerts.unshift(e.payload),e.payload.dismissed||(n.unreadAlertsCount+=1)},dismissAlert:(n,e)=>{const t=n.alerts.findIndex(r=>r.id===e.payload);t!==-1&&!n.alerts[t].dismissed&&(n.alerts[t].dismissed=!0,n.unreadAlertsCount=Math.max(0,n.unreadAlertsCount-1))},dismissAllAlerts:n=>{n.alerts.forEach(e=>{e.dismissed=!0}),n.unreadAlertsCount=0},removeAlert:(n,e)=>{const t=n.alerts.findIndex(r=>r.id===e.payload);if(t!==-1){const r=!n.alerts[t].dismissed;n.alerts.splice(t,1),r&&(n.unreadAlertsCount=Math.max(0,n.unreadAlertsCount-1))}},resetDailyTotals:n=>{n.totalDeductionsToday=0,n.totalQuantityDeductedToday=0},updateValidationResults:(n,e)=>{n.validationResults={...n.validationResults,...e.payload}},clearValidationResults:n=>{n.validationResults={}}},extraReducers:n=>{n.addCase(processOrderDeductions.pending,e=>{e.processing=!0,e.error=null}),n.addCase(processOrderDeductions.fulfilled,(e,t)=>{e.processing=!1,e.lastDeductionResult=t.payload.inventoryResult,t.payload.orderItems.forEach(a=>{if(a.SKU&&a.quantity){const i={id:`${Date.now()}-${a.SKU}`,timestamp:new Date,orderId:a.orderId,platform:a.type,categoryId:a.categoryId||"",categoryName:a.category||"",productName:a.name,productSku:a.SKU,quantityDeducted:parseInt(a.quantity),unit:"pcs",status:"success"};e.recentActivity.unshift(i)}});const r=t.payload.orderItems.filter(a=>a.SKU&&a.quantity);e.totalDeductionsToday+=r.length,e.totalQuantityDeductedToday+=r.reduce((a,i)=>a+parseInt(i.quantity||"0"),0)}),n.addCase(processOrderDeductions.rejected,(e,t)=>{e.processing=!1,e.error=t.payload}),n.addCase(previewOrderDeductions.pending,e=>{e.previewLoading=!0,e.previewError=null}),n.addCase(previewOrderDeductions.fulfilled,(e,t)=>{e.previewLoading=!1,e.currentPreview=t.payload}),n.addCase(previewOrderDeductions.rejected,(e,t)=>{e.previewLoading=!1,e.previewError=t.payload}),n.addCase(fetchRecentDeductionActivity.pending,e=>{e.activityLoading=!0,e.activityError=null}),n.addCase(fetchRecentDeductionActivity.fulfilled,(e,t)=>{e.activityLoading=!1,e.recentActivity=t.payload}),n.addCase(fetchRecentDeductionActivity.rejected,(e,t)=>{e.activityLoading=!1,e.activityError=t.payload}),n.addCase(fetchDeductionAlerts.pending,e=>{e.alertsLoading=!0,e.alertsError=null}),n.addCase(fetchDeductionAlerts.fulfilled,(e,t)=>{e.alertsLoading=!1,e.alerts=t.payload,e.unreadAlertsCount=t.payload.filter(r=>!r.dismissed).length}),n.addCase(fetchDeductionAlerts.rejected,(e,t)=>{e.alertsLoading=!1,e.alertsError=t.payload}),n.addCase(validateCategoryDeductionConfig.pending,e=>{e.validationLoading=!0}),n.addCase(validateCategoryDeductionConfig.fulfilled,(e,t)=>{e.validationLoading=!1,e.validationResults={...e.validationResults,...t.payload}}),n.addCase(validateCategoryDeductionConfig.rejected,e=>{e.validationLoading=!1})}}),{clearError,clearPreviewError,clearActivityError,clearAlertsError,clearCurrentPreview,addDeductionActivity,updateDeductionActivity,startDeduction,completeDeduction,addAlert,dismissAlert,dismissAllAlerts,removeAlert,resetDailyTotals,updateValidationResults,clearValidationResults}=inventoryDeductionSlice.actions,inventoryDeductionReducer=inventoryDeductionSlice.reducer,inventorySyncMiddleware=createListenerMiddleware();inventorySyncMiddleware.startListening({matcher:isAnyOf(fetchInventoryLevels.fulfilled,adjustInventoryManually.fulfilled,processInventoryDeductions.fulfilled),effect:async(n,e)=>{const t=e.dispatch;try{const r=n.payload;r&&Array.isArray(r)&&(t(updateInventoryLevelsMapping(r)),t(updateCategoryInventoryLevels(r)),console.log("Inventory levels synchronized across slices"))}catch(r){console.error("Failed to synchronize inventory levels:",r)}}});inventorySyncMiddleware.startListening({actionCreator:fetchProductInventoryLevels.fulfilled,effect:async(n,e)=>{const t=e.dispatch;try{t(updateCategoryInventoryLevels(n.payload)),console.log("Product inventory levels synchronized with categories")}catch(r){console.error("Failed to synchronize product inventory levels:",r)}}});inventorySyncMiddleware.startListening({actionCreator:fetchCategoryInventoryLevels.fulfilled,effect:async(n,e)=>{const t=e.dispatch;try{t(updateInventoryLevelsMapping(n.payload)),console.log("Category inventory levels synchronized with products")}catch(r){console.error("Failed to synchronize category inventory levels:",r)}}});inventorySyncMiddleware.startListening({actionCreator:saveTransactionsWithInventoryDeduction.fulfilled,effect:async(n,e)=>{var r;const t=e.dispatch;try{await t(syncTransactionInventoryImpacts()).unwrap(),(r=n.payload)!=null&&r.inventoryDeductionResults&&Object.keys(n.payload.inventoryDeductionResults).length>0&&setTimeout(async()=>{try{const a=await t(fetchInventoryLevels()).unwrap();t(updateInventoryLevelsMapping(a)),t(updateCategoryInventoryLevels(a))}catch(a){console.error("Failed to refresh inventory after transaction:",a)}},100),console.log("Transaction inventory impacts synchronized")}catch(a){console.error("Failed to synchronize transaction inventory impacts:",a)}}});inventorySyncMiddleware.startListening({actionCreator:updateInventoryMovements,effect:async(n,e)=>{var a;const t=e.dispatch,r=e.getState();try{n.payload.some(l=>{var s;const h=(s=l.createdAt)==null?void 0:s.toDate(),o=new Date(Date.now()-5*60*1e3);return h&&h>o})&&!((a=r.inventory)!=null&&a.loading.inventoryLevels)&&setTimeout(async()=>{try{const l=await t(fetchInventoryLevels()).unwrap();t(updateInventoryLevelsMapping(l)),t(updateCategoryInventoryLevels(l)),console.log("Inventory levels refreshed due to recent movements")}catch(l){console.error("Failed to refresh inventory after movements:",l)}},200)}catch(i){console.error("Failed to process inventory movements update:",i)}}});inventorySyncMiddleware.startListening({predicate:(n,e,t)=>{var i,c;const r=e,a=t;return((i=r.auth)==null?void 0:i.isAuthenticated)&&!((c=a.auth)!=null&&c.isAuthenticated)},effect:async(n,e)=>{const t=e.dispatch;try{console.log("Starting inventory synchronization on authentication...");const r=await t(fetchInventoryLevels()).unwrap();t(updateInventoryLevelsMapping(r)),t(updateCategoryInventoryLevels(r)),await t(syncTransactionInventoryImpacts()).unwrap(),console.log("Initial inventory synchronization completed")}catch(r){console.error("Failed to perform initial inventory synchronization:",r)}}});let syncInterval=null,lastSyncTime=0;const MIN_SYNC_INTERVAL=3e4;inventorySyncMiddleware.startListening({predicate:(n,e)=>{var r;return((r=e.auth)==null?void 0:r.isAuthenticated)||!1},effect:async(n,e)=>{syncInterval&&clearInterval(syncInterval),syncInterval=setInterval(async()=>{var i,c;const t=e.dispatch,r=e.getState(),a=Date.now();if((i=r.auth)!=null&&i.isAuthenticated&&!((c=r.inventory)!=null&&c.loading.inventoryLevels)&&a-lastSyncTime>MIN_SYNC_INTERVAL)try{console.log("Performing periodic inventory synchronization..."),lastSyncTime=a;const l=await t(fetchInventoryLevels()).unwrap();t(updateInventoryLevelsMapping(l)),t(updateCategoryInventoryLevels(l)),console.log("Periodic inventory synchronization completed")}catch(l){console.error("Failed to perform periodic inventory synchronization:",l)}},5*60*1e3)}});inventorySyncMiddleware.startListening({predicate:(n,e,t)=>{var i,c;const r=e,a=t;return!((i=r.auth)!=null&&i.isAuthenticated)&&((c=a.auth)==null?void 0:c.isAuthenticated)},effect:()=>{syncInterval&&(clearInterval(syncInterval),syncInterval=null,console.log("Inventory synchronization interval cleared"))}});const useAppDispatch=()=>useDispatch(),useAppSelector=useSelector,persistConfig={key:"root",version:1,storage:storage$1,whitelist:["inventory"],blacklist:["auth","pdfMerger","products","orders","transactions","orderHistory","orderAnalytics","allOrdersForAnalytics","categoryGroups","inventoryDeduction"]},rootReducer=combineReducers({products:productsReducer,orders:ordersReducer,transactions:transactionsReducer,auth:authReducer,pdfMerger:pdfMergerReducer,orderHistory:orderHistoryReducer,categories:categoriesReducer,categoryGroups:categoryGroupsReducer,orderAnalytics:orderAnalyticsReducer,allOrdersForAnalytics:allOrdersForAnalyticsReducer,inventory:inventoryReducer,inventoryDeduction:inventoryDeductionReducer}),persistedReducer=persistReducer(persistConfig,rootReducer),store=configureStore({reducer:persistedReducer,middleware:n=>n({serializableCheck:!1}).prepend(inventorySyncMiddleware.middleware)}),persistor=persistStore(store),getDesignTokens=n=>({palette:{mode:n,primary:{main:n==="light"?"#1565c0":"#90caf9",light:n==="light"?"#64b5f6":"#bbdefb",dark:n==="light"?"#0d47a1":"#42a5f5"},secondary:{main:n==="light"?"#2e7d32":"#81c784",light:n==="light"?"#4caf50":"#a5d6a7",dark:n==="light"?"#1b5e20":"#66bb6a"},error:{main:"#c62828",light:n==="light"?"#ef5350":"#e57373",dark:"#b71c1c"},warning:{main:"#e65100",light:n==="light"?"#ff9800":"#ffb74d",dark:"#bf360c"},info:{main:"#01579b",light:n==="light"?"#03a9f4":"#4fc3f7",dark:"#003c71"},success:{main:"#2e7d32",light:n==="light"?"#4caf50":"#81c784",dark:"#1b5e20"},background:{default:n==="light"?"#f8f9fa":"#121212",paper:n==="light"?"#ffffff":"#1e1e1e"},text:{primary:n==="light"?"#2c3e50":"#ecf0f1",secondary:n==="light"?"rgba(44, 62, 80, 0.7)":"rgba(236, 240, 241, 0.7)"}},shape:{borderRadius:8},typography:{fontFamily:"'Roboto', 'Helvetica', 'Arial', sans-serif",h6:{fontWeight:500},subtitle1:{fontWeight:400,letterSpacing:.5}},components:{MuiAppBar:{styleOverrides:{root:{backgroundColor:n==="dark"?"#1e1e1e":"#1565c0",boxShadow:n==="dark"?"0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24)":"0 2px 4px rgba(21,101,192,0.2)"}}},MuiButton:{styleOverrides:{root:{textTransform:"none",borderRadius:8,padding:"8px 16px",fontWeight:500},containedPrimary:{"&:hover":{boxShadow:"0 4px 8px rgba(21,101,192,0.2)"}},containedSecondary:{"&:hover":{boxShadow:"0 4px 8px rgba(46,125,50,0.2)"}},containedError:{"&:hover":{boxShadow:"0 4px 8px rgba(211,47,47,0.2)"}},containedWarning:{"&:hover":{boxShadow:"0 4px 8px rgba(237,108,2,0.2)"}}}},MuiPaper:{styleOverrides:{root:{borderRadius:8,boxShadow:n==="dark"?"0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24)":"0 2px 4px rgba(0,0,0,0.05)",transition:"box-shadow 0.2s ease-in-out","&:hover":{boxShadow:n==="dark"?"0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23)":"0 3px 6px rgba(0,0,0,0.1)"}}}},MuiCard:{styleOverrides:{root:{borderRadius:8,transition:"transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out","&:hover":{transform:"translateY(-2px)",boxShadow:n==="dark"?"0 4px 6px rgba(0,0,0,0.15)":"0 4px 6px rgba(0,0,0,0.08)"}}}},MuiChip:{styleOverrides:{root:{fontWeight:500},colorError:{backgroundColor:"#c62828",color:"#ffffff",fontWeight:600,"&:hover":{backgroundColor:"#c62828",filter:"brightness(0.9)"},"& .MuiChip-deleteIcon":{color:"#ffffff"}},colorWarning:{backgroundColor:"#e65100",color:"#ffffff",fontWeight:600,"&:hover":{backgroundColor:"#e65100",filter:"brightness(0.9)"},"& .MuiChip-deleteIcon":{color:"#ffffff"}},colorSuccess:{backgroundColor:"#2e7d32",color:"#ffffff",fontWeight:600,"&:hover":{backgroundColor:"#2e7d32",filter:"brightness(0.9)"},"& .MuiChip-deleteIcon":{color:"#ffffff"}},colorInfo:{backgroundColor:"#01579b",color:"#ffffff",fontWeight:600,"&:hover":{backgroundColor:"#01579b",filter:"brightness(0.9)"},"& .MuiChip-deleteIcon":{color:"#ffffff"}}}},MuiContainer:{styleOverrides:{root:{paddingTop:"24px",paddingBottom:"24px"}}},MuiAccordion:{styleOverrides:{root:{"&:before":{display:"none"},borderRadius:8,marginBottom:16,boxShadow:n==="dark"?"0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24)":"0 2px 4px rgba(0,0,0,0.05)"}}},MuiTable:{styleOverrides:{root:{"& .MuiTableRow-root:hover":{backgroundColor:n==="dark"?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.02)"}}}},MuiTableCell:{styleOverrides:{head:{fontWeight:600,backgroundColor:n==="dark"?"rgba(255,255,255,0.05)":"rgba(21,101,192,0.05)"}}},MuiAlert:{styleOverrides:{root:{borderRadius:8,fontWeight:500},standardWarning:{backgroundColor:"#e65100",color:"#ffffff",border:"2px solid #bf360c","& .MuiAlert-icon":{color:"#ffffff"}},standardError:{backgroundColor:"#b71c1c",color:"#ffffff",border:"2px solid #7f0000","& .MuiAlert-icon":{color:"#ffffff"}},standardInfo:{backgroundColor:"#01579b",color:"#ffffff",border:"2px solid #003c71","& .MuiAlert-icon":{color:"#ffffff"}},standardSuccess:{backgroundColor:"#2e7d32",color:"#ffffff",border:"2px solid #1b5e20","& .MuiAlert-icon":{color:"#ffffff"}}}}}}),ProtectedRoute=({children:n})=>{const e=useAppSelector(selectIsAuthenticated),t=useAppSelector(selectAuthStateLoaded),r=useLocation();return t?e?jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:n}):jsxRuntimeExports.jsx(Navigate,{to:"/login",state:{from:r},replace:!0}):jsxRuntimeExports.jsx(Box,{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",children:jsxRuntimeExports.jsx(CircularProgress,{})})};class ProductNavigationService{generateProductUrl(e){const{metadata:t}=e;return t.amazonSerialNumber&&t.amazonSerialNumber.trim()!==""?`https://www.amazon.in/sacred/dp/${t.amazonSerialNumber}`:t.flipkartSerialNumber&&t.flipkartSerialNumber.trim()!==""?`https://www.flipkart.com/product/p/itme?pid=${t.flipkartSerialNumber}`:null}openExternalUrl(e){if(!e||typeof e!="string")throw new Error("Invalid URL provided");if(!this.isValidMarketplaceUrl(e))throw new Error("Invalid marketplace URL format");try{const t=window.open(e,"_blank","noopener,noreferrer");if(t){t.focus();return}else throw new Error("Failed to open product page in new tab. Please check your browser popup settings and allow popups for this site.")}catch{throw new Error("Failed to open product page in new tab. Please check your browser popup settings.")}}async navigateToProduct(e){if(!e)throw new Error("Product is required for navigation");const t=this.generateProductUrl(e);if(!t)throw new Error("Product found but no marketplace listing available");try{this.openExternalUrl(t)}catch(r){throw new Error(`Failed to navigate to product listing: ${r instanceof Error?r.message:"Unknown error"}`)}}getProductPlatform(e){const{metadata:t}=e;return t.amazonSerialNumber&&t.amazonSerialNumber.trim()!==""?"amazon":t.flipkartSerialNumber&&t.flipkartSerialNumber.trim()!==""?"flipkart":"unknown"}hasMarketplaceListing(e){const{metadata:t}=e;return!!(t.amazonSerialNumber&&t.amazonSerialNumber.trim()!==""||t.flipkartSerialNumber&&t.flipkartSerialNumber.trim()!=="")}isValidMarketplaceUrl(e){try{const r=new URL(e).hostname.toLowerCase();return r==="www.amazon.in"||r==="amazon.in"?e.includes("/sacred/dp/"):r==="www.flipkart.com"||r==="flipkart.com"?e.includes("/product/p/itme?pid="):!1}catch{return!1}}}const getFeedbackIcon=n=>{switch(n){case"scanning":return jsxRuntimeExports.jsx(CircularProgress,{size:20});case"success":return jsxRuntimeExports.jsx(CheckCircle,{});case"error":return jsxRuntimeExports.jsx(Error$1,{});case"throttled":case"duplicate":return jsxRuntimeExports.jsx(Warning,{});case"idle":default:return jsxRuntimeExports.jsx(ScannerIcon,{})}},ScanFeedback=({feedback:n,visible:e,asSnackbar:t=!1,snackbarPosition:r={vertical:"top",horizontal:"center"},onHide:a,sx:i={}})=>{const{state:c,message:l,severity:h}=n;if(c==="idle"&&!e)return null;const o=jsxRuntimeExports.jsx(Alert,{severity:h,icon:getFeedbackIcon(c),action:a&&jsxRuntimeExports.jsx(IconButton,{"aria-label":"close",color:"inherit",size:"small",onClick:a,children:jsxRuntimeExports.jsx(CloseIcon,{fontSize:"inherit"})}),sx:{"& .MuiAlert-message":{display:"flex",alignItems:"center",fontWeight:500},...i},children:l});return t?jsxRuntimeExports.jsx(Snackbar,{open:e,autoHideDuration:n.autoHide?n.duration:null,onClose:a,anchorOrigin:r,TransitionComponent:Fade,children:jsxRuntimeExports.jsx(Box,{children:o})}):jsxRuntimeExports.jsx(Fade,{in:e,timeout:300,children:jsxRuntimeExports.jsx(Box,{sx:{width:"100%",...i},children:o})})},DEFAULT_MESSAGES={idle:"",scanning:"Scanning...",success:"Barcode scanned successfully!",error:"Failed to scan barcode",throttled:"Please wait before scanning again",duplicate:"Barcode already scanned"},useScanFeedback=(n={})=>{const{defaultDuration:e=2e3,autoHide:t=!0}=n,[r,a]=reactExports.useState({state:"idle",message:"",duration:e,autoHide:t,severity:"info"}),[i,c]=reactExports.useState(!1),l=reactExports.useRef(null),h=reactExports.useCallback(()=>{l.current&&(clearTimeout(l.current),l.current=null)},[]),o=reactExports.useCallback((b,_,w,m)=>{h();const S=m??e,C=w??DEFAULT_MESSAGES[b];a({state:b,message:C,duration:S,autoHide:t,severity:_}),c(!0),t&&S>0&&(l.current=setTimeout(()=>{c(!1),setTimeout(()=>{a(R=>({...R,state:"idle",message:""}))},300)},S))},[e,t,h]),s=reactExports.useCallback((b,_)=>{o("success","success",b,_)},[o]),f=reactExports.useCallback((b,_)=>{o("error","error",b,_)},[o]),u=reactExports.useCallback((b,_)=>{o("throttled","warning",b,_)},[o]),p=reactExports.useCallback((b,_)=>{o("scanning","info",b,_)},[o]),v=reactExports.useCallback((b,_)=>{o("throttled","warning",b,_)},[o]),g=reactExports.useCallback((b,_)=>{o("duplicate","warning",b,_)},[o]),A=reactExports.useCallback(()=>{h(),c(!1),setTimeout(()=>{a(b=>({...b,state:"idle",message:""}))},300)},[h]),T=reactExports.useCallback(()=>{h(),a({state:"idle",message:"",duration:e,autoHide:t,severity:"info"}),c(!1)},[h,e,t]);return reactExports.useEffect(()=>()=>{h()},[h]),{feedback:r,isVisible:i,showSuccess:s,showError:f,showWarning:u,showInfo:p,showThrottled:v,showDuplicate:g,hideFeedback:A,resetToIdle:T}},ProductIdentificationScanner=reactExports.lazy(()=>__vitePreload(()=>import("./index-DH0QK90Q.js"),__vite__mapDeps([2,3,1,4,5,6,7,0])).then(n=>({default:n.ProductIdentificationScanner}))),BarcodeScannerButton=({className:n,disabled:e=!1,onScanSuccess:t,onScanError:r})=>{const[a,i]=reactExports.useState(!1),[c,l]=reactExports.useState(!1),[h,o]=reactExports.useState(""),[s,f]=reactExports.useState(!1),[u,p]=reactExports.useState(""),[v,g]=reactExports.useState("error"),[A,T]=reactExports.useState(!1),b=useTheme(),_=useMediaQuery(b.breakpoints.down("md")),w=useMediaQuery(b.breakpoints.down("sm")),m=useAppDispatch(),S=useAppSelector(E=>E.products.items),C=useAppSelector(E=>E.products.loading),x=reactExports.useMemo(()=>new BarcodeService,[]),R=reactExports.useMemo(()=>new ProductNavigationService,[]),M=reactExports.useRef(0),F=2e3,H=reactExports.useMemo(()=>({defaultDuration:3e3,autoHide:!0}),[]),{feedback:V,isVisible:X,showSuccess:K,showError:q,showInfo:U,hideFeedback:B}=useScanFeedback(H),N=reactExports.useRef(null),Q=reactExports.useCallback((E,P="error")=>{p(E),g(P),f(!0)},[]),ce=reactExports.useCallback(()=>{f(!1)},[]),pe=reactExports.useCallback(E=>{N.current&&clearTimeout(N.current),o(E),N.current=setTimeout(()=>{o(""),N.current=null},1e3)},[]),Re=reactExports.useCallback(()=>{const E=Date.now(),P=E-M.current;if(P<F){const k=Math.ceil((F-P)/1e3);return Q(`Please wait ${k} seconds before scanning again`,"warning"),!0}return M.current=E,!1},[Q,F]);reactExports.useEffect(()=>()=>{N.current&&clearTimeout(N.current)},[]);const Y=reactExports.useCallback(async E=>{if(!A&&!Re()){if(!E.success||!E.barcodeId){q("Invalid scan result - please try again"),Q("Invalid scan result - please try again","error"),r==null||r("Invalid scan result");return}l(!0),T(!0),U("Looking up product..."),pe("Looking up product information");try{let P=null;if(P=S.find(j=>{var z,Z,te;return j.sku===E.barcodeId||j.sku.toLowerCase()===((z=E.barcodeId)==null?void 0:z.toLowerCase())||((Z=j.metadata)==null?void 0:Z.amazonSerialNumber)===E.barcodeId||((te=j.metadata)==null?void 0:te.flipkartSerialNumber)===E.barcodeId})||null,!P){U("Checking order history..."),pe("Product not found in catalog, checking order history");try{const j=await x.lookupBarcodeForProductIdentification(E.barcodeId);j.success&&j.sku&&(P=S.find(z=>z.sku===j.sku)||null)}catch{}}if(!P){const j=`Product not found for barcode: ${E.barcodeId}`;q(j,4e3),Q(j,"error"),pe("Product not found. Please try scanning a different barcode."),r==null||r("Product not found for this barcode");return}if(!R.hasMarketplaceListing(P)){const j=`Product "${P.name}" found but no marketplace listing available`;q(j,4e3),Q(j,"warning"),pe(`Product ${P.name} found, but no marketplace listing is available`),r==null||r("Product found but no marketplace listing available");return}U("Opening marketplace listing..."),pe(`Product ${P.name} found. Opening marketplace listing.`),await R.navigateToProduct(P);const k=R.getProductPlatform(P),L=`Successfully opened ${P.name} on ${k.charAt(0).toUpperCase()+k.slice(1)}`;K(L,2e3),Q(L,"success"),pe(`Successfully opened ${P.name} on ${k}`),i(!1),t==null||t(E)}catch(P){const k=P instanceof Error?P.message:"Failed to process barcode";q(`Navigation failed: ${k}`,4e3),Q(`Navigation failed: ${k}`,"error"),pe(`Navigation failed: ${k}`),r==null||r(k)}finally{l(!1),T(!1)}}},[R,x,t,r,K,q,U,pe,Re,S,Q,A]),O=reactExports.useCallback(E=>{console.error("Barcode scanning error:",E),q(E,4e3),pe(`Scanning error: ${E}`),r==null||r(E)},[r,q,pe]),D=reactExports.useCallback(()=>{!e&&!c&&(i(!0),pe("Barcode scanner opened. Position a barcode in front of your camera or enter it manually."),S.length===0&&!C&&m(fetchProducts({})))},[e,c,pe,S.length,C,m]),W=reactExports.useCallback(E=>{(E.key==="Enter"||E.key===" ")&&(E.preventDefault(),D()),E.key==="Escape"&&a&&(E.preventDefault(),i(!1),pe("Barcode scanner closed"))},[D,a]),G=reactExports.useCallback(()=>{i(!1),l(!1),T(!1),B(),pe("Barcode scanner closed")},[B,pe]);return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{role:"status","aria-live":"polite","aria-atomic":"true",style:{position:"absolute",left:"-10000px",width:"1px",height:"1px",overflow:"hidden"},children:h}),jsxRuntimeExports.jsxs(Box,{sx:{position:"relative"},children:[jsxRuntimeExports.jsx(Tooltip,{title:w?"":"Scan Product Barcode",arrow:!0,disableHoverListener:w,disableFocusListener:w,children:jsxRuntimeExports.jsx(IconButton,{color:"inherit",onClick:D,onKeyDown:W,disabled:e||c,className:n,"aria-label":c?"Processing barcode scan, please wait":"Scan product barcode to open marketplace listing","aria-describedby":X?"scanner-feedback":void 0,"aria-expanded":a,"aria-haspopup":"dialog",size:_?"medium":"large",sx:{minWidth:_?44:"auto",minHeight:_?44:"auto","&:focus-visible":{outline:`2px solid ${b.palette.primary.main}`,outlineOffset:"2px"},..._&&{"&:active":{transform:"scale(0.95)",transition:"transform 0.1s"}}},children:jsxRuntimeExports.jsx(ScannerIcon,{fontSize:_?"medium":"large"})})}),jsxRuntimeExports.jsx("div",{id:"scanner-feedback",children:jsxRuntimeExports.jsx(ScanFeedback,{feedback:V,visible:X,asSnackbar:_,snackbarPosition:_?{vertical:"top",horizontal:"center"}:void 0,onHide:B,sx:_?{}:{position:"absolute",top:"100%",right:0,mt:1,minWidth:w?250:300,maxWidth:w?300:400,zIndex:9999}})})]}),a&&jsxRuntimeExports.jsx(reactExports.Suspense,{fallback:jsxRuntimeExports.jsx(Box,{sx:{display:"flex",justifyContent:"center",alignItems:"center",position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:9999},children:jsxRuntimeExports.jsx(CircularProgress,{})}),children:jsxRuntimeExports.jsx(ProductIdentificationScanner,{open:a,onClose:G,onScanSuccess:Y,onScanError:O,throttleMs:F})}),jsxRuntimeExports.jsx(Snackbar,{open:s,autoHideDuration:4e3,onClose:ce,anchorOrigin:{vertical:"top",horizontal:"center"},children:jsxRuntimeExports.jsx(Alert,{onClose:ce,severity:v,variant:"filled",sx:{width:"100%"},children:u})})]})},DRAWER_WIDTH$1=250,StyledAppBar=styled(AppBar$1,{shouldForwardProp:n=>n!=="open"})(({theme:n,open:e})=>({transition:n.transitions.create(["margin","width"],{easing:n.transitions.easing.sharp,duration:n.transitions.duration.leavingScreen}),...e&&{width:`calc(100% - ${DRAWER_WIDTH$1}px)`,marginLeft:`${DRAWER_WIDTH$1}px`,transition:n.transitions.create(["margin","width"],{easing:n.transitions.easing.easeOut,duration:n.transitions.duration.enteringScreen})}})),getRouteTitle=n=>{switch(n){case"/":return"Dashboard";case"/transactions/":return"Transaction Analytics";case"/activeOrders/":return"Active Orders";case"/products/":return"Products";case"/order-analytics/":return"Order Analytics";case"/storage-management/":return"Storage Management";case"/inventory/":return"Inventory Management";default:return"Label Merger"}},AppBar=({toggleDrawer:n,toggleTheme:e,mode:t,open:r})=>{const a=useLocation(),i=useNavigate(),c=getRouteTitle(a.pathname),[l,h]=reactExports.useState(!1),o=new AuthService,s=useTheme(),f=useMediaQuery(s.breakpoints.down("md"));reactExports.useEffect(()=>{const p=o.onAuthStateChanged(v=>{h(!!v)});return()=>p()},[]);const u=async()=>{try{await o.signOut(),i("/login")}catch{}};return jsxRuntimeExports.jsx(StyledAppBar,{position:"fixed",open:r,children:jsxRuntimeExports.jsxs(Toolbar,{children:[jsxRuntimeExports.jsx(IconButton,{size:"large",edge:"start",color:"inherit","aria-label":"menu",onClick:n(!r),"data-testid":"menu-button",sx:{mr:2,...r&&{display:"none"}},children:jsxRuntimeExports.jsx(MenuIcon,{})}),jsxRuntimeExports.jsx(IconButton,{color:"inherit","aria-label":"close drawer",onClick:n(!1),sx:{mr:2,...!r&&{display:"none"}},children:jsxRuntimeExports.jsx(ChevronLeftIcon,{})}),jsxRuntimeExports.jsx(Typography,{variant:"h6",component:"div",sx:{flexGrow:1},children:c}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:f?1:2,flexWrap:"nowrap",overflow:"hidden"},children:[jsxRuntimeExports.jsx(Switch,{checked:t==="dark",onChange:e,inputProps:{"aria-label":"dark mode toggle"},"data-testid":"theme-toggle",size:f?"small":"medium"}),l&&jsxRuntimeExports.jsx(BarcodeScannerButton,{}),l&&jsxRuntimeExports.jsx(Hidden,{smDown:!0,implementation:"css",children:jsxRuntimeExports.jsx(Button,{color:"inherit",onClick:u,startIcon:jsxRuntimeExports.jsx(LogoutIcon,{}),size:f?"small":"medium",children:"Logout"})}),l&&jsxRuntimeExports.jsx(Hidden,{smUp:!0,implementation:"css",children:jsxRuntimeExports.jsx(IconButton,{color:"inherit",onClick:u,"aria-label":"logout",size:"small",sx:{minWidth:44,minHeight:44},children:jsxRuntimeExports.jsx(LogoutIcon,{})})})]})]})})},DRAWER_WIDTH={xs:240,sm:240,md:250},DrawerHeader=styled("div")(({theme:n})=>({display:"flex",alignItems:"center",padding:n.spacing(2,2),...n.mixins.toolbar,justifyContent:"space-between",backgroundColor:n.palette.primary.main,color:n.palette.primary.contrastText})),StyledListItemButton=styled(ListItemButton)(({theme:n})=>({margin:n.spacing(.5,0),borderRadius:n.shape.borderRadius,padding:n.spacing(1,1.5),"&:hover":{backgroundColor:alpha(n.palette.primary.main,.08)},"&.Mui-selected":{backgroundColor:alpha(n.palette.primary.main,.12),"&:hover":{backgroundColor:alpha(n.palette.primary.main,.16)}}})),StyledListItemIcon=styled(ListItemIcon)(({theme:n})=>({minWidth:36,color:n.palette.primary.main,marginRight:n.spacing(1)})),StyledListItemText=styled(ListItemText)({"& .MuiTypography-root":{fontWeight:500}}),Main=styled("main",{shouldForwardProp:n=>n!=="open"})(({theme:n,open:e})=>({flexGrow:1,transition:n.transitions.create(["margin","width"],{easing:n.transitions.easing.sharp,duration:n.transitions.duration.leavingScreen}),marginLeft:0,width:"100%",...e&&{[n.breakpoints.up("sm")]:{transition:n.transitions.create(["margin","width"],{easing:n.transitions.easing.easeOut,duration:n.transitions.duration.enteringScreen})}}})),DefaultContainer=({children:n,toggleTheme:e,mode:t})=>{const r=useTheme(),a=useMediaQuery(r.breakpoints.down("sm")),i=useLocation(),[c,l]=React.useState(!a),[h,o]=React.useState(!1),[s,f]=React.useState(!1),[u,p]=React.useState(!1),[v,g]=React.useState(!1);React.useEffect(()=>{l(!a)},[a]),React.useEffect(()=>{const w=i.pathname;o(w.includes("/home/")||w.includes("/activeOrders/")),f(w.includes("/products/")||w.includes("/uncategorized-products/")),p(w.includes("/categories/")||w.includes("/category-groups/")),g(w.includes("/storage-management/")||w.includes("/inventory/"))},[i.pathname]);const A=w=>()=>{l(w)},T=()=>{a&&l(!1)},b=w=>i.pathname===w,_=jsxRuntimeExports.jsxs(Box,{sx:{width:{xs:DRAWER_WIDTH.xs,sm:DRAWER_WIDTH.sm,md:DRAWER_WIDTH.md}},role:"presentation",children:[jsxRuntimeExports.jsxs(DrawerHeader,{children:[jsxRuntimeExports.jsx(Typography,{variant:"h6",noWrap:!0,component:"div",sx:{fontWeight:600,fontSize:{xs:"1rem",sm:"1.1rem",md:"1.25rem"}},children:"Sacred Sutra"}),jsxRuntimeExports.jsx(IconButton,{onClick:A(!1),sx:{color:"inherit","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"}},children:jsxRuntimeExports.jsx(ChevronLeftIcon,{})})]}),jsxRuntimeExports.jsx(Divider,{}),jsxRuntimeExports.jsxs(List,{sx:{px:.5,py:2},children:[jsxRuntimeExports.jsx(Link,{component:Link$1,to:"/","data-testid":"dashboard",style:{textDecoration:"none",color:"inherit"},onClick:T,children:jsxRuntimeExports.jsx(ListItem,{disablePadding:!0,children:jsxRuntimeExports.jsxs(StyledListItemButton,{selected:b("/"),children:[jsxRuntimeExports.jsx(StyledListItemIcon,{children:jsxRuntimeExports.jsx(DashboardIcon,{})}),jsxRuntimeExports.jsx(StyledListItemText,{primary:"Dashboard"})]})},"Dashboard")}),jsxRuntimeExports.jsx(ListItem,{disablePadding:!0,children:jsxRuntimeExports.jsxs(ListItemButton,{onClick:()=>o(!h),children:[jsxRuntimeExports.jsx(StyledListItemIcon,{children:jsxRuntimeExports.jsx(ShoppingCartIcon,{})}),jsxRuntimeExports.jsx(StyledListItemText,{primary:"Orders"}),h?jsxRuntimeExports.jsx(ExpandLessIcon,{}):jsxRuntimeExports.jsx(ExpandMoreIcon,{})]})}),jsxRuntimeExports.jsx(Collapse,{in:h,timeout:"auto",unmountOnExit:!0,children:jsxRuntimeExports.jsxs(List,{component:"div",disablePadding:!0,sx:{pl:1},children:[jsxRuntimeExports.jsx(Link,{component:Link$1,to:"/home/","data-testid":"merge-labels",style:{textDecoration:"none",color:"inherit"},onClick:T,children:jsxRuntimeExports.jsx(ListItem,{disablePadding:!0,children:jsxRuntimeExports.jsxs(StyledListItemButton,{selected:b("/home/"),children:[jsxRuntimeExports.jsx(StyledListItemIcon,{children:jsxRuntimeExports.jsx(LabelIcon,{})}),jsxRuntimeExports.jsx(StyledListItemText,{primary:"Merge Labels"})]})},"Merge Labels")}),jsxRuntimeExports.jsx(Link,{component:Link$1,to:"/activeOrders/","data-testid":"active-orders",style:{textDecoration:"none",color:"inherit"},onClick:T,children:jsxRuntimeExports.jsx(ListItem,{disablePadding:!0,children:jsxRuntimeExports.jsxs(StyledListItemButton,{selected:b("/activeOrders/"),children:[jsxRuntimeExports.jsx(StyledListItemIcon,{children:jsxRuntimeExports.jsx(ShoppingCartIcon,{})}),jsxRuntimeExports.jsx(StyledListItemText,{primary:"Active Orders"})]})},"Active Orders")})]})}),jsxRuntimeExports.jsx(ListItem,{disablePadding:!0,children:jsxRuntimeExports.jsxs(ListItemButton,{onClick:()=>f(!s),children:[jsxRuntimeExports.jsx(StyledListItemIcon,{children:jsxRuntimeExports.jsx(ShoppingCartIcon,{})}),jsxRuntimeExports.jsx(StyledListItemText,{primary:"Products"}),s?jsxRuntimeExports.jsx(ExpandLessIcon,{}):jsxRuntimeExports.jsx(ExpandMoreIcon,{})]})}),jsxRuntimeExports.jsx(Collapse,{in:s,timeout:"auto",unmountOnExit:!0,children:jsxRuntimeExports.jsxs(List,{component:"div",disablePadding:!0,sx:{pl:1},children:[jsxRuntimeExports.jsx(Link,{component:Link$1,to:"/products/","data-testid":"products",style:{textDecoration:"none",color:"inherit"},onClick:T,children:jsxRuntimeExports.jsx(ListItem,{disablePadding:!0,children:jsxRuntimeExports.jsxs(StyledListItemButton,{selected:b("/products/"),children:[jsxRuntimeExports.jsx(StyledListItemIcon,{children:jsxRuntimeExports.jsx(ShoppingCartIcon,{})}),jsxRuntimeExports.jsx(StyledListItemText,{primary:"All Products"})]})},"All Products")}),jsxRuntimeExports.jsx(Link,{component:Link$1,to:"/uncategorized-products/","data-testid":"uncategorized-products",style:{textDecoration:"none",color:"inherit"},onClick:T,children:jsxRuntimeExports.jsx(ListItem,{disablePadding:!0,children:jsxRuntimeExports.jsxs(StyledListItemButton,{selected:b("/uncategorized-products/"),children:[jsxRuntimeExports.jsx(StyledListItemIcon,{children:jsxRuntimeExports.jsx(Warning,{})}),jsxRuntimeExports.jsx(StyledListItemText,{primary:"Uncategorized Products"})]})},"Uncategorized Products")})]})}),jsxRuntimeExports.jsx(ListItem,{disablePadding:!0,children:jsxRuntimeExports.jsxs(ListItemButton,{onClick:()=>p(!u),children:[jsxRuntimeExports.jsx(StyledListItemIcon,{children:jsxRuntimeExports.jsx(CategoryIcon,{})}),jsxRuntimeExports.jsx(StyledListItemText,{primary:"Categories"}),u?jsxRuntimeExports.jsx(ExpandLessIcon,{}):jsxRuntimeExports.jsx(ExpandMoreIcon,{})]})}),jsxRuntimeExports.jsx(Collapse,{in:u,timeout:"auto",unmountOnExit:!0,children:jsxRuntimeExports.jsxs(List,{component:"div",disablePadding:!0,sx:{pl:1},children:[jsxRuntimeExports.jsx(Link,{component:Link$1,to:"/categories/","data-testid":"all-categories",style:{textDecoration:"none",color:"inherit"},onClick:T,children:jsxRuntimeExports.jsx(ListItem,{disablePadding:!0,children:jsxRuntimeExports.jsxs(StyledListItemButton,{selected:b("/categories/"),children:[jsxRuntimeExports.jsx(StyledListItemIcon,{children:jsxRuntimeExports.jsx(CategoryIcon,{})}),jsxRuntimeExports.jsx(StyledListItemText,{primary:"All Categories"})]})},"All Categories")}),jsxRuntimeExports.jsx(Link,{component:Link$1,to:"/category-groups/","data-testid":"category-groups",style:{textDecoration:"none",color:"inherit"},onClick:T,children:jsxRuntimeExports.jsx(ListItem,{disablePadding:!0,children:jsxRuntimeExports.jsxs(StyledListItemButton,{selected:b("/category-groups/"),children:[jsxRuntimeExports.jsx(StyledListItemIcon,{children:jsxRuntimeExports.jsx(GroupIcon,{})}),jsxRuntimeExports.jsx(StyledListItemText,{primary:"Category Groups"})]})},"Category Groups")})]})}),jsxRuntimeExports.jsx(ListItem,{disablePadding:!0,children:jsxRuntimeExports.jsxs(ListItemButton,{onClick:()=>g(!v),children:[jsxRuntimeExports.jsx(StyledListItemIcon,{children:jsxRuntimeExports.jsx(ManagementIcon,{})}),jsxRuntimeExports.jsx(StyledListItemText,{primary:"Management"}),v?jsxRuntimeExports.jsx(ExpandLessIcon,{}):jsxRuntimeExports.jsx(ExpandMoreIcon,{})]})}),jsxRuntimeExports.jsx(Collapse,{in:v,timeout:"auto",unmountOnExit:!0,children:jsxRuntimeExports.jsxs(List,{component:"div",disablePadding:!0,sx:{pl:1},children:[jsxRuntimeExports.jsx(Link,{component:Link$1,to:"/inventory/","data-testid":"inventory-management",style:{textDecoration:"none",color:"inherit"},onClick:T,children:jsxRuntimeExports.jsx(ListItem,{disablePadding:!0,children:jsxRuntimeExports.jsxs(StyledListItemButton,{selected:b("/inventory/"),children:[jsxRuntimeExports.jsx(StyledListItemIcon,{children:jsxRuntimeExports.jsx(ManagementIcon,{})}),jsxRuntimeExports.jsx(StyledListItemText,{primary:"Inventory Management"})]})},"Inventory Management")}),jsxRuntimeExports.jsx(Link,{component:Link$1,to:"/storage-management/","data-testid":"storage-management",style:{textDecoration:"none",color:"inherit"},onClick:T,children:jsxRuntimeExports.jsx(ListItem,{disablePadding:!0,children:jsxRuntimeExports.jsxs(StyledListItemButton,{selected:b("/storage-management/"),children:[jsxRuntimeExports.jsx(StyledListItemIcon,{children:jsxRuntimeExports.jsx(StorageIcon,{})}),jsxRuntimeExports.jsx(StyledListItemText,{primary:"Storage Management"})]})},"Storage Management")})]})}),jsxRuntimeExports.jsx(Link,{component:Link$1,to:"/transactions/","data-testid":"transactions",style:{textDecoration:"none",color:"inherit"},onClick:T,children:jsxRuntimeExports.jsx(ListItem,{disablePadding:!0,children:jsxRuntimeExports.jsxs(StyledListItemButton,{selected:b("/transactions/"),children:[jsxRuntimeExports.jsx(StyledListItemIcon,{children:jsxRuntimeExports.jsx(Analytics,{})}),jsxRuntimeExports.jsx(StyledListItemText,{primary:"Transaction Analytics"})]})},"Transaction Analytics")}),jsxRuntimeExports.jsx(Link,{component:Link$1,to:"/order-analytics/","data-testid":"order-analytics",style:{textDecoration:"none",color:"inherit"},onClick:T,children:jsxRuntimeExports.jsx(ListItem,{disablePadding:!0,children:jsxRuntimeExports.jsxs(StyledListItemButton,{selected:b("/order-analytics/"),children:[jsxRuntimeExports.jsx(StyledListItemIcon,{children:jsxRuntimeExports.jsx(Analytics,{})}),jsxRuntimeExports.jsx(StyledListItemText,{primary:"Order Analytics"})]})},"Order Analytics")})]})]});return jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",width:"100%"},children:[jsxRuntimeExports.jsx(AppBar,{toggleDrawer:A,toggleTheme:e,mode:t,open:c}),jsxRuntimeExports.jsx(Drawer,{sx:{width:c?{xs:DRAWER_WIDTH.xs,sm:DRAWER_WIDTH.sm,md:DRAWER_WIDTH.md}:0,flexShrink:0,"& .MuiDrawer-paper":{width:c?{xs:DRAWER_WIDTH.xs,sm:DRAWER_WIDTH.sm,md:DRAWER_WIDTH.md}:0,boxSizing:"border-box",borderRight:"none",boxShadow:"0 0 35px 0 rgba(154,161,171,.15)"},transition:"width 0.3s ease-in-out"},variant:"persistent",anchor:"left",open:c,children:_}),jsxRuntimeExports.jsx(Main,{open:c,children:jsxRuntimeExports.jsx(Container,{maxWidth:!1,sx:{maxWidth:"100%",mt:8,px:{xs:2,sm:3},transition:"padding 0.3s ease-in-out"},children:n})})]})},NotFound=()=>{const n=useNavigate();return jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:"100vh",textAlign:"center",p:2},children:[jsxRuntimeExports.jsx(ErrorOutline,{sx:{fontSize:80,color:"error.main",mb:2}}),jsxRuntimeExports.jsx(Typography,{variant:"h1",component:"h1",gutterBottom:!0,children:"404 - Not Found"}),jsxRuntimeExports.jsx(Typography,{variant:"h6",component:"p",sx:{mb:4},children:"The page you are looking for does not exist."}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",gap:2},children:[jsxRuntimeExports.jsx(Button,{variant:"contained",onClick:()=>n(-1),children:"Go Back"}),jsxRuntimeExports.jsx(Button,{variant:"outlined",component:Link$1,to:"/",children:"Go Home"})]})]})},DashboardPage=React.lazy(()=>__vitePreload(()=>import("./dashboard.page-BQ8NLI-w.js"),__vite__mapDeps([8,3,1,9,10,5,6,7,0])).then(n=>({default:n.DashboardPage}))),HomePage=React.lazy(()=>__vitePreload(()=>import("./home.page-BlOYehJ8.js"),__vite__mapDeps([11,3,1,12,6,13,14,5,7,0])).then(n=>({default:n.HomePage}))),TransactionAnalytics=React.lazy(()=>__vitePreload(()=>import("./transactionAnalytics.page-B630Xmtc.js"),__vite__mapDeps([15,3,1,16,9,7,5,6,0])).then(n=>({default:n.TransactionAnalytics}))),ProductsPage=React.lazy(()=>__vitePreload(()=>import("./products.page-DvfakXcm.js"),__vite__mapDeps([17,3,1,18,16,9,19,5,6,7,0])).then(n=>({default:n.default}))),ActiveOrders=React.lazy(()=>__vitePreload(()=>import("./todaysOrder.page-QPGII2lt.js"),__vite__mapDeps([20,3,1,16,19,9,4,12,6,13,14,5,7,0])).then(n=>({default:n.TodaysOrderPage}))),CategoriesPage=React.lazy(()=>__vitePreload(()=>import("./categories.page-B6yZrKD8.js"),__vite__mapDeps([21,3,1,16,5,6,7,0])).then(n=>({default:n.CategoriesPage}))),CategoryGroupsPage=React.lazy(()=>__vitePreload(()=>import("./categoryGroups.page-BlUKEHHr.js"),__vite__mapDeps([22,3,1,16,23,5,6,7,0])).then(n=>({default:n.default}))),OrderAnalytics=React.lazy(()=>__vitePreload(()=>import("./index-DVotOe97.js"),__vite__mapDeps([24,3,1,5,13,14,9,10,6,7,0])).then(n=>({default:n.default}))),UncategorizedProductsPage=React.lazy(()=>__vitePreload(()=>import("./uncategorized-products.page-DXBDwss6.js"),__vite__mapDeps([25,3,1,18,16,9,19,5,6,7,0])).then(n=>({default:n.default}))),StorageManagementPage=React.lazy(()=>__vitePreload(()=>import("./storage-management.page-Byecb2Q3.js"),__vite__mapDeps([26,3,1,12,6,5,7,0])).then(n=>({default:n.StorageManagementPage}))),HealthPage=React.lazy(()=>__vitePreload(()=>import("./health.page-CzQr08zB.js"),__vite__mapDeps([27,3,1])).then(n=>({default:n.default}))),MonitoringDashboard=React.lazy(()=>__vitePreload(()=>import("./monitoring-dashboard.page-CG1HYxfv.js"),__vite__mapDeps([28,3,1,14,5,6,7,0])).then(n=>({default:n.default}))),DeploymentStatusPage=React.lazy(()=>__vitePreload(()=>import("./deployment-status.page-DOWKIg0I.js"),__vite__mapDeps([29,3,1])).then(n=>({default:n.default}))),InventoryPage=React.lazy(()=>__vitePreload(()=>import("./InventoryDashboard-ClFtREmj.js"),__vite__mapDeps([30,3,1,16,23,13,14,5,6,7,0])).then(n=>({default:n.InventoryDashboard}))),ProtectedRoutes=({toggleTheme:n,mode:e})=>jsxRuntimeExports.jsx(DefaultContainer,{toggleTheme:n,mode:e,children:jsxRuntimeExports.jsxs(Routes,{children:[jsxRuntimeExports.jsx(Route,{path:"/",element:jsxRuntimeExports.jsx(DashboardPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/home/",element:jsxRuntimeExports.jsx(HomePage,{})}),jsxRuntimeExports.jsx(Route,{path:"/products/",element:jsxRuntimeExports.jsx(ProductsPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/transactions/",element:jsxRuntimeExports.jsx(TransactionAnalytics,{})}),jsxRuntimeExports.jsx(Route,{path:"/activeOrders/",element:jsxRuntimeExports.jsx(ActiveOrders,{})}),jsxRuntimeExports.jsx(Route,{path:"/categories/",element:jsxRuntimeExports.jsx(CategoriesPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/category-groups/",element:jsxRuntimeExports.jsx(CategoryGroupsPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/order-analytics/",element:jsxRuntimeExports.jsx(OrderAnalytics,{})}),jsxRuntimeExports.jsx(Route,{path:"/uncategorized-products/",element:jsxRuntimeExports.jsx(UncategorizedProductsPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/storage-management/",element:jsxRuntimeExports.jsx(StorageManagementPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/inventory/*",element:jsxRuntimeExports.jsx(InventoryPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/health/",element:jsxRuntimeExports.jsx(HealthPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/monitoring/",element:jsxRuntimeExports.jsx(MonitoringDashboard,{})}),jsxRuntimeExports.jsx(Route,{path:"/deployment-status/",element:jsxRuntimeExports.jsx(DeploymentStatusPage,{})}),jsxRuntimeExports.jsx(Route,{path:"*",element:jsxRuntimeExports.jsx(NotFound,{})})]})}),LoginPage=()=>{const[n,e]=reactExports.useState(""),[t,r]=reactExports.useState(""),[a,i]=reactExports.useState(!1),[c,l]=reactExports.useState(!1),[h,o]=reactExports.useState(!1),s=useNavigate(),f=useAppDispatch(),{loading:u,error:p}=useAppSelector(g=>g.auth),v=async g=>{g.preventDefault();try{c?(await f(resetPassword(n)).unwrap(),l(!1)):(await f(login({email:n,password:t,rememberMe:a})).unwrap(),s("/"))}catch{}};return jsxRuntimeExports.jsx(Box,{sx:{minHeight:{xs:"calc(100vh - 60px)",sm:"100vh"},display:"flex",width:"100%",alignItems:"center",justifyContent:"center",py:{xs:4,sm:0},bgcolor:g=>g.palette.mode==="dark"?"background.paper":"primary.light",backgroundImage:"linear-gradient(rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.05))"},children:jsxRuntimeExports.jsxs(Card,{elevation:5,sx:{p:{xs:3,sm:4},width:"100%",maxWidth:{xs:350,sm:450},mx:{xs:2,sm:0},display:"flex",flexDirection:"column",gap:2,borderRadius:2,boxShadow:g=>g.palette.mode==="dark"?"0 8px 24px rgba(0,0,0,0.4)":"0 8px 24px rgba(21,101,192,0.2)"},children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:2},children:[jsxRuntimeExports.jsx(Box,{sx:{bgcolor:"primary.main",color:"white",width:56,height:56,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",mb:2},children:jsxRuntimeExports.jsx(LockOutlinedIcon,{fontSize:"large"})}),jsxRuntimeExports.jsx(Typography,{variant:"h4",component:"h1",align:"center",sx:{fontWeight:"bold",color:"primary.dark"},children:c?"Reset Password":"Sign In"}),jsxRuntimeExports.jsx(Typography,{variant:"body2",color:"text.secondary",align:"center",sx:{mt:1},children:c?"Enter your email to receive a password reset link":"Sign in to access your account"})]}),jsxRuntimeExports.jsx(Divider,{sx:{mb:2}}),jsxRuntimeExports.jsxs("form",{onSubmit:v,children:[jsxRuntimeExports.jsx(TextField,{fullWidth:!0,label:"Email",type:"email",value:n,onChange:g=>e(g.target.value),margin:"normal",required:!0,autoFocus:!0,InputProps:{startAdornment:jsxRuntimeExports.jsx(InputAdornment,{position:"start",children:jsxRuntimeExports.jsx(EmailOutlinedIcon,{color:"primary"})})},sx:{mb:2}}),!c&&jsxRuntimeExports.jsx(TextField,{fullWidth:!0,label:"Password",type:h?"text":"password",value:t,onChange:g=>r(g.target.value),margin:"normal",required:!0,InputProps:{startAdornment:jsxRuntimeExports.jsx(InputAdornment,{position:"start",children:jsxRuntimeExports.jsx(LockOutlinedIcon,{color:"primary"})}),endAdornment:jsxRuntimeExports.jsx(InputAdornment,{position:"end",children:jsxRuntimeExports.jsx(IconButton,{"aria-label":"toggle password visibility",onClick:()=>o(!h),edge:"end",children:h?jsxRuntimeExports.jsx(VisibilityOffOutlinedIcon,{}):jsxRuntimeExports.jsx(VisibilityOutlined,{})})})},sx:{mb:1}}),!c&&jsxRuntimeExports.jsx(FormControlLabel,{control:jsxRuntimeExports.jsx(Checkbox,{checked:a,onChange:g=>i(g.target.checked),color:"primary"}),label:"Remember me"}),p&&jsxRuntimeExports.jsx(Alert,{severity:p.includes("sent")?"success":"error",sx:{mt:2},children:p}),jsxRuntimeExports.jsx(Button,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2,py:1.5,fontWeight:"bold",fontSize:"1rem",boxShadow:g=>g.palette.mode==="dark"?"0 4px 12px rgba(0,0,0,0.2)":"0 4px 12px rgba(21,101,192,0.2)"},disabled:u,children:u?jsxRuntimeExports.jsx(CircularProgress,{size:24}):c?"Send Reset Link":"Sign In"})]}),jsxRuntimeExports.jsx(Divider,{sx:{my:2},children:jsxRuntimeExports.jsx(Typography,{variant:"body2",color:"text.secondary",children:c?"Remember your password?":"Having trouble?"})}),jsxRuntimeExports.jsx(Box,{sx:{display:"flex",justifyContent:"center"},children:jsxRuntimeExports.jsx(Button,{variant:"text",color:"primary",onClick:()=>l(!c),sx:{fontWeight:"medium"},children:c?"Back to Sign In":"Forgot Password?"})})]})})};class MonitoringService{constructor(){Te(this,"sessionId");Te(this,"userId");Te(this,"isEnabled");Te(this,"errorQueue",[]);Te(this,"performanceQueue",[]);Te(this,"analyticsQueue",[]);Te(this,"flushInterval",3e4);Te(this,"maxQueueSize",100);this.sessionId=this.generateSessionId(),this.isEnabled=this.shouldEnableMonitoring(),this.isEnabled&&this.initializeMonitoring()}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}shouldEnableMonitoring(){const e=window.location.hostname;return e.includes("github.io")||e.includes("netlify.app")||e.includes("vercel.app")||!0}initializeMonitoring(){window.addEventListener("error",e=>{var t;this.captureError({message:e.message,stack:(t=e.error)==null?void 0:t.stack,url:e.filename||window.location.href,line:e.lineno,column:e.colno})}),window.addEventListener("unhandledrejection",e=>{var t;this.captureError({message:`Unhandled Promise Rejection: ${e.reason}`,stack:(t=e.reason)==null?void 0:t.stack,url:window.location.href})}),this.initializePerformanceMonitoring(),setInterval(()=>{this.flushData()},this.flushInterval),window.addEventListener("beforeunload",()=>{this.flushData()})}initializePerformanceMonitoring(){performance.timing&&setTimeout(()=>{this.capturePerformanceMetrics()},2e3),this.observeWebVitals()}observeWebVitals(){if("PerformanceObserver"in window)try{new PerformanceObserver(a=>{a.getEntries().forEach(c=>{c.name==="first-contentful-paint"&&this.trackCustomMetric("first_contentful_paint",c.startTime)})}).observe({entryTypes:["paint"]}),new PerformanceObserver(a=>{const i=a.getEntries(),c=i[i.length-1];this.trackCustomMetric("largest_contentful_paint",c.startTime)}).observe({entryTypes:["largest-contentful-paint"]}),new PerformanceObserver(a=>{a.getEntries().forEach(c=>{const l=c;this.trackCustomMetric("first_input_delay",l.processingStart-c.startTime)})}).observe({entryTypes:["first-input"]})}catch(e){console.warn("Performance Observer not fully supported:",e)}}setUserId(e){this.userId=e}captureError(e){var r,a;if(!this.isEnabled)return;const t={id:`error_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:new Date().toISOString(),message:e.message,stack:e.stack,url:e.url||window.location.href,userAgent:navigator.userAgent,userId:this.userId,sessionId:this.sessionId,severity:e.severity||"medium",tags:{...e.tags,line:((r=e.line)==null?void 0:r.toString())||"",column:((a=e.column)==null?void 0:a.toString())||""},context:{...e.context,timestamp:Date.now(),viewport:{width:window.innerWidth,height:window.innerHeight}}};this.errorQueue.push(t),e.severity==="critical"&&this.flushErrors(),this.errorQueue.length>this.maxQueueSize&&(this.errorQueue=this.errorQueue.slice(-this.maxQueueSize))}capturePerformanceMetrics(){if(!this.isEnabled||!performance.timing)return;const e=performance.timing,t={id:`perf_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:new Date().toISOString(),sessionId:this.sessionId,metrics:{pageLoadTime:e.loadEventEnd-e.navigationStart,domContentLoadedTime:e.domContentLoadedEventEnd-e.navigationStart,resourceLoadTime:e.loadEventEnd-e.domContentLoadedEventEnd,apiResponseTime:0},userAgent:navigator.userAgent,url:window.location.href};this.performanceQueue.push(t),this.performanceQueue.length>this.maxQueueSize&&(this.performanceQueue=this.performanceQueue.slice(-this.maxQueueSize))}trackEvent(e,t){if(!this.isEnabled)return;const r={sessionId:this.sessionId,userId:this.userId,timestamp:new Date().toISOString(),event:e,properties:t||{},page:window.location.pathname,userAgent:navigator.userAgent};this.analyticsQueue.push(r),this.analyticsQueue.length>this.maxQueueSize&&(this.analyticsQueue=this.analyticsQueue.slice(-this.maxQueueSize))}trackCustomMetric(e,t,r){this.trackEvent("custom_metric",{metric_name:e,metric_value:t,tags:r||{}})}async flushData(){await Promise.all([this.flushErrors(),this.flushPerformanceMetrics(),this.flushAnalytics()])}async flushErrors(){if(this.errorQueue.length===0)return;const e=[...this.errorQueue];this.errorQueue=[];try{console.warn("Monitoring: Flushing errors:",e);const r=[...JSON.parse(localStorage.getItem("monitoring_errors")||"[]"),...e].slice(-1e3);localStorage.setItem("monitoring_errors",JSON.stringify(r))}catch(t){console.error("Failed to flush errors:",t),this.errorQueue.unshift(...e)}}async flushPerformanceMetrics(){if(this.performanceQueue.length===0)return;const e=[...this.performanceQueue];this.performanceQueue=[];try{console.info("Monitoring: Flushing performance metrics:",e);const r=[...JSON.parse(localStorage.getItem("monitoring_performance")||"[]"),...e].slice(-500);localStorage.setItem("monitoring_performance",JSON.stringify(r))}catch(t){console.error("Failed to flush performance metrics:",t),this.performanceQueue.unshift(...e)}}async flushAnalytics(){if(this.analyticsQueue.length===0)return;const e=[...this.analyticsQueue];this.analyticsQueue=[];try{console.info("Monitoring: Flushing analytics:",e);const r=[...JSON.parse(localStorage.getItem("monitoring_analytics")||"[]"),...e].slice(-1e3);localStorage.setItem("monitoring_analytics",JSON.stringify(r))}catch(t){console.error("Failed to flush analytics:",t),this.analyticsQueue.unshift(...e)}}getStoredErrors(){try{return JSON.parse(localStorage.getItem("monitoring_errors")||"[]")}catch{return[]}}getStoredPerformanceMetrics(){try{return JSON.parse(localStorage.getItem("monitoring_performance")||"[]")}catch{return[]}}getStoredAnalytics(){try{return JSON.parse(localStorage.getItem("monitoring_analytics")||"[]")}catch{return[]}}clearStoredData(){localStorage.removeItem("monitoring_errors"),localStorage.removeItem("monitoring_performance"),localStorage.removeItem("monitoring_analytics")}}const monitoringService=new MonitoringService;class ErrorBoundary extends reactExports.Component{constructor(t){super(t);Te(this,"handleReload",()=>{window.location.reload()});Te(this,"handleRetry",()=>{this.setState({hasError:!1,error:void 0,errorInfo:void 0,errorId:void 0})});this.state={hasError:!1}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,r){const a=this.generateErrorId();monitoringService.captureError({message:t.message,stack:t.stack,severity:"high",tags:{errorBoundary:"true",componentStack:"true"},context:{errorId:a,componentStack:r.componentStack,errorBoundary:!0,props:this.props,state:this.state}}),this.setState({error:t,errorInfo:r,errorId:a}),monitoringService.trackEvent("error_boundary_triggered",{errorId:a,errorMessage:t.message,componentStack:r.componentStack})}generateErrorId(){return`error_boundary_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}render(){return this.state.hasError?this.props.fallback?this.props.fallback:jsxRuntimeExports.jsx(Box,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh",padding:3},children:jsxRuntimeExports.jsxs(Paper,{elevation:3,sx:{padding:4,maxWidth:600,textAlign:"center",borderRadius:2},children:[jsxRuntimeExports.jsx(BugReportOutlined,{sx:{fontSize:64,color:"error.main",marginBottom:2}}),jsxRuntimeExports.jsx(Typography,{variant:"h4",gutterBottom:!0,color:"error",children:"Oops! Something went wrong"}),jsxRuntimeExports.jsx(Typography,{variant:"body1",paragraph:!0,color:"text.secondary",children:"We've encountered an unexpected error. Our team has been notified and is working on a fix."}),this.state.errorId&&jsxRuntimeExports.jsxs(Alert,{severity:"info",sx:{marginBottom:3,textAlign:"left"},children:[jsxRuntimeExports.jsxs(Typography,{variant:"body2",children:[jsxRuntimeExports.jsx("strong",{children:"Error ID:"})," ",this.state.errorId]}),jsxRuntimeExports.jsx(Typography,{variant:"body2",sx:{marginTop:1},children:"Please include this ID when reporting the issue to our support team."})]}),!1,jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",gap:2,justifyContent:"center"},children:[jsxRuntimeExports.jsx(Button,{variant:"contained",onClick:this.handleRetry,startIcon:jsxRuntimeExports.jsx(RefreshOutlined,{}),children:"Try Again"}),jsxRuntimeExports.jsx(Button,{variant:"outlined",onClick:this.handleReload,children:"Reload Page"})]}),jsxRuntimeExports.jsx(Typography,{variant:"body2",sx:{marginTop:3,color:"text.secondary"},children:"If the problem persists, please contact our support team."})]})}):this.props.children}}function App({toggleTheme:n,mode:e}){return reactExports.useEffect(()=>{monitoringService.trackEvent("app_loaded",{timestamp:Date.now(),userAgent:navigator.userAgent,url:window.location.href}),setTimeout(()=>{monitoringService.capturePerformanceMetrics()},2e3)},[]),jsxRuntimeExports.jsx(ErrorBoundary,{children:jsxRuntimeExports.jsx(Box,{sx:{display:"flex",width:"100%",justifyContent:"center",alignItems:"center"},children:jsxRuntimeExports.jsx(reactExports.Suspense,{fallback:jsxRuntimeExports.jsx(CircularProgress,{"data-testid":"loading-progress",color:"success"}),children:jsxRuntimeExports.jsxs(Routes,{children:[jsxRuntimeExports.jsx(Route,{path:"/login",element:jsxRuntimeExports.jsx(LoginPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/health",element:React.createElement(React.lazy(()=>__vitePreload(()=>import("./health.page-CzQr08zB.js"),__vite__mapDeps([27,3,1])).then(t=>({default:t.default}))))}),jsxRuntimeExports.jsx(Route,{path:"/*",element:jsxRuntimeExports.jsx(ProtectedRoute,{children:jsxRuntimeExports.jsx(ProtectedRoutes,{toggleTheme:n,mode:e})})})]})})})})}const AppWrapper=()=>{const[n,e]=reactExports.useState(localStorage.getItem("theme")==="dark"?"dark":"light"),t=reactExports.useMemo(()=>createTheme(getDesignTokens(n)),[n]),r=()=>{const a=n==="light"?"dark":"light";e(a),localStorage.setItem("theme",a)};return reactExports.useEffect(()=>{store.dispatch(initializeAuthState())},[]),jsxRuntimeExports.jsx(Provider_default,{store,children:jsxRuntimeExports.jsx(PersistGate,{loading:null,persistor,children:jsxRuntimeExports.jsxs(ThemeProvider,{theme:t,children:[jsxRuntimeExports.jsx(CssBaseline,{}),jsxRuntimeExports.jsx(Paper,{sx:{minHeight:"100vh"},children:jsxRuntimeExports.jsx(BrowserRouter,{children:jsxRuntimeExports.jsx(App,{toggleTheme:r,mode:n})})})]})})})};clientExports.createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(reactExports.StrictMode,{children:jsxRuntimeExports.jsx(AppWrapper,{})}));export{CategoryService as $,removeFlipkartFile as A,removeAmazonFile as B,addFlipkartFile as C,addAmazonFile as D,setEnableBarcodes as E,mergePDFs as F,fetchTransactions as G,saveTransactions as H,selectCategories as I,importProducts as J,bulkUpdateProducts as K,setFilters as L,updateProduct as M,BarcodeService as N,useScanFeedback as O,Papa as P,fetchBatchesForToday as Q,fetchOrdersForDate as R,fetchBatchesForDate as S,selectFilteredOrders as T,clearAllFilters as U,setCompletionFilter as V,setBatchFilter as W,setPlatformFilter as X,completeOrderByBarcode as Y,selectCategoryGroupsLoading as Z,selectCategoryGroupsLastUpdated as _,useAppSelector as a,CategoryGroupService as a0,selectCategoryGroupsError as a1,clearError$1 as a2,deleteCategoryGroup as a3,CATEGORY_GROUP_COLORS as a4,updateCategoryGroup as a5,createCategoryGroup as a6,startOfDay as a7,fetchAllOrdersForAnalytics as a8,fetchCategories as a9,adjustInventoryManually as aA,importInventoryData as aB,fetchCategoriesWithDeduction as aC,exportInventoryData as aD,millisecondsInHour as aE,millisecondsInMinute as aF,millisecondsInSecond as aG,getWeekYear as aH,startOfWeek as aI,startOfISOWeek as aJ,getWeek as aK,getISOWeek as aL,longFormatters as aM,isProtectedWeekYearToken as aN,warnOrThrowProtectedError as aO,isProtectedDayOfYearToken as aP,isValid as aQ,startOfYear as aR,ScanFeedback as aS,addCategory as aa,ref as ab,storage as ac,uploadBytesResumable as ad,getDownloadURL as ae,deleteObject as af,listAll as ag,getMetadata as ah,updateMetadata as ai,toDate as aj,constructFrom as ak,normalizeDates as al,getDefaultOptions as am,enUS as an,getTimezoneOffsetInMilliseconds as ao,minutesInDay as ap,minutesInMonth as aq,monitoringService as ar,InventoryService as as,selectInventoryFilters as at,clearInventoryFilters as au,setInventoryFilters as av,fetchInventoryMovements as aw,clearMovementFilters as ax,setMovementFilters as ay,clearAdjustmentError as az,selectActiveInventoryAlerts as b,selectInventoryLoading as c,selectInventoryErrors as d,selectCategoryGroups as e,selectUser as f,fetchInventoryAlerts as g,fetchCategoryGroups as h,clearAlertAcknowledgmentError as i,clearAlertResolutionError as j,acknowledgeInventoryAlert as k,selectIsAuthenticated as l,selectInventoryLevels as m,fetchProducts as n,fetchOrders as o,fetchOrderHistory as p,fetchInventoryLevels as q,resolveInventoryAlert as r,selectInventoryAlerts as s,setSelectedDate as t,useAppDispatch as u,format as v,fetchCategories$1 as w,defaultSortConfig as x,clearFlipkartFiles as y,clearAmazonFiles as z};
