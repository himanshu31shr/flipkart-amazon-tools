import{j as e,bk as ie,B as m,h as c,a8 as k,bl as Q,k as L,p as Ce,bm as ve,r as $,ao as H,ap as G,aq as V,ar as W,u as le,b1 as ce,b2 as de,bn as Se,aW as he,a2 as U,aX as ue,aY as xe,aZ as K,a_ as P,b0 as ge,ac as me,bo as fe,C as ee,I as pe,y as Pe,bp as De,U as Ie,at as Oe,Q as ae,aG as ze,ak as ke,b9 as Te}from"./mui-vendor-D4OjBZQt.js";import{a as g,b as te}from"./react-vendor-DYr15v6v.js";import{u as Me,f as X}from"./redux-vendor-CLOwJCHO.js";import{a7 as N,v as ne,a8 as we,n as Re,a9 as Ae}from"./index-BIOtAz8Z.js";import{a as Ee,b as Fe,D as se,s as q,i as J,L as We,A as Le}from"./AdapterDateFns-ChDwltzC.js";import{e as B,a as oe}from"./endOfMonth-CrccTSkP.js";import{F as Z}from"./FormattedCurrency-Cr38E1t8.js";import{B as Be,M as ye,X as je,Y as be,F as Ue,R as Ne,K as qe,I as Ke,t as $e}from"./generateCategoricalChart-0pyt0Y-a.js";import"./firebase-vendor-OxXAdhiL.js";import"./utils-vendor-CFocuF-S.js";import"./pdf-vendor-CApBJrGQ.js";function Y(a,x,d){return Ee(a,-x,d)}function _(a,x,d){return Fe(a,-x,d)}var He=Be({chartName:"BarChart",GraphicalChild:ye,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:je},{axisType:"yAxis",AxisComp:be}],formatAxisMap:Ue});const Ge=({dateRange:a,onDateRangeChange:x,anchorEl:d,onClose:i})=>{const o=r=>t=>{t&&x(r==="startDate"?N(t):a.startDate,r==="endDate"?B(t):a.endDate)},p=r=>{const t=new Date;let h,C;switch(r){case"today":h=N(t),C=B(t);break;case"yesterday":h=N(Y(t,1)),C=B(Y(t,1));break;case"monthToDate":h=q(t),C=B(t);break;case"last30Days":h=N(Y(t,29)),C=B(t);break;case"lastMonth":h=q(_(t,1)),C=oe(_(t,1));break;case"last3Months":h=q(_(t,3)),C=B(t);break;default:return}x(h,C)},v=()=>{x(q(new Date),oe(new Date))};return e.jsx(ie,{open:!!d,anchorEl:d,onClose:i,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsxs(m,{sx:{width:340,p:2},children:[e.jsx(c,{variant:"subtitle1",gutterBottom:!0,children:"Date Range"}),e.jsxs(k,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(k,{item:!0,xs:12,sm:6,children:e.jsx(se,{label:"Start Date",value:a.startDate,onChange:o("startDate"),slotProps:{textField:{fullWidth:!0}}})}),e.jsx(k,{item:!0,xs:12,sm:6,children:e.jsx(se,{label:"End Date",value:a.endDate,onChange:o("endDate"),slotProps:{textField:{fullWidth:!0}}})}),e.jsx(k,{item:!0,xs:12,children:e.jsxs(Q,{variant:"outlined",fullWidth:!0,children:[e.jsx(L,{onClick:()=>p("today"),children:"Today"}),e.jsx(L,{onClick:()=>p("yesterday"),children:"Yesterday"})]})}),e.jsx(k,{item:!0,xs:12,children:e.jsxs(Q,{variant:"outlined",fullWidth:!0,children:[e.jsx(L,{onClick:()=>p("monthToDate"),children:"Month to Date"}),e.jsx(L,{onClick:()=>p("last30Days"),children:"Last 30 Days"})]})}),e.jsx(k,{item:!0,xs:12,children:e.jsxs(Q,{variant:"outlined",fullWidth:!0,children:[e.jsx(L,{onClick:()=>p("lastMonth"),children:"Last Month"}),e.jsx(L,{onClick:()=>p("last3Months"),children:"Last 3 Months"})]})}),e.jsx(k,{item:!0,xs:12,children:e.jsx(L,{variant:"text",color:"secondary",onClick:v,fullWidth:!0,children:"Reset to Current Month"})})]})]})})},Ve=({anchorEl:a,onClose:x,categories:d,selectedCategory:i,selectedSku:o,selectedPlatform:p,selectedProduct:v,skuOptions:r,platformOptions:t,productOptions:h,onCategoryChange:C,onSkuChange:I,onPlatformChange:u,onProductChange:n,onClearFilters:f})=>e.jsx(ie,{open:!!a,anchorEl:a,onClose:x,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(m,{sx:{width:300,maxHeight:500,overflow:"auto"},children:e.jsxs(Ce,{children:[e.jsx(ve,{children:e.jsxs(m,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(c,{variant:"subtitle1",children:"Filters"}),e.jsx(L,{size:"small",onClick:f,children:"Clear All"})]})}),e.jsx($,{children:e.jsxs(H,{fullWidth:!0,children:[e.jsx(G,{children:"Category"}),e.jsxs(V,{value:i,label:"Category",onChange:s=>C(s.target.value),size:"small",children:[e.jsx(W,{value:"",children:"All Categories"}),d.map(s=>e.jsx(W,{value:s.name,children:s.name},s.id)),e.jsx(W,{value:"Uncategorized",children:"Uncategorized"})]})]})}),e.jsx($,{children:e.jsxs(H,{fullWidth:!0,children:[e.jsx(G,{children:"Product"}),e.jsxs(V,{value:v,label:"Product",onChange:s=>n(s.target.value),size:"small",children:[e.jsx(W,{value:"",children:"All Products"}),h.map(s=>e.jsx(W,{value:s,children:s},s))]})]})}),e.jsx($,{children:e.jsxs(H,{fullWidth:!0,children:[e.jsx(G,{children:"SKU"}),e.jsxs(V,{value:o,label:"SKU",onChange:s=>I(s.target.value),size:"small",children:[e.jsx(W,{value:"",children:"All SKUs"}),r.map(s=>e.jsx(W,{value:s,children:s},s))]})]})}),e.jsx($,{children:e.jsxs(H,{fullWidth:!0,children:[e.jsx(G,{children:"Platform"}),e.jsxs(V,{value:p,label:"Platform",onChange:s=>u(s.target.value),size:"small",children:[e.jsx(W,{value:"",children:"All Platforms"}),t.map(s=>e.jsx(W,{value:s,children:s},s))]})]})})]})})}),Ye=({allOrders:a,categories:x,products:d})=>{const[i,o]=g.useState({selectedCategory:"",selectedSku:"",selectedPlatform:"",selectedProduct:"",dateRange:{startDate:q(new Date),endDate:B(new Date)}}),[p,v]=g.useState([]),[r,t]=g.useState([]),[h,C]=g.useState([]);g.useEffect(()=>{if(a.length>0){const s=Array.from(new Set(a.map(b=>b.SKU).filter(b=>b&&typeof b=="string")));v(s);const D=Array.from(new Set(a.map(b=>b.type).filter(b=>b&&typeof b=="string")));t(D);const M=Array.from(new Set(a.map(b=>{var z;return b.name||((z=b.product)==null?void 0:z.name)}).filter(b=>b&&typeof b=="string")));C(M)}},[a]);const I=(s,D)=>{o(M=>({...M,[s]:D}))},u=()=>{o({selectedCategory:"",selectedSku:"",selectedPlatform:"",selectedProduct:"",dateRange:i.dateRange})},n=()=>{o(s=>({...s,dateRange:{startDate:new Date,endDate:new Date}}))},f=a.filter(s=>{var j;let D=!0;try{if(s.date&&typeof s.date=="string"){const O=new Date(s.date);isNaN(O.getTime())||(D=J(O,{start:i.dateRange.startDate,end:i.dateRange.endDate}))}}catch{}if(!D)return!1;const M=(()=>{var T;if(!((T=s.product)!=null&&T.categoryId)||x.length===0)return"Uncategorized";const O=x.find(E=>{var S;return E.id===((S=s.product)==null?void 0:S.categoryId)});return(O==null?void 0:O.name)||"Uncategorized"})(),b=s.SKU||"",z=s.type||"",R=s.name||((j=s.product)==null?void 0:j.name)||"",w=!i.selectedCategory||M===i.selectedCategory,A=!i.selectedSku||b===i.selectedSku,l=!i.selectedPlatform||z===i.selectedPlatform,y=!i.selectedProduct||R===i.selectedProduct;return w&&A&&l&&y}).map(s=>{const D=d.find(M=>{var b;return M.sku.toLowerCase()===((b=s.SKU)==null?void 0:b.toLowerCase())});return{...s,product:D}});return{filterState:i,skuOptions:p,platformOptions:r,productOptions:h,filteredOrders:f,updateFilter:I,clearFilters:u,clearDateRange:n}},Qe=({orders:a,categories:x})=>{const[d,i]=g.useState(!1),o=g.useMemo(()=>{const r=N(new Date),t=Y(r,1);return{today:{start:r,end:B(r)},yesterday:{start:t,end:B(t)}}},[]),p=g.useMemo(()=>{const r={};return x.forEach(t=>{t.id&&(r[t.id]=t.name)}),r},[x]),v=g.useMemo(()=>{if(!a.length)return{categoryData:[],topCategories:[],todayTotal:0,yesterdayTotal:0};const r={};let t=0,h=0;a.forEach(u=>{var s;let n,f;if((s=u.product)!=null&&s.categoryId&&p[u.product.categoryId]?(n=u.product.categoryId,f=p[n]):(n="uncategorized",f="Uncategorized"),r[n]||(r[n]={categoryId:n,categoryName:f,totalOrders:0,todayOrders:0,yesterdayOrders:0,orderChange:0,orderChangePercent:0,isTopCategory:!1,productCount:0}),r[n].totalOrders+=1,u.date){const D=new Date(u.date);J(D,o.today)?(r[n].todayOrders+=1,t+=1):J(D,o.yesterday)&&(r[n].yesterdayOrders+=1,h+=1)}}),Object.values(r).forEach(u=>{const n=new Set(a.filter(f=>{var s,D;return u.categoryId==="uncategorized"?!((s=f.product)!=null&&s.categoryId)||!p[f.product.categoryId]:((D=f.product)==null?void 0:D.categoryId)===u.categoryId}).map(f=>f.SKU).filter(Boolean));u.productCount=n.size}),Object.values(r).forEach(u=>{u.orderChange=u.todayOrders-u.yesterdayOrders,u.orderChangePercent=u.yesterdayOrders>0?u.orderChange/u.yesterdayOrders*100:u.todayOrders>0?100:0});const C=Object.values(r).sort((u,n)=>n.totalOrders-u.totalOrders),I=C.slice(0,10).map(u=>({...u,isTopCategory:!0}));return I.forEach(u=>{const n=r[u.categoryId];n&&(n.isTopCategory=!0)}),{categoryData:C,topCategories:I,todayTotal:t,yesterdayTotal:h}},[a,p,o]);return g.useEffect(()=>{if(a.length>0){i(!0);const r=setTimeout(()=>i(!1),100);return()=>clearTimeout(r)}},[a.length]),{...v,loading:d}},Xe=({value:a,percentage:x,showIcon:d=!0,size:i="medium"})=>{const o=le(),p=()=>a>0?{color:o.palette.success.main,icon:e.jsx(ce,{fontSize:i}),textColor:o.palette.success.main}:a<0?{color:o.palette.error.main,icon:e.jsx(de,{fontSize:i}),textColor:o.palette.error.main}:{color:o.palette.text.secondary,icon:e.jsx(Se,{fontSize:i}),textColor:o.palette.text.secondary},{color:v,icon:r,textColor:t}=p(),h=n=>n>0?`+${n}`:n<0?`${n}`:"0",C=n=>n>0?`+${n.toFixed(1)}%`:n<0?`${n.toFixed(1)}%`:"0.0%",u={small:{fontSize:"0.75rem",iconSize:"small",spacing:.5},medium:{fontSize:"0.875rem",iconSize:"small",spacing:1},large:{fontSize:"1rem",iconSize:"medium",spacing:1.5}}[i];return e.jsxs(m,{display:"flex",alignItems:"center",gap:u.spacing,sx:{color:t,fontWeight:500},children:[d&&e.jsx(m,{display:"flex",alignItems:"center",sx:{color:v},children:te.cloneElement(r,{fontSize:u.iconSize})}),e.jsxs(m,{display:"flex",flexDirection:"column",alignItems:"flex-end",children:[e.jsx(c,{variant:"body2",sx:{fontSize:u.fontSize,fontWeight:600,lineHeight:1.2},children:h(a)}),e.jsx(c,{variant:"caption",sx:{fontSize:`calc(${u.fontSize} * 0.85)`,color:o.palette.text.secondary,lineHeight:1.2},children:C(x)})]})]})},Ze=({categoryName:a,products:x,categories:d,isOpen:i})=>{const[o,p]=g.useState(0),[v,r]=g.useState(10),t={};d.forEach(n=>{n.id&&(t[n.id]=n.name)});const h=g.useMemo(()=>[...x].sort((n,f)=>{const s=parseInt(n.quantity)||0;return(parseInt(f.quantity)||0)-s}),[x]),C=g.useMemo(()=>{const n=o*v;return h.slice(n,n+v)},[h,o,v]),I=(n,f)=>{p(f)},u=n=>{r(parseInt(n.target.value,10)),p(0)};return te.useEffect(()=>{p(0)},[x]),i?e.jsxs(m,{children:[e.jsxs(c,{variant:"h6",gutterBottom:!0,color:"primary",sx:{mt:2,mb:1},children:['Products in "',a,'" Category']}),e.jsxs(c,{variant:"body2",color:"text.secondary",mb:2,children:[h.length," products found"]}),e.jsx(he,{component:U,variant:"outlined",children:e.jsxs(ue,{size:"small",children:[e.jsx(xe,{children:e.jsxs(K,{children:[e.jsx(P,{sx:{fontWeight:"bold"},children:"Product Name"}),e.jsx(P,{sx:{fontWeight:"bold"},align:"right",children:"SKU"}),e.jsx(P,{sx:{fontWeight:"bold"},align:"right",children:"Quantity"}),e.jsx(P,{sx:{fontWeight:"bold"},align:"right",children:"Price"}),e.jsx(P,{sx:{fontWeight:"bold"},align:"right",children:"Total Value"})]})}),e.jsx(ge,{children:C.map((n,f)=>{var b,z,R,w,A;const s=parseInt(n.quantity)||0,D=((b=n.product)==null?void 0:b.sellingPrice)||0,M=s*D;return e.jsxs(K,{hover:!0,children:[e.jsx(P,{children:e.jsxs(m,{children:[e.jsx(c,{variant:"body2",fontWeight:"medium",children:((z=n.product)==null?void 0:z.name)||"Unknown Product"}),((R=n.product)==null?void 0:R.categoryId)&&e.jsx(me,{label:t[n.product.categoryId]||"Unknown Category",size:"small",color:"primary",variant:"outlined",sx:{mt:.5}})]})}),e.jsx(P,{align:"right",children:e.jsx(c,{variant:"body2",fontFamily:"monospace",children:((w=n.product)==null?void 0:w.sku)||"N/A"})}),e.jsx(P,{align:"right",children:e.jsx(c,{variant:"body2",fontWeight:"medium",children:s.toLocaleString()})}),e.jsx(P,{align:"right",children:e.jsxs(c,{variant:"body2",children:["₹",D.toLocaleString()]})}),e.jsx(P,{align:"right",children:e.jsxs(c,{variant:"body2",fontWeight:"bold",color:"primary",children:["₹",M.toLocaleString()]})})]},`${(A=n.product)==null?void 0:A.sku}-${f}`)})})]})}),h.length>0&&e.jsx(fe,{rowsPerPageOptions:[5,10,25,50],component:"div",count:h.length,rowsPerPage:v,page:o,onPageChange:I,onRowsPerPageChange:u,sx:{".MuiTablePagination-selectLabel":{fontSize:"0.875rem"},".MuiTablePagination-displayedRows":{fontSize:"0.875rem"}}}),h.length===0&&e.jsx(m,{display:"flex",justifyContent:"center",alignItems:"center",py:4,children:e.jsx(c,{variant:"body2",color:"text.secondary",children:"No products found in this category"})})]}):null},_e=({historicalData:a,orders:x,categories:d})=>{const[i,o]=g.useState(!0),[p,v]=g.useState([]),[r,t]=g.useState(new Set),[h,C]=g.useState(0),[I,u]=g.useState(25),n=g.useMemo(()=>{const l={};return d.forEach(y=>{y.id&&(l[y.id]=y.name)}),l},[d]),f=g.useMemo(()=>{const l={};return x.forEach(y=>{var T;const j=(T=y.product)==null?void 0:T.categoryId,O=j&&n[j]||"Uncategorized";l[O]||(l[O]=[]),l[O].push(y)}),l},[x,n]),s=g.useCallback(l=>f[l]||[],[f]),D=g.useCallback(l=>{t(y=>{const j=new Set(y);return j.has(l)?j.delete(l):j.add(l),j})},[]),M=g.useCallback((l,y)=>{C(y)},[]),b=g.useCallback(l=>{u(parseInt(l.target.value,10)),C(0)},[]),z=g.useMemo(()=>{const l={},y={};return x.forEach(j=>{var E;const O=(E=j.product)==null?void 0:E.categoryId,T=O&&n[O]||"Uncategorized";y[T]||(y[T]=[]),y[T].push(j)}),Object.entries(y).forEach(([j,O])=>{l[j]={revenue:0,cost:0,profit:0},O.forEach(T=>{var re;const E=parseInt(T.quantity)||1,S=((re=T.product)==null?void 0:re.sellingPrice)||0,F=0;l[j].revenue+=S*E,l[j].cost+=F*E}),l[j].profit=l[j].revenue-l[j].cost}),l},[x,n]),R=g.useMemo(()=>{if(!a.length)return[];const l=[];return a.forEach(y=>{const j=z[y.categoryName]||{revenue:0,cost:0,profit:0},O=j.revenue>0?j.profit/j.revenue*100:0;l.push({categoryId:y.categoryId,categoryName:y.categoryName,totalOrders:y.totalOrders,todayOrders:y.todayOrders,yesterdayOrders:y.yesterdayOrders,orderChange:y.orderChange,orderChangePercent:y.orderChangePercent,totalRevenue:j.revenue,totalCost:j.cost,profit:j.profit,profitMargin:O})}),l},[a,z]);g.useEffect(()=>{v(R),o(!1)},[R]);const w=g.useMemo(()=>[...p].sort((l,y)=>y.totalOrders-l.totalOrders),[p]),A=g.useMemo(()=>{const l=h*I;return w.slice(l,l+I)},[w,h,I]);return i?e.jsx(m,{display:"flex",justifyContent:"center",p:2,children:e.jsx(ee,{})}):p.length?e.jsxs(m,{children:[e.jsx(he,{component:U,children:e.jsxs(ue,{children:[e.jsx(xe,{children:e.jsxs(K,{children:[e.jsx(P,{padding:"checkbox"}),e.jsx(P,{sx:{fontWeight:"bold"},children:"Category"}),e.jsx(P,{sx:{fontWeight:"bold"},align:"right",children:"Total Orders"}),e.jsx(P,{sx:{fontWeight:"bold"},align:"right",children:"Today vs Yesterday"}),e.jsx(P,{sx:{fontWeight:"bold"},align:"right",children:"Revenue"}),e.jsx(P,{sx:{fontWeight:"bold"},align:"right",children:"Cost"}),e.jsx(P,{sx:{fontWeight:"bold"},align:"right",children:"Profit"})]})}),e.jsx(ge,{children:A.map(l=>{const y=r.has(l.categoryName),j=s(l.categoryName);return e.jsxs(te.Fragment,{children:[e.jsxs(K,{hover:!0,onClick:()=>D(l.categoryName),sx:{cursor:"pointer"},children:[e.jsx(P,{padding:"checkbox",children:e.jsx(pe,{size:"small",onClick:O=>{O.stopPropagation(),D(l.categoryName)},children:y?e.jsx(ce,{}):e.jsx(de,{})})}),e.jsx(P,{children:l.categoryName}),e.jsx(P,{align:"right",children:l.totalOrders.toLocaleString()}),e.jsx(P,{align:"right",children:e.jsx(Xe,{value:l.orderChange,percentage:l.orderChangePercent,size:"small"})}),e.jsx(P,{align:"right",children:e.jsx(Z,{value:l.totalRevenue})}),e.jsx(P,{align:"right",children:e.jsx(Z,{value:l.totalCost})}),e.jsx(P,{align:"right",children:e.jsxs(m,{children:[e.jsx(Z,{value:l.profit}),e.jsxs(m,{fontSize:"0.75rem",color:"text.secondary",children:[l.profitMargin.toFixed(1),"%"]})]})})]}),e.jsx(K,{children:e.jsx(P,{style:{paddingBottom:0,paddingTop:0},colSpan:7,children:e.jsx(Pe,{in:y,timeout:"auto",unmountOnExit:!0,children:e.jsx(m,{sx:{margin:1},children:e.jsx(Ze,{categoryName:l.categoryName,products:j,categories:d,isOpen:!0})})})})})]},l.categoryId)})})]})}),e.jsx(fe,{rowsPerPageOptions:[10,25,50],component:"div",count:w.length,rowsPerPage:I,page:h,onPageChange:M,onRowsPerPageChange:b})]}):e.jsx(m,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"300px",children:e.jsx(m,{textAlign:"center",children:e.jsx(m,{color:"text.secondary",mb:2,children:"No category data available"})})})},Je=({topCategories:a,totalCategories:x})=>{const d=le();return a.length?e.jsxs(m,{children:[e.jsxs(m,{display:"flex",alignItems:"center",gap:1,mb:2,children:[e.jsx(De,{sx:{color:d.palette.warning.main}}),e.jsx(c,{variant:"h6",children:"Top 10 Categories"}),e.jsx(me,{label:`${a.length} of ${x} categories`,size:"small",variant:"outlined",color:"primary"})]}),e.jsx(k,{container:!0,spacing:1,children:a.map((i,o)=>e.jsx(k,{item:!0,xs:12,sm:6,md:4,lg:3,xl:2,children:e.jsx(Ie,{sx:{height:"100%",border:`1px solid ${d.palette.divider}`,boxShadow:"none","&:hover":{boxShadow:d.shadows[2],borderColor:d.palette.primary.main}},children:e.jsxs(Oe,{sx:{p:1.5},children:[e.jsxs(m,{display:"flex",alignItems:"center",gap:1,mb:1,children:[e.jsx(m,{sx:{width:20,height:20,borderRadius:"50%",backgroundColor:o<3?d.palette.primary.main:d.palette.grey[300],color:o<3?d.palette.primary.contrastText:d.palette.text.primary,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.7rem",fontWeight:"bold"},children:o+1}),e.jsx(c,{variant:"subtitle2",sx:{fontSize:"0.8rem",fontWeight:500,lineHeight:1.2,flex:1},children:i.categoryName})]}),e.jsxs(m,{display:"flex",flexDirection:"column",gap:.5,children:[e.jsxs(m,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(c,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.7rem"},children:"Total:"}),e.jsx(c,{variant:"body2",fontWeight:"bold",sx:{fontSize:"0.8rem"},children:i.totalOrders.toLocaleString()})]}),e.jsxs(m,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(c,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.7rem"},children:"2 Days:"}),e.jsx(c,{variant:"body2",sx:{fontSize:"0.8rem"},children:i.todayOrders+i.yesterdayOrders})]}),e.jsxs(m,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(c,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.7rem"},children:"Products:"}),e.jsx(c,{variant:"body2",sx:{fontSize:"0.8rem"},children:i.productCount})]})]})]})})},i.categoryId))}),e.jsxs(m,{mt:2,p:1.5,bgcolor:"background.paper",borderRadius:1,border:1,borderColor:"divider",children:[e.jsx(c,{variant:"subtitle2",gutterBottom:!0,sx:{fontSize:"0.875rem"},children:"Top Categories Summary"}),e.jsxs(m,{display:"flex",gap:3,children:[e.jsxs(m,{children:[e.jsx(c,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.7rem"},children:"Total Orders"}),e.jsx(c,{variant:"h6",sx:{fontSize:"1.1rem"},children:a.reduce((i,o)=>i+o.totalOrders,0).toLocaleString()})]}),e.jsxs(m,{children:[e.jsx(c,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.7rem"},children:"Last 2 Days"}),e.jsx(c,{variant:"h6",sx:{fontSize:"1.1rem"},children:a.reduce((i,o)=>i+o.todayOrders+o.yesterdayOrders,0).toLocaleString()})]}),e.jsxs(m,{children:[e.jsx(c,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.7rem"},children:"Total Products"}),e.jsx(c,{variant:"h6",sx:{fontSize:"1.1rem"},children:a.reduce((i,o)=>i+o.productCount,0).toLocaleString()})]})]})]})]}):e.jsx(m,{textAlign:"center",py:3,children:e.jsx(c,{variant:"h6",color:"text.secondary",children:"No top performers data available"})})},et=({orders:a,categories:x,isLoading:d})=>{const{categoryData:i,topCategories:o,loading:p}=Qe({orders:a,categories:x});return d||p?e.jsx(m,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(ee,{})}):a.length?e.jsxs(e.Fragment,{children:[e.jsx(U,{sx:{p:2,mb:3},children:e.jsx(Je,{topCategories:o,totalCategories:i.length})}),e.jsxs(U,{sx:{p:2},children:[e.jsx(c,{variant:"h6",gutterBottom:!0,children:"All Categories & Distribution Details"}),e.jsx(_e,{historicalData:i,orders:a,categories:x})]})]}):e.jsx(m,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"300px",children:e.jsx(c,{variant:"h6",color:"text.secondary",children:"No data available for historical analysis"})})},tt=({orders:a,categories:x})=>{const d=["#1976d2","#dc004e","#388e3c","#f57c00","#7b1fa2","#d32f2f","#388e3c","#f57c00","#1976d2","#7b1fa2","#ff9800","#795548","#607d8b","#e91e63","#3f51b5","#009688","#ff5722","#673ab7","#2196f3","#4caf50","#ffeb3b","#9c27b0","#00bcd4","#8bc34a","#ffc107","#9e9e9e","#f44336","#3f51b5","#009688","#ff9800"],i={};x.forEach(r=>{r.id&&(i[r.id]=r.name)});const o={};a.forEach(r=>{var I;const t=(I=r.product)==null?void 0:I.categoryId,h=t&&i[t]||"Uncategorized",C=parseInt(r.quantity)||1;o[h]||(o[h]=0),o[h]+=C});const p=Object.entries(o).map(([r,t],h)=>({name:r,value:t,color:d[h%d.length]})).sort((r,t)=>t.value-r.value).slice(0,30);if(!a.length)return e.jsx(m,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"300px",children:e.jsx(c,{variant:"body2",color:"text.secondary",children:"No data available"})});const v=({active:r,payload:t,label:h})=>r&&t&&t.length?e.jsxs(m,{sx:{backgroundColor:"background.paper",border:"1px solid #ccc",borderRadius:1,p:1.5,boxShadow:2},children:[e.jsx(c,{variant:"body2",fontWeight:"bold",mb:.5,children:h}),e.jsxs(c,{variant:"body2",color:"primary",children:["Orders: ",t[0].value.toLocaleString()]})]}):null;return e.jsxs(m,{children:[e.jsx(c,{variant:"body2",color:"text.secondary",mb:2,children:"Top 30 Categories by Order Quantity"}),e.jsx(Ne,{width:"100%",height:500,children:e.jsxs(He,{data:p,margin:{top:20,right:30,left:20,bottom:100},children:[e.jsx(qe,{strokeDasharray:"3 3"}),e.jsx(je,{dataKey:"name",angle:-45,textAnchor:"end",height:80,tick:{fontSize:10},interval:0}),e.jsx(be,{label:{value:"Number of Orders",angle:-90,position:"insideLeft",style:{textAnchor:"middle",fontSize:"12px"}},tickFormatter:r=>r.toLocaleString()}),e.jsx(Ke,{content:e.jsx(v,{})}),e.jsx(ye,{dataKey:"value",name:"Orders",fill:"#1976d2",radius:[4,4,0,0],maxBarSize:50,children:p.map((r,t)=>e.jsx($e,{fill:r.color},`cell-${t}`))})]})})]})},rt=({orders:a,categories:x,isLoading:d})=>d?e.jsx(m,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(ee,{})}):e.jsx(U,{sx:{p:2},children:e.jsx(k,{container:!0,spacing:3,children:e.jsxs(k,{item:!0,xs:12,children:[e.jsx(c,{variant:"h6",gutterBottom:!0,children:"Orders by Category"}),e.jsx(tt,{orders:a,categories:x})]})})}),at=({orders:a,products:x,categories:d})=>{const i={};d.forEach(t=>{t.id&&(i[t.id]=t.name)});const o=a.length,p=a.reduce((t,h)=>{var u;const C=((u=h.product)==null?void 0:u.sellingPrice)||0,I=parseInt(h.quantity)||0;return t+C*I},0),v=o?p/o:0,r=x.length;return e.jsxs(k,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(k,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(U,{sx:{p:2},children:[e.jsx(c,{variant:"subtitle2",color:"text.secondary",children:"Total Orders"}),e.jsx(c,{variant:"h4",children:o})]})}),e.jsx(k,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(U,{sx:{p:2},children:[e.jsx(c,{variant:"subtitle2",color:"text.secondary",children:"Total Revenue"}),e.jsxs(c,{variant:"h4",children:["₹",p.toFixed(2)]})]})}),e.jsx(k,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(U,{sx:{p:2},children:[e.jsx(c,{variant:"subtitle2",color:"text.secondary",children:"Average Order Value"}),e.jsxs(c,{variant:"h4",children:["₹",v.toFixed(2)]})]})}),e.jsx(k,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(U,{sx:{p:2},children:[e.jsx(c,{variant:"subtitle2",color:"text.secondary",children:"Total Products"}),e.jsx(c,{variant:"h4",children:r})]})})]})},mt=()=>{const a=Me(),{items:x,loading:d,error:i}=X(S=>S.allOrdersForAnalytics),{items:o,loading:p,error:v}=X(S=>S.products),{items:r,loading:t,error:h}=X(S=>S.categories),[C,I]=g.useState(null),[u,n]=g.useState(null),{filterState:f,skuOptions:s,platformOptions:D,productOptions:M,filteredOrders:b,updateFilter:z,clearFilters:R}=Ye({allOrders:x,categories:r,products:o}),w=g.useMemo(()=>d||p||t,[d,p,t]),A=g.useMemo(()=>i||v||h,[i,v,h]);g.useEffect(()=>{(async()=>{const F=[];x.length===0&&!d&&!i&&F.push(a(we())),o.length===0&&!p&&!v&&F.push(a(Re({}))),r.length===0&&!t&&!h&&F.push(a(Ae())),F.length>0&&await Promise.all(F)})()},[x.length,d,i,o.length,p,v,r.length,t,h,a]);const l=g.useCallback(S=>{I(S.currentTarget)},[]),y=g.useCallback(()=>{I(null)},[]),j=g.useCallback(S=>{n(S.currentTarget)},[]),O=g.useCallback(()=>{n(null)},[]),T=g.useMemo(()=>[f.selectedCategory,f.selectedSku,f.selectedPlatform,f.selectedProduct].filter(Boolean).length,[f]),E=g.useMemo(()=>`${ne(f.dateRange.startDate,"dd MMM yyyy")} - ${ne(f.dateRange.endDate,"dd MMM yyyy")}`,[f.dateRange.startDate,f.dateRange.endDate]);return A?e.jsx(ae,{maxWidth:"xl",sx:{mt:4,mb:4},children:e.jsxs(c,{color:"error",variant:"h6",children:["Error: ",A]})}):e.jsx(We,{dateAdapter:Le,children:e.jsxs(ae,{maxWidth:"xl",sx:{mt:4,mb:4},children:[e.jsxs(m,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsx(c,{variant:"h4",children:"Order Analytics"}),e.jsxs(m,{display:"flex",gap:2,children:[e.jsx(L,{variant:"outlined",startIcon:e.jsx(ze,{}),onClick:j,sx:{textTransform:"none"},children:E}),e.jsx(pe,{onClick:l,color:T>0?"primary":"default",sx:{ml:1},children:e.jsx(ke,{badgeContent:T,color:"primary",children:e.jsx(Te,{})})})]})]}),e.jsx(Ge,{dateRange:f.dateRange,onDateRangeChange:(S,F)=>z("dateRange",{startDate:S,endDate:F}),anchorEl:u,onClose:O}),e.jsx(Ve,{anchorEl:C,onClose:y,categories:r,selectedCategory:f.selectedCategory,selectedSku:f.selectedSku,selectedPlatform:f.selectedPlatform,selectedProduct:f.selectedProduct,skuOptions:s,platformOptions:D,productOptions:M,onCategoryChange:S=>z("selectedCategory",S),onSkuChange:S=>z("selectedSku",S),onPlatformChange:S=>z("selectedPlatform",S),onProductChange:S=>z("selectedProduct",S),onClearFilters:R}),e.jsx(at,{orders:b,products:o,categories:r}),e.jsx(et,{orders:b,products:o,categories:r,filterState:f,onFilterUpdate:z,isLoading:w}),e.jsx(m,{mt:4,children:e.jsx(rt,{orders:b,products:o,categories:r,filterState:f,onFilterUpdate:z,isLoading:w})})]})})};export{mt as default};
