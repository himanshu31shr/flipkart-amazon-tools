import{j as e,B as n,A as W,C as E,a2 as S,J as B,h as o,af as O,ag as z,ah as N,aj as V,k as C,ac as Q,G as w,T as _,I as H,aV as de,aK as ue,X as A,a8 as M,Q as J,am as he,bg as xe,D as me,p as pe,r as ge,n as je,o as fe,S as ye}from"./mui-vendor-D4OjBZQt.js";import{a as i}from"./react-vendor-DYr15v6v.js";import{u as L,a as I,e as X,Z as Y,a1 as Z,h as P,a2 as ee,a3 as Ce,a4 as K,a5 as be,a6 as ve,l as Se,a0 as Ie}from"./index-BIOtAz8Z.js";import{D as Ge}from"./DataTable-EonKnU6y.js";import{u as ke,c as De,a as R}from"./index.esm-Cqya02Iw.js";import"./redux-vendor-CLOwJCHO.js";import"./firebase-vendor-OxXAdhiL.js";import"./utils-vendor-CFocuF-S.js";import"./pdf-vendor-CApBJrGQ.js";const We=({onEditGroup:g,onViewGroupDetails:b,refreshTrigger:a=0})=>{const u=L(),j=I(X),f=I(Y),h=I(Z),[y,c]=i.useState(!1),[r,x]=i.useState(null),G=[{id:"name",label:"Group Name",filter:!0,priorityOnMobile:!0,format:t=>e.jsxs(n,{display:"flex",alignItems:"center",children:[e.jsx(B,{sx:{mr:1,color:"text.secondary"}}),e.jsx(o,{variant:"subtitle1",fontWeight:"medium",children:String(t)})]})},{id:"color",label:"Color",align:"center",filter:!0,filterValue:t=>t.color,format:t=>e.jsx(Q,{label:String(t),size:"small",sx:{backgroundColor:String(t),color:m(String(t)),fontWeight:"medium",minWidth:80}})},{id:"categoryCount",label:"Categories",align:"center",format:(t,d)=>e.jsx(n,{display:"flex",alignItems:"center",justifyContent:"center",children:e.jsx(C,{variant:"outlined",size:"small",onClick:p=>{p.stopPropagation(),b(d)},startIcon:e.jsx(w,{sx:{fontSize:20}}),sx:{minWidth:80},children:String(t)})})},{id:"actions",label:"Actions",align:"center",format:(t,d)=>e.jsxs(n,{display:"flex",justifyContent:"center",gap:1,children:[e.jsx(_,{title:"Edit Group",children:e.jsx(H,{size:"small",onClick:p=>{p.stopPropagation(),g(d)},color:"primary",children:e.jsx(de,{})})}),e.jsx(_,{title:d.categoryCount>0?"Cannot delete group with categories":"Delete Group",children:e.jsx("span",{children:e.jsx(H,{size:"small",onClick:p=>{p.stopPropagation(),k(d)},color:"error",disabled:d.categoryCount>0,children:e.jsx(ue,{})})})})]})}];i.useEffect(()=>{u(P())},[u,a]),i.useEffect(()=>{if(h){const t=setTimeout(()=>{u(ee())},5e3);return()=>clearTimeout(t)}},[h,u]);const k=t=>{x(t),c(!0)},D=async()=>{if(r)try{await u(Ce(r.id)).unwrap(),c(!1),x(null)}catch{c(!1),x(null)}},s=()=>{c(!1),x(null)},m=t=>{const d=parseInt(t.slice(1,3),16),p=parseInt(t.slice(3,5),16),T=parseInt(t.slice(5,7),16);return(.299*d+.587*p+.114*T)/255>.5?"#000000":"#ffffff"};return e.jsxs(n,{children:[h&&e.jsx(W,{severity:"error",sx:{mb:2},children:h}),f&&j.length===0?e.jsx(n,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:200,children:e.jsx(E,{})}):j.length===0?e.jsxs(S,{sx:{p:4,textAlign:"center"},children:[e.jsx(B,{sx:{fontSize:48,color:"text.secondary",mb:2}}),e.jsx(o,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No Category Groups Found"}),e.jsx(o,{variant:"body2",color:"text.secondary",children:"Create your first category group to organize your categories with colors and descriptions."})]}):e.jsx(Ge,{columns:G,data:j,defaultSortColumn:"name",defaultSortDirection:"asc",rowsPerPageOptions:[10,25,50],defaultRowsPerPage:25,getRowId:t=>t.id}),e.jsxs(O,{open:y,onClose:s,children:[e.jsx(z,{children:"Delete Category Group"}),e.jsxs(N,{children:[e.jsxs(o,{children:['Are you sure you want to delete "',r==null?void 0:r.name,'"? This action cannot be undone.']}),(r==null?void 0:r.categoryCount)===0&&e.jsx(W,{severity:"info",sx:{mt:2},children:"This group has no categories assigned and can be safely deleted."})]}),e.jsxs(V,{children:[e.jsx(C,{onClick:s,children:"Cancel"}),e.jsx(C,{onClick:D,color:"error",variant:"contained",disabled:f,children:f?e.jsx(E,{size:20}):"Delete"})]})]})]})},we=De({name:R().required("Group name is required").min(2,"Name must be at least 2 characters").max(100,"Name must be 100 characters or less"),description:R().max(500,"Description must be 500 characters or less"),color:R().required("Color is required").matches(/^#[0-9A-F]{6}$/i,"Color must be a valid hex color")}),Be=({open:g,onClose:b,editingGroup:a,onSuccess:u})=>{const j=L(),f=I(Y),h=I(Z),[y,c]=i.useState(""),r=ke({initialValues:{name:"",description:"",color:K[0],currentInventory:0,inventoryUnit:"pcs",inventoryType:"qty",minimumThreshold:10},validationSchema:we,onSubmit:async s=>{try{a?await j(be({id:a.id,groupData:s})).unwrap():await j(ve(s)).unwrap(),x(),u==null||u()}catch(m){console.error("Failed to save category group:",m)}}});i.useEffect(()=>{g&&(a?(r.setValues({name:a.name,description:a.description,color:a.color,currentInventory:a.currentInventory,inventoryUnit:a.inventoryUnit,inventoryType:a.inventoryType,minimumThreshold:a.minimumThreshold}),c(a.color)):(r.resetForm(),c("")))},[g,a]);const x=()=>{r.resetForm(),c(""),b()},G=s=>{r.setFieldValue("color",s),c(s)},k=s=>{const m=s.target.value;c(m),m.match(/^#[0-9A-F]{6}$/i)&&r.setFieldValue("color",m)},D=s=>{try{const m=parseInt(s.slice(1,3),16),t=parseInt(s.slice(3,5),16),d=parseInt(s.slice(5,7),16);return(.299*m+.587*t+.114*d)/255>.5?"#000000":"#ffffff"}catch{return"#000000"}};return e.jsx(O,{open:g,onClose:x,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:e.jsxs("form",{onSubmit:r.handleSubmit,children:[e.jsx(z,{children:e.jsx(o,{variant:"h6",fontWeight:"bold",children:a?"Edit Category Group":"Create New Category Group"})}),e.jsxs(N,{dividers:!0,children:[h&&e.jsx(W,{severity:"error",sx:{mb:3},children:h}),e.jsxs(n,{sx:{mb:3},children:[e.jsx(A,{fullWidth:!0,label:"Group Name",name:"name",value:r.values.name,onChange:r.handleChange,onBlur:r.handleBlur,error:r.touched.name&&!!r.errors.name,helperText:r.touched.name&&r.errors.name,sx:{mb:3},placeholder:"e.g., Electronics, Books, Fashion"}),e.jsx(A,{fullWidth:!0,label:"Description",name:"description",multiline:!0,rows:3,value:r.values.description,onChange:r.handleChange,onBlur:r.handleBlur,error:r.touched.description&&!!r.errors.description,helperText:r.touched.description&&r.errors.description,sx:{mb:3},placeholder:"Describe this category group..."})]}),e.jsxs(n,{sx:{mb:2},children:[e.jsx(o,{variant:"subtitle1",fontWeight:"medium",gutterBottom:!0,children:"Select Color"}),e.jsxs(n,{sx:{mb:2},children:[e.jsx(o,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Predefined Colors"}),e.jsx(M,{container:!0,spacing:1,children:K.map(s=>e.jsx(M,{item:!0,children:e.jsx(S,{sx:{width:40,height:40,backgroundColor:s,cursor:"pointer",border:r.values.color===s?"3px solid #1976d2":"1px solid #ddd",borderRadius:1,display:"flex",alignItems:"center",justifyContent:"center","&:hover":{transform:"scale(1.1)"},transition:"all 0.2s ease"},onClick:()=>G(s),children:r.values.color===s&&e.jsx(o,{sx:{color:D(s),fontSize:"18px",fontWeight:"bold"},children:"âœ“"})})},s))})]}),e.jsxs(n,{children:[e.jsx(o,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Custom Color"}),e.jsxs(n,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(A,{label:"Hex Color",value:y,onChange:k,placeholder:"#FF5722",error:r.touched.color&&!!r.errors.color,helperText:r.touched.color&&r.errors.color,sx:{minWidth:120}}),y&&y.match(/^#[0-9A-F]{6}$/i)&&e.jsx(S,{sx:{width:40,height:40,backgroundColor:y,border:"1px solid #ddd",borderRadius:1}})]})]}),r.values.color&&e.jsxs(n,{sx:{mt:2},children:[e.jsx(o,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Preview"}),e.jsxs(S,{sx:{p:2,backgroundColor:r.values.color,color:D(r.values.color),borderRadius:2,maxWidth:200},children:[e.jsx(o,{variant:"subtitle1",fontWeight:"bold",children:r.values.name||"New Category Group"}),e.jsx(o,{variant:"body2",sx:{opacity:.9},children:r.values.description||"Enter a description for this group"})]})]})]})]}),e.jsxs(V,{sx:{p:2},children:[e.jsx(C,{onClick:x,disabled:f,children:"Cancel"}),e.jsx(C,{type:"submit",variant:"contained",disabled:f||!r.isValid,children:f?e.jsx(E,{size:20}):a?"Update Group":"Create Group"})]})]})})},Le=()=>{const g=L(),b=I(Se),a=I(X),[u,j]=i.useState(!1),[f,h]=i.useState(null),[y,c]=i.useState(!1),[r,x]=i.useState(null),[G,k]=i.useState([]),[D,s]=i.useState(0),[m,t]=i.useState(!1),[d,p]=i.useState(""),[T,F]=i.useState("success"),re=new Ie;i.useEffect(()=>{b&&g(P())},[g,b]);const q=()=>{g(P()),s(l=>l+1)},te=()=>{h(null),j(!0)},se=l=>{h(l),j(!0)},oe=()=>{j(!1),h(null),g(ee())},ne=()=>{p(f?"Category group updated successfully!":"Category group created successfully!"),F("success"),t(!0),q()},ae=async l=>{x(l);try{const v=await re.getCategoriesByGroup(l.id);k(v),c(!0)}catch(v){p("Failed to load group details"),F("error"),t(!0),console.error("Failed to load group details:",v)}},U=()=>{c(!1),x(null),k([])},$=()=>{t(!1)},ie=l=>{try{const v=parseInt(l.slice(1,3),16),le=parseInt(l.slice(3,5),16),ce=parseInt(l.slice(5,7),16);return(.299*v+.587*le+.114*ce)/255>.5?"#000000":"#ffffff"}catch{return"#000000"}};return b?e.jsxs(J,{maxWidth:"xl",sx:{py:3},children:[e.jsxs(S,{sx:{p:3,mb:4,borderRadius:2},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(B,{sx:{fontSize:32,mr:2,color:"primary.main"}}),e.jsx(o,{variant:"h4",component:"h1",sx:{fontWeight:"bold",color:"primary.dark"},children:"Category Groups"}),e.jsx(n,{sx:{flexGrow:1}}),e.jsx(C,{variant:"outlined",onClick:q,startIcon:e.jsx(he,{}),sx:{mr:2,fontWeight:"medium"},children:"Refresh"}),e.jsx(C,{variant:"contained",onClick:te,startIcon:e.jsx(xe,{}),sx:{fontWeight:"medium"},children:"Create Group"})]}),e.jsx(me,{sx:{mb:3}}),e.jsxs(n,{sx:{mb:3,display:"flex",gap:3,flexWrap:"wrap"},children:[e.jsx(S,{sx:{p:2,minWidth:200,borderRadius:2},children:e.jsxs(n,{display:"flex",alignItems:"center",children:[e.jsx(B,{sx:{color:"primary.main",mr:1}}),e.jsxs(n,{children:[e.jsx(o,{variant:"h5",fontWeight:"bold",children:a.length}),e.jsx(o,{variant:"body2",color:"text.secondary",children:"Total Groups"})]})]})}),e.jsx(S,{sx:{p:2,minWidth:200,borderRadius:2},children:e.jsxs(n,{display:"flex",alignItems:"center",children:[e.jsx(w,{sx:{color:"success.main",mr:1}}),e.jsxs(n,{children:[e.jsx(o,{variant:"h5",fontWeight:"bold",children:a.reduce((l,v)=>l+v.categoryCount,0)}),e.jsx(o,{variant:"body2",color:"text.secondary",children:"Assigned Categories"})]})]})})]}),e.jsx(We,{onEditGroup:se,onViewGroupDetails:ae,refreshTrigger:D})]}),e.jsx(Be,{open:u,onClose:oe,editingGroup:f,onSuccess:ne}),e.jsxs(O,{open:y,onClose:U,maxWidth:"sm",fullWidth:!0,children:[e.jsx(z,{children:e.jsxs(n,{display:"flex",alignItems:"center",gap:2,children:[r&&e.jsx(Q,{label:r.name,sx:{backgroundColor:r.color,color:ie(r.color),fontWeight:"bold"}}),e.jsx(o,{variant:"h6",children:"Group Details"})]})}),e.jsxs(N,{dividers:!0,children:[r&&e.jsxs(n,{sx:{mb:3},children:[e.jsxs(o,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Description:"})," ",r.description||"No description"]}),e.jsxs(o,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Color:"})," ",r.color]}),e.jsxs(o,{variant:"body1",gutterBottom:!0,children:[e.jsx("strong",{children:"Categories:"})," ",r.categoryCount]})]}),e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Associated Categories"}),G.length===0?e.jsxs(n,{sx:{p:2,textAlign:"center",bgcolor:"grey.50",borderRadius:1},children:[e.jsx(w,{sx:{fontSize:40,color:"text.secondary",mb:1}}),e.jsx(o,{variant:"body2",color:"text.secondary",children:"No categories assigned to this group yet."})]}):e.jsx(pe,{dense:!0,children:G.map(l=>e.jsxs(ge,{children:[e.jsx(je,{children:e.jsx(w,{fontSize:"small"})}),e.jsx(fe,{primary:l.name})]},l.id))})]}),e.jsx(V,{children:e.jsx(C,{onClick:U,children:"Close"})})]}),e.jsx(ye,{open:m,autoHideDuration:6e3,onClose:$,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(W,{onClose:$,severity:T,sx:{width:"100%"},children:d})})]}):e.jsx(J,{maxWidth:"xl",sx:{py:3},children:e.jsx(W,{severity:"warning",children:"Please log in to manage category groups."})})};export{Le as default};
